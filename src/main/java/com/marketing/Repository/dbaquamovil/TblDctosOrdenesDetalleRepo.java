package com.marketing.Repository.dbaquamovil;

import java.sql.Timestamp;
import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.marketing.Model.dbaquamovil.TblDctosOrdenesDetalle;
import com.marketing.Projection.TblDctosDTO;
import com.marketing.Projection.TblDctosOrdenesDetalleDTO;
import com.marketing.Projection.TblDctosOrdenesDetalleDTO2;
import com.marketing.Projection.TblMailMarketingReporteDTO;
import com.marketing.Projection.TblTercerosProjectionDTO;

@Repository
public interface TblDctosOrdenesDetalleRepo extends JpaRepository<TblDctosOrdenesDetalle, Integer> {

	// Modificamos el IDTIPOORDEN de 67 a 17
	  @Modifying
	  @Transactional
	  @Query(value = "UPDATE tblDctosOrdenesDetalle SET IDTIPOORDEN = 17, item = 1 " +
	                 "WHERE IDTIPOORDEN = 67 AND tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2", nativeQuery = true)
	  public void actualizarIdTipoOrdenDetalle(int idLocal, int IDORDEN);
	  
	  
	// Eliminamos los registros del IDORDEN de ese momento
		  @Modifying
		  @Transactional
		  @Query(value = "DELETE FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
		                 "AND tblDctosOrdenesDetalle.IDTIPOORDEN = 67", nativeQuery = true)
		  public void eliminarRegistros(int idLocal, int IDORDEN);
	  
		  
		  @Query(value = "SELECT NOMBREPLU " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
	                 "AND tblDctosOrdenesDetalle.idCliente = ?3", nativeQuery = true)
		  List<String> ObtenerNombresPlus(int idLocal, int IDORDEN, int idCliente);
		  
		  @Query(value = "SELECT DISTINCT comentario " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
	                 "AND tblDctosOrdenesDetalle.idCliente = ?3", nativeQuery = true)
		  String ObtenerComentario(int idLocal, int IDORDEN, int idCliente);
		  
		  @Query(value = "SELECT * " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
	                 "AND tblDctosOrdenesDetalle.IDTIPOORDEN = 17 "
	                 , nativeQuery = true)
		  List<TblDctosOrdenesDetalleDTO> ObtenerInfoPQR(int idLocal, int IDORDEN);
		  
		  
		  @Query(value = "SELECT tblDctosOrdenesDetalle.item " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
	                 "AND tblDctosOrdenesDetalle.IDTIPOORDEN = 17 "
	                 , nativeQuery = true)
		  List<String> ObtenerItems(int idLocal, int IDORDEN);
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tblDctosOrdenesDetalle SET ESTADO = 9 " +
		                 "WHERE IDTIPOORDEN = 17 AND tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2", nativeQuery = true)
		  public void actualizarEstadoDetalle(int idLocal, int IDORDEN);
		  
		  
		  @Query(value = "SELECT DISTINCT IDORDEN " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.ESTADO = 9 " 
	                 , nativeQuery = true)
		  Integer ObtenerIdOrdenEstado9(int idLocal);
		  
		  @Query(value = "SELECT ESTADO " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.item = 2 " 
	                 , nativeQuery = true)
		  List<String> ObtenerEstado9(int idLocal);
		  
		  @Query(value = "SELECT DISTINCT comentario " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
	                 "AND tblDctosOrdenesDetalle.idCliente = ?3 " +
	                 "AND tblDctosOrdenesDetalle.item = 2 ", nativeQuery = true)
		  String ObtenerComentarioRespuesta(int idLocal, int IDORDEN, String idCliente);
		  
		  @Query(value = "SELECT DISTINCT comentario " +
	                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
	                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
	                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
	                 "AND tblDctosOrdenesDetalle.idCliente = ?3 " +
	                 "AND tblDctosOrdenesDetalle.item = 1 ", nativeQuery = true)
		  String ObtenerComentarioPQR(int idLocal, int IDORDEN, String idCliente);
		  
			// Eliminamos los registros del IDORDEN de la respuesta de ese momento
		  @Modifying
		  @Transactional
		  @Query(value = "DELETE FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
		                 "AND tblDctosOrdenesDetalle.IDTIPOORDEN = 17 " +
		                 "AND tblDctosOrdenesDetalle.item = 2 ", nativeQuery = true)
		  public void eliminarRegistrosRespuesta(int idLocal, int IDORDEN);
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tblDctosOrdenesDetalle SET ESTADO = 1 " +
		                 "WHERE IDTIPOORDEN = 17 AND tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
		                 "AND tblDctosOrdenesDetalle.idCliente = ?3", nativeQuery = true)
		  public void actualizarEstadoDetalleFinal(int idLocal, int IDORDEN, String idCliente);
		  
		  
			@Query(
					value = "SELECT tblDctosOrdenesDetalle.NOMBREPLU " +
							"FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
							"JOIN bdaquamovil.dbo.tblPlus "+
							"ON tblPlus.idLocal  = tblDctosOrdenesDetalle.IDLOCAL " +
							"AND tblPlus.idPlu  = tblDctosOrdenesDetalle.idPlu " +
							"WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
							"AND tblDctosOrdenesDetalle.IDORDEN = ?2 " +
							"AND tblDctosOrdenesDetalle.idCliente = ?3 " +
							"AND tblPlus.idCategoria = ?4 " +
							"AND tblPlus.idLinea = 200 " + 
							"AND tblDctosOrdenesDetalle.idTipoOrden = 17 ",
					nativeQuery = true
					)

			String ObtenerNombrePlu(int idLocal, int IDORDEN, String idCliente, int idCategoria);
			
			
			
			  @Modifying
			  @Transactional
			  @Query(value = "SELECT MAX(t1.IDLOCAL) AS idLocal,  " +
			                 "?2   AS idPeriodo, " +
			                 "t1.idCliente, " +
			                 "('c'+ " +
			                 "CAST(tbldctosordenes.idPeriodo AS VARCHAR(100)) " +
			                 "+'g'+ " +
			                 "CAST(SUM(t1.CANTIDAD) AS VARCHAR(100))) " +
			                 "AS historicoConsumo " +
			                 "INTO tmp_historicoConsumo " +
			                 "FROM tbldctosordenesdetalle t1 " +
			                 "INNER JOIN  tblterceros " +
			                 "ON t1.IDLOCAL = tblterceros.idLocal " +
			                 "AND t1.idCliente =  tblterceros.idCliente " +
			                 "INNER JOIN tbldctosordenes " +
			                 "ON t1.IDLOCAL = tbldctosordenes.IDLOCAL " +
			                 "AND t1.IDTIPOORDEN =  tbldctosordenes.IDTIPOORDEN " +
			                 "AND t1.IDORDEN =  tbldctosordenes.IDORDEN " +
			                 "WHERE t1.IDLOCAL = ?1 " +
			                 "AND t1.IDTIPOORDEN =  9 " +
			                 "AND tbldctosordenes.idPeriodo IN (?3) " +
			                 "AND t1.IDTIPO = 4 " +
			                 "GROUP BY t1.idCliente, tbldctosordenes.idPeriodo " +
			                 "ORDER BY t1.idCliente "
			                 , nativeQuery = true)
			  public void creaTablaHistoricoConsumo(int idLocal, int xIdPeriodo, List<String> xIdPeriodoLista);
			
			
			
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle " +
			                 "FROM  tbldctosordenes " +
			                 "JOIN tbldctosordenesdetalle " +
			                 "ON tbldctosordenes.IDLOCAL  =  tbldctosordenesdetalle.IDLOCAL " +
			                 "AND tbldctosordenes.IDTIPOORDEN = tbldctosordenesdetalle.IDTIPOORDEN  " +
			                 "AND tbldctosordenes.IDORDEN  = tbldctosordenesdetalle.IDORDEN " +
			                 "WHERE  tbldctosordenes.IDLOCAL  = ?1 " +
			                 "AND tbldctosordenes.IDTIPOORDEN  IN (7,9,29, 59) " +			                 
			                 "AND tbldctosordenes.idPeriodo  = ?2 ", nativeQuery = true)
			  public void retiraOrdenesDetalle(int idLocal, int idPeriodo);
			
			
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle " +
			                 "SET  itemPadre = 1 " +
			                 ",tbldctosordenesdetalle.estado = 0 " +
			                 "FROM tbldctosordenes " +
			                 "JOIN tbldctosordenesdetalle " +
			                 "ON tbldctosordenes.IDLOCAL  =  tbldctosordenesdetalle.IDLOCAL " +
			                 "AND tbldctosordenes.IDTIPOORDEN =  tbldctosordenesdetalle.IDTIPOORDEN " +
			                 "AND tbldctosordenes.IDORDEN   =   tbldctosordenesdetalle.IDORDEN " +
			                 "WHERE tbldctosordenes.IDLOCAL   =   ?1 " +
			                 "AND  tbldctosordenes.IDTIPOORDEN = 7 " +
			                 "AND  tbldctosordenesdetalle.itempadre =  ?2 " +
			                 "AND tbldctosordenesdetalle.itemPadre !=1 ", nativeQuery = true)
			  public void recuperaOrdenesFinaciacion(int idLocal, int idPeriodo);
			
			
			
			
			  @Query(value = "SELECT tbldctosordenesdetalle.idLocal,                    " 
					  + "   tbldctosordenesdetalle.idTipo,                       "
					  + "   tbldctosordenesdetalle.idPlu,                        "
					  + "   SUM(tbldctosordenesdetalle.cantidad *                "
					  + "             vrVentaUnitario) AS vrBase,                "
					  + "   MAX(tmpCAT.NOMBREPLU) AS nombrePlu,                  "
					  + "   MAX(tmpPRO.nombreProducto) AS nombreServicio         "
					  + "  FROM       tbldctosordenesdetalle                     "
					  + "  INNER JOIN tbldctos                                   "
					  + "  ON tbldctos.idLocal     =                             "
					  + "    tbldctosordenesdetalle.IDLOCAL                      "
					  + "  AND tbldctos.idtipoorden=                             "
					  + "            tbldctosordenesdetalle.idtipoorden          "
					  + "  AND tbldctos.idorden    =                             "
					  + "    tbldctosordenesdetalle.idorden                      "
					  + "  INNER JOIN                                            "
					  + "  (SELECT tblplus.idLocal,                              "
					  + "     tblplus.idPlu,                                     "
					  + "   (tblcategorias.nombreCategoria + ' ' +               "
					  + "     tblplus.nombrePlu) AS nombrePlu                    "
					  + "  FROM  tblcategorias                                   "
					  + "  INNER JOIN tblplus                                    "
					  + "  ON tblcategorias.idLocal = tblplus.idLocal            "
					  + "  AND tblcategorias.idLinea = tblplus.idLinea           "
					  + "  AND tblcategorias.IdCategoria =                       "
					  + "              tblplus.idCategoria) AS tmpCAT            "
					  + "  ON tmpCAT.idLocal =                                   "
					  + "    tbldctosordenesdetalle.idLocal                      "
					  + "  AND tmpCAT.idPlu  =                                   "
					  + "      tbldctosordenesdetalle.idPlu                      "
					  + "  INNER JOIN tblterceros                                "
					  + "  ON tblterceros.idCliente =                            "
					  + "               tbldctos.idCliente                       "
					  + "  AND tbldctos.idLocal = tblterceros.idLocal            "
					  + "  AND   tblterceros.idTipoTercero = 1                   "
					  + " INNER JOIN (                                           "
					  + " SELECT  tblPlus.idLocal,                               "
					  + "   tblPlus.idPlu,                                       "
					  + "   tblCategorias.idProducto,                            "
					  + "   tblTipoCausaNota.nombreCausa AS nombreProducto       "
					  + " FROM tblCategorias                                     "
					  + " INNER JOIN tblPlus                                     "
					  + " ON tblCategorias.idLocal = tblPlus.idLocal             "
					  + " AND tblCategorias.idLinea = tblPlus.idLinea            "
					  + " AND tblCategorias.IdCategoria = tblPlus.idCategoria    "
					  + " INNER JOIN tblTipoCausaNota                            "
					  + " ON tblCategorias.idProducto = tblTipoCausaNota.idCausa "
					  + " WHERE tblTipoCausaNota.idTipoTabla = 10 ) AS tmpPRO    "
					  + " ON tmpPRO.idLocal = tbldctosordenesdetalle.idLocal     "
					  + " AND tmpPRO.idPlu = tbldctosordenesdetalle.idPlu        "
					  + " WHERE EXISTS                                           "
					  + "    ( SELECT *                                          "
					  + "      FROM   tbldctosordenes                            "
					  + "      INNER JOIN tbldctosordenesdetalle                 "
					  + "      ON tbldctosordenes.IDLOCAL      =                 "
					  + "         tbldctosordenesdetalle.IDLOCAL                 "
					  + "      AND tbldctosordenes.IDTIPOORDEN =                 "
					  + "         tbldctosordenesdetalle.IDTIPOORDEN             "
					  + "      AND tbldctosordenes.IDORDEN     =                 "
					  + "         tbldctosordenesdetalle.IDORDEN                 "
					  + "      WHERE tbldctosordenes.IDLOCAL   =                 "
					  + "               tbldctos.IDLOCAL                         "
					  + "      AND tbldctosordenes.IDTIPOORDEN =                 "
					  + "           tbldctos.IDTIPOORDEN                         "
					  + "      AND tbldctosordenes.IDORDEN     =                 "
					  + "              tbldctos.IDORDEN)                         "
					  + " AND tbldctos.idLocal   =                               "
					  + " ?1                                 "
		                + " AND tbldctos.idTipoOrden IN                 ("
		                + "?2 ,                       "
		                + "?3 )                       "
		                + " AND tbldctos.idPeriodo   =                   "
		                + "?4                             "           
					  + " AND (tbldctosordenesdetalle.cantidad *                 "
					  + "                       vrVentaUnitario) != 0            "
					  + " GROUP BY tbldctosordenesdetalle.idLocal,               "
					  + "          tbldctosordenesdetalle.idTipo,                "
					  + " 		 tbldctosordenesdetalle.idPlu                  "
					  + " HAVING                                                 "
					  + "      SUM(tbldctosordenesdetalle.cantidad *             "
					  + "                  vrVentaUnitario) != 0                 "
					  + " ORDER BY tbldctosordenesdetalle.idLocal,               "
					  + "          nombreServicio,                               "
					  + "          idTipo,                                       "
					  + " 	      idPlu", nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaRubroAgrupado(int idLocal, int IdTipoOrdenINI, int IdTipoOrdenFIN, int idPeriodo);
			  
			  
			  
			  @Query(value = "SELECT tbldctos.idLocal,                    "
		                + "       tbldctos.idTipoOrden,                "
		                + "       tbldctos.idDcto,                     "
		                + "       MAX(tbldctos.idCliente) AS           "
		                + "		                   idCliente,  "
		                + "	  MAX(tmpTER.nombreTercero) AS         "
		                + "		                nombreTercero, "
		                + "       MAX(tmpTER.nombreRuta) AS            "
		                + "		                  nombreRuta,  "
		                + "	  MAX(tmpTER.nombreEstracto) AS        "
		                + "		               nombreEstracto, "
		                + "       tbldctosordenesdetalle.idPlu,        "
		                + "      SUM(tbldctosordenesdetalle.cantidad * "
		                + "                vrVentaUnitario) AS vrBase, "
		                + "       MAX(NOMBREPLU) AS nombrePlu          "
		                + "FROM tbldctosordenesdetalle                 "
		                + "INNER JOIN tbldctos                         "
		                + "ON [tbldctos].idLocal     =                 "
		                + " tbldctosordenesdetalle.IDLOCAL "
		                + "AND [tbldctos].idtipoorden=                 "
		                + "         tbldctosordenesdetalle.idtipoorden "
		                + "AND [tbldctos].idorden    =                 "
		                + "tbldctosordenesdetalle.idorden  "
		                + "INNER JOIN                                  "
		                + "( SELECT tblterceros.idLocal,               "
		                + "       tblterceros.idCliente,               "
		                + "	   tblterceros.nombreTercero,          "
		                + "	   (tbltercerosruta.nombreCiclo+' '+   "
		                + "	   tbltercerosruta.nombreRuta)         "
		                + "	                      AS nombreRuta,   "
		                + "	   tblterceroestracto.nombreEstracto   "
		                + "FROM     tblterceros                        "
		                + "INNER JOIN tbltercerosruta                  "
		                + "ON tblterceros.idLocal                      "
		                + "                = tbltercerosruta.idLocal   "
		                + "AND tblterceros.idRuta                      "
		                + "                 = tbltercerosruta.idRuta   "
		                + "INNER JOIN  tblterceroestracto              "
		                + "ON tblterceros.idLocal =                    "
		                + "  tblterceroestracto.idLocal    "
		                + "AND tblterceros.idEstracto =                "
		                + "           tblterceroestracto.idEstracto )  "
		                + "		                     AS tmpTER "
		                + "ON tmpTER.idCliente  = tbldctos.idCliente   "
		                + "AND tmpTER.idLocal   = tbldctos.idLocal     "
		                + "WHERE tbldctos.idLocal            =         "
		                +" ?1                              "
		                + " AND tbldctos.idTipoOrden IN               ("
		                + "?2 ,                     "
		                + "?3 )                     "
		                + "AND tbldctos.idPeriodo =                    "
		                + "?4                            "
		                + "AND tbldctosordenesdetalle.idEstracto  =    "
		                + "?5                           "
		                + "AND (tbldctosordenesdetalle.cantidad *      "
		                + "           vrVentaUnitario) != 0            "
		                + "GROUP BY tbldctos.IDdcto,                   "
		                + "         IDPLU,                             "
		                + "         tbldctos.idLocal,                  "
		                + "       tbldctos.idTipoOrden                 "
		                + "HAVING SUM(tbldctosordenesdetalle.cantidad * "
		                + "                 vrVentaUnitario)!=0        "
		                + "ORDER BY tbldctos.idLocal,                  "
		                + "         tbldctos.idtipoOrden,              "
		                + "         tbldctos.idDcto", nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaDetalleRubroEstrato(int idLocal, int IdTipoOrdenINI, int IdTipoOrdenFIN, int idPeriodo, int idEstrato);
			  
			  
			  
			  @Query(value = " SELECT tbldctos.idLocal,                       "     
					  + "    tbldctos.idTipoOrden,                     "
					  + "    tbldctos.idDcto,                          "
					  + "    MAX(tbldctos.idCliente) AS                "
					  + "                     idCliente,               "
					  + "    MAX(tmpTER.nombreTercero) AS              "
					  + "                  nombreTercero,              "
					  + "    MAX(tmpTER.nombreRuta) AS                 "
					  + "                    nombreRuta,               "
					  + "    MAX(tmpTER.nombreEstracto) AS             "
					  + "                 nombreEstracto,              "
					  + "    tbldctosordenesdetalle.idPlu,             "
					  + "   CONVERT(DECIMAL(12, 2),                    "              
					  + "   SUM(tbldctosordenesdetalle.cantidad *      "
					  + "      vrVentaUnitario)) AS vrBase,            "              
					  + "    LTRIM(STR(tbldctosordenesdetalle.idPlu))  "
					  + "   +'-'+ MAX(tmpCAT.nombrePlu) AS nombrePlu,  "  
					  + "   MAX(tmpTER.CC_Nit) AS CC_Nit,              "
					  + "   tmpCAT.idProducto                          "
					  + "  FROM tbldctosordenesdetalle                 "
					  + "  INNER JOIN tbldctos                         "
					  + "  ON [tbldctos].idLocal     =                 "
					  + "   tbldctosordenesdetalle.IDLOCAL             "
					  + "  AND [tbldctos].idtipoorden=                 "
					  + "       tbldctosordenesdetalle.idtipoorden     "
					  + "  AND [tbldctos].idorden    =                 "
					  + "  tbldctosordenesdetalle.idorden              "
					  + "  INNER JOIN                                  "
					  + "  ( SELECT tblterceros.idLocal,               "
					  + "    tblterceros.idCliente,                    "
					  + "    tblterceros.nombreTercero,                "
					  + "    (tbltercerosruta.nombreCiclo+' '+         "
					  + "    tbltercerosruta.nombreRuta)               "
					  + "                       AS nombreRuta,         "
					  + "    tblterceroestracto.nombreEstracto,        "
					  + "     tblterceros.CC_Nit                       "
					  + "  FROM     tblterceros                        "
					  + "  INNER JOIN tbltercerosruta                  "
					  + "  ON tblterceros.idLocal                      "
					  + "                  = tbltercerosruta.idLocal   "
					  + "  AND tblterceros.idRuta                      "
					  + "                   = tbltercerosruta.idRuta   "
					  + "  INNER JOIN  tblterceroestracto              "
					  + "  ON tblterceros.idLocal =                    "
					  + "    tblterceroestracto.idLocal                "
					  + "  AND tblterceros.idEstracto =                "
					  + "             tblterceroestracto.idEstracto )  "
					  + "  		                     AS tmpTER   "
					  + "  ON tmpTER.idCliente  = tbldctos.idCliente   "
					  + "  AND tmpTER.idLocal   = tbldctos.idLocal     "
					  + " INNER JOIN				         "
					  + "  ( SELECT tblCategorias.idLocal,             "
					  + "     tblPlus.idPlu,                           "
					  + "     tblCategorias.idProducto,                "
					  + "     tblCategorias.nombreCategoria + ' ' +    "
					  + " 	   tblPlus.nombrePlu AS nombrePlu        "
					  + " FROM        tblCategorias                    "
					  + " INNER JOIN  tblPlus                          "
					  + " ON tblCategorias.idLocal      =              "
					  + "                   tblPlus.idLocal            "
					  + " AND tblCategorias.idLinea     =              "
					  + "                   tblPlus.idLinea            "
					  + " AND tblCategorias.IdCategoria =              "
					  + "  tblPlus.idCategoria ) AS tmpCAT             "
					  + "  ON tmpCAT.idLocal =                         "
					  + "       tbldctosordenesdetalle.idLocal         "
					  + "  AND tmpCAT.idPlu  =                         "
					  + "            tbldctosordenesdetalle.idPlu      "
					  + "  WHERE tbldctos.idLocal            =         " 
					  + "?1                                "                
					  + "AND tbldctos.idTipoOrden  BETWEEN             "
					  + "?2  AND                    "
					  + "?3                         "
					  + "  AND tbldctos.idPeriodo =                    "   
					  + "?4                              "                
					  + "  AND (tbldctosordenesdetalle.cantidad *      "
					  + "             vrVentaUnitario) != 0            "
					  + "  GROUP BY tbldctos.IDdcto,                   "
					  + "           tbldctosordenesdetalle.IDPLU,      "                       
					  + "           tbldctos.idLocal,                  " 
					  + "           tbldctos.idTipoOrden,              "
					  + "          tmpCAT.idProducto                   "
					  + " HAVING SUM(tbldctosordenesdetalle.cantidad * " 
					  + "                   vrVentaUnitario)!=0        "
					  + "  ORDER BY tbldctos.idLocal,                  "
					  + "           tbldctos.idtipoOrden,              "
					  + "           tbldctos.idDcto,                   "
					  + "  	 tmpCAT.idProducto  ", nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaDetalleRubro(int idLocal, int IdTipoOrdenINI, int IdTipoOrdenFIN, int idPeriodo);
			  
			  
			  
			  @Query(value = " SELECT tmpDET.idLocal,                           "
					  + " 	   tblTerceroEstracto.nombreEstracto,      "
					  + " 	   tmpDET.idCliente,                       "
					  + " 	   tblTerceros.nombreTercero,              "
					  + " 	   tmpDET.grupo AS nombreDcto,             "
					  //+ " 	   tmpDET.idDcto,                          "
					  + " 	   tmpDET.idPlu,                           "
					  + " 	   tmpDET.nombrePlu,                       "
					  + " 	   tmpDET.vrVenta AS vrVentaConIva         "
					  + " FROM  tblTerceros                              "
					  + " INNER JOIN                                     "
					  + " (SELECT  tblDctosOrdenesDetalle.idLocal,       "
					  //+ "  tblDctos.idDcto,                              "
					  + "  tblDctosOrdenesDetalle.idPlu,                 "
					  + "  MAX(tblDctos.idCliente) AS idCliente,         "
					  + "  MAX(tmpPRO.nombrePlu) AS nombrePlu ,          "
					  + "  SUM( tblDctosOrdenesDetalle.VRVENTAUNITARIO * "
					  + "  tblDctosOrdenesDetalle.cantidad ) AS vrVenta, "
					  + " 	 'Factura' AS grupo,                       "
					  + " 	 tblDctos.idPeriodo                        "
					  + " FROM            tblDctos                       "
					  + " INNER JOIN tblDctosOrdenesDetalle              "
					  + " ON tblDctos.IDLOCAL      =                     "
					  + "      tblDctosOrdenesDetalle.IDLOCAL            "
					  + " AND tblDctos.IDTIPOORDEN =                     "
					  + "    tblDctosOrdenesDetalle.IDTIPOORDEN          "
					  + " AND tblDctos.IDORDEN     =                     "
					  + "      tblDctosOrdenesDetalle.IDORDEN            "
					  + " INNER JOIN (                                   "
					  + " SELECT tblPlus.idLocal,                        "
					  + "   tblPlus.idPlu,                               "
					  + "   tblCategorias.nombreCategoria + ' ' +        "
					  + "   tblPlus.nombrePlu AS nombrePlu,              "
					  + "   tblCategorias.idProducto                     "
					  + " FROM            tblCategorias                  "
					  + " INNER JOIN tblPlus                             "
					  + " ON tblCategorias.idLocal      =                "
					  + "                 tblPlus.idLocal                "
					  + " AND tblCategorias.idLinea     =                "
					  + "                 tblPlus.idLinea                "
					  + " AND tblCategorias.IdCategoria =                "
					  + "          tblPlus.idCategoria ) AS tmpPRO	   "
					  + " ON tmpPRO.idLocal         =                    "
					  + "        tblDctosOrdenesDetalle.idLocal          "
					  + " AND tmpPRO.idPlu          =                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " WHERE tblDctos.IDTIPOORDEN =  9                "
					  + " AND   tmpPRO.idProducto    =                   "
					  + " ?1                            "                
					  + " GROUP BY tblDctosOrdenesDetalle.idLocal,       "
					  + "         tblDctos.idCliente,                    "
					  + "         tblDctos.idPeriodo,                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " UNION                                          "
					  + " SELECT  tblDctosOrdenesDetalle.idLocal,        "
					  //+ "    tblDctos.idDcto,                            "
					  + "    tblDctosOrdenesDetalle.idPlu,               "
					  + "    MAX(tblDctos.idCliente) AS idCliente,       "
					  + "  MAX(tmpPRO.nombrePlu) AS nombrePlu ,          "
					  + "  SUM( tblDctosOrdenesDetalle.VRVENTAUNITARIO * "
					  + "  tblDctosOrdenesDetalle.cantidad ) AS vrVenta, "
					  + "    'Nota' AS grupo,                            "
					  + "    tblDctos.idPeriodo                          "
					  + " FROM            tblDctos                       "
					  + " INNER JOIN tblDctosOrdenesDetalle              "
					  + " ON tblDctos.IDLOCAL      =                     "
					  + "      tblDctosOrdenesDetalle.IDLOCAL            "
					  + " AND tblDctos.IDTIPOORDEN =                     "
					  + "    tblDctosOrdenesDetalle.IDTIPOORDEN          "
					  + " AND tblDctos.IDORDEN     =                     "
					  + "      tblDctosOrdenesDetalle.IDORDEN            "
					  + " INNER JOIN (                                   "
					  + " SELECT tblPlus.idLocal,                        "
					  + "   tblPlus.idPlu,                               "
					  + "   tblCategorias.nombreCategoria + ' ' +        "
					  + "   tblPlus.nombrePlu AS nombrePlu,              "
					  + "   tblCategorias.idProducto                     "
					  + " FROM            tblCategorias                  "
					  + " INNER JOIN tblPlus                             "
					  + " ON tblCategorias.idLocal      =                "
					  + "                 tblPlus.idLocal                "
					  + " AND tblCategorias.idLinea     =                "
					  + "                 tblPlus.idLinea                "
					  + " AND tblCategorias.IdCategoria =                "
					  + "             tblPlus.idCategoria ) AS tmpPRO	   "
					  + " ON tmpPRO.idLocal         =                    "
					  + "        tblDctosOrdenesDetalle.idLocal          "
					  + " AND tmpPRO.idPlu          =                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " WHERE tblDctos.IDTIPOORDEN =  29               "
					  + " AND   tmpPRO.idProducto    =                   "
					  + " ?1                              "                     
					  + " GROUP BY tblDctosOrdenesDetalle.idLocal,       "
					  + "         tblDctos.idCliente,                    "
					  + "         tblDctos.idPeriodo,                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " UNION                                          "
					  + " SELECT  tblPagosMedios.idLocal,                "
					  //+ "   tblPagos.idDcto,                             "
					  + "   tblPagosMedios.idPlu,                        "
					  + "   MAX(tblPagos.nitCC) AS idCliente,            "
					  + "   MAX(tmpPRO.nombrePlu) AS nombrePlu ,         "
					  + "   SUM( tblPagosMedios.vrMedio*(-1))            "
					  + "                           AS vrVenta,          "
					  + "  'Pago' AS grupo,                              "
					  + "  tblPagos.idPeriodo                            "
					  + " FROM    tblPagos                               "
					  + " INNER JOIN tblPagosMedios                      "
					  + " ON tblPagos.idLocal      =                     "
					  + "         tblPagosMedios.idLocal                 "
					  + " AND tblPagos.idTipoOrden =                     "
					  + "     tblPagosMedios.idTipoOrden                 "
					  + " AND tblPagos.idRecibo    =                     "
					  + "        tblPagosMedios.idRecibo                 "
					  + " AND tblPagos.indicador   =                     "
					  + "       tblPagosMedios.indicador                 "
					  + " INNER JOIN (                                   "
					  + " SELECT tblPlus.idLocal,                        "
					  + "   tblPlus.idPlu,                               "
					  + "   tblCategorias.nombreCategoria + ' ' +        "
					  + "   tblPlus.nombrePlu AS nombrePlu,              "
					  + "   tblCategorias.idProducto                     "
					  + " FROM            tblCategorias                  "
					  + " INNER JOIN tblPlus                             "
					  + " ON tblCategorias.idLocal      =                "
					  + "                 tblPlus.idLocal                "
					  + " AND tblCategorias.idLinea     =                "
					  + "                 tblPlus.idLinea                "
					  + " AND tblCategorias.IdCategoria =                "
					  + "          tblPlus.idCategoria ) AS tmpPRO	   "
					  + " ON tmpPRO.idLocal         =                    "
					  + "        tblPagosMedios.idLocal                  "
					  + " AND tmpPRO.idPlu          =                    "
					  + "         tblPagosMedios.idPlu                   "
					  + " WHERE tblPagosMedios.idTipoOrden IN (9,29)     "
					  + " AND   tmpPRO.idProducto    =                   " 
					  + " ?1                              "                     
					  + " GROUP BY tblPagosMedios.idLocal,               "
					  + "       tblPagos.nitCC,                          "
					  + "       tblPagos.idPeriodo,                      "
					  + "       tblPagosMedios.idPlu) AS tmpDET          "
					  + " ON  tblTerceros.idLocal   = tmpDET.idLocal     "
					  + " AND tblTerceros.idCliente = tmpDET.idCliente   "
					  + " INNER JOIN tblTerceroEstracto                  "
					  + " ON  tblTerceros.idLocal    =                   "
					  + "                 tblTerceroEstracto.idLocal     "
					  + " AND tblTerceros.idEstracto =                   "
					  + "              tblTerceroEstracto.idEstracto     "
					  + " WHERE tblTerceros.idLocal       =              "
					  + " ?2                                 "                     
					  + " AND   tmpDET.idPeriodo          =              "
					  + " ?3                               "                
					  + " AND   tblTerceros.idTipoTercero = 1            "
					  + " AND   tmpDET.vrVenta           != 0            "
					  + "  AND   tblTerceros.idCliente     = ?4      "          
					  + " ORDER BY tmpDET.idLocal,                       "
					  + " 	   tmpDET.idCliente,                       "
					  + " 	   tblTerceros.nombreTercero,              "
					  + " 	   tmpDET.grupo,                           "
					  //+ " 	   tmpDET.idDcto,                          "
					  + " 	   tmpDET.IDPLU,                           "
					  + " 	   tmpDET.nombrePlu,                       "
					  + " 	   tmpDET.vrVenta  ", nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaProductoPeriodoIdCliente(int idProducto, int idLocal, int idPeriodo, String idCliente);
			  
			  
			  
			  @Query(value = " SELECT tmpDET.idLocal,                           "
					  + " 	   tblTerceroEstracto.nombreEstracto,      "
					  + " 	   tmpDET.idCliente,                       "
					  + " 	   tblTerceros.nombreTercero,              "
					  + " 	   tmpDET.grupo AS nombreDcto,             "
					  //+ " 	   tmpDET.idDcto,                          "
					  + " 	   tmpDET.idPlu,                           "
					  + " 	   tmpDET.nombrePlu,                       "
					  + " 	   tmpDET.vrVenta AS vrVentaConIva         "
					  + " FROM  tblTerceros                              "
					  + " INNER JOIN                                     "
					  + " (SELECT  tblDctosOrdenesDetalle.idLocal,       "
					  //+ "  tblDctos.idDcto,                              "
					  + "  tblDctosOrdenesDetalle.idPlu,                 "
					  + "  MAX(tblDctos.idCliente) AS idCliente,         "
					  + "  MAX(tmpPRO.nombrePlu) AS nombrePlu ,          "
					  + "  SUM( tblDctosOrdenesDetalle.VRVENTAUNITARIO * "
					  + "  tblDctosOrdenesDetalle.cantidad ) AS vrVenta, "
					  + " 	 'Factura' AS grupo,                       "
					  + " 	 tblDctos.idPeriodo                        "
					  + " FROM            tblDctos                       "
					  + " INNER JOIN tblDctosOrdenesDetalle              "
					  + " ON tblDctos.IDLOCAL      =                     "
					  + "      tblDctosOrdenesDetalle.IDLOCAL            "
					  + " AND tblDctos.IDTIPOORDEN =                     "
					  + "    tblDctosOrdenesDetalle.IDTIPOORDEN          "
					  + " AND tblDctos.IDORDEN     =                     "
					  + "      tblDctosOrdenesDetalle.IDORDEN            "
					  + " INNER JOIN (                                   "
					  + " SELECT tblPlus.idLocal,                        "
					  + "   tblPlus.idPlu,                               "
					  + "   tblCategorias.nombreCategoria + ' ' +        "
					  + "   tblPlus.nombrePlu AS nombrePlu,              "
					  + "   tblCategorias.idProducto                     "
					  + " FROM            tblCategorias                  "
					  + " INNER JOIN tblPlus                             "
					  + " ON tblCategorias.idLocal      =                "
					  + "                 tblPlus.idLocal                "
					  + " AND tblCategorias.idLinea     =                "
					  + "                 tblPlus.idLinea                "
					  + " AND tblCategorias.IdCategoria =                "
					  + "          tblPlus.idCategoria ) AS tmpPRO	   "
					  + " ON tmpPRO.idLocal         =                    "
					  + "        tblDctosOrdenesDetalle.idLocal          "
					  + " AND tmpPRO.idPlu          =                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " WHERE tblDctos.IDTIPOORDEN =  9                "
					  + " AND   tmpPRO.idProducto       IN (?1)          "
					                
					  + " GROUP BY tblDctosOrdenesDetalle.idLocal,       "
					  + "         tblDctos.idCliente,                    "
					  + "         tblDctos.idPeriodo,                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " UNION                                          "
					  + " SELECT  tblDctosOrdenesDetalle.idLocal,        "
					  //+ "    tblDctos.idDcto,                            "
					  + "    tblDctosOrdenesDetalle.idPlu,               "
					  + "    MAX(tblDctos.idCliente) AS idCliente,       "
					  + "  MAX(tmpPRO.nombrePlu) AS nombrePlu ,          "
					  + "  SUM( tblDctosOrdenesDetalle.VRVENTAUNITARIO * "
					  + "  tblDctosOrdenesDetalle.cantidad ) AS vrVenta, "
					  + "    'Nota' AS grupo,                            "
					  + "    tblDctos.idPeriodo                          "
					  + " FROM            tblDctos                       "
					  + " INNER JOIN tblDctosOrdenesDetalle              "
					  + " ON tblDctos.IDLOCAL      =                     "
					  + "      tblDctosOrdenesDetalle.IDLOCAL            "
					  + " AND tblDctos.IDTIPOORDEN =                     "
					  + "    tblDctosOrdenesDetalle.IDTIPOORDEN          "
					  + " AND tblDctos.IDORDEN     =                     "
					  + "      tblDctosOrdenesDetalle.IDORDEN            "
					  + " INNER JOIN (                                   "
					  + " SELECT tblPlus.idLocal,                        "
					  + "   tblPlus.idPlu,                               "
					  + "   tblCategorias.nombreCategoria + ' ' +        "
					  + "   tblPlus.nombrePlu AS nombrePlu,              "
					  + "   tblCategorias.idProducto                     "
					  + " FROM            tblCategorias                  "
					  + " INNER JOIN tblPlus                             "
					  + " ON tblCategorias.idLocal      =                "
					  + "                 tblPlus.idLocal                "
					  + " AND tblCategorias.idLinea     =                "
					  + "                 tblPlus.idLinea                "
					  + " AND tblCategorias.IdCategoria =                "
					  + "             tblPlus.idCategoria ) AS tmpPRO	   "
					  + " ON tmpPRO.idLocal         =                    "
					  + "        tblDctosOrdenesDetalle.idLocal          "
					  + " AND tmpPRO.idPlu          =                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " WHERE tblDctos.IDTIPOORDEN =  29               "
					  + " AND   tmpPRO.idProducto    IN (?1)                 "
					               
					  + " GROUP BY tblDctosOrdenesDetalle.idLocal,       "
					  + "         tblDctos.idCliente,                    "
					  + "         tblDctos.idPeriodo,                    "
					  + "         tblDctosOrdenesDetalle.idPlu           "
					  + " UNION                                          "
					  + " SELECT  tblPagosMedios.idLocal,                "
					  //+ "   tblPagos.idDcto,                             "
					  + "   tblPagosMedios.idPlu,                        "
					  + "   MAX(tblPagos.nitCC) AS idCliente,            "
					  + "   MAX(tmpPRO.nombrePlu) AS nombrePlu ,         "
					  + "   SUM( tblPagosMedios.vrMedio*(-1))            "
					  + "                           AS vrVenta,          "
					  + "  'Pago' AS grupo,                              "
					  + "  tblPagos.idPeriodo                            "
					  + " FROM    tblPagos                               "
					  + " INNER JOIN tblPagosMedios                      "
					  + " ON tblPagos.idLocal      =                     "
					  + "         tblPagosMedios.idLocal                 "
					  + " AND tblPagos.idTipoOrden =                     "
					  + "     tblPagosMedios.idTipoOrden                 "
					  + " AND tblPagos.idRecibo    =                     "
					  + "        tblPagosMedios.idRecibo                 "
					  + " AND tblPagos.indicador   =                     "
					  + "       tblPagosMedios.indicador                 "
					  + " INNER JOIN (                                   "
					  + " SELECT tblPlus.idLocal,                        "
					  + "   tblPlus.idPlu,                               "
					  + "   tblCategorias.nombreCategoria + ' ' +        "
					  + "   tblPlus.nombrePlu AS nombrePlu,              "
					  + "   tblCategorias.idProducto                     "
					  + " FROM            tblCategorias                  "
					  + " INNER JOIN tblPlus                             "
					  + " ON tblCategorias.idLocal      =                "
					  + "                 tblPlus.idLocal                "
					  + " AND tblCategorias.idLinea     =                "
					  + "                 tblPlus.idLinea                "
					  + " AND tblCategorias.IdCategoria =                "
					  + "          tblPlus.idCategoria ) AS tmpPRO	   "
					  + " ON tmpPRO.idLocal         =                    "
					  + "        tblPagosMedios.idLocal                  "
					  + " AND tmpPRO.idPlu          =                    "
					  + "         tblPagosMedios.idPlu                   "
					  + " WHERE tblPagosMedios.idTipoOrden IN (9,29)     "
					  + " AND   tmpPRO.idProducto    IN (?1)             " 
					      
					  + " GROUP BY tblPagosMedios.idLocal,               "
					  + "       tblPagos.nitCC,                          "
					  + "       tblPagos.idPeriodo,                      "
					  + "       tblPagosMedios.idPlu) AS tmpDET          "
					  + " ON  tblTerceros.idLocal   = tmpDET.idLocal     "
					  + " AND tblTerceros.idCliente = tmpDET.idCliente   "
					  + " INNER JOIN tblTerceroEstracto                  "
					  + " ON  tblTerceros.idLocal    =                   "
					  + "                 tblTerceroEstracto.idLocal     "
					  + " AND tblTerceros.idEstracto =                   "
					  + "              tblTerceroEstracto.idEstracto     "
					  + " WHERE tblTerceros.idLocal       =              "
					  + "?2                                 "                     
					  + " AND   tmpDET.idPeriodo          =              "
					  + "?3                               "                
					  + " AND   tblTerceros.idTipoTercero = 1            "
					  + " AND   tmpDET.vrVenta           != 0            "
					  + " ORDER BY tmpDET.idLocal,                       "
					  + " 	   tmpDET.idCliente,                       "
					  + " 	   tblTerceros.nombreTercero,              "
					  + " 	   tmpDET.grupo,                           "
					  //+ " 	   tmpDET.idDcto,                          "
					  + " 	   tmpDET.IDPLU,                           "
					  + " 	   tmpDET.nombrePlu,                       "
					  + " 	   tmpDET.vrVenta  ", nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaProductoPeriodo( List<Integer> IdProductoList , int idLocal, int idPeriodo);
			
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle   "
		                + " (IDLOCAL                             "
		                + " ,IDTIPOORDEN                         "
		                + " ,IDORDEN                             "
		                + " ,IDPLU                               "
		                + " ,CANTIDAD                            "
		                + " ,IDTIPO                              "
		                + " ,PORCENTAJEIVA                       "
		                + " ,VRVENTAUNITARIO                     "
		                + " ,ESTADO                              "
		                + " ,NOMBREPLU                           "
		                + " ,VRVENTAORIGINAL                     "
		                + " ,VRCOSTO                             "
		                + " ,VRDSCTOPIE                          "
		                + " ,PORCENTAJEDSCTO                     "
		                + " ,CANTIDADPEDIDA                      "
		                + " ,STRIDLISTA                          "
		                + " ,NOMBREUNIDADMEDIDA                  "
		                + " ,comentario                          "
		                + " ,item                                "
		                + " ,itemPadre                           "
		                + " ,idEstadoTx                          "
		                + " ,idTipoTx                            "
		                + " ,fechaEntrega                        "
		                + " ,idBodega                            "
		                + " ,idSubcuenta                         "
		                + " ,lecturaMedidor                      "
		                + " ,idCliente                           "
		                + " ,idEstracto                          "
		                + " ,idRuta                              "
		                + " ,idNovedadLectura)                   "
		                + " SELECT  tblplus.idLocal,             "
		                + "?1  AS idTipoOrden,   "
		                + "?2 AS idOrden,		 "
		                + " tblplus.idPlu,                       "
		                + " 0 AS cantidad,                       "
		                + " tblplus.idTipo,                      "
		                + " tblplus.porcentajeIva,               "
		                + " tblplus.vrGeneral                    "
		                + "                  AS VRVENTAUNITARIO, "
		                + "  0 AS estado,			 "
		                + " tblplus.nombrePlu,                   "
		                + " tblplus.vrGeneral                    "
		                + "                  AS VRVENTAORIGINAL, "
		                + " tblplus.vrCosto                      "
		                + " ,00 as VRDSCTOPIE                    "
		                + " ,00 as PORCENTAJEDSCTO               "
		                + " ,00 as CANTIDADPEDIDA                "
		                + " ,1 AS STRIDLISTA                     "
		                + " ,'M3' AS  NOMBREUNIDADMEDIDA         "
		                + " ,'' AS comentario                    "
		                + " ,1 AS item                           "
		                + " ,1 AS itemPadre                      "
		                + " ,0 AS idEstadoTx                     "
		                + " ,0 AS idTipoTx                       "
		                + " ,GETDATE() AS fechaEntrega           "
		                + " ,1 AS idBodega                       "
		                + " ,'' AS idSubcuenta                   "
		                + " ,0 AS lecturaMedidor                 "
		                + " ,tblterceros.idCliente               "
		                + " ,tblplus.idEstracto                  "
		                + " ,tblterceros.idRuta                  "
		                + " ,99 AS idNovedadLectura              "
		                + " FROM tblplus                         "
		                + " INNER JOIN tblmarcas                 "
		                + " ON tblplus.idMarca      =            "
		                + "         tblmarcas.idMarca            "
		                + " INNER JOIN tblcategorias             "
		                + " ON tblplus.idLinea      =            "
		                + "     tblcategorias.idLinea            "
		                + " AND tblplus.idLocal      =           "
		                + "      tblcategorias.idLocal           "
		                + " AND tblplus.idCategoria =            "
		                + "   tblcategorias.IdCategoria          "
		                + " INNER JOIN  tblterceros              "
		                + " ON tblterceros.idLocal  =            "
		                + "            tblplus.idLocal           "
		                + " AND tblterceros.idEstracto           "
		                + "       = tblplus.idEstracto           "
		                + " WHERE tblplus.idTipo    =            "
		                + "?3                        "
		                + " AND tblplus.idLocal     =            "
		                + "?4                       "
		                + " AND tblplus.idCategoria = 1          "
		                + " AND tblterceros.estado NOT IN (2)    "
		                + " AND NOT EXISTS ( SELECT *            "
		                + " FROM tbldctosordenesdetalle          "
		                + " INNER JOIN  tblplus                  "
		                + " ON tblplus.idLocal =                 "
		                + "       tbldctosordenesdetalle.idLocal "
		                + " AND tblplus.idPlu =                  "
		                + "        tbldctosordenesdetalle.idPlu  "
		                + " INNER JOIN tblterceros tmpTER        "
		                + " ON tmpTER.idLocal =                  "
		                + "       tbldctosordenesdetalle.idLocal "
		                + " AND tmpTER.idCliente =               "
		                + "    tbldctosordenesdetalle.idCliente  "
		                + " WHERE tblplus.idTipo    =            "
		                + "?3                        "
		                + " AND tblplus.idLocal     =            "
		                + "?4                       "
		                + " AND tblplus.idCategoria = 1          "
		                + " AND                                  "
		                + " tbldctosordenesdetalle.idTipoOrden = "
		                + "?1                   "
		                + " AND                                  "
		                + " tbldctosordenesdetalle.idOrden     = "
		                + "?2                       "
		                + "AND tmpTER.idCliente                = "
		                + " tblterceros.idCliente)", nativeQuery = true)
			  public void ingresaCreaLectura(int idTipoOrden, int idOrden, int idTipo, int idLocal);
			  
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle     "
		                + " FROM     tbldctosordenes              "
		                + " INNER JOIN tbldctosordenesdetalle     "
		                + " ON tbldctosordenes.IDLOCAL      =     "
		                + "       tbldctosordenesdetalle.IDLOCAL  "
		                + " AND tbldctosordenes.IDTIPOORDEN =     "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN  "
		                + " AND tbldctosordenes.IDORDEN     =     "
		                + "       tbldctosordenesdetalle.IDORDEN  "
		                + " INNER JOIN  tblterceros               "
		                + " ON tblterceros.idLocal          =     "
		                + "        tbldctosordenesdetalle.IDLOCAL "
		                + " AND tblterceros.idCliente       =     "
		                + "      tbldctosordenesdetalle.idCliente "
		                + " AND tbldctosordenesdetalle.idEstracto "
		                + "             <> tblterceros.idEstracto "
		                + " WHERE  tbldctosordenes.IDLOCAL    =   "
		                + "?1                         "
		                + " AND tbldctosordenes.IDTIPOORDEN   =   "
		                + "?2                     "
		                + " AND tbldctosordenes.idPeriodo     =   "
		                + "?3                       "
		                + " AND tbldctosordenesdetalle.IDTIPO = 4", nativeQuery = true)
			  public void retiraCambioEstrato(int idLocal, int IdTipoOrden, int idPeriodo);
			  
			  
			  @Query(value = "SELECT MAX(tbldctosordenesdetalle.item)   AS maxItem "
		                + "FROM   tbldctosordenes                               "
		                + "INNER  JOIN tbldctosordenesdetalle                   "
		                + "ON     tbldctosordenes.IDORDEN       =               "
		                + "          tbldctosordenesdetalle.IDORDEN "
		                + "AND    tbldctosordenes.IDTIPOORDEN   =               "
		                + "      tbldctosordenesdetalle.IDTIPOORDEN "
		                + "AND    tbldctosordenes.IDLOCAL       =               "
		                + "          tbldctosordenesdetalle.IDLOCAL "
		                + "WHERE tbldctosordenes.IDTIPOORDEN    =               "
		                + "?1                                "
		                + "AND tbldctosordenes.IDLOCAL          =               "
		                + "?2                                    "
		                + "AND   tbldctosordenes.IDLOG          =               "
		                + "?3 ", nativeQuery = true)
			  Integer maximoItem(int idTipoOrden, int idLocal, int idLog);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value =  "DELETE FROM tbldctosordenesdetalle        "
		                + "FROM   tbldctosordenes                    "
		                + "INNER JOIN tbldctosordenesdetalle         "
		                + "ON  tbldctosordenes.IDLOCAL     =         "
		                + "          tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN =         "
		                + "     tbldctosordenesdetalle.IDTIPOORDEN   "
		                + "AND tbldctosordenes.IDORDEN     =         "
		                + "         tbldctosordenesdetalle.IDORDEN   "
		                + "WHERE  tbldctosordenesdetalle.IdPlu  =    "
		                + "?1                             "
		                + "AND tbldctosordenesdetalle.idCliente =   "
		                + "?2                       "
		                + "AND tbldctosordenesdetalle.idLocal   =    "
		                + "?3                          "
		                + "AND    tbldctosordenes.idLog         =    "
		                + "?4 " , nativeQuery = true)
			  public void retiraLectura(int IdPlu, String IdCliente, int idLocal, int idLog);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value =  "INSERT INTO tbldctosordenesdetalle (idLocal,   "
		                + "                      idTipoOrden,           "
		                + "                      idOrden,               "
		                + "                      cantidad,              "
		                + "                      nombrePlu,             "
		                + "                      idPlu,                 "
		                + "                      idTipo,                "
		                + "                      estado,                "
		                + "                      porcentajeIva,         "
		                + "                      vrVentaUnitario,       "
		                + "                      vrVentaOriginal,       "
		                + "                      vrCosto,               "
		                + "                      vrDsctoPie,            "
		                + "                      porcentajeDscto,       "
		                + "                      cantidadPedida,        "
		                + "                      strIdLista ,           "
		                + "                      nombreUnidadMedida,    "
		                + "                      comentario,            "
		                + "                      item,                  "
		                + "                      itemPadre,             "
		                + "                      idEstadoTx,            "
		                + "                      idTipoTx,              "
		                + "                      idBodega,              "
		                + "                      idSubcuenta,           "
		                + "                      lecturaMedidor,        "
		                + "                      idCliente,             "
		                + "                      idEstracto,            "
		                + "                      idRuta,                "
		                + "                      idNovedadLectura)      "
		                + "VALUES (?1,                "
		                + "?2, "
		                + "?3, "
		                + "?4,"
		                + "?5,"
		                + "?6, "
		                + "?7, "
		                + "?8, "
		                + "?9, "
		                + "?10, "
		                + "?11, "
		                + "?12, "
		                + "?13, "
		                + "?14, "
		                + "?15, "
		                + "?16, "
		                + "?17, "
		                + "?18, "
		                + "?19, "
		                + "?20, "
		                + "?21, "
		                + "?22, "
		                + "?23, "
		                + "?24, "
		                + "?25, "
		                + "?26, "
		                + "?27, "
		                + "?28, "
		                + "?29) " , nativeQuery = true)
			  public void ingresaLecturaMedidor(int idLocal, int IdTipoOrden, int idOrden, Double Cantidad, String NombrePlu, int IdPlu, int IdTipo, int Estado, Double PorcentajeIva,
					  Double VrVentaUnitario, Double VrVentaOriginal, Double VrCosto, Double VrDsctoPie, Double PorcentajeDscto, Double CantidadPedida, String StrIdLista, String NombreUnidadMedida,
					  String Comentario, int Item, int ItemPadre, int IdEstadoTx, int IdTipoTx, int IdBodega, int IdSubcuenta, Double LecturaMedidor, String IdCliente, int IdEstracto,
					  int IdRuta, int IdNovedadLectura);
			  
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tblDctosOrdenesDetalle SET lecturaMedidor = ?1 " +
			                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?2 " +
			                 "AND tblDctosOrdenesDetalle.IDORDEN = ?3 " +
			                 "AND tblDctosOrdenesDetalle.idCliente = ?4 ", nativeQuery = true)
			  public void actualizarLecturaAnterior(Double lecturaMedidor, int idLocal, int idOrden, String idCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tblDctosOrdenesDetalle            "  
					  + " FROM tblDctosOrdenesDetalle                "       
					  + " INNER JOIN (                               "
					  + " SELECT  tblDctosOrdenesDetalle.idlocal,    "
					  + "   tblDctosOrdenesDetalle.IDTIPOORDEN,      "
					  + "   tblDctosOrdenesDetalle.IDORDEN,          "
					  + "   tblDctosOrdenesDetalle.idPlu,            "
					  + "   tblDctosOrdenesDetalle.idCliente,        "
					  + "   COUNT(*) AS cuenta,                      "
					  + "   MAX(tblDctosOrdenesDetalle.item)         "
					  + "                         AS maxItem         "
					  + " FROM  tblDctosOrdenes                      "
					  + " INNER JOIN tblDctosOrdenesDetalle          "
					  + " ON tblDctosOrdenes.IDLOCAL      =          "
					  + "         tblDctosOrdenesDetalle.IDLOCAL     "
					  + " AND tblDctosOrdenes.IDTIPOORDEN =          "
					  + "       tblDctosOrdenesDetalle.IDTIPOORDEN   "
					  + " AND tblDctosOrdenes.IDORDEN     =          "
					  + "           tblDctosOrdenesDetalle.IDORDEN   "
					  + " WHERE  tblDctosOrdenesDetalle.idlocal =    "
					  + "?1                             "                
					  + " AND tblDctosOrdenes.IDTIPOORDEN       =    "
					  + "?2                         "                 
					  + " AND tblDctosOrdenesDetalle.idTipo     =    "
					  + "?3                              "                
					  + " AND tblDctosOrdenesDetalle.strIdLista = '1'" 
					  + " AND tblDctosOrdenes.idPeriodo         =    "
					  + "?4                           "             
					  + " GROUP BY tblDctosOrdenesDetalle.idlocal,   "
					  + "    tblDctosOrdenesDetalle.IDTIPOORDEN,     "
					  + "    tblDctosOrdenesDetalle.IDORDEN,         "
					  + "    tblDctosOrdenesDetalle.idPlu,           "
					  + "    tblDctosOrdenesDetalle.idCliente        "
					  + " HAVING COUNT(*)>1 ) tmpDOB                 "
					  + " ON tblDctosOrdenesDetalle.idLocal      =   "
					  + "                           tmpDOB.IDLOCAL   "
					  + " AND tblDctosOrdenesDetalle.idTipoOrden =   "
					  + "                       tmpDOB.idTipoOrden   "
					  + " AND tblDctosOrdenesDetalle.idOrden     =   "
					  + "                           tmpDOB.idOrden   "
					  + " AND tblDctosOrdenesDetalle.idCliente   =   "
					  + "                         tmpDOB.idCliente   "
					  + " AND tblDctosOrdenesDetalle.idPlu       =   "
					  + "                             tmpDOB.idPlu   "
					  + " AND tblDctosOrdenesDetalle.item        =   "
					  + "                           tmpDOB.maxItem  ", nativeQuery = true)
			  public void retiraConsumo(int idLocal, int IdTipoOrden, int IdTipo, int IdPeriodo);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle                    "
		                + "SET tbldctosordenesdetalle.idOrden =             "
		                + "   (SELECT  MIN(tbldctosordenesdetalle.idOrden)  "
		                + "                                  AS minIdOrden  "
		                + "    FROM tblagendalogvisitas		    "
		                + "    INNER JOIN tbldctosordenes		    "
		                + " ON tblagendalogvisitas.idLocal    = 	 "
		                + "                 tbldctosordenes.idLocal	 "
		                + " AND tblagendalogvisitas.IDLOG    = 		 "
		                + "                 tbldctosordenes.IDLOG	 "
		                + "    INNER JOIN tbldctosordenesdetalle	    "
		                + "    ON tbldctosordenes.IDLOCAL          =        "
		                + "                tbldctosordenesdetalle.IDLOCAL   "
		                + "    AND tbldctosordenes.IDTIPOORDEN     =        "
		                + "            tbldctosordenesdetalle.IDTIPOORDEN   "
		                + "    AND tbldctosordenes.IDORDEN         =        "
		                + "                tbldctosordenesdetalle.IDORDEN   "
		                + "    WHERE tblagendalogvisitas.idPeriodo =        "
		                + "?1                                    "
		                + "    AND  tbldctosordenes.idTipoOrden    =        "
		                + "?2                              "
		                + "AND  tbldctosordenes.idLocal        =            "
		                + "?3 )                                "
		                + "FROM   tblagendalogvisitas                       "
		                + "INNER JOIN tbldctosordenes                       "
		                + " ON tblagendalogvisitas.idLocal    = 	 "
		                + "                 tbldctosordenes.idLocal	 "
		                + " AND tblagendalogvisitas.IDLOG    = 		 "
		                + "                 tbldctosordenes.IDLOG	 "
		                + "INNER JOIN tbldctosordenesdetalle                "
		                + "ON  tbldctosordenes.IDLOCAL     =                "
		                + "            tbldctosordenesdetalle.IDLOCAL       "
		                + "AND tbldctosordenes.IDTIPOORDEN =                "
		                + "        tbldctosordenesdetalle.IDTIPOORDEN       "
		                + "AND tbldctosordenes.IDORDEN     =                "
		                + "            tbldctosordenesdetalle.IDORDEN       "
		                + "WHERE tblagendalogvisitas.idPeriodo =            "
		                + "?1                                    "
		                + "AND  tbldctosordenes.idTipoOrden    =            "
		                + "?2                              "
		                + "AND  tbldctosordenes.idLocal        =    ?3        "
		                , nativeQuery = true)
			  public void actualizaOrden(int idPeriodo, int IdTipoOrden, int idLocal );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tblDctosOrdenesDetalle                 "
					  + " SET    CANTIDAD = ( tmpCFI.lecturaMedidor - "
					  + "                  tmpCFI.lecturaAnterior ),  "                
					  + "    lecturaAnterior = tmpCFI.lecturaAnterior "       
					  + " FROM  tblDctosOrdenesDetalle                "
					  + " INNER JOIN                                  "
					  + " (SELECT tmpCMO.IDLOCAL,                     "
					  + "         tmpCMO.IDTIPOORDEN,                 "
					  + "         tmpCMO.idCliente,                   "
					  + " 	    tmpCMO.lecturaMedidor,              "
					  + " 	    tmpCON.lecturaAnterior              "                
					  + "  FROM tblDctosOrdenesDetalle AS tmpCMO      "
					  + "  INNER JOIN  (SELECT                        "
					  + "  tblDctosOrdenesDetalle_1.IDLOCAL,          "
					  + "  tblDctosOrdenesDetalle_1.IDTIPOORDEN,      "
					  + "  tblDctosOrdenesDetalle_1.idCliente,        "
					  + "  tblDctosOrdenesDetalle_1.lecturaMedidor,   "
					  + "  (SELECT TOP (1) tmpDET.lecturaMedidor      "
					  + "   FROM tblDctos AS tmpDCT                   "
					  + "   INNER JOIN tblDctosOrdenesDetalle         "
					  + "                                AS tmpDET    "
					  + "   ON tmpDCT.IDLOCAL      =                  "
					  + "                           tmpDET.IDLOCAL    "
					  + "   AND tmpDCT.IDTIPOORDEN =                  "
					  + "                       tmpDET.IDTIPOORDEN    "
					  + "   AND tmpDCT.IDORDEN     =                  "
					  + "                           tmpDET.IDORDEN    "
					  + "   AND tmpDCT.IDLOCAL     =                  "
					  + "?1                              "
					  + "   AND tmpDCT.IDTIPOORDEN IN (9, 29)         "
					  + "   AND tmpDCT.idPeriodo   =                  "
					  + "?2                        "
					  + "   AND tmpDET.IDTIPO      = 4                "
					  + "   AND tmpDET.idCliente   =                  "
					  + "       tblDctosOrdenesDetalle_1.idCliente    "
					  + "   ORDER BY tmpDCT.idCliente,                "
					  + "    tmpDCT.IDORDEN DESC) AS lecturaAnterior  "
					  + "    FROM tblDctosOrdenesDetalle AS           "
					  + " 	      tblDctosOrdenesDetalle_1          "
					  + "  INNER JOIN tblDctosOrdenes                 "
					  + "  ON tblDctosOrdenes.IDLOCAL      =          "
					  + "           tblDctosOrdenesDetalle_1.IDLOCAL  "
					  + "  AND tblDctosOrdenes.IDTIPOORDEN =          "
					  + "       tblDctosOrdenesDetalle_1.IDTIPOORDEN  "
					  + "  AND tblDctosOrdenes.IDORDEN     =          "
					  + "           tblDctosOrdenesDetalle_1.IDORDEN  "
					  + "  WHERE tblDctosOrdenes.IDLOCAL        =     " 
					  + "?1                              "
					  + "  AND  tblDctosOrdenes.IDTIPOORDEN     = 59  "
					  + "  AND  tblDctosOrdenesDetalle_1.IDTIPO = 4   "
					  + "  AND  tblDctosOrdenes.idPeriodo =           "
					  + "?3 )                        "
					  + "                                  AS tmpCON  "
					  + "  ON  tmpCMO.IDLOCAL     =                   "
					  + "                       tmpCON.IDLOCAL        "
					  + "  AND tmpCMO.IDTIPOORDEN =                   "
					  + "                   tmpCON.IDTIPOORDEN        "
					  + "  AND tmpCMO.idCliente   =                   "
					  + "                     tmpCON.idCliente        "
					  + "  WHERE         tmpCMO.IDLOCAL =             "
					  + "?1                              "
					  + "  AND tmpCMO.IDTIPOORDEN = 59                "
					  + "  AND  tmpCMO.IDTIPO     = 4 ) AS tmpCFI     "
					  + "  ON tblDctosOrdenesDetalle.IDLOCAL      =   "
					  + "                   tmpCFI.IDLOCAL            "
					  + "  AND tblDctosOrdenesDetalle.IDTIPOORDEN =   "
					  + "                       tmpCFI.IDTIPOORDEN    "
					  + "  AND tblDctosOrdenesDetalle.idCliente   =   "
					  + "                          tmpCFI.idCliente   " 
					  + "  WHERE tblDctosOrdenesDetalle.IDTIPO     = 4"
		                , nativeQuery = true)
			  public void cantidadM3(int idLocal, int IdPeriodoAnterior, int idPeriodo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle                "
		                + " SET  CANTIDAD =                              "
		                + "    tbldctosordenesdetalle.cantidadPedida     "
		                + " FROM  tbldctosordenesdetalle                 "
		                + " INNER JOIN tbldctosordenes                   "
		                + " ON tbldctosordenes.IDLOCAL           =       "
		                + "          tbldctosordenesdetalle.IDLOCAL      "
		                + " AND tbldctosordenes.IDTIPOORDEN      =       "
		                + "       tbldctosordenesdetalle.IDTIPOORDEN     "
		                + " AND tbldctosordenes.IDORDEN          =       "
		                + "           tbldctosordenesdetalle.IDORDEN     "
		                + " WHERE  tbldctosordenes.IDLOCAL     =         "
		                + "?1                               "
		                + " AND  tbldctosordenes.IDTIPOORDEN   = 59      "
		                + " AND  tbldctosordenesdetalle.IDTIPO = 4       "
		                + " AND  tbldctosordenesdetalle.idNovedadLectura "
		                + "                                      IN (91) "
		                + " AND  tbldctosordenes.idPeriodo     =   ?2      "
		                , nativeQuery = true)
			  public void cantidadAforoM3(int idLocal, int idPeriodo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle        "
		                + " SET      idNovedadLectura = 9        "
		                + " FROM   tbldctosordenesdetalle        "
		                + " INNER JOIN  tbldctosordenes          "
		                + " ON tbldctosordenes.IDLOCAL       =   "
		                + "     tbldctosordenesdetalle.IDLOCAL   "
		                + " AND tbldctosordenes.IDTIPOORDEN  =   "
		                + "  tbldctosordenesdetalle.IDTIPOORDEN  "
		                + " AND tbldctosordenes.IDORDEN      =   "
		                + "      tbldctosordenesdetalle.IDORDEN  "
		                + " WHERE tbldctosordenes.IDLOCAL     =  "
		                + "?1                       "
		                + " AND  tbldctosordenes.IDTIPOORDEN  =  "
		                + "?2                   "
		                + " AND tbldctosordenesdetalle.idTipo =4 "
		                + " AND  tbldctosordenes.idPeriodo    = ?3 ",
		                nativeQuery = true)
			  public void actualizaCausalPromedio(int idLocal, int IdTipoOrden, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle           "
		                + " SET    CANTIDAD =                       "
		                + "         CEILING(tblterceros.promedio)   "
		                + " FROM tbldctosordenes                    "
		                + " INNER JOIN tbldctosordenesdetalle       "
		                + " ON tbldctosordenes.IDLOCAL      =       "
		                + "      tbldctosordenesdetalle.IDLOCAL     "
		                + " AND tbldctosordenes.IDTIPOORDEN =       "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN    "
		                + " AND tbldctosordenes.IDORDEN     =       "
		                + "       tbldctosordenesdetalle.IDORDEN    "
		                + " INNER JOIN tbltipocausanota             "
		                + " ON tbltipocausanota.idCausa     =       "
		                + " tbldctosordenesdetalle.idNovedadLectura "
		                + " INNER JOIN tblterceros                  "
		                + " ON tblterceros.idLocal          =       "
		                + "        tbldctosordenesdetalle.IDLOCAL   "
		                + " AND tblterceros.idCliente       =       "
		                + "      tbldctosordenesdetalle.idCliente   "
		                + " WHERE tbldctosordenes.IDLOCAL     =     "
		                + "?1                          "
		                + " AND tbldctosordenes.IDTIPOORDEN   =     "
		                + "?2                     "
		                + " AND tbldctosordenesdetalle.IDTIPO = 4   "
		                + " AND tbltipocausanota.idTipoTabla  = 2   "
		                + "  AND tbltipocausanota.idCausa IN       ("
		                + "?3 )              "
		                + " AND  tbldctosordenes.idPeriodo    = ?4    ",
		                nativeQuery = true)
			  public void cantidadM3Promedio(int idLocal, int IdTipoOrden, String IdCausaConsumoPromedio, int idPeriodo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle           "
		                + " SET    CANTIDAD =                       "
		                + "    CEILING(tblterceros.promedioEstrato) "
		                + " FROM tbldctosordenes                    "
		                + " INNER JOIN tbldctosordenesdetalle       "
		                + " ON tbldctosordenes.IDLOCAL      =       "
		                + "      tbldctosordenesdetalle.IDLOCAL     "
		                + " AND tbldctosordenes.IDTIPOORDEN =       "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN    "
		                + " AND tbldctosordenes.IDORDEN     =       "
		                + "       tbldctosordenesdetalle.IDORDEN    "
		                + " INNER JOIN tbltipocausanota             "
		                + " ON tbltipocausanota.idCausa     =       "
		                + " tbldctosordenesdetalle.idNovedadLectura "
		                + " INNER JOIN tblterceros                  "
		                + " ON tblterceros.idLocal          =       "
		                + "        tbldctosordenesdetalle.IDLOCAL   "
		                + " AND tblterceros.idCliente       =       "
		                + "      tbldctosordenesdetalle.idCliente   "
		                + " WHERE tbldctosordenes.IDLOCAL     =     "
		                + "?1                          "
		                + " AND tbldctosordenes.IDTIPOORDEN   =     "
		                + "?2                      "
		                + " AND tbldctosordenesdetalle.IDTIPO = 4   "
		                + " AND tbltipocausanota.idTipoTabla  = 2   "
		                + "  AND tbltipocausanota.idCausa IN       ("
		                + "?3 )       "
		                + " AND  tbldctosordenes.idPeriodo    = ?4   ",
		                nativeQuery = true)
			  public void cantidadM3PromedioEstrato(int idLocal, int IdTipoOrden, String IdCausaConsumoPromedio, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle           "
		                + " SET    CANTIDAD =                       "
		                + "   tbldctosordenesdetalle.cantidadPedida "
		                + " FROM tbldctosordenes                    "
		                + " INNER JOIN tbldctosordenesdetalle       "
		                + " ON tbldctosordenes.IDLOCAL      =       "
		                + "      tbldctosordenesdetalle.IDLOCAL     "
		                + " AND tbldctosordenes.IDTIPOORDEN =       "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN    "
		                + " AND tbldctosordenes.IDORDEN     =       "
		                + "       tbldctosordenesdetalle.IDORDEN    "
		                + " INNER JOIN tbltipocausanota             "
		                + " ON tbltipocausanota.idCausa     =       "
		                + " tbldctosordenesdetalle.idNovedadLectura "
		                + " INNER JOIN tblterceros                  "
		                + " ON tblterceros.idLocal          =       "
		                + "        tbldctosordenesdetalle.IDLOCAL   "
		                + " AND tblterceros.idCliente       =       "
		                + "      tbldctosordenesdetalle.idCliente   "
		                + " WHERE tbldctosordenes.IDLOCAL     =     "
		                + "?1                          "
		                + " AND tbldctosordenes.IDTIPOORDEN   =     "
		                + "?2                      "
		                + " AND tbldctosordenesdetalle.IDTIPO = 4   "
		                + " AND tbltipocausanota.idTipoTabla  = 2   "
		                + "  AND tbltipocausanota.idCausa IN       ("
		                + "?3 )                 "
		                + " AND  tbldctosordenes.idPeriodo    =  ?4   ",
		                nativeQuery = true)
			  public void cantidadM3Aforo(int idLocal, int IdTipoOrden, String IdCausaConsumoPromedio, int idPeriodo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle           "
		                + " SET tbldctosordenesdetalle.cantidad =   "
		                + "                 tblterceros.promedio,   "
		                + "                   idNovedadLectura = 9  "
		                + " FROM tbldctosordenes                    "
		                + " INNER JOIN tbldctosordenesdetalle       "
		                + " ON tbldctosordenes.IDLOCAL      =       "
		                + "      tbldctosordenesdetalle.IDLOCAL     "
		                + " AND tbldctosordenes.IDTIPOORDEN =       "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN    "
		                + " AND tbldctosordenes.IDORDEN     =       "
		                + "       tbldctosordenesdetalle.IDORDEN    "
		                + " INNER JOIN tbltipocausanota             "
		                + " ON tbltipocausanota.idCausa     =       "
		                + " tbldctosordenesdetalle.idNovedadLectura "
		                + " INNER JOIN tblterceros                  "
		                + " ON tblterceros.idLocal          =       "
		                + "        tbldctosordenesdetalle.IDLOCAL   "
		                + " AND tblterceros.idCliente       =       "
		                + "      tbldctosordenesdetalle.idCliente   "
		                + " WHERE tbldctosordenes.IDLOCAL     =     "
		                + "?1                          "
		                + " AND tbldctosordenes.IDTIPOORDEN   =     "
		                + "?2                      "
		                + " AND tbldctosordenesdetalle.IDTIPO = 4   "
		                + " AND tbltipocausanota.idTipoTabla  = 2   "
		                + " AND tbldctosordenesdetalle.cantidad < 0 "
		                + " AND  tbldctosordenes.idPeriodo      = ?3  ",
		                nativeQuery = true)
			  public void cambiaConsumoNegativo(int idLocal, int IdTipoOrden, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle               "
		                + " SET      item = tmpDET.idReg                "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN                                  "
		                + " ( SELECT tbldctosordenesdetalle.IDLOCAL,    "
		                + "        tbldctosordenesdetalle.IDTIPOORDEN,  "
		                + " 	   tbldctosordenesdetalle.IDORDEN,      "
		                + " 	   tbldctosordenesdetalle.IDPLU,        "
		                + "        tbldctosordenesdetalle.item,         "
		                + " 	   tbldctosordenesdetalle.idCliente     "
		                + "       ,ROW_NUMBER() OVER (ORDER BY          "
		                + " 	   tbldctosordenesdetalle.IDLOCAL,      "
		                + "        tbldctosordenesdetalle.IDTIPOORDEN,  "
		                + " 	   tbldctosordenesdetalle.IDORDEN,      "
		                + " 	   tbldctosordenesdetalle.IDPLU,        "
		                + "        tbldctosordenesdetalle.item,         "
		                + " 	   tbldctosordenesdetalle.idCliente )   "
		                + " 			             AS idReg   "
		                + " FROM  tbldctosordenes                       "
		                + " INNER JOIN tbldctosordenesdetalle           "
		                + " ON tbldctosordenes.IDLOCAL       =          "
		                + "       tbldctosordenesdetalle.IDLOCAL        "
		                + " AND tbldctosordenes.IDTIPOORDEN  =          "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN        "
		                + " AND tbldctosordenes.IDORDEN      =          "
		                + "       tbldctosordenesdetalle.IDORDEN        "
		                + " WHERE  tbldctosordenes.IDLOCAL   =          "
		                + "?1                              "
		                + " AND  tbldctosordenes.IDTIPOORDEN =          "
		                + "?2                          "
		                + " AND tbldctosordenes.idPeriodo    =          "
		                + "?3 ) AS tmpDET                    "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =    "
		                + "                           tmpDET.IDLOCAL    "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "                       tmpDET.IDTIPOORDEN    "
		                + " AND tbldctosordenesdetalle.IDORDEN     =    "
		                + "                           tmpDET.IDORDEN    "
		                + " AND tbldctosordenesdetalle.IDPLU       =    "
		                + "                             tmpDET.IDPLU    "
		                + " AND tbldctosordenesdetalle.item        =    "
		                + "                              tmpDET.item    "
		                + " AND tbldctosordenesdetalle.idcliente   =    "
		                + "                         tmpDET.idcliente ",
		                nativeQuery = true)
			  public void actualizaItem(int idLocal, int IdTipoOrden, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle           "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "            ,idEstracto                     "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT tbldctosordenesdetalle.IDLOCAL      "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       , ( CANTIDAD - rangoMaximo )         "
		                + " 	                    AS cantidad        "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "      ,tmpRNG3.vrGeneral AS vrVentaUnitario "
		                + "       ,ESTADO                              "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	          AS VRVENTAORIGINAL           "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,3 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,comentario                          "
		                + "       ,tmpRNG3.IDPLU AS item               "
		                + "       ,itemPadre                           "
		                + "       ,idEstadoTx                          "
		                + "       ,idTipoTx                            "
		                + "       ,fechaEntrega                        "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,idCliente                           "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "    ( SELECT tblplus.idLocal,               "
		                + "            tblplus.idEstracto,             "
		                + "      SUM(tblplus.rangoMaximo)              "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1,4)           "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto ) AS tmpR14   "
		                + " ON tbldctosordenesdetalle.idLocal =        "
		                + "                        tmpR14.idLocal      "
		                + " AND tbldctosordenesdetalle.idEstracto =    "
		                + "                        tmpR14.idEstracto   "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "      tblplus.idPlu,                        "
		                + "  tblcategorias.nombreCategoria + ' ' +     "
		                + "    tblplus.nombrePlu AS nombrePlu,         "
		                + "    tblplus.vrGeneral,                      "
		                + "    tblplus.idTipo,                         "
		                + "    tblplus.idEstracto                      "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (5))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + "   WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =4  "
		                + "   AND tbldctosordenesdetalle.CANTIDAD   >  "
		                + "                     tmpR14.rangoMaximo ",
		                nativeQuery = true)
			  public void ingresaSuntuario(int idLocal );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle              "
		                + " SET CANTIDAD =                             "
		                + "  ( CANTIDAD - cantidadSuntuario )          "
		                + " FROM tbldctosordenesdetalle                "
		                + " INNER JOIN                                 "
		                + "   (SELECT                                  "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,      "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,  "
		                + "     tbldctosordenesdetalle_1.IDORDEN,      "
		                + "     tbldctosordenesdetalle_1.IDPLU,        "
		                + " 	( tbldctosordenesdetalle_1.CANTIDAD -  "
		                + " 		     tmpR14.rangoMaximo )      "
		                + " 		      AS cantidadSuntuario,    "
		                + "      tbldctosordenesdetalle_1.idCliente    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "       AS tbldctosordenesdetalle_1          "
		                + "   INNER JOIN                               "
		                + "   (SELECT  tblplus.idLocal,                "
		                + "            tblplus.idEstracto,             "
		                + "        SUM(tblplus.rangoMaximo)            "
		                + " 	            AS rangoMaximo             "
		                + "    FROM tblcategorias                      "
		                + "    INNER JOIN tblplus                      "
		                + "    ON tblcategorias.idLocal      =         "
		                + "                     tblplus.idLocal        "
		                + "    AND tblcategorias.idLinea     =         "
		                + "                     tblplus.idLinea        "
		                + "    AND tblcategorias.IdCategoria =         "
		                + "                 tblplus.idCategoria        "
		                + "   WHERE       tblplus.idLocal =            "
		                + "?1                             "
		                + "   AND  tblplus.idLinea        = 1          "
		                + "   AND  tblplus.idCategoria   IN (1, 4)     "
		                + "   GROUP BY tblplus.idLocal,                "
		                + "          tblplus.idEstracto) AS tmpR14     "
		                + "   ON tbldctosordenesdetalle_1.IDLOCAL =    "
		                + "                           tmpR14.idLocal   "
		                + "   AND tbldctosordenesdetalle_1.idEstracto =  "
		                + "                           tmpR14.idEstracto  "
		                + "   AND tbldctosordenesdetalle_1.CANTIDAD >  "
		                + "                        tmpR14.rangoMaximo  "
		                + " WHERE tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59"
		                + " AND tbldctosordenesdetalle_1.IDTIPO     =4 "
		                + "                         ) AS tmpCAN        "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =   "
		                + "                           tmpCAN.IDLOCAL   "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                       tmpCAN.IDTIPOORDEN   "
		                + " AND tbldctosordenesdetalle.IDORDEN     =   "
		                + "                           tmpCAN.IDORDEN   "
		                + " AND tbldctosordenesdetalle.IDPLU       =   "
		                + "                             tmpCAN.IDPLU   "
		                + " AND tbldctosordenesdetalle.idCliente   =   "
		                + "                         tmpCAN.idCliente   "
		                + " AND  tbldctosordenesdetalle.strIdLista = 1",
		                nativeQuery = true)
			  public void actualizaSuntuario(int idLocal );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle           "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "            ,tmpRNG3.idEstracto             "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT                                     "
		                + "    tbldctosordenesdetalle.IDLOCAL          "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       ,( CANTIDAD -                        "
		                + " 	     tmpRNG.rangoMaximo) AS cantidad   "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	                    AS vrVentaUnitario "
		                + "       ,ESTADO                              "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	                   AS VRVENTAORIGINAL  "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,2 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,comentario                          "
		                + "       ,tmpRNG3.IDPLU  AS item              "
		                + "       ,itemPadre                           "
		                + "       ,idEstadoTx                          "
		                + "       ,idTipoTx                            "
		                + "       ,fechaEntrega                        "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,idCliente                           "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "      ( SELECT tblplus.idLocal,             "
		                + "               tblplus.idEstracto,          "
		                + "   SUM(tblplus.rangoMaximo)                 "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1)             "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto )              "
		                + "                      AS tmpRNG             "
		                + " ON tbldctosordenesdetalle.idLocal          "
		                + "                  = tmpRNG.idLocal          "
		                + " AND tbldctosordenesdetalle.idEstracto      "
		                + "                      = tmpRNG.idEstracto   "
		                + "  INNER JOIN                                "
		                + "         ( SELECT tblplus.idLocal,          "
		                + "                 tblplus.idEstracto,        "
		                + "       SUM(tblplus.rangoMaximo)             "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1,4)           "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto )              "
		                + "                       AS tmpRNG4           "
		                + "   ON tbldctosordenesdetalle.idLocal        "
		                + "                  = tmpRNG4.idLocal         "
		                + "  AND tbldctosordenesdetalle.idEstracto     "
		                + "              = tmpRNG4.idEstracto          "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "   tblplus.idPlu,                           "
		                + "   tblcategorias.nombreCategoria + ' ' +    "
		                + "   tblplus.nombrePlu AS nombrePlu,          "
		                + " 	      tblplus.vrGeneral,               "
		                + "              tblplus.idTipo,               "
		                + "              tblplus.idEstracto            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.idCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                            "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (4))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + "   WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =4  "
		                + " AND tbldctosordenesdetalle.strIdLista  =1  "
		                + " AND ( CANTIDAD - tmpRNG.rangoMaximo )  >0  "
		                + "   AND tbldctosordenesdetalle.CANTIDAD  <=  "
		                + "                     tmpRNG4.rangoMaximo ",
		                nativeQuery = true)
			  public void ingresaComplementario(int idLocal );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE   tbldctosordenesdetalle               "
		                + " SET CANTIDAD =                              "
		                + "   ( CANTIDAD -                              "
		                + "     tmpCAN.cantidadComplementario )         "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN                                  "
		                + "   (SELECT                                   "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,       "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,   "
		                + "     tbldctosordenesdetalle_1.IDORDEN,       "
		                + "     tbldctosordenesdetalle_1.IDPLU,         "
		                + "     tbldctosordenesdetalle_1.CANTIDAD -     "
		                + " 		         tmpR14.rangoMaximo     "
		                + "           AS cantidadComplementario,        "
		                + "     tbldctosordenesdetalle_1.idCliente      "
		                + "  FROM  tbldctosordenesdetalle               "
		                + "           AS tbldctosordenesdetalle_1       "
		                + "  INNER JOIN                                 "
		                + "    (SELECT tblplus.idLocal,                 "
		                + "            tblplus.idEstracto,              "
		                + "            SUM(tblplus.rangoMaximo)         "
		                + " 		   AS rangoMaximo               "
		                + "  FROM  tblcategorias                        "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal      =             "
		                + "                     tblplus.idLocal         "
		                + " AND tblcategorias.idLinea     =             "
		                + "                     tblplus.idLinea         "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                 tblplus.idCategoria         "
		                + " WHERE   tblplus.idLocal       =             "
		                + "?1                              "
		                + " AND  tblplus.idLinea          = 1           "
		                + " AND  tblplus.idCategoria IN (1)             "
		                + " GROUP BY tblplus.idLocal,                   "
		                + "          tblplus.idEstracto) AS tmpR14      "
		                + " ON tbldctosordenesdetalle_1.IDLOCAL =       "
		                + "                              tmpR14.idLocal "
		                + " AND tbldctosordenesdetalle_1.idEstracto =   "
		                + "                           tmpR14.idEstracto "
		                + " AND tbldctosordenesdetalle_1.CANTIDAD   >   "
		                + "                    tmpR14.rangoMaximo       "
		                + " WHERE  tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59 "
		                + " AND  tbldctosordenesdetalle_1.IDTIPO    =4  "
		                + "                       )  AS tmpCAN          "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =    "
		                + "                           tmpCAN.IDLOCAL    "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "                       tmpCAN.IDTIPOORDEN    "
		                + " AND tbldctosordenesdetalle.IDORDEN     =    "
		                + "                           tmpCAN.IDORDEN    "
		                + " AND tbldctosordenesdetalle.IDPLU       =    "
		                + "                             tmpCAN.IDPLU    "
		                + " AND tbldctosordenesdetalle.idCliente   =    "
		                + "                         tmpCAN.idCliente    "
		                + " AND tbldctosordenesdetalle.STRIDLISTA  = 1 ",
		                nativeQuery = true)
			  public void actualizaComplementario(int idLocal );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " DELETE FROM tbldctosordenesdetalle       "
		                + " FROM   tblagendalogvisitas               "
		                + " INNER JOIN tbldctosordenes               "
		                + " ON tblagendalogvisitas.idLocal    = 	     "
		                + "                 tbldctosordenes.idLocal     "
		                + " AND tblagendalogvisitas.IDLOG    = 	     "
		                + "                 tbldctosordenes.IDLOG	 "
		                + " INNER JOIN tbldctosordenesdetalle        "
		                + " ON  tbldctosordenes.IDLOCAL     =        "
		                + "        tbldctosordenesdetalle.IDLOCAL    "
		                + " AND tbldctosordenes.IDTIPOORDEN =        "
		                + "    tbldctosordenesdetalle.IDTIPOORDEN    "
		                + " AND tbldctosordenes.IDORDEN     =        "
		                + "           tbldctosordenesdetalle.IDORDEN "
		                + " WHERE  tbldctosordenesdetalle.IDTIPO = 6 "
		                + " AND  tbldctosordenes.idLocal         =   "
		                + "?1                           "
		                + " AND  tbldctosordenes.IDTIPOORDEN     = ?2  ",
		                nativeQuery = true)
			  public void retiraCargoFijo(int idLocal, int IdTipoOrden );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " DELETE FROM tbldctosordenesdetalle  "
		                + " FROM         tbldctosordenes        "
		                + " INNER JOIN tbldctosordenesdetalle   "
		                + " ON tbldctosordenes.IDLOCAL      =   "
		                + "     tbldctosordenesdetalle.IDLOCAL  "
		                + " AND tbldctosordenes.IDTIPOORDEN =   "
		                + "  tbldctosordenesdetalle.IDTIPOORDEN "
		                + " AND tbldctosordenes.IDORDEN     =   "
		                + "      tbldctosordenesdetalle.IDORDEN "
		                + " WHERE     tbldctosordenes.IDLOCAL = "
		                + "?1                     "
		                + " AND  tbldctosordenes.IDTIPOORDEN  = "
		                + "?2                  "
		                + " AND  tbldctosordenes.idPeriodo   != ?3 ",
		                nativeQuery = true)
			  public void retiraPeriodoDiferente(int idLocal, int IdTipoOrden, int idPeriodo );
			 
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " DELETE FROM tbldctosordenesdetalle       "
		                + " FROM tbldctosordenes                     "
		                + " INNER JOIN tbldctosordenesdetalle        "
		                + " ON tbldctosordenes.IDLOCAL      =        "
		                + "     tbldctosordenesdetalle.IDLOCAL       "
		                + " AND tbldctosordenes.IDTIPOORDEN =        "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN     "
		                + " AND tbldctosordenes.IDORDEN     =        "
		                + "       tbldctosordenesdetalle.IDORDEN     "
		                + " INNER JOIN tblterceros                   "
		                + " ON tblterceros.idLocal          =        "
		                + "     tbldctosordenesdetalle.IDLOCAL       "
		                + " AND tblterceros.idCliente       =        "
		                + "   tbldctosordenesdetalle.idCliente       "
		                + " WHERE tblterceros.idLocal       =        "
		                + "?1                           "
		                + " AND  tblterceros.estado IN (2)           "
		                + " AND  tbldctosordenes.idPeriodo  =        "
		                + "?2                         "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN = ?3 ",
		                nativeQuery = true)
			  public void retiraSuspendidoDefinitivo(int idLocal, int idPeriodo, int IdTipoOrden );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle        "
		                + "            (IDLOCAL		    "
		                + "            ,IDTIPOORDEN		    "
		                + "            ,IDORDEN		    "
		                + "            ,IDPLU			    "
		                + "            ,CANTIDAD		    "
		                + "            ,IDTIPO		    "
		                + "            ,PORCENTAJEIVA		    "
		                + "            ,VRVENTAUNITARIO	    "
		                + "            ,ESTADO		    "
		                + "            ,NOMBREPLU		    "
		                + "            ,VRVENTAORIGINAL           "
		                + "            ,VRCOSTO                   "
		                + "            ,VRDSCTOPIE                "
		                + "            ,PORCENTAJEDSCTO           "
		                + "            ,CANTIDADPEDIDA            "
		                + "            ,item			    "
		                + "            ,itemPadre		    "
		                + "            ,idEstadoTx		    "
		                + "            ,idTipoTx		    "
		                + "            ,lecturaMedidor              "
		                + "            ,idCliente		    "
		                + "            ,idEstracto                  "
		                + "            ,idRuta)		            "
		                + " SELECT                                  "
		                + "?1 AS idLocal,	            "
		                + "?2  AS idTipoOrden,     "
		                + "?3  AS idOrden,	            "
		                + "        tblplus.idPlu, 		    "
		                + "        01 AS cantidad,		    "
		                + "        tblplus.idTipo, 		    "
		                + "        tblplus.porcentajeIva,           "
		                + "        tblplus.vrGeneral         *      "
		                + "        tblterceros.cuentaDerecho *      "
		                + "     ( CASE WHEN tblterceros.estado = 2  "
		                + "       THEN 0 ELSE 1 END )               "
		                + "                     AS vrVentaUnitario, "
		                + "                         0 AS estado,    "
		                + "  (tblcategorias.nombreCategoria + ' ' + "
		                + "       tblplus.nombrePlu) AS nombrePlu   "
		                + "            ,0 AS VRVENTAORIGINAL        "
		                + "            ,0 AS VRCOSTO                "
		                + "            ,0 AS VRDSCTOPIE             "
		                + "            ,0 AS PORCENTAJEDSCTO        "
		                + "            ,0 AS CANTIDADPEDIDA         "
		                + "            ,tblplus.idPlu AS item,      "
		                + "         1 AS itemPadre,        	    "
		                + "         0 AS idEstadoTx,                "
		                + "         0 AS idTipoTx,                  "
		                + "         0 AS lecturaMedidor,            "
		                + "         tblterceros.idCliente, 	    "
		                + "         tblterceros.idEstracto,         "
		                + "         tblterceros.idRuta              "
		                + " FROM   tblplus			    "
		                + " INNER JOIN tblterceros		    "
		                + " ON tblplus.idEstracto    = 		    "
		                + "               tblterceros.idEstracto    "
		                + " AND tblplus.idLocal      = 	            "
		                + "                    tblterceros.idLocal  "
		                + " INNER JOIN tblcategorias		    "
		                + " ON tblplus.idLinea = 		    "
		                + "                tblcategorias.idLinea    "
		                + " AND tblplus.idCategoria  = 		    "
		                + "            tblcategorias.IdCategoria    "
		                + " AND tblplus.idLocal      = 	            "
		                + "                   tblcategorias.idLocal "
		                + " INNER JOIN tblmarcas		    "
		                + " ON tblplus.idMarca       = 		    "
		                + "                    tblmarcas.idMarca    "
		                + " INNER JOIN tbllineas 		    "
		                + " ON tblplus.idLinea       = 		    "
		                + "                    tbllineas.idLinea    "
		                + " AND tblplus.idLocal      = 	            "
		                + "                       tbllineas.idLocal "
		                + " WHERE tblterceros.idLocal=              "
		                + "?1                          "
		                + " AND     tblplus.idTipo =                "
		                + "?4                           "
		                + " AND tblterceros.estado NOT IN (2)",
		                nativeQuery = true)
			  public void ingresaCargoFijo(int idLocal, int IdTipoOrden, int IdOrden, int IdTipo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle        "
		                + "            (IDLOCAL		    "
		                + "            ,IDTIPOORDEN		    "
		                + "            ,IDORDEN		    "
		                + "            ,IDPLU			    "
		                + "            ,CANTIDAD		    "
		                + "            ,IDTIPO		    "
		                + "            ,PORCENTAJEIVA		    "
		                + "            ,VRVENTAUNITARIO	    "
		                + "            ,ESTADO		    "
		                + "            ,NOMBREPLU		    "
		                + "            ,VRVENTAORIGINAL           "
		                + "            ,VRCOSTO                   "
		                + "            ,VRDSCTOPIE                "
		                + "            ,PORCENTAJEDSCTO           "
		                + "            ,CANTIDADPEDIDA            "
		                + "            ,item			    "
		                + "            ,itemPadre		    "
		                + "            ,idEstadoTx		    "
		                + "            ,idTipoTx		    "
		                + "            ,lecturaMedidor            "
		                + "            ,idCliente		    "
		                + "            ,idEstracto                "
		                + "            ,idRuta)		    "
		                + " SELECT                                  "
		                + "?1 AS idLocal,	            "
		                + "?2  AS idTipoOrden,     "
		                + "?3  AS idOrden,	            "
		                + "        tblplus.idPlu, 		    "
		                + "        01 AS cantidad,		    "
		                + "        18 AS idTipo, 		    "
		                + "        tblplus.porcentajeIva,           "
		                + "        tblplus.vrGeneral         *      "
		                + "        tblterceros.cuentaDerecho *      "
		                + "     ( CASE WHEN tblterceros.estado = 2  "
		                + "       THEN 0 ELSE 1 END )               "
		                + "                     AS vrVentaUnitario, "
		                + "                         0 AS estado,    "
		                + "  (tblcategorias.nombreCategoria + ' ' + "
		                + "       tblplus.nombrePlu) AS nombrePlu   "
		                + "            ,0 AS VRVENTAORIGINAL        "
		                + "            ,0 AS VRCOSTO                "
		                + "            ,0 AS VRDSCTOPIE             "
		                + "            ,0 AS PORCENTAJEDSCTO        "
		                + "            ,0 AS CANTIDADPEDIDA         "
		                + "            ,tblplus.idPlu AS item,      "
		                + "         1 AS itemPadre,        	    "
		                + "         0 AS idEstadoTx,                "
		                + "         0 AS idTipoTx,                  "
		                + "         0 AS lecturaMedidor,            "
		                + "         tblterceros.idCliente, 	    "
		                + "         tblterceros.idEstracto,         "
		                + "         tblterceros.idRuta              "
		                + " FROM   tblplus			    "
		                + " INNER JOIN tblterceros		    "
		                + " ON tblplus.idEstracto    = 		    "
		                + "               tblterceros.idEstracto    "
		                + " AND tblplus.idLocal      = 	            "
		                + "                    tblterceros.idLocal  "
		                + " INNER JOIN tblcategorias		    "
		                + " ON tblplus.idLinea = 		    "
		                + "                tblcategorias.idLinea    "
		                + " AND tblplus.idCategoria  = 		    "
		                + "            tblcategorias.IdCategoria    "
		                + " AND tblplus.idLocal      = 	            "
		                + "                   tblcategorias.idLocal "
		                + " INNER JOIN tblmarcas		    "
		                + " ON tblplus.idMarca       = 		    "
		                + "                    tblmarcas.idMarca    "
		                + " INNER JOIN tbllineas 		    "
		                + " ON tblplus.idLinea       = 		    "
		                + "                    tbllineas.idLinea    "
		                + " AND tblplus.idLocal      = 	            "
		                + "                       tbllineas.idLocal "
		                + " WHERE tblterceros.idLocal=              "
		                + "?1                          "
		                + " AND tblterceros.idTipoTercero = 1       "
		                + " AND     tblplus.idTipo =                "
		                + "?4                           "
		                + " AND tblterceros.idEstracto!=0 ",
		                nativeQuery = true)
			  public void ingresaCargoOtros(int idLocal, int IdTipoOrden, int IdOrden, int IdTipo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle        "
		                + "            (IDLOCAL		    "
		                + "            ,IDTIPOORDEN		    "
		                + "            ,IDORDEN		    "
		                + "            ,IDPLU			    "
		                + "            ,CANTIDAD		    "
		                + "            ,IDTIPO		    "
		                + "            ,PORCENTAJEIVA		    "
		                + "            ,VRVENTAUNITARIO	    "
		                + "            ,ESTADO		    "
		                + "            ,NOMBREPLU		    "
		                + "            ,VRVENTAORIGINAL           "
		                + "            ,VRCOSTO                   "
		                + "            ,VRDSCTOPIE                "
		                + "            ,PORCENTAJEDSCTO           "
		                + "            ,CANTIDADPEDIDA            "
		                + "            ,item			    "
		                + "            ,itemPadre		    "
		                + "            ,idEstadoTx		    "
		                + "            ,idTipoTx		    "
		                + "            ,lecturaMedidor            "
		                + "            ,idCliente		    "
		                + "            ,idEstracto                "
		                + "            ,idRuta)		    "
		                + " SELECT                                  "
		                + "?1 AS idLocal,	            "
		                + "?2 AS idTipoOrden,     "
		                + "?3  AS idOrden,	            "
		                + "         tblplus.idPlu,               "
		                + "        tmpALC.cantida  AS cantidad,  "
		                + "         tblplus.idTipo, 	         "
		                + "        tblplus.porcentajeIva,        "
		                + "        tblplus.vrGeneral         *   "
		                + "        tblterceros.cuentaDerecho *   "
		                + "  ( CASE WHEN tblterceros.estado = 2  "
		                + " THEN 0 ELSE 1 END )                  "
		                + "                  AS vrVentaUnitario, "
		                + "                  0 AS estado,        "
		                + "   (tblcategorias.nombreCategoria +   "
		                + "                              ' ' +   "
		                + "   tblplus.nombrePlu) AS nombrePlu    "
		                + "        ,0 AS VRVENTAORIGINAL         "
		                + "             ,0 AS VRCOSTO            "
		                + "             ,0 AS VRDSCTOPIE         "
		                + "             ,0 AS PORCENTAJEDSCTO    "
		                + "             ,0 AS CANTIDADPEDIDA     "
		                + "          ,tblplus.idPlu AS item,     "
		                + "          1 AS itemPadre,        	 "
		                + "          0 AS idEstadoTx,            "
		                + "          0 AS idTipoTx,              "
		                + "          0 AS lecturaMedidor,        "
		                + "          tblterceros.idCliente, 	 "
		                + "          tblterceros.idEstracto,     "
		                + "          tblterceros.idRuta          "
		                + "  FROM   tblplus			 "
		                + "  INNER JOIN tblterceros		 "
		                + "  ON tblplus.idEstracto    = 	 "
		                + "             tblterceros.idEstracto   "
		                + "  AND tblplus.idLocal      = 	 "
		                + "                 tblterceros.idLocal  "
		                + "  INNER JOIN tblcategorias		 "
		                + "  ON tblplus.idLinea = 		 "
		                + "             tblcategorias.idLinea    "
		                + "  AND tblplus.idCategoria  = 	 "
		                + "          tblcategorias.IdCategoria   "
		                + "  AND tblplus.idLocal      = 	 "
		                + "               tblcategorias.idLocal  "
		                + "  INNER JOIN tblmarcas		 "
		                + "  ON tblplus.idMarca       = 	 "
		                + "                tblmarcas.idMarca     "
		                + "  INNER JOIN tbllineas 		 "
		                + "  ON tblplus.idLinea       = 	 "
		                + "                tbllineas.idLinea     "
		                + "  AND tblplus.idLocal      =          "
		                + "                 tbllineas.idLocal    "
		                + "  INNER JOIN (                        "
		                + "     SELECT idCliente               "
		                + "       ,1 AS cantida                  "
		                + "     FROM tbldctosordenesdetalle    "
		                + "     WHERE IDLOCAL    =               "
		                + "?1                       "
		                + "     AND  IDTIPOORDEN  =              "
		                + "?2                   "
		                + "     AND IDTIPO       = 4             "
		                + "   GROUP BY  idCliente )            "
		                + "                      AS tmpALC       "
		                + "   ON tmpALC.idCliente =              "
		                + "            tblterceros.idCliente     "
		                + "   WHERE tblterceros.idLocal=         "
		                + "?1                       "
		                + "    AND     tblplus.idTipo   =  ?4      ",
		                nativeQuery = true)
			  public void ingresaAlcantarillaCargoFijo(int idLocal, int IdTipoOrden, int IdOrden, int IdTipo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle       "
		                + "            (IDLOCAL		     "
		                + "            ,IDTIPOORDEN		     "
		                + "            ,IDORDEN		     "
		                + "            ,IDPLU			     "
		                + "            ,CANTIDAD		     "
		                + "            ,IDTIPO		     "
		                + "            ,PORCENTAJEIVA		     "
		                + "            ,VRVENTAUNITARIO	     "
		                + "            ,ESTADO		     "
		                + "            ,NOMBREPLU		     "
		                + "            ,VRVENTAORIGINAL            "
		                + "            ,VRCOSTO                    "
		                + "            ,VRDSCTOPIE                 "
		                + "            ,PORCENTAJEDSCTO            "
		                + "            ,CANTIDADPEDIDA             "
		                + "            ,strIdLista                 "
		                + "            ,item			     "
		                + "            ,itemPadre		     "
		                + "            ,idEstadoTx		     "
		                + "            ,idTipoTx		     "
		                + "            ,lecturaMedidor             "
		                + "            ,idCliente		     "
		                + "            ,idEstracto                 "
		                + "            ,idRuta)		     "
		                + " SELECT  ?1 AS idLocal, "
		                + "?2  AS idTipoOrden,      "
		                + "?3  AS idOrden,	             "
		                + "   tmpCAT.idPlu, 		             "
		                + "   tbldctosordenesdetalle.cantidad ,      "
		                + "   tmpCAT.idTipo, 		             "
		                + "   tmpCAT.porcentajeIva,                  "
		                + "   tmpCAT.vrGeneral  AS vrVentaUnitario,  "
		                + "   0 AS estado,                           "
		                + "   tmpCAT.nombrePlu AS nombrePlu,         "
		                + "   (tmpCAT.vrGeneral) AS VRVENTAORIGINAL  "
		                + "   ,0 AS VRCOSTO                          "
		                + "   ,0 AS VRDSCTOPIE                       "
		                + "   ,0 AS PORCENTAJEDSCTO                  "
		                + "   ,tbldctosordenesdetalle.cantidad       "
		                + "                        AS CANTIDADPEDIDA "
		                + "   ,tmpCAT.topeMaximo AS strIdLista       "
		                + "   ,tmpCAT.topeMaximo AS item,            "
		                + "    1 AS itemPadre,        	             "
		                + "    0 AS idEstadoTx,                      "
		                + "    0 AS idTipoTx,                        "
		                + "    0 AS lecturaMedidor,                  "
		                + "    tbldctosordenesdetalle.idCliente,      "
		                + "    tbldctosordenesdetalle.idEstracto,       "
		                + "    tbldctosordenesdetalle.idRuta            "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN  tbldctosordenes                 "
		                + " ON tbldctosordenesdetalle.IDLOCAL  =        "
		                + "                     tbldctosordenes.IDLOCAL "
		                + " AND tbldctosordenesdetalle.IDORDEN =        "
		                + "                     tbldctosordenes.IDORDEN "
		                + " AND  tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                 tbldctosordenes.IDTIPOORDEN "
		                + " INNER JOIN                                  "
		                + " ( SELECT tblplus.idLocal,                   "
		                + "          tblplus.idTipo,                    "
		                + "          tblplus.idPlu,                     "
		                + "	     tblplus.porcentajeIva,             "
		                + "	     tblplus.vrGeneral,                 "
		                + "	 (tblcategorias.nombreCategoria + ' ' + "
		                + "	       tblplus.nombrePlu) AS nombrePlu, "
		                + "	     tblplus.idEstracto,                "
		                + "          tblplus.topeMaximo                 "
		                + " FROM tblcategorias                          "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal  = tblplus.idLocal "
		                + " AND tblcategorias.idLinea = tblplus.idLinea "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                         tblplus.idCategoria "
		                + " WHERE tblplus.idLocal =                     "
		                + "?1                              "
		                + " AND   tblplus.idTipo  =                     "
		                + "?4 ) AS tmpCAT                    "
		                + " ON tbldctosordenesdetalle.IDLOCAL =         "
		                + "                             tmpCAT.idLocal  "
		                + " AND tbldctosordenesdetalle.idEstracto  =    "
		                + "                           tmpCAT.idEstracto "
		                + " AND tmpCAT.topeMaximo  =                    "
		                + "           tbldctosordenesdetalle.strIdLista "
		                + " WHERE tbldctosordenesdetalle.idLocal   =    "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "?2                          "
		                + " AND (tmpCAT.vrGeneral *                     "
		                + "      tbldctosordenesdetalle.cantidad) != 0  "
		                + " AND  tbldctosordenesdetalle.idTipo = 4      ",
		                nativeQuery = true)
			  public void ingresaAlcantarillaConsumo(int idLocal, int IdTipoOrden, int IdOrden, int IdTipo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle         "
		                + "SET VRVENTAUNITARIO = 0               "
		                + "FROM tbldctosordenes                  "
		                + "INNER JOIN tbldctosordenesdetalle     "
		                + "ON tbldctosordenes.IDLOCAL =          "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tbldctosordenes.IDTIPOORDEN =     "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN "
		                + "AND tbldctosordenes.IDORDEN =         "
		                + "       tbldctosordenesdetalle.IDORDEN "
		                + "INNER JOIN tblterceros                "
		                + "ON tblterceros.idLocal =              "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tblterceros.idCliente =           "
		                + "     tbldctosordenesdetalle.idCliente "
		                + "WHERE tblterceros.idLocal =           "
		                + "?1                       "
		                + "AND tblterceros.estado IN (5,6)       "
		                + "AND tbldctosordenes.idPeriodo =       "
		                + "?2                     "
		                + "AND tbldctosordenesdetalle.IDTIPOORDEN = "
		                + "?3                   "
		                + "AND tbldctosordenesdetalle.IDTIPO IN (6,50)",
		                nativeQuery = true)
			  public void anulaCargoFijoSuspendidoParcial(int idLocal, int idPeriodo, int IdTipoOrden);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle           "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "            ,idEstracto                     "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT tbldctosordenesdetalle.IDLOCAL      "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       ,( CANTIDAD - rangoMaximo )         "
		                + " 	                    AS cantidad        "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	                    AS vrVentaUnitario "
		                + "       ,ESTADO                              "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	                   AS VRVENTAORIGINAL  "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,3 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,comentario                          "
		                + "       ,tmpRNG3.IDPLU AS item               "
		                + "       ,itemPadre                           "
		                + "       ,idEstadoTx                          "
		                + "       ,idTipoTx                            "
		                + "       ,fechaEntrega                        "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,idCliente                           "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "    ( SELECT tblplus.idLocal,               "
		                + "      SUM(tblplus.rangoMaximo)              "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10,19)           "
		                + " AND tblplus.idEstracto   =  1              "
		                + " GROUP BY tblplus.idLocal ) AS tmpR14       "
		                + " ON tbldctosordenesdetalle.idLocal =        "
		                + "                        tmpR14.idLocal      "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "      tblplus.idPlu,                        "
		                + "  tblcategorias.nombreCategoria + ' ' +     "
		                + "    tblplus.nombrePlu AS nombrePlu,         "
		                + "    tblplus.vrGeneral,                      "
		                + "    tblplus.idTipo,                         "
		                + "    tblplus.idEstracto                      "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                              "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + "   WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =51"
		                + "   AND tbldctosordenesdetalle.CANTIDAD    > "
		                + "                     tmpR14.rangoMaximo ",
		                nativeQuery = true)
			  public void ingresaSuntuarioAlcantarillado(int idLocal);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle              "
		                + " SET CANTIDAD =                             "
		                + "  ( CANTIDAD - cantidadSuntuario )          "
		                + " FROM tbldctosordenesdetalle                "
		                + " INNER JOIN                                 "
		                + "   (SELECT                                  "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,      "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,  "
		                + "     tbldctosordenesdetalle_1.IDORDEN,      "
		                + "     tbldctosordenesdetalle_1.IDPLU,        "
		                + " 	( tbldctosordenesdetalle_1.CANTIDAD -  "
		                + " 		     tmpR14.rangoMaximo )      "
		                + " 		      AS cantidadSuntuario,    "
		                + "      tbldctosordenesdetalle_1.idCliente    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "       AS tbldctosordenesdetalle_1          "
		                + "   INNER JOIN                               "
		                + "   (SELECT  tblplus.idLocal,                "
		                + "        SUM(tblplus.rangoMaximo)            "
		                + " 	            AS rangoMaximo             "
		                + "    FROM tblcategorias                      "
		                + "    INNER JOIN tblplus                      "
		                + "    ON tblcategorias.idLocal      =         "
		                + "                     tblplus.idLocal        "
		                + "    AND tblcategorias.idLinea     =         "
		                + "                     tblplus.idLinea        "
		                + "    AND tblcategorias.IdCategoria =         "
		                + "                 tblplus.idCategoria        "
		                + "   WHERE       tblplus.idLocal =            "
		                + "?1                             "
		                + "   AND  tblplus.idLinea        = 1          "
		                + "   AND  tblplus.idCategoria   IN (10,19)     "
		                + "   AND  tblplus.idEstracto     = 1          "
		                + "   GROUP BY tblplus.idLocal) AS tmpR14      "
		                + "   ON tbldctosordenesdetalle_1.IDLOCAL =    "
		                + "                           tmpR14.idLocal   "
		                + "   AND tbldctosordenesdetalle_1.CANTIDAD >  "
		                + "                        tmpR14.rangoMaximo  "
		                + " WHERE tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59"
		                + " AND tbldctosordenesdetalle_1.IDTIPO     =51 "
		                + "                         ) AS tmpCAN        "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =   "
		                + "                           tmpCAN.IDLOCAL   "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                       tmpCAN.IDTIPOORDEN   "
		                + " AND tbldctosordenesdetalle.IDORDEN     =   "
		                + "                           tmpCAN.IDORDEN   "
		                + " AND tbldctosordenesdetalle.IDPLU       =   "
		                + "                             tmpCAN.IDPLU   "
		                + " AND tbldctosordenesdetalle.idCliente   =   "
		                + "                         tmpCAN.idCliente   "
		                + " AND  tbldctosordenesdetalle.strIdLista = 1",
		                nativeQuery = true)
			  public void actualizaSuntuarioAlcantarillado(int idLocal);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle           "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT                                     "
		                + "    tbldctosordenesdetalle.IDLOCAL          "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       ,( CANTIDAD -                        "
		                + " 	     tmpRNG.rangoMaximo)               "
		                + " 	            AS cantidad                "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	        AS vrVentaUnitario             "
		                + "       ,ESTADO                              "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	    AS VRVENTAORIGINAL                 "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,2 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,comentario                          "
		                + "       ,tmpRNG3.IDPLU  AS item              "
		                + "       ,itemPadre                           "
		                + "       ,idEstadoTx                          "
		                + "       ,idTipoTx                            "
		                + "       ,fechaEntrega                        "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,idCliente                           "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "      ( SELECT tblplus.idLocal,             "
		                + "   SUM(tblplus.rangoMaximo)                 "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10)             "
		                + " AND tblplus.idEstracto   =  1              "
		                + " GROUP BY tblplus.idLocal )                 "
		                + "                      AS tmpRNG             "
		                + " ON tbldctosordenesdetalle.idLocal          "
		                + "                  = tmpRNG.idLocal          "
		                + "  INNER JOIN                                "
		                + "         ( SELECT tblplus.idLocal,          "
		                + "   SUM(tblplus.rangoMaximo)                 "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10,19)           "
		                + " AND tblplus.idEstracto   =  1              "
		                + " GROUP BY tblplus.idLocal )                 "
		                + "                       AS tmpRNG4           "
		                + "   ON tbldctosordenesdetalle.idLocal        "
		                + "                  = tmpRNG4.idLocal         "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "   tblplus.idPlu,                           "
		                + "   tblcategorias.nombreCategoria + ' ' +    "
		                + "   tblplus.nombrePlu AS nombrePlu,          "
		                + " 	      tblplus.vrGeneral,               "
		                + "              tblplus.idTipo,               "
		                + "              tblplus.idEstracto            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.idCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (19))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + "   WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =51 "
		                + " AND tbldctosordenesdetalle.strIdLista  =1  "
		                + " AND ( CANTIDAD - tmpRNG.rangoMaximo )  >0  "
		                + "   AND tbldctosordenesdetalle.CANTIDAD  <=  "
		                + "                     tmpRNG4.rangoMaximo ",
		                nativeQuery = true)
			  public void ingresaComplementarioAlcantarillado(int idLocal);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE   tbldctosordenesdetalle               "
		                + " SET CANTIDAD =                              "
		                + "   ( CANTIDAD -                              "
		                + "     tmpCAN.cantidadComplementario )         "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN                                  "
		                + "   (SELECT                                   "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,       "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,   "
		                + "     tbldctosordenesdetalle_1.IDORDEN,       "
		                + "     tbldctosordenesdetalle_1.IDPLU,         "
		                + "     tbldctosordenesdetalle_1.CANTIDAD -     "
		                + " 		         tmpR14.rangoMaximo     "
		                + "           AS cantidadComplementario,        "
		                + "     tbldctosordenesdetalle_1.idCliente      "
		                + "  FROM  tbldctosordenesdetalle               "
		                + "           AS tbldctosordenesdetalle_1       "
		                + "  INNER JOIN                                 "
		                + "    (SELECT tblplus.idLocal,                 "
		                + "            SUM(tblplus.rangoMaximo)         "
		                + " 		   AS rangoMaximo               "
		                + "  FROM  tblcategorias                        "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal      =             "
		                + "                     tblplus.idLocal         "
		                + " AND tblcategorias.idLinea     =             "
		                + "                     tblplus.idLinea         "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                 tblplus.idCategoria         "
		                + " WHERE   tblplus.idLocal       =             "
		                + "?1                              "
		                + " AND  tblplus.idLinea          = 1           "
		                + " AND  tblplus.idCategoria IN (10)             "
		                + " AND  tblplus.idEstracto       = 1           "
		                + " GROUP BY tblplus.idLocal)                   "
		                + "                 AS tmpR14                   "
		                + " ON tbldctosordenesdetalle_1.IDLOCAL =       "
		                + "                    tmpR14.idLocal AND       "
		                + " tbldctosordenesdetalle_1.CANTIDAD   >       "
		                + "                    tmpR14.rangoMaximo       "
		                + " WHERE  tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59 "
		                + " AND  tbldctosordenesdetalle_1.IDTIPO    =51 "
		                + "                       )  AS tmpCAN          "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =    "
		                + "                           tmpCAN.IDLOCAL    "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "                       tmpCAN.IDTIPOORDEN    "
		                + " AND tbldctosordenesdetalle.IDORDEN     =    "
		                + "                           tmpCAN.IDORDEN    "
		                + " AND tbldctosordenesdetalle.IDPLU       =    "
		                + "                             tmpCAN.IDPLU    "
		                + " AND tbldctosordenesdetalle.idCliente   =    "
		                + "                         tmpCAN.idCliente    "
		                + " AND tbldctosordenesdetalle.STRIDLISTA  = 1 ",
		                nativeQuery = true)
			  public void actualizaComplementarioAlcantarillado(int idLocal);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle        "
		                + "            (IDLOCAL		    "
		                + "            ,IDTIPOORDEN		    "
		                + "            ,IDORDEN		    "
		                + "            ,IDPLU			    "
		                + "            ,CANTIDAD		    "
		                + "            ,IDTIPO		    "
		                + "            ,PORCENTAJEIVA		    "
		                + "            ,VRVENTAUNITARIO	    "
		                + "            ,ESTADO		    "
		                + "            ,NOMBREPLU		    "
		                + "            ,VRVENTAORIGINAL           "
		                + "            ,VRCOSTO                   "
		                + "            ,VRDSCTOPIE                "
		                + "            ,PORCENTAJEDSCTO           "
		                + "            ,CANTIDADPEDIDA            "
		                + "            ,item			    "
		                + "            ,itemPadre		    "
		                + "            ,idEstadoTx		    "
		                + "            ,idTipoTx		    "
		                + "            ,lecturaMedidor            "
		                + "            ,idCliente		    "
		                + "            ,idEstracto                "
		                + "            ,idRuta)		    "
		                + " SELECT                                  "
		                + "?1 AS idLocal,	            "
		                + "?2  AS idTipoOrden,     "
		                + "?3 AS idOrden,	            "
		                + "         tblplus.idPlu,               "
		                + "        tmpALC.cantida                "
		                + "            AS cantidad,	         "
		                + "         tblplus.idTipo, 	         "
		                + "        tblplus.porcentajeIva,        "
		                + "        tblplus.vrGeneral         *   "
		                + "        tblterceros.cuentaDerecho *   "
		                + "  ( CASE WHEN tblterceros.estado = 2  "
		                + " THEN 0 ELSE 1 END )                  "
		                + "                  AS vrVentaUnitario, "
		                + "                  0 AS estado,        "
		                + "   (tblcategorias.nombreCategoria +   "
		                + "                              ' ' +   "
		                + "   tblplus.nombrePlu) AS nombrePlu    "
		                + "        ,0 AS VRVENTAORIGINAL         "
		                + "             ,0 AS VRCOSTO            "
		                + "             ,0 AS VRDSCTOPIE         "
		                + "             ,0 AS PORCENTAJEDSCTO    "
		                + "             ,0 AS CANTIDADPEDIDA     "
		                + "        ,tblplus.idPlu AS item,       "
		                + "          1 AS itemPadre,        	 "
		                + "          0 AS idEstadoTx,            "
		                + "          0 AS idTipoTx,              "
		                + "          0 AS lecturaMedidor,        "
		                + "          tblterceros.idCliente, 	 "
		                + "          tblterceros.idEstracto,     "
		                + "          tblterceros.idRuta          "
		                + "  FROM   tblplus			 "
		                + "  INNER JOIN tblterceros		 "
		                + "  ON tblplus.idEstracto    = 	 "
		                + "             tblterceros.idEstracto   "
		                + "  AND tblplus.idLocal      = 	 "
		                + "                 tblterceros.idLocal  "
		                + "  INNER JOIN tblcategorias		 "
		                + "  ON tblplus.idLinea = 		 "
		                + "             tblcategorias.idLinea    "
		                + "  AND tblplus.idCategoria  = 	 "
		                + "          tblcategorias.IdCategoria   "
		                + "  AND tblplus.idLocal      = 	 "
		                + "               tblcategorias.idLocal  "
		                + "  INNER JOIN tblmarcas		 "
		                + "  ON tblplus.idMarca       = 	 "
		                + "                tblmarcas.idMarca     "
		                + "  INNER JOIN tbllineas 		 "
		                + "  ON tblplus.idLinea       = 	 "
		                + "                tbllineas.idLinea     "
		                + "  AND tblplus.idLocal      =          "
		                + "                 tbllineas.idLocal    "
		                + "  INNER JOIN (                        "
		                + "     SELECT idCliente               "
		                + "       ,1 AS cantida                  "
		                + "     FROM tbldctosordenesdetalle    "
		                + "     WHERE IDLOCAL    =               "
		                + "?1                       "
		                + "     AND  IDTIPOORDEN  =              "
		                + "?2                   " 
		                + "     AND IDTIPO       = 4             "
		                + "   GROUP BY  idCliente )              "
		                + "                      AS tmpALC       "
		                + "   ON tmpALC.idCliente =              "
		                + "            tblterceros.idCliente     "
		                + "   WHERE tblterceros.idLocal=         "
		                + "?1                       "
		                + "    AND     tblplus.idTipo   =   ?4     ",
		                nativeQuery = true)
			  public void ingresaAseoCargoFijo(int idLocal, int IdTipoOrden, int IdOrden, int IdTipo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle                 "
		                + "SET IDPLU = tblplus.idPlu,                    "
		                + "    idEstracto = tblterceros.idEstracto,      "
		                + "    VRVENTAUNITARIO = tblplus.vrGeneral       "
		                + "FROM     tbldctosordenes                      "
		                + "INNER JOIN  tbldctosordenesdetalle            "
		                + "ON tbldctosordenes.IDLOCAL      =             "
		                + "               tbldctosordenesdetalle.IDLOCAL "
		                + "AND tbldctosordenes.IDTIPOORDEN =             "
		                + "           tbldctosordenesdetalle.IDTIPOORDEN "
		                + "AND tbldctosordenes.IDORDEN    =              "
		                + "               tbldctosordenesdetalle.IDORDEN "
		                + "INNER JOIN tblterceros                        "
		                + "ON tblterceros.IDLOCAL     =                  "
		                + "                      tbldctosordenes.idLocal "
		                + "AND tblterceros.idCliente =                   "
		                + "             tbldctosordenesdetalle.idCliente "
		                + "INNER JOIN tblplus                            "
		                + "ON tblterceros.IDLOCAL = tblplus.idLocal      "
		                + "AND tblterceros.idEstracto  =                 "
		                + "                           tblplus.idEstracto "
		                + "WHERE tbldctosordenes.idLocal       =         "
		                + "?1                               "
		                + "AND   tbldctosordenes.idPeriodo     =         "
		                + "?2                             "
		                + "AND   tbldctosordenesdetalle.IDTIPO = 4       "
		                + "AND   tblplus.idTipo   =                      "
		                + "               tbldctosordenesdetalle.IDTIPO  "
		                + "AND   tblplus.idCategoria = 1                 "
		                + "AND   tbldctosordenesdetalle.idEstracto!=     "
		                + "                      tblterceros.idEstracto",
		                nativeQuery = true)
			  public void actualizaListaPrecioEstratoPlu(int idLocal, int idPeriodo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle          "
		                + " SET VRVENTAUNITARIO = tmpPLU.vrGeneral"
		                + " FROM tbldctosordenes                  "
		                + " INNER JOIN tbldctosordenesdetalle     "
		                + " ON tbldctosordenes.IDLOCAL      =     "
		                + "         tbldctosordenesdetalle.IDLOCAL"
		                + " AND tbldctosordenes.IDTIPOORDEN =     "
		                + "     tbldctosordenesdetalle.IDTIPOORDEN"
		                + " AND tbldctosordenes.IDORDEN     =     "
		                + "         tbldctosordenesdetalle.IDORDEN"
		                + " INNER JOIN                            "
		                + " (SELECT tblplus.idLocal,              "
		                + "         tblplus.idPlu,                "
		                + "         tblplus.vrGeneral,            "
		                + " 	    tblplus.idEstracto            "
		                + "  FROM tblcategorias                   "
		                + "  INNER JOIN tblplus                   "
		                + "  ON tblcategorias.idLocal      =      "
		                + "                       tblplus.idLocal "
		                + "  AND tblcategorias.idLinea     =      "
		                + "                       tblplus.idLinea "
		                + "  AND tblcategorias.IdCategoria =      "
		                + "                   tblplus.idCategoria "
		                + " WHERE tblplus.idLocal          =      "
		                + "?1                        "
		                + " AND tblplus.idTipo = 4) AS tmpPLU     "
		                + " ON tbldctosordenes.IDLOCAL     =      "
		                + "                        tmpPLU.idLocal "
		                + " AND tbldctosordenesdetalle.IDPLU =    "
		                + "                          tmpPLU.idPlu "
		                + " AND tbldctosordenesdetalle.idEstracto "
		                + "                   = tmpPLU.idEstracto "
		                + " WHERE tbldctosordenes.IDLOCAL       = "
		                + "?1                        "
		                + " AND tbldctosordenes.IDTIPOORDEN  = 59 "
		                + " AND tbldctosordenes.idPeriodo       = "
		                + "?2                      "
		                + " AND tbldctosordenesdetalle.IDTIPO = 4 ",
		                nativeQuery = true)
			  public void actualizaListaPrecio(int idLocal, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle       "
		                + "            (IDLOCAL		     "
		                + "            ,IDTIPOORDEN		     "
		                + "            ,IDORDEN		     "
		                + "            ,IDPLU			     "
		                + "            ,CANTIDAD		     "
		                + "            ,IDTIPO		     "
		                + "            ,PORCENTAJEIVA		     "
		                + "            ,VRVENTAUNITARIO	     "
		                + "            ,ESTADO		     "
		                + "            ,NOMBREPLU		     "
		                + "            ,VRVENTAORIGINAL            "
		                + "            ,VRCOSTO                    "
		                + "            ,VRDSCTOPIE                 "
		                + "            ,PORCENTAJEDSCTO            "
		                + "            ,CANTIDADPEDIDA             "
		                + "            ,strIdLista                 "
		                + "            ,item			     "
		                + "            ,itemPadre		     "
		                + "            ,idEstadoTx		     "
		                + "            ,idTipoTx		     "
		                + "            ,lecturaMedidor             "
		                + "            ,idCliente		     "
		                + "            ,idEstracto                 "
		                + "            ,idRuta)		     "
		                + " SELECT                            "
		                + "?1  AS idLocal,	      "
		                + "?2                "
		                + "  AS idTipoOrden,                  "
		                + "?3  AS idOrden,	      "
		                + "   tblplus.idPlu, 		      "
		                + "   01 AS cantidad,		      "
		                + "   tblplus.idTipo, 		      "
		                + "   tblplus.porcentajeIva, 	      "
		                + "   ( tblplus.vrGeneral *           "
		                + "?4 ) AS vrVentaUnitario,  "
		                + "                0 AS estado,       "
		                + " tblcategorias.nombreCategoria +   "
		                + "  ' ' + tblplus.nombrePlu          "
		                + "               AS nombrePlu,       "
		                + "   ( tblplus.vrGeneral *           "
		                + "?4 ) AS VRVENTAORIGINAL,  "
		                + " 0 AS VRCOSTO         ,            "
		                + " 0 AS VRDSCTOPIE      ,            "
		                + " 0 AS PORCENTAJEDSCTO ,            "
		                + " 0 AS CANTIDADPEDIDA  ,            "
		                + " 0 AS  strIdLista,                 "
		                + " tblterceros.idCliente             "
		                + "              AS item,             "
		                + " 1 AS itemPadre,        	      "
		                + " 0 AS idEstadoTx,                  "
		                + " 0 AS idTipoTx,                    "
		                + " 0 AS lecturaMedidor,              "
		                + " tblterceros.idCliente, 	      "
		                + " tblterceros.idEstracto,           "
		                + " tblterceros.idRuta                "
		                + " FROM   tblplus		      "
		                + " INNER JOIN tblterceros	      "
		                + " ON tblplus.idEstracto    = 	      "
		                + "      tblterceros.idEstracto       "
		                + " AND tblplus.idLocal      = 	      "
		                + "         tblterceros.idLocal       "
		                + " INNER JOIN tblcategorias	      "
		                + " ON tblplus.idLinea = 	      "
		                + "       tblcategorias.idLinea       "
		                + " AND tblplus.idCategoria  = 	      "
		                + "    tblcategorias.IdCategoria      "
		                + " AND tblplus.idLocal      = 	      "
		                + "        tblcategorias.idLocal      "
		                + " INNER JOIN tblmarcas	      "
		                + " ON tblplus.idMarca       = 	      "
		                + "            tblmarcas.idMarca      "
		                + " INNER JOIN tbllineas 	      "
		                + " ON tblplus.idLinea       = 	      "
		                + "             tbllineas.idLinea     "
		                + " AND tblplus.idLocal      =        "
		                + "             tbllineas.idLocal     "
		                + " WHERE tblterceros.idLocal =       "
		                + "?1                    "
		                + " AND   tblplus.idLinea     =  1    "
		                + " AND tblplus.idTipo        =       "
		                + "?5                     "
		                + " AND tblplus.vrGeneral    != 0     "
		                + " AND tblterceros.estado NOT IN (2) ",
		                nativeQuery = true)
			  public void ingresaCategoriaCargoFijo(int idLocal, int IdTipoOrden, int IdOrden, int xIdSigno, int IdTipo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle       "
		                + "            (IDLOCAL		     "
		                + "            ,IDTIPOORDEN		     "
		                + "            ,IDORDEN		     "
		                + "            ,IDPLU			     "
		                + "            ,CANTIDAD		     "
		                + "            ,IDTIPO		     "
		                + "            ,PORCENTAJEIVA		     "
		                + "            ,VRVENTAUNITARIO	     "
		                + "            ,ESTADO		     "
		                + "            ,NOMBREPLU		     "
		                + "            ,VRVENTAORIGINAL            "
		                + "            ,VRCOSTO                    "
		                + "            ,VRDSCTOPIE                 "
		                + "            ,PORCENTAJEDSCTO            "
		                + "            ,CANTIDADPEDIDA             "
		                + "            ,strIdLista                 "
		                + "            ,item			     "
		                + "            ,itemPadre		     "
		                + "            ,idEstadoTx		     "
		                + "            ,idTipoTx		     "
		                + "            ,lecturaMedidor             "
		                + "            ,idCliente		     "
		                + "            ,idEstracto                 "
		                + "            ,idRuta)		     "
		                + " SELECT  ?1 AS idLocal, "
		                + "?2  AS idTipoOrden,      "
		                + "?3  AS idOrden,	             "
		                + "   tmpCAT.idPlu, 		             "
		                + "   tbldctosordenesdetalle.cantidad,       "
		                + "   tmpCAT.idTipo, 		             "
		                + "   tmpCAT.porcentajeIva,                  "
		                + "   (tmpCAT.vrGeneral *                    "
		                + "?4)  AS vrVentaUnitario,         "
		                + "   0 AS estado,                           "
		                + "   tmpCAT.nombrePlu AS nombrePlu,         "
		                + "   (tmpCAT.vrGeneral *                    "
		                + "?4) AS VRVENTAORIGINAL           "
		                + "   ,0 AS VRCOSTO                          "
		                + "   ,0 AS VRDSCTOPIE                       "
		                + "   ,0 AS PORCENTAJEDSCTO                  "
		                + "   ,tbldctosordenesdetalle.cantidad       "
		                + "                        AS CANTIDADPEDIDA "
		                + "   ,tmpCAT.topeMaximo AS strIdLista       "
		                + "   ,tmpCAT.topeMaximo AS item,            "
		                + "    1 AS itemPadre,        	             "
		                + "    0 AS idEstadoTx,                      "
		                + "    0 AS idTipoTx,                        "
		                + "    0 AS lecturaMedidor,                  "
		                + "    tbldctosordenesdetalle.idCliente,      "
		                + "    tbldctosordenesdetalle.idEstracto,       "
		                + "    tbldctosordenesdetalle.idRuta            "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN  tbldctosordenes                 "
		                + " ON tbldctosordenesdetalle.IDLOCAL  =        "
		                + "                     tbldctosordenes.IDLOCAL "
		                + " AND tbldctosordenesdetalle.IDORDEN =        "
		                + "                     tbldctosordenes.IDORDEN "
		                + " AND  tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                 tbldctosordenes.IDTIPOORDEN "
		                + " INNER JOIN                                  "
		                + " ( SELECT tblplus.idLocal,                   "
		                + "          tblplus.idTipo,                    "
		                + "          tblplus.idPlu,                     "
		                + "	     tblplus.porcentajeIva,             "
		                + "	     tblplus.vrGeneral,                 "
		                + "	 (tblcategorias.nombreCategoria + ' ' + "
		                + "	       tblplus.nombrePlu) AS nombrePlu, "
		                + "	     tblplus.idEstracto,                "
		                + "          tblplus.topeMaximo                 "
		                + " FROM tblcategorias                          "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal  = tblplus.idLocal "
		                + " AND tblcategorias.idLinea = tblplus.idLinea "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                         tblplus.idCategoria "
		                + " WHERE tblplus.idLocal =                     "
		                + "?1                             "
		                + " AND   tblplus.idTipo  =                     "
		                + "?5 ) AS tmpCAT                    "
		                + " ON tbldctosordenesdetalle.IDLOCAL =         "
		                + "                             tmpCAT.idLocal  "
		                + " AND tbldctosordenesdetalle.idEstracto  =    "
		                + "                           tmpCAT.idEstracto "
		                + " AND tmpCAT.topeMaximo  =                    "
		                + "           tbldctosordenesdetalle.strIdLista "
		                + " WHERE tbldctosordenesdetalle.idLocal   =    "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "?2                          "
		                + " AND (tmpCAT.vrGeneral *                     "
		                + "      tbldctosordenesdetalle.cantidad) != 0  "
		                + " AND  tbldctosordenesdetalle.idTipo = 4      ",
		                nativeQuery = true)
			  public void ingresaCategoriaConsumo(int idLocal, int IdTipoOrden, int IdOrden, int xIdSigno, int IdTipo );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle         "
		                + "SET VRVENTAUNITARIO = 0               "
		                + "FROM tbldctosordenes                  "
		                + "INNER JOIN tbldctosordenesdetalle     "
		                + "ON tbldctosordenes.IDLOCAL =          "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tbldctosordenes.IDTIPOORDEN =     "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN "
		                + "AND tbldctosordenes.IDORDEN =         "
		                + "       tbldctosordenesdetalle.IDORDEN "
		                + "INNER JOIN tblterceros                "
		                + "ON tblterceros.idLocal =              "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tblterceros.idCliente =           "
		                + "     tbldctosordenesdetalle.idCliente "
		                + "WHERE tblterceros.idLocal =           "
		                + "?1                       "
		                + "AND tblterceros.estado IN (6)         "
		                + "AND tbldctosordenes.idPeriodo =       "
		                + "?2                     "
		                + "AND tbldctosordenesdetalle.IDTIPOORDEN = "
		                + "?3                   "
		                + "AND tbldctosordenesdetalle.IDTIPO     "
		                + "                         IN (19,20,29)",
		                nativeQuery = true)
			  public void anulaSubsidioContribucionCFSuspendidoParcial(int idLocal, int idPeriodo, int IdTipoOrden );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle "
		                + "            (IDLOCAL		       "
		                + "            ,IDTIPOORDEN	       "
		                + "            ,IDORDEN		       "
		                + "            ,IDPLU		       "
		                + "            ,CANTIDAD	       "
		                + "            ,IDTIPO		       "
		                + "            ,PORCENTAJEIVA	       "
		                + "            ,VRVENTAUNITARIO	       "
		                + "            ,ESTADO		       "
		                + "            ,NOMBREPLU	       "
		                + "            ,VRVENTAORIGINAL        "
		                + "            ,VRCOSTO                "
		                + "            ,VRDSCTOPIE             "
		                + "            ,PORCENTAJEDSCTO        "
		                + "            ,CANTIDADPEDIDA         "
		                + "            ,strIdLista             "
		                + "            ,item		       "
		                + "            ,itemPadre	       "
		                + "            ,idEstadoTx	       "
		                + "            ,idTipoTx	       "
		                + "            ,lecturaMedidor         "
		                + "            ,idCliente	       "
		                + "            ,idEstracto             "
		                + "            ,idRuta)		       "
		+ " SELECT  ?1 AS idLocal,     "
		+ "?2 AS idTipoOrden,          "
		+ "?3  AS idOrden,	                 "
		+ "  tmpPLU.idPlu, 		                 "
		+ "  tbldctosordenesdetalle.cantidad,            "
		+ "  tmpPLU.idTipo, 		                 "
		+ "  tmpPLU.porcentajeIva,                       "
		+ "  (tmpPLU.vrGeneral *                         "
		+ "?4)  AS vrVentaUnitario,             "
		+ "  0 AS estado,                                "
		+ "  tmpPLU.nombrePlu AS nombrePlu,              "
		+ "  (tmpPLU.vrGeneral *                         "
		+ "?4) AS VRVENTAORIGINAL               "
		+ "  ,0 AS VRCOSTO                               "
		+ "  ,0 AS VRDSCTOPIE                            "
		+ "  ,0 AS PORCENTAJEDSCTO                       "
		+ "  ,tbldctosordenesdetalle.cantidad            "
		+ "                       AS CANTIDADPEDIDA      "
		+ "  ,tmpPLU.topeMaximo AS strIdLista            "
		+ "  ,tmpPLU.topeMaximo AS item,                 "
		+ "  1 AS itemPadre,        	                 "
		+ "  0 AS idEstadoTx,                            "
		+ "  0 AS idTipoTx,                              "
		+ "  0 AS lecturaMedidor,                        "
		+ "  tbldctosordenesdetalle.idCliente,           "
		+ "  tbldctosordenesdetalle.idEstracto,          "
		+ "  tbldctosordenesdetalle.idRuta               "
		+ " FROM        tblDctosOrdenes                  "
		+ " INNER JOIN tblDctosOrdenesDetalle            "
		+ " ON tblDctosOrdenes.IDLOCAL      =            "
		+ "       tblDctosOrdenesDetalle.IDLOCAL         "
		+ " AND tblDctosOrdenes.IDTIPOORDEN =            "
		+ "      tblDctosOrdenesDetalle.IDTIPOORDEN      "
		+ " AND tblDctosOrdenes.IDORDEN     =            "
		+ "         tblDctosOrdenesDetalle.IDORDEN       "
		+ " INNER JOIN ( SELECT tblplus.idLocal,         "          
		+ "  tblplus.idTipo,                             "
		+ "  tblplus.idPlu,                              "
		+ "  tblplus.porcentajeIva,                      "
		+ "  tblplus.vrGeneral,                          "
		+ "  (tblcategorias.nombreCategoria + ' ' +      "
		+ "  tblplus.nombrePlu) AS nombrePlu,            "
		+ "  tblplus.idEstracto,                         "
		+ "  tblplus.topeMaximo                          "
		+ "  FROM tblcategorias                          "
		+ "  INNER JOIN tblplus                          "
		+ "  ON tblcategorias.idLocal  = tblplus.idLocal "
		+ "  AND tblcategorias.idLinea = tblplus.idLinea "
		+ "  AND tblcategorias.IdCategoria =             "
		+ "                          tblplus.idCategoria "
		+ "  WHERE tblplus.idTipo      =                 "
		+ "?5   ) AS tmpPLU          "                
		+ " ON tmpPLU.idLocal          =                 "
		+ "        tblDctosOrdenesDetalle.idLocal        "
		+ " AND tmpPLU.idEstracto      =                 "
		+ "     tblDctosOrdenesDetalle.idEstracto        "
		+ " AND tmpPLU.topeMaximo      =                 "
		+ "     tbldctosordenesdetalle.strIdLista        "
		+ " WHERE tblDctosOrdenes.IDLOCAL          =     "
		+ "?1                               "                
		+ " AND   tblDctosOrdenes.IDTIPOORDEN      =     "
		+ "?2                           "                
		+ " AND   tblDctosOrdenes.IDPERIODO        =     "
		+ "?6                             "       
		+ " AND   tblDctosOrdenesDetalle.IDTIPO    = 4   "
		+ " AND   tblDctosOrdenesDetalle.strIdLista= ?7   ",
		                nativeQuery = true)
			  public void ingresaSancion(int idLocal, int IdTipoOrden, int IdOrden, int xIdSigno, int xIdTipoDesincentivo, int idPeriodo, String StrIdLista );
			  
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "INSERT INTO tbldctosordenesdetalle      "
		                + "            (IDLOCAL		           "
		                + "            ,IDTIPOORDEN                "
		                + "            ,IDORDEN		           "
		                + "            ,IDPLU		           "
		                + "            ,CANTIDAD	           "
		                + "            ,IDTIPO		           "
		                + "            ,PORCENTAJEIVA              "
		                + "            ,VRVENTAUNITARIO	           "
		                + "            ,ESTADO		           "
		                + "            ,NOMBREPLU	           "
		                + "            ,VRVENTAORIGINAL            "
		                + "            ,VRCOSTO                    "
		                + "            ,VRDSCTOPIE                 "
		                + "            ,PORCENTAJEDSCTO            "
		                + "            ,CANTIDADPEDIDA             "
		                + "            ,item			   "
		                + "            ,itemPadre		   "
		                + "            ,idEstadoTx		   "
		                + "            ,idTipoTx		   "
		                + "            ,lecturaMedidor             "
		                + "            ,idCliente		   "
		                + "            ,idEstracto                 "
		                + "            ,idRuta)		           "                                
		+ "SELECT tblpagos.idLocal,                      "
		+ "?1  AS idTipoOrden,          "
		+ "?2  AS idOrden,	                 "
		+ "   tblPlus.idPlu, 		                 "
		+ "   01 AS cantidad,		                 "
		+ "   MAX(tblPlus.idTipo) AS idTipo ,            "
		+ "   MAX(tblplus.porcentajeIva)                 "
		+ "            AS porcentajeIva,                 "
		+ "   SUM(tblpagos.vrPago *                      "
		+ " (tbllocales.porInteresPagoExtenporaneo/100)) "   
		+ "         AS vrInteresPagoExtenporaneo,        "
		+ "   0 AS estado,                               "
		+ "   MAX(tblplus.nombrePlu) AS nombrePlu        "
		+ "   ,0 AS VRVENTAORIGINAL                      "
		+ "   ,0 AS VRCOSTO                              "
		+ "   ,0 AS VRDSCTOPIE                           "
		+ "   ,0 AS PORCENTAJEDSCTO                      "
		+ "   ,0 AS CANTIDADPEDIDA                       "
		+ "   ,tblPagos.nitcc AS item                    "
		+ "   ,1 AS itemPadre         	                 "
		+ "   ,0 AS idEstadoTx                           "
		+ "   ,0 AS idTipoTx                             "
		+ "   ,0 AS lecturaMedidor                       "
		+ "   ,tblPagos.nitcc AS idCliente   	         "
		+ "   ,MAX(tblterceros.idEstracto)               "
		+ "                  AS idEstracto               " 
		+ "   ,MAX(tblterceros.idRuta)                   "
		+ "                      AS idRuta               "
		+ " FROM tblPagos                                "
		+ "   INNER JOIN tblDctosPeriodo                 "
		+ "   ON tblPagos.idLocal     =                  "
		+ "          tblDctosPeriodo.idLocal             "
		+ "   AND tblPagos.idPeriodo  =                  "
		+ "        tblDctosPeriodo.idPeriodo             "
		+ "                                              "
		+ "   INNER JOIN tblPlus                         "
		+ "   ON tblPagos.idLocal     =                  "
		+ "                  tblPlus.idLocal             "
		+ "                                              "
		+ "   INNER JOIN tblCategorias                   "
		+ "   ON tblPlus.idLocal      =                  "
		+ "            tblCategorias.idLocal             "
		+ "   AND tblPlus.idLinea     =                  "
		+ "            tblCategorias.idLinea             "
		+ "   AND tblPlus.idCategoria =                  "
		+ "       tblCategorias.idCategoria              "
		+ "                                              "
		+ "   INNER JOIN tblLocales                      "
		+ "   ON tblPagos.idLocal =                      "
		+ "              tblLocales.idLocal              "
		+ "                                              "
		+ "   INNER JOIN tblTerceros                     "
		+ "   ON tblPagos.idLocal =                      "
		+ "             tblTerceros.idLocal              "
		+ "   AND tblPagos.nitCC  =                      "
		+ "           tblTerceros.idCliente              "
		+ " WHERE EXISTS                                 "
		+ "   ( SELECT *                                 "
		+ "     FROM tblPagosMedios                      "
		+ " 	WHERE  tblPagos.idLocal =                "
		+ " 	    tblPagosMedios.idLocal               "
		+ " AND tblPagos.idTipoOrden    =                "
		+ "     tblPagosMedios.idTipoOrden               "
		+ " AND tblPagos.idRecibo       =                "
		+ "        tblPagosMedios.idRecibo               "
		+ " AND tblPagos.indicador      =                "
		+ "      tblPagosMedios.indicador )              "
		+ " AND tblpagos.IDLOCAL             =           "  
		+ "?3                               "                
		+ " AND tblpagos.idPeriodo           =           "
		+ "?4                         "                
		+ " AND tblpagos.fechaPago           >           "
		+ "   tbldctosPeriodo.fechaSinRecargo            "
		+ " AND tblPlus.idPlu                = 36        "
		+ " AND tblTerceros.idTipoTercero    = 1         "
		+ " GROUP BY tblPagos.idLocal 	                 "    
		+ "   ,tblPlus.idPlu 		                 "  
		+ "   ,tblPagos.nitcc ",
		                nativeQuery = true)
			  public void ingresaInteresPagoExtemporaneo(int IdTipoOrden, int IdOrden, int idLocal, int xIdPeriodoAnterior);
			  
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "INSERT INTO tbldctosordenesdetalle              "
		                + "            (IDLOCAL		           "
		                + "            ,IDTIPOORDEN		           "
		                + "            ,IDORDEN		           "
		                + "            ,IDPLU			           "
		                + "            ,CANTIDAD		           "
		                + "            ,IDTIPO		           "
		                + "            ,PORCENTAJEIVA		           "
		                + "            ,VRVENTAUNITARIO	           "
		                + "            ,ESTADO		           "
		                + "            ,NOMBREPLU		           "
		                + "            ,VRVENTAORIGINAL                  "
		                + "            ,VRCOSTO                          "
		                + "            ,VRDSCTOPIE                       "
		                + "            ,PORCENTAJEDSCTO                  "
		                + "            ,CANTIDADPEDIDA                   "
		                + "            ,item			           "
		                + "            ,itemPadre		           "
		                + "            ,idEstadoTx		           "
		                + "            ,idTipoTx		           "
		                + "            ,lecturaMedidor                   "
		                + "            ,idCliente		           "
		                + "            ,idEstracto                       "
		                + "            ,idRuta)		           "
		                + " SELECT ?1 AS idLocal,	   "
		                + "?2  AS idTipoOrden,            "
		                + "?3  AS idOrden,	                   "
		                + "        tblplus.idPlu, 		           "
		                + "        1 AS cantidad,		           "
		                + "        tblplus.idTipo AS idTipo,		   "
		                + "        tblplus.porcentajeIva,                  "
		                + "        tmpINT.vrPagoAnticipado*(-1)            "
		                + "                            AS vrVentaUnitario, "
		                + "        0 AS estado,                            "
		                + "        'PAGO ANTICIPADO' AS nombrePlu,         "
		                + "        tmpINT.vrPagoAnticipado                 "
		                + "	                       AS VRVENTAORIGINAL, "
		                + "        0 AS VRCOSTO,                           "
		                + "        0 AS VRDSCTOPIE,                        "
		                + "        0 AS PORCENTAJEDSCTO,                   "
		                + "        0 AS CANTIDADPEDIDA,                    "
		                + "       (tmpINT.idCliente +                      "
		                + "		           tblplus.idPlu) AS item, "
		                + "        1 AS itemPadre,        	           "
		                + "        0 AS idEstadoTx,                        "
		                + "        0 AS idTipoTx,                          "
		                + "        0 AS lecturaMedidor,                    "
		                + "        tmpINT.idCliente AS idCliente,	   "
		                + "        tblterceros.idEstracto,                 "
		                + "        tblterceros.idRuta                      "
		                + " FROM tblPlus                                   "
		                + " INNER JOIN tblcategorias		           "
		                + " ON tblplus.idLinea = tblcategorias.idLinea     "
		                + " AND tblplus.idCategoria  = 		           "
		                + "                     tblcategorias.IdCategoria  "
		                + " AND tblplus.idLocal = tblcategorias.idLocal    "
		                + " INNER JOIN tblterceros		           "
		                + " ON tblplus.idLocal = tblterceros.idLocal       "
		                + " INNER JOIN                                     "
		                + " (SELECT tblpagos.idLocal,                      "
		                + "         tblpagos.nitCC AS idCliente,           "
		                + "         SUM(tblpagos.vrPago) AS vrPago,        "
		                + "         SUM(tblpagos.vrPago *                  "
		                + "     (tbllocales.porcentajePagoAnticipado/100)) "
		                + "               	      AS vrPagoAnticipado, "
		                + "         COUNT(*) AS conteo                     "
		                + "  FROM  tblpagos                                "
		                + "  INNER JOIN tbldctosPeriodo                    "
		                + "  ON tblpagos.IDLOCAL = tbldctosPeriodo.idLocal "
		                + "  AND tblpagos.idPeriodo =                      "
		                + "                      tbldctosPeriodo.idPeriodo "
		                + "  INNER JOIN tbllocales                         "
		                + "  ON tblpagos.IDLOCAL = tbllocales.idLocal      "
		                + "  WHERE tblpagos.IDLOCAL                     =  "
		                + "?1                                 "
		                + " AND tblpagos.idPeriodo                     =   "
		                + "?4                           "
		                + "  AND tblpagos.fechaPago <=                     "
		                + "                tbldctosPeriodo.fechaSinRecargo "
		                + "  GROUP BY tblpagos.idLocal,                    "
		                + "          tblpagos.nitCC) AS tmpINT             "
		                + " ON tmpINT.IDLOCAL = tblterceros.IDLOCAL        "
		                + " AND tmpINT.idCliente = tblterceros.idCliente   "
		                + " WHERE tblplus.idLocal     =                    "
		                + "?1                                "
		                + " AND tblplus.idTipo   = 18                      "
		                + " AND tblplus.idCategoria = 7 ",
		                nativeQuery = true)
			  public void ingresaVrPagoAnticipado(int idLocal, int IdTipoOrden, int IdOrden, int xIdPeriodoAnterior);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle         "
		                + "SET VRVENTAUNITARIO = 0               "
		                + "FROM tbldctosordenes                  "
		                + "INNER JOIN tbldctosordenesdetalle     "
		                + "ON tbldctosordenes.IDLOCAL =          "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tbldctosordenes.IDTIPOORDEN =     "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN "
		                + "AND tbldctosordenes.IDORDEN =         "
		                + "       tbldctosordenesdetalle.IDORDEN "
		                + "INNER JOIN tblterceros                "
		                + "ON tblterceros.idLocal =              "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tblterceros.idCliente =           "
		                + "     tbldctosordenesdetalle.idCliente "
		                + "WHERE tblterceros.idLocal =           "
		                + "?1                       "
		                + "AND tblterceros.estado IN (5)         "
		                + "AND tbldctosordenes.idPeriodo =       "
		                + "?2                     "
		                + "AND tbldctosordenesdetalle.IDTIPOORDEN = ?3 ",
		                nativeQuery = true)
			  public void anulaConsumoEstadoExento(int idLocal, int idPeriodo, int IdTipoOrden);
			  
			  
			  
			  @Query(value = " SELECT  tbldctosordenesdetalle.idLocal,      "
		                + "         tbldctosordenesdetalle.idTipoOrden,  "
		                + "         tbldctosordenesdetalle.idCliente,    " 
		                + "         MAX(tblterceros.idRuta) AS idRuta    " 
		                + "     ,MAX(tblterceros.ordenRuta) AS ordenRuta "
		                + "      ,MAX(tblterceros.promedio) AS promedio  "
		                + "      ,MAX(tblterceros.historiaConsumo)       "
		                + "                        AS historiaConsumo    "
		                + "       ,MAX(tblterceros.promedioEstrato)      "
		                + "                          AS promedioEstrato  "
		                + " FROM    tbldctosordenes                      "
		                + " INNER JOIN tbldctosordenesdetalle	         "
		                + " ON tbldctosordenes.IDLOCAL          =        "
		                + "               tbldctosordenesdetalle.IDLOCAL "
		                + " AND tbldctosordenes.IDTIPOORDEN     =        "
		                + "           tbldctosordenesdetalle.IDTIPOORDEN "
		                + " AND tbldctosordenes.IDORDEN         =        "
		                + "               tbldctosordenesdetalle.IDORDEN "
		                + " INNER JOIN tblterceros                       "
		                + " ON  tblterceros.idLocal             =        "
		                + "                      tbldctosordenes.IDLOCAL "
		                + " AND tblterceros.idCliente           =        "
		                + "             tbldctosordenesdetalle.idCliente "
		                + " WHERE tbldctosordenes.idPeriodo =            "
		                + "?1                             "
		                + " AND  tbldctosordenes.idTipoOrden    =        "
		                + "?2                           "
		                + " AND  tbldctosordenes.idLocal        =        "
		                + "?3                               "
		                + " AND tblterceros.estado NOT IN (2)            "   
		                + " AND  tblterceros.idTipoTercero  =            "
		                + "?4                         "                
		                + " GROUP BY tbldctosordenesdetalle.IDLOCAL,     "
		                + "          tbldctosordenesdetalle.idTipoOrden, "
		                + "          tbldctosordenesdetalle.idCliente    "
		                + "    ORDER BY  4,5 ", nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaPrevia( int idPeriodo, int IdTipoOrden, int idLocal, int IdTipoTercero);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle          "
					  + "            (IDLOCAL			      "
					  + "            ,IDTIPOORDEN		      "
					  + "            ,IDORDEN			      "
					  + "            ,IDPLU			      "
					  + "            ,CANTIDAD		      "
					  + "            ,IDTIPO			      "                
					  + "            ,PORCENTAJEIVA	              "
					  + "            ,VRVENTAUNITARIO    	      "
					  + "            ,ESTADO			      "               
					  + "            ,NOMBREPLU          	      "
					  + "            ,VRVENTAORIGINAL               "
					  + "            ,VRCOSTO			      "               
					  + "            ,VRDSCTOPIE		      "
					  + "            ,PORCENTAJEDSCTO		      "
					  + "            ,CANTIDADPEDIDA		      "                
					  + "            ,STRIDLISTA		      "
					  + "            ,NOMBREUNIDADMEDIDA            "
					  + "            ,comentario		      "                
					  + "            ,item			      "
					  + "            ,itemPadre                     "
					  + "            ,idEstadoTx		      "                
					  + "            ,idTipoTx		      "
					  + "            ,idBodega		      "
					  + "            ,idSubcuenta		      "                
					  + "            ,lecturaMedidor		      "
					  + "            ,idCliente		      "
					  + "            ,idEstracto	              "                
					  + "            ,idRuta                        "
					  + "            ,idNovedadLectura)	      "  
					  + " SELECT tmpDEU.idLocal,                    "  
					  + "?1 AS idTipoOrden,	      "
					  + "?2 AS idOrden, 		      "                
					  + "   tmpDEU.idPlu,                           "
					  + "   1 AS cantidad,                          "
					  + "   MAX(tmpDEU.idTipo) AS idTipo,           "                
					  + "   MAX(tmpDEU.porcentajeIva)               "
					  + "               AS porcentajeIva,           "
					  + "   SUM(tmpDEU.vrVentaUnitario)             "
					  + "             AS vrVentaUnitario,           "
					  + "   0 AS estado,                            "                
					  + "   MAX(tmpDEU.nombrePlu)                   "
					  + "                   AS nombrePlu,           "
					  + "   SUM(tmpDEU.vrVentaUnitario)             "
					  + "             AS vrVentaOriginal,           "
					  + "   0.0 AS VRCOSTO,                         "                
					  + "   0.0 AS VRDSCTOPIE,    	              "   
					  + "   0.0 AS PORCENTAJEDSCTO,	              "   
					  + "   0.0 AS CANTIDADPEDIDA,	              "                   
					  + "   0   AS STRIDLISTA,	              "       
					  + "   '' AS NOMBREUNIDADMEDIDA,               "     
					  + "   '' AS comentario,                       "                   
					  + "   tmpDEU.idPlu AS item,	              "
					  + "   1 AS itemPadre,                         "   
					  + "   0.0 AS idEstadoTx,                      "                   
					  + "   0.0 AS idTipoTx,		              "  
					  + "   1 AS idBodega,		              "                
					  + "   0 AS idSubcuenta,	                      "                   
					  + "   0 AS lectraMedidor,	             "
					  + "?3  AS idCliente,          "               
					  + "   MAX(tmpDEU.idEstracto)                  "
					  + "                 AS idEstracto,	      "                 
					  + "   MAX(tmpDEU.idRuta) AS idRuta,           "
					  + "   0 AS idNovedadLectura                   "
					  + " FROM                                      "
					  + " (SELECT tmpTOT.idLocal,                   " 	         
					  + "         CASE                              "      
					  + "      WHEN tmpPLU.idTipo > 100             " 
					  + "      THEN MAX(tmpPLU.idPlu)               "     
					  + "      ELSE tmpPLU.idPluDeuda               "
					  + "      END AS idPlu,                        "
					  + "      CASE                                 "   
					  + "      WHEN tmpPLU.idTipo > 100             " 
					  + "      THEN tmpPLU.idTipo                   " 
					  + "      ELSE tmpPLU.idTipo + 100             " 
					  + "      END AS idTipo,                       "
					  + "   MAX(tmpPLU.porcentajeIva)               "
					  + "              AS porcentajeIva, 	      "		
					  + "   SUM(tmpTOT.vrVenta)                     "
					  + "            AS vrVentaUnitario,            "
					  + "   0 AS estado,                            "
					  + "   MAX(tmpPLU.nombrePlu)                   "
					  + "                  AS nombrePlu,            "
					  + "   SUM(tmpTOT.vrVenta)                     "
					  + "            AS vrVentaOriginal,            "                       
					  + "   tmpTOT.idCliente,                       "    
					  + "   MAX(tblterceros.idEstracto)             "   
					  + "                AS idEstracto,	      "
					  + "   MAX(tblterceros.idRuta)                 "
					  + "                     AS idRuta  	      "		       
					  + "   FROM                                    "     
					  + "   (SELECT tbldctosordenesdetalle.IDLOCAL  "     
					  + "      ,tbldctosordenesdetalle.IDTIPOORDEN  "     
					  + "      ,tbldctosordenesdetalle.IDPLU        "     
					  + "      ,tbldctosordenesdetalle.idTipo       "     
					  + "   ,SUM(tbldctosordenesdetalle.CANTIDAD *  "     
					  + "   tbldctosordenesdetalle.VRVENTAUNITARIO) "     
					  + "                              AS vrVenta   "     
					  + "       ,tbldctosordenesdetalle.idCliente   "     
					  + "   FROM  tbldctos                          "     
					  + "   INNER JOIN tbldctosordenesdetalle       "     
					  + "   ON tbldctos.IDLOCAL        =            "     
					  + "           tbldctosordenesdetalle.IDLOCAL  "     
					  + "   AND tbldctos.IDTIPOORDEN   =            "     
					  + "      tbldctosordenesdetalle.IDTIPOORDEN   "     
					  + "   AND  tbldctos.IDORDEN      =            "     
					  + "          tbldctosordenesdetalle.IDORDEN   "     
					  + "                                           "     
					  + "   WHERE tbldctos.IDLOCAL     =            "    
					  + "?4                            "                                 
					  + "   AND   tbldctos.IDTIPOORDEN IN (9,29)    "       
					  + "   AND   tbldctos.idPeriodo   =            "     
					  + "?5                      "
					  + "   AND tbldctos.IDCLIENTE     =           " 
					  + "?3                         "
					  + "   GROUP BY tbldctosordenesdetalle.IDLOCAL "     
					  + "      ,tbldctosordenesdetalle.IDTIPOORDEN  "     
					  + "      ,tbldctosordenesdetalle.IDPLU        "     
					  + "      ,tbldctosordenesdetalle.idTipo       "     
					  + "     ,tbldctosordenesdetalle.idCliente     "     
					  + "   UNION ALL                               "     
					  + "   SELECT tblpagosmedios.idLocal, 	      "   
					  + "    tblpagosmedios.idTipoOrden,            "     
					  + "   tblpagosmedios.IDPLU, 	              "   
					  + "   	  0 as idtipo,                        "   
					  + "    tblpagosmedios.vrMedio * (-1)          "     
					  + "            AS vrVenta,                    "     
					  + "   tblpagos.nitCC AS idCliente             "     
					  + "   FROM   tblpagos			      "
					  + "    INNER JOIN tblpagosmedios	      "       
					  + "    ON tblpagos.idLocal      = 	      "
					  + "         tblpagosmedios.idLocal            "     
					  + "   AND tblpagos.idTipoOrden = 	      "       
					  + "    tblpagosmedios.idTipoOrden             "     
					  + "    AND tblpagos.idRecibo    = 	      "
					  + "           tblpagosmedios.idRecibo         "     
					  + "    AND tblpagos.indicador   = 	      "
					  + "     tblpagosmedios.indicador              "     
					  + "    WHERE tblpagos.idLocal   =             "     
					  + "?4                            "       
					  + "   AND tblpagos.idTipoOrden  = 9           "     
					  + "   AND tblpagos.idPeriodo    =             "     
					  + "?5                      "            
					  + "   AND tblpagos.nitCC     =               " 
					  + "?3      )    AS tmpTOT     "     
					  + "   INNER JOIN (                            "     
					  + "   SELECT     tblplus.idLocal,             "     
					  + "              tblplus.idPlu,               "     
					  + "              tblplus.idPluDeuda,          "     
					  + "   		    tblplus.idTipo,           "   
					  + "   RTRIM(tblcategorias.nombreCategoria)    "     
					  + "                                + ' ' +    "     
					  + "       tblplus.nombrePlu AS nombrePlu,     "     
					  + "       tblplus.porcentajeIva,              "     
					  + "        tblplus.idEstracto                 "     
					  + "   FROM   tblplus                          "     
					  + "   INNER JOIN tblcategorias                "     
					  + "   ON tblcategorias.idLocal      =         "
					  + "                    tblplus.idLocal        "
					  + "   AND tblcategorias.idLinea     =         "
					  + "                   tblplus.idLinea         "
					  + "   AND tblcategorias.idCategoria =         "     
					  + "               tblplus.idCategoria         "     
					  + "   WHERE  tblplus.idLocal        =         "     
					  + "?4  )   AS tmpPLU             "     
					  + "   ON tmpPLU.idLocal  =  tmpTOT.idLocal    "     
					  + "   AND tmpPLU.idPlu   = tmpTOT.idPlu       "	 
					  + "   INNER JOIN tblterceros                  "     
					  + "   ON tblterceros.idLocal        =         "
					  + "                    tmpTOT.idLocal         "
					  + "   AND tblterceros.idCliente     =         "
					  + "                  tmpTOT.idCliente         "
					  + "   GROUP BY tmpTOT.idLocal,                "     
					  + "          tmpTOT.idTipoOrden,              "     
					  + "          tmpPLU.idPluDeuda,               "          
					  + "          tmpPLU.idTipo,                   "     
					  + "          tmpTOT.idCliente                 "
					  + "   HAVING SUM(tmpTOT.vrVenta)!=0	)     "
					  + "                        tmpDEU             "
					  + "   GROUP BY tmpDEU.IDLOCAL,                "
					  + "        tmpDEU.idPlu ",
		                nativeQuery = true)
			  public void ingresaDeudaMedidor(int IdTipoOrden, int IdOrden, String idCliente, int idLocal, int xIdPeriodoAnterior);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle         "
					  + "            (IDLOCAL                      "
					  + "            ,IDTIPOORDEN                  "
					  + "            ,IDORDEN                      "
					  + "            ,IDPLU                        "
					  + "            ,CANTIDAD                     "
					  + "            ,IDTIPO                       "
					  + "            ,PORCENTAJEIVA                "
					  + "            ,VRVENTAUNITARIO              "
					  + "            ,ESTADO                       "
					  + "            ,NOMBREPLU                    "
					  + "            ,VRVENTAORIGINAL              "
					  + "            ,VRCOSTO                      "
					  + "            ,VRDSCTOPIE                   "
					  + "            ,PORCENTAJEDSCTO              "
					  + "            ,CANTIDADPEDIDA               "
					  + "            ,STRIDLISTA                   "
					  + "            ,NOMBREUNIDADMEDIDA           "
					  + "            ,comentario                   "
					  + "            ,item                         "
					  + "            ,itemPadre                    "
					  + "            ,idEstadoTx                   "
					  + "            ,idTipoTx                     "
					  + "            ,fechaEntrega                 "
					  + "            ,idBodega                     "
					  + "            ,idSubcuenta                  "
					  + "            ,lecturaMedidor               "
					  + "            ,idCliente                    "
					  + "            ,idEstracto                   "
					  + "            ,idRuta)                      "
					  + " SELECT tblDctosOrdenesDetalle.idLocal,          "
					  + "?1 AS idTipoOrden,              "
					  + "?2 AS idOrden                       "
					  + "  ,tmpCAT.IDPLU                                  "
					  + "  ,1.0 AS CANTIDAD                               "
					  + "  ,MAX(tmpCAT.IDTIPO) AS IDTIPO                  "  
					  + "  ,MAX(tmpCAT.PORCENTAJEIVA) AS PORCENTAJEIVA    "
					  + " ,SUM(tblDctosOrdenesDetalle.VRVENTAUNITARIO) *  "
					  + "   CASE                                          "
					  + "   WHEN tblDctosOrdenesDetalle.idEstracto        "
					  + "                          IN (1,2,3,4,5,6)       "
					  + "   THEN MAX(tblLocales.porcentajeInteres/100)    "
					  + " ELSE MAX(tblLocales.porcentajeInteresCcial/100) "
					  + "   END AS VRVENTAUNITARIO                        "
					  + "  ,1 AS estado                                   "
					  + "  ,MAX(tmpCAT.nombrePlu) AS nombrePlu            "
					  + "  ,0.0 AS  VRVENTAORIGINAL                       "
					  + "  ,0 AS VRCOSTO                                  "
					  + "  ,0.0 AS VRDSCTOPIE                             "
					  + "  ,0.0 AS PORCENTAJEDSCTO                        "
					  + "  ,1.0 AS CANTIDADPEDIDA                         "
					  + "  ,0 AS STRIDLISTA                               "
					  + "  ,'' AS NOMBREUNIDADMEDIDA                      "
					  + "  ,'' AS comentario                              "
					  + "  ,tmpCAT.IDPLU AS item                          "
					  + "  ,1 AS itemPadre                                "
					  + "  ,0 AS idEstadoTx                               "
					  + "  ,0 AS idTipoTx                                 "
					  + "  ,GETDATE() AS fechaEntrega                     "
					  + "  ,1 AS idBodega                                 "
					  + "  ,'' AS idSubcuenta                             "
					  + "  ,0 AS lecturaMedidor                           "
					  + "  ,tbldctosordenesdetalle.idCliente              "
					  + "  ,tbldctosordenesdetalle.idEstracto             "
					  + "  ,MAX(tbldctosordenesdetalle.idRuta) AS idRuta  "      
					  + " FROM        tblDctosOrdenes                     "
					  + " INNER JOIN tblDctosOrdenesDetalle               "
					  + " ON tblDctosOrdenes.IDLOCAL      =               "
					  + "     tblDctosOrdenesDetalle.IDLOCAL              "
					  + " AND tblDctosOrdenes.IDTIPOORDEN =               "
					  + "  tblDctosOrdenesDetalle.IDTIPOORDEN             "
					  + " AND tblDctosOrdenes.IDORDEN     =               "
					  + "      tblDctosOrdenesDetalle.IDORDEN             "
					  + " INNER JOIN tblLocales                           "
					  + " ON tblLocales.idLocal           =               "
					  + "           tblDctosOrdenes.idLocal               "
					  + " INNER JOIN (                                    "
					  + " SELECT tblPlus.idLocal,                         "
					  + "         tblPlus.idPlu,                          "
					  + "        tblCategorias.idProducto                 "
					  + " FROM        tblCategorias                       "
					  + " INNER JOIN  tblPlus                             "
					  + " ON tblCategorias.idLocal      =                 "
					  + "                   tblPlus.idLocal               "
					  + " AND tblCategorias.idLinea     =                 "
					  + "                   tblPlus.idLinea               "
					  + " AND tblCategorias.IdCategoria =                 "
					  + "               tblPlus.idCategoria )             "
					  + " 			              AS tmpPRO     "
					  + " ON tmpPRO.idLocal             =                 "
					  + "       tblDctosOrdenesDetalle.idLocal            "
					  + " AND tmpPRO.idPlu              =                 "
					  + "     tblDctosOrdenesDetalle.idPlu                "
					  + " INNER JOIN ( SELECT tblCategorias.idlocal,      "
					  + "    tblPlus.idPlu,                               "
					  + "    tblCategorias.idProducto,                    "
					  + "    tblCategorias.nombreCategoria + ' ' +        "
					  + "    tblPlus.nombrePlu AS nombrePlu,              "
					  + "    tblPlus.idTipo,                              "
					  + "    tblPlus.porcentajeIva                        "
					  + " FROM       tblCategorias                        "
					  + " INNER JOIN  tblPlus                             "
					  + " ON tblCategorias.idLocal  =                     "
					  + "              tblPlus.idLocal                    "
					  + " AND tblCategorias.idLinea =                     "
					  + "               tblPlus.idLinea                   "
					  + " AND tblPlus.idCategoria   =                     "
					  + "      tblCategorias.IdCategoria                  "
					  + " WHERE tblPlus.idTipo    IN (12)) AS tmpCAT      "
					  + " ON tmpCAT.idLocal        =                      "
					  + "      tblDctosOrdenesDetalle.idLocal             "
					  + " AND tmpCAT.idProducto        =                  "
					  + "                   tmpPRO.idProducto             "
					  + " WHERE tblDctosOrdenes.idLocal        =          "
					  + "?3                                  "                
					  + " AND   tblDctosOrdenes.idTipoOrden    =         "
					  + "?1                              "                
					  + " AND   tblDctosOrdenesDetalle.IDTIPO  > 100      "
					  + " AND tblDctosOrdenesDetalle.idCliente =         "
					  + "?4                               "                
					  + " AND tblDctosOrdenesDetalle.idTipo NOT IN (112)  "           
					  + " GROUP BY  tblDctosOrdenesDetalle.idLocal,       "
					  + "   tblDctosOrdenesDetalle.idEstracto,            "
					  + "   tmpPRO.idProducto,                            "
					  + "   tmpCAT.idPlu,                                 "
					  + "   tbldctosordenesdetalle.idCliente              " 
					  + " HAVING SUM(tblDctosOrdenesDetalle.VRVENTAUNITARIO) > 0 ",
		                nativeQuery = true)
			  public void ingresaInteresMatricula(int IdTipoOrden, int IdOrden, int idLocal, String idCliente);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle   "
		                + "            (IDLOCAL                  "
		                + "            ,IDTIPOORDEN              "
		                + "            ,IDORDEN                  "
		                + "            ,IDPLU                    "
		                + "            ,CANTIDAD                 "
		                + "            ,IDTIPO                   "
		                + "            ,PORCENTAJEIVA            "
		                + "            ,VRVENTAUNITARIO          "
		                + "            ,ESTADO                   "
		                + "            ,NOMBREPLU                "
		                + "            ,VRVENTAORIGINAL          "
		                + "            ,VRCOSTO                  "
		                + "            ,VRDSCTOPIE               "
		                + "            ,PORCENTAJEDSCTO          "
		                + "            ,CANTIDADPEDIDA           "
		                + "            ,STRIDLISTA               "
		                + "            ,NOMBREUNIDADMEDIDA       "
		                + "            ,comentario               "
		                + "            ,item                     "
		                + "            ,itemPadre                "
		                + "            ,idEstadoTx               "
		                + "            ,idTipoTx                 "
		                + "            ,fechaEntrega             "
		                + "            ,idBodega                 "
		                + "            ,idSubcuenta              "
		                + "            ,lecturaMedidor           "
		                + "            ,idCliente                "
		                + "            ,idEstracto               "
		                + "            ,idRuta)                  "
		                + "     SELECT                           "
		                + "?1 AS idLocal,	         "
		                + "?2 AS idTipoOrden,   "
		                + "?3 AS idOrden, 	         "
		                + "    tblplus.idPlu,                    "
		                + "    tmpFIN.CANTIDAD,                  "
		                + "    tblplus.idTipo,                   "
		                + "    tblplus.PORCENTAJEIVA,            "
		                + "    tmpFIN.vrVentaUnitario,           "
		                + "    tblplus.ESTADO,                   "
		                + "    tblcategorias.nombreCategoria     "
		                + "    + ' ' +                           "
		                + "    tblplus.nombrePlu AS nombrePlu,   "
		                + "    tmpFIN.vrVentaUnitario            "
		                + "                  AS VRVENTAORIGINAL, "
		                + "    0 AS VRCOSTO,                     "
		                + "    0 AS VRDSCTOPIE,                  "
		                + "    0 AS PORCENTAJEDSCTO,             "
		                + "    0 AS CANTIDADPEDIDA,              "
		                + "       0 AS STRIDLISTA,               "
		                + "    '' AS NOMBREUNIDADMEDIDA,         "
		                + "     tmpFIN.comentario,               "
		                + "     tmpFIN.idorden AS item,          "
		                + "     1 AS itemPadre,                  "
		                + "     0 AS idEstadoTx,                 "
		                + "     0 AS idTipoTx,                   "
		                + "     GETDATE() AS fechaEntrega,       "
		                + "     1 AS idBodega,                   "
		                + "    '' AS idSubcuenta,                "
		                + "     0 AS lecturaMedidor,             "
		                + "     tmpFIN.IDCLIENTE   ,             "
		                + "     tblterceros.idEstracto,          "
		                + "     tblterceros.IDRUTA               "
		                + " FROM   tblcategorias                 "
		                + " INNER JOIN tblplus                   "
		                + " ON tblcategorias.idLocal  =          "
		                + "                     tblplus.idLocal  "
		                + " AND tblcategorias.idLinea =          "
		                + "                     tblplus.idLinea  "
		                + " AND tblcategorias.IdCategoria =      "
		                + "                 tblplus.idCategoria  "
		                + " INNER JOIN                           "
		                + " ( SELECT tbldctosordenesdetalle.IDLOCAL, "
		                + "          idPlu,                          "
		                + "      tbldctosordenesdetalle.IDtipoORDEN, "
		                + "          tbldctosordenesdetalle.IDORDEN  "
		                + "                              AS idOrden, "
		                + "          1 AS cantidad,                  "
		                + "          VRVENTAUNITARIO                 "
		                + "                      AS vrVentaUnitario, "
		                + "        tbldctosordenesdetalle.idCliente, "
		                + "         ((tbldctosordenes.OBSERVACION)   "
		                + "           +' CTA ' +                     "
		                + "              CAST((item) AS varchar(10)) "
		                + "            +'/' +                        "
		                + "       CAST(cuotaDiferir AS varchar(10))) "
		                + "                           AS comentario, "
		                + "	      tbldctosordenesdetalle.item,   "
		                + "	   tbldctosordenesdetalle.ITEMPADRE  "
		                + "   FROM tbldctosordenesdetalle            "
		                + "   INNER JOIN tbldctosordenes             "
		                + "   ON tbldctosordenes.IDLOCAL =           "
		                + "           tbldctosordenesdetalle.IDLOCAL "
		                + "   AND tbldctosordenes.IDORDEN =          "
		                + "          tbldctosordenesdetalle.IDORDEN  "
		                + "   AND tbldctosordenes.IDTIPOORDEN =      "
		                + "      tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "   WHERE tbldctosordenesdetalle.IDLOCAL = "
		                + "?1                           "
		                + "   AND tbldctosordenesdetalle.IDTIPOORDEN = 7 "
		                + "   AND tbldctosordenesdetalle.idCliente = "
		                + "?4               "
		                + "   AND  tbldctosordenesdetalle.ESTADO != 4 "
		                + "                        ) AS tmpFIN        "
		                + " ON tmpFIN.IDLOCAL  = tblplus.idLocal      "
		                + " AND tmpFIN.idPlu   = tblplus.idPlu        "
		                + " INNER JOIN tblterceros                    "
		                + " ON tmpFIN.IDLOCAL  = tblterceros.idLocal  "
		                + " AND tmpFIN.IDCLIENTE =                    "
		                + "                     tblterceros.IDCLIENTE "
		                + " INNER JOIN (SELECT IDLOCAL                "
		                + "                   ,IDTIPOORDEN            "
		                + "                   ,IDORDEN                "
		                + "                   ,IDPLU                  "
		                + "                   ,MIN(item) AS item      "
		                + "             FROM tbldctosordenesdetalle   "
		                + "             WHERE  IDLOCAL =              "
		                + "?1                            "
		                + "             AND IDTIPOORDEN = 7           "
		                + "             AND  IDTIPO =  8              "
		                + "             AND  ESTADO != 4              "
		                + " AND tbldctosordenesdetalle.idCliente =   "
		                + "?4                         "
		                + "             GROUP BY IDLOCAL              "
		                + "                     ,IDTIPOORDEN          "
		                + "                    ,IDORDEN               "
		                + "                    ,IDPLU) AS tmpCUO      "
		                + " ON tmpCUO.idLocal = tmpFIN.idLocal        "
		                + " AND tmpCUO.IDTIPOORDEN =                  "
		                + "                        tmpFIN.IDTIPOORDEN "
		                + " AND tmpCUO.IDORDEN = tmpFIN.IDORDEN       "
		                + " AND tmpCUO.item = tmpFIN.item",
		                nativeQuery = true)
			  public void ingresaFinanciacion(int idLocal, int IdTipoOrden, int IdOrden, String idCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle              "
		                + " SET     ESTADO =                           "
		                + "?1,                             "
		                + "itemPadre =                                 "
		                + "?2                           "
		                + " FROM    tbldctosordenesdetalle             "
		                + " INNER JOIN (                               "
		                + "  SELECT IDLOCAL                            "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,IDPLU                               "
		                + "       ,MIN(item) AS item                   "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   WHERE  IDLOCAL =                         "
		                + "?3                             "
		                + "     AND IDTIPOORDEN =                      "
		                + "?4                 "
		                + "     AND  IDTIPO =  8                       "
		                + "     AND  idCliente =                      "
		                + "?5                          "
		                + "     AND  ESTADO != 4                       "
		                + "   GROUP BY IDLOCAL                         "
		                + "           ,IDTIPOORDEN                     "
		                + "           ,IDORDEN                         "
		                + "           ,IDPLU )  AS tmpDET              "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =   "
		                + "                      tmpDET.IDLOCAL        "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                       tmpDET.IDTIPOORDEN   "
		                + " AND tbldctosordenesdetalle.IDORDEN     =   "
		                + "                           tmpDET.IDORDEN   "
		                + " AND tbldctosordenesdetalle.IDPLU       =   "
		                + "                             tmpDET.IDPLU   "
		                + " AND tbldctosordenesdetalle.item        =   "
		                + "                              tmpDET.item   "
		                + " WHERE tbldctosordenesdetalle.IDLOCAL    =  "
		                + "?3                             "
		                + " AND  tbldctosordenesdetalle.IDTIPOORDEN =  "
		                + "?4                  "
		                + " AND  tbldctosordenesdetalle.IDTIPO =  8    "
		                + " AND  tbldctosordenesdetalle.idCliente   = "
		                + "?5                          "
		                + " AND  tbldctosordenesdetalle.ESTADO != 4 ",
		                nativeQuery = true)
			  public void actualizaCargoFinanciacion(int Estado, int ItemPadre, int idLocal, int xIdTipoOrdenFinanciacion, String idCliente );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle   "
		                + "            (IDLOCAL                  "
		                + "            ,IDTIPOORDEN              "
		                + "            ,IDORDEN                  "
		                + "            ,IDPLU                    "
		                + "            ,CANTIDAD                 "
		                + "            ,IDTIPO                   "
		                + "            ,PORCENTAJEIVA            "
		                + "            ,VRVENTAUNITARIO          "
		                + "            ,ESTADO                   "
		                + "            ,NOMBREPLU                "
		                + "            ,VRVENTAORIGINAL          "
		                + "            ,VRCOSTO                  "
		                + "            ,VRDSCTOPIE               "
		                + "            ,PORCENTAJEDSCTO          "
		                + "            ,CANTIDADPEDIDA           "
		                + "            ,STRIDLISTA               "
		                + "            ,NOMBREUNIDADMEDIDA       "
		                + "            ,comentario               "
		                + "            ,item                     "
		                + "            ,itemPadre                "
		                + "            ,idEstadoTx               "
		                + "            ,idTipoTx                 "
		                + "            ,fechaEntrega             "
		                + "            ,idBodega                 "
		                + "            ,idSubcuenta              "
		                + "            ,lecturaMedidor           "
		                + "            ,idCliente                "
		                + "            ,idEstracto               "
		                + "            ,idRuta)                  "
		                + "     SELECT                           "
		                + "?1 AS idLocal,	         "
		                + "?2 AS idTipoOrden,   "
		                + "?3 AS idOrden, 	         "
		                + "    tblplus.idPlu,                    "
		                + "    tmpFIN.CANTIDAD,                  "
		                + "    tblplus.idTipo,                   "
		                + "    tblplus.PORCENTAJEIVA,            "
		                + "    tmpFIN.vrVentaUnitario,           "
		                + "    tblplus.ESTADO,                   "
		                + "    tblcategorias.nombreCategoria     "
		                + "    + ' ' + tblplus.nombrePlu         "
		                + "               AS nombrePlu,          "
		                + "    tmpFIN.vrVentaUnitario            "
		                + "                 AS VRVENTAORIGINAL,  "
		                + "    0 AS VRCOSTO,                     "
		                + "    0 AS VRDSCTOPIE,                  "
		                + "    0 AS PORCENTAJEDSCTO,             "
		                + "    0 AS CANTIDADPEDIDA,              "
		                + "    0 AS STRIDLISTA,                  "
		                + "    '' AS NOMBREUNIDADMEDIDA,         "
		                + "    tmpFIN.comentario,                "
		                + "    (tmpFIN.item +1) AS ITEM,         "
		                + "    1 AS itemPadre,                   "
		                + "    0 AS idEstadoTx,                  "
		                + "    0 AS idTipoTx,                    "
		                + "    GETDATE() AS fechaEntrega,        "
		                + "    1 AS idBodega,                    "
		                + "    '' AS idSubcuenta,                "
		                + "    0 AS lecturaMedidor,              "
		                + "    tmpFIN.IDCLIENTE   ,              "
		                + "    tblterceros.idEstracto,           "
		                + "    tblterceros.IDRUTA                "
		                + " FROM   tblcategorias                 "
		                + " INNER JOIN tblplus                   "
		                + " ON tblcategorias.idLocal  =          "
		                + "                      tblplus.idLocal "
		                + " AND tblcategorias.idLinea =          "
		                + "                      tblplus.idLinea "
		                + " AND tblcategorias.IdCategoria =      "
		                + "                  tblplus.idCategoria "
		                + " INNER JOIN                              "
		                + " (SELECT tbldctosordenesdetalle.IDLOCAL, "
		                + "       idPlu                             "
		                + "       ,tbldctosordenesdetalle.IDORDEN   "
		                + "                                AS item  "
		                + "       ,1 AS cantidad                    "
		                + "      ,MAX(VRVENTAUNITARIO)              "
		                + "                      AS vrVentaUnitario "
		                + "      ,tbldctosordenesdetalle.idCliente  "
		                + "     ,(MAX(tbldctosordenes.OBSERVACION)  "
		                + "       +' N.CUOTA -> ' +                 "
		                + "        CAST(MIN(item) AS varchar(10))+  "
		                + "         ' / ' +                         "
		                + "        CAST(MAX(item) AS varchar(10)))  "
		                + "                          AS comentario  "
		                + "  FROM tbldctosordenesdetalle            "
		                + "  INNER JOIN tbldctosordenes             "
		                + "  ON tbldctosordenes.IDLOCAL =           "
		                + "          tbldctosordenesdetalle.IDLOCAL "
		                + "  AND tbldctosordenes.IDORDEN =          "
		                + "         tbldctosordenesdetalle.IDORDEN  "
		                + "  AND tbldctosordenes.IDTIPOORDEN =      "
		                + "      tbldctosordenesdetalle.IDTIPOORDEN "
		                + "  WHERE  tbldctosordenesdetalle.IDLOCAL   =      "
		                + "?1                   "
		                + "   AND  tbldctosordenesdetalle.IDTIPOORDEN = 7   "
		                + "   AND tbldctosordenesdetalle.idCliente    =    "
		                + "?4               "
		                + "   AND  tbldctosordenesdetalle.ESTADO     != 4   "
		                + "   AND tbldctosordenesdetalle.idtipo <> 8        "
		                + "   GROUP BY tbldctosordenesdetalle.IDLOCAL       "
		                + "        ,tbldctosordenesdetalle.IDTIPOORDEN      "
		                + "        ,tbldctosordenesdetalle.IDORDEN          "
		                + "        ,tbldctosordenesdetalle.IDCLIENTE        "
		                + "        ,idPlu ) AS tmpFIN                       "
		                + " ON tmpFIN.IDLOCAL  =  tblplus.idLocal    "
		                + " AND tmpFIN.idPlu   =   tblplus.idPlu     "
		                + " INNER JOIN tblterceros                   "
		                + " ON tmpFIN.IDLOCAL  = tblterceros.idLocal "
		                + " AND tmpFIN.IDCLIENTE =                   "
		                + "     tblterceros.IDCLIENTE ",
		                nativeQuery = true)
			  public void ingresaCobroPermanente(int idLocal, int IdTipoOrden, int IdOrden, String idCliente );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE    tbldctosordenesdetalle         "
		                + " SET      IDTIPOORDEN =                  "
		                + "?1,                    "
		                + "          IDORDEN =                      "
		                + "?2                           "
		                + " FROM         tbldctosordenes            "
		                + " INNER JOIN tbldctosordenesdetalle       "
		                + " ON tbldctosordenes.IDLOCAL      =       "
		                + "    tbldctosordenesdetalle.IDLOCAL       "
		                + " AND tbldctosordenes.IDTIPOORDEN =       "
		                + "    tbldctosordenesdetalle.IDTIPOORDEN   "
		                + " AND tbldctosordenes.IDORDEN     =       "
		                + "          tbldctosordenesdetalle.IDORDEN "
		                + " WHERE     tbldctosordenes.IDLOCAL =     "
		                + "?3                          "
		                + " AND tbldctosordenes.IDTIPOORDEN   =     "
		                + "?4                      "
		                + " AND tbldctosordenesdetalle.idCliente = "
		                + "?5                       "
		                + " AND tbldctosordenes.idPeriodo     =  ?6   ",
		                nativeQuery = true)
			  public void actualizaOrdenCliente(int xIdTipoOrdenVenta, int xIdOrdenNew, int idLocal, int IdTipoOrden, String idCliente, int xIdPeriodo );
			  
			  
			  @Query(value = "SELECT tbldctosordenes.idLog,                                      "
		                + "       tbldctosordenes.idCliente,                      	      "
		                + "       tbldctosordenes.idUsuario,                        	      "
		                + "       tbldctosordenes.fechaOrden,                      	      "
		                + "       tbldctosordenes.idEstadoTx,                      	      "
		                + "       tmpDET.IDLOCAL,                                             "
		                + "	  tmpDET.IDTIPOORDEN,                                         "
		                + "	  tmpDET.IDORDEN,                                             "
		                + "	  tmpDET.cantidadArticulos,                                   "
		                + "	  tmpDET.vrVentaConIva,                                       "
		                + "	 (tmpDET.vrVentaConIva - tmpDET.vrIvaVenta) AS vrVentaSinIva, "
		                + "	  tmpDET.vrCostoConIva,                                       "
		                + "	  tmpDET.vrCostoSinIva,                                       "
		                + "	  tmpDET.vrVentaSinDscto,                                     "
		                + "	  tmpDET.vrIvaVenta,                                          "
		                + "       tmpDET.vrIvaCosto					      "
		                + "FROM tbldctosordenes,					      "
		                + "    (						              "
		                + "SELECT tbldctosordenesdetalle.idLocal,              		      "
		                + "       tbldctosordenesdetalle.idTipoOrden,          		      "
		                + "       tbldctosordenesdetalle.idOrden,  			      "
		                + "       tbldctosordenes.idLog,  				      "
		                + "       COUNT(*) AS cantidadArticulos,			      "
		                + "       SUM(tbldctosordenesdetalle.cantidad      * 		      "
		                + "          tbldctosordenesdetalle.vrVentaUnitario )  		      "
		                + "                                 AS vrVentaConIva,  		      "
		                + "       SUM(tbldctosordenesdetalle.cantidad          *	      "
		                + "        (tbldctosordenesdetalle.vrVentaUnitario)    /              "
		                + "       ( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ) ))    "
		                + "                                              AS vrVentaSinIva,    "
		                + "       SUM(tbldctosordenesdetalle.vrCosto *  		      "
		                + "                       tbldctosordenesdetalle.cantidad)  	      "
		                + "                                              AS vrCostoConIva,    "
		                + "       SUM((tbldctosordenesdetalle.cantidad * 		      "
		                + "            tbldctosordenesdetalle.vrCosto ) /                     "
		                + "             (1 + (tbldctosordenesdetalle.porcentajeIva/100)))     "
		                + "                                              AS vrCostoSinIva,    "
		                + "       SUM((tbldctosordenesdetalle.cantidad  *                     "
		                + "        (tbldctosordenesdetalle.vrVentaUnitario  ) /	              "
		                + "       (( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ))) *  "
		                + "        ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) ) *     "
		                + "        ( 1 - ( tbldctosordenesdetalle.porcentajeDscto /  100 )))) "
		                + "                                               AS vrVentaSinDscto, "
		                + "       tmpIVA.vrIvaVenta AS vrIvaVenta,                            "
		                + "       SUM((tbldctosordenesdetalle.cantidad        *               "
		                + "           tbldctosordenesdetalle.vrCosto) -                       "
		                + "           (tbldctosordenesdetalle.cantidad        *               "
		                + "           tbldctosordenesdetalle.vrCosto) /                       "
		                + "           ( 1 + tbldctosordenesdetalle.porcentajeIva / 100))      "
		                + "                                                    AS vrIvaCosto  "
		                + "FROM   tbldctosordenes				              "
		                + "INNER JOIN tbldctosordenesdetalle				      "
		                + "ON  tbldctosordenes.IDLOCAL     =  tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN = 				      "
		                + "                               tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "AND tbldctosordenes.IDORDEN =  tbldctosordenesdetalle.IDORDEN      "
		                + "LEFT JOIN                                                          "
		                + "(SELECT tbldctosordenesdetalle.IDLOCAL,                            "
		                + "        tbldctosordenesdetalle.IDTIPOORDEN,                        "
		                + "	   tbldctosordenesdetalle.IDORDEN,                            "
		                + "	   SUM(tbldctosordenesdetalle.cantidad *                      "
		                + "           (tbldctosordenesdetalle.vrVentaUnitario) *	      "
		                + "           (1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) ) *   "
		                + "           (1 - (tbldctosordenesdetalle.porcentajeDscto / 100))) - "
		                + "        SUM(tbldctosordenesdetalle.cantidad *	              "
		                + "           (tbldctosordenesdetalle.vrVentaUnitario) *              "
		                + "           ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100 ) ) *   "
		                + "         ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100 )) / "
		                + "         ( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 )))   "
		                + "					                AS vrIvaVenta "
		                + "FROM     tblDctosOrdenes                                           "
		                + "INNER JOIN tblDctosOrdenesDetalle                                  "
		                + "ON tblDctosOrdenes.IDLOCAL = tblDctosOrdenesDetalle.IDLOCAL        "
		                + "AND tblDctosOrdenes.IDTIPOORDEN =                                  "
		                + "                                tblDctosOrdenesDetalle.IDTIPOORDEN "
		                + "AND tblDctosOrdenes.IDORDEN = tblDctosOrdenesDetalle.IDORDEN       "
		                + "WHERE  tblDctosOrdenesDetalle.IDTIPO <100                          "
		                + "GROUP BY tbldctosordenesdetalle.IDLOCAL,                           "
		                + "       tbldctosordenesdetalle.IDTIPOORDEN,                         "
		                + "	   tbldctosordenesdetalle.IDORDEN) AS tmpIVA                  "
		                + "ON tmpIVA.IDLOCAL = tblDctosOrdenesDetalle.IDLOCAL                 "
		                + "AND tmpIVA.IDTIPOORDEN = tblDctosOrdenesDetalle.IDTIPOORDEN        "
		                + "AND tmpIVA.IDORDEN = tblDctosOrdenesDetalle.IDORDEN                "
		                + "GROUP BY tbldctosordenesdetalle.idLocal,              	      "
		                + "         tbldctosordenesdetalle.idTipoOrden,                       "
		                + "         tbldctosordenesdetalle.idOrden,          		      "
		                + "         tbldctosordenes.idLog,                                    "
		                + "         tmpIVA.vrIvaVenta) AS tmpDET     	                      "
		                + "WHERE tbldctosordenes.idLocal  =   tmpDET.idLocal                  "
		                + "AND   tbldctosordenes.idTipoOrden =   tmpDET.idTipoOrden           "
		                + "AND   tbldctosordenes.idOrden     =    tmpDET.idOrden              "
		                + "AND   tmpDET.idLocal     =      				      "
		                + "?1                                                    "
		                + "AND   tmpDET.idTipoOrden =                       		      "
		                + "?2                                                "
		                + "AND   tmpDET.idLog       =          ?3             		      ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> liquidaOrdenDetalleFCH(int idLocal, int IdTipoOrden, int IdLog);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tblDctosOrdenesDetalle                                   "
		                + " SET comentario =  "
		                + "           LTRIM((RTRIM(tbldctosordenesdetalle.comentario)) +   "
		                + "           ' SDO:'+                                             "
		                + " 	          CAST(tmpCOM.vrCreditoPendiente AS varchar(14)))  "
		                + " FROM     tblDctosOrdenesDetalle                                "
		                + " INNER JOIN  tblDctosOrdenes                                    "
		                + " ON tblDctosOrdenes.IDLOCAL = tblDctosOrdenesDetalle.IDLOCAL    "
		                + " AND tblDctosOrdenes.IDTIPOORDEN =                              "
		                + "                           tblDctosOrdenesDetalle.IDTIPOORDEN   "
		                + " AND tblDctosOrdenes.IDORDEN = tblDctosOrdenesDetalle.IDORDEN   "
		                + " INNER JOIN (                                                   "
		                + "     SELECT tblDctosOrdenes_1.IDLOCAL,                          "
		                + "            tblDctosOrdenes_1.idOrden,                          "
		                + "            MAX(tblDctosOrdenes_1.idCliente) AS idCliente,      "
		                + " 	       MAX(tblDctosOrdenes_1.cuotaDiferir) AS cantidad,    "
		                + " 	       SUM(tmpFIN.vrVentaUnitario *                        "
		                + " 		         tmpFIN.cuotaFacturada) AS vrFacturado,    "
		                + "            MAX(tblDctosOrdenes_1.vrTotalDiferir) -             "
		                + " 	       SUM(tmpFIN.vrVentaUnitario * tmpFIN.cuotaFacturada) "
		                + " 		                            AS vrCreditoPendiente  "
		                + "     FROM tblDctosOrdenes AS tblDctosOrdenes_1                  "
		                + "     INNER JOIN (                                               "
		                + "        SELECT IDLOCAL,                                         "
		                + "               IDTIPOORDEN,                                     "
		                + " 		  IDORDEN,                                         "
		                + " 		  SUM(VRVENTAUNITARIO) AS vrVentaUnitario,         "
		                + " 	          CASE WHEN itemPadre > 1 THEN 1 ELSE 0 END        "
		                + " 			                        AS cuotaFacturada  "
		                + "        FROM tblDctosOrdenesDetalle AS tblDctosOrdenesDetalle_1 "
		                + "        WHERE IDLOCAL =                                         "
		                + "?1                                                 "
		                + " 	   AND IDTIPOORDEN =                                       "
		                + "?2                                   "
		                + " 	   AND IDTIPO = 8                                          "
		                + "        GROUP BY IDLOCAL,                                       "
		                + " 	            IDTIPOORDEN,                                   "
		                + " 		    IDORDEN,                                       "
		                + " 		    itemPadre) AS tmpFIN                           "
		                + " 	ON tmpFIN.IDLOCAL = tblDctosOrdenes_1.IDLOCAL              "
		                + " 	AND tmpFIN.IDTIPOORDEN = tblDctosOrdenes_1.IDTIPOORDEN     "
		                + " 	AND tmpFIN.IDORDEN = tblDctosOrdenes_1.IDORDEN             "
		                + "    INNER JOIN tblTerceros                                      "
		                + " ON tblTerceros.idLocal = tblDctosOrdenes_1.IDLOCAL             "
		                + " AND tblTerceros.idCliente = tblDctosOrdenes_1.idCliente        "
		                + " WHERE tblDctosOrdenes_1.IDLOCAL =                              "
		                + "?1                                                 "
		                + " AND tblDctosOrdenes_1.IDTIPOORDEN =                            "
		                + "?2                                   "
		                + " AND tblTerceros.idTipoTercero = 1                              "
		                + " GROUP BY tblDctosOrdenes_1.IDLOCAL,                            "
		                + "          tblDctosOrdenes_1.IDTIPOORDEN,                        "
		                + " 	     tblDctosOrdenes_1.IDORDEN) AS tmpCOM                  "
		                + " ON tmpCOM.IDLOCAL = tblDctosOrdenesDetalle.IDLOCAL             "
		                + " AND tmpCOM.idCliente = tblDctosOrdenesDetalle.idCliente        "
		                + " AND  tmpCOM.IDORDEN =tbldctosordenesdetalle.item               "
		                + " WHERE tblDctosOrdenes.IDLOCAL =                                "
		                + "?1                                                 "
		                + " AND tblDctosOrdenes.IDTIPOORDEN = 9                            "
		                + " AND tblDctosOrdenesDetalle.IDTIPO = 8                          "
		                + " AND tblDctosOrdenes.idPeriodo =  ?3                            ",
		                nativeQuery = true)
			  public void actualizaDetalleFinanciacion(int idLocal, int xIdTipoOrdenFinanciacion, int xIdPeriodo );
			  
			  
			  
			  @Query(value = "SELECT tbldctosordenesdetalle.IDLOCAL             "
		                + "    ,tbldctosordenesdetalle.IDTIPOORDEN           "
		                + "    ,tbldctosordenesdetalle.IDORDEN               "
		                + "    ,(RTRIM(tbldctosordenesdetalle.comentario) +  "
		                + "                                      ' CTA ' +    "
		                + "           CAST(VRVENTAUNITARIO AS varchar(20))   "
		                + "                 + char(10)) AS comentario  "
		                + " FROM tbldctosordenesdetalle                      "
		                + " INNER JOIN tbldctosordenes                       "
		                + " ON tbldctosordenes.idlocal      =                "
		                + "        tbldctosordenesdetalle.idlocal            "
		                + " AND tbldctosordenes.IDTIPOORDEN =                "
		                + "    tbldctosordenesdetalle.IDTIPOORDEN            "
		                + " AND tbldctosordenes.IDORDEN     =                "
		                + "        tbldctosordenesdetalle.IDORDEN            "
		                + " WHERE tbldctosordenes.idLocal     =              "
		                + "?1                                   "
		                + " AND tbldctosordenes.IDTIPOORDEN   =              "
		                + "?2                               "
		                + " AND tbldctosordenesdetalle.idTipo =              "
		                + "?3                                    "
		                + " AND tbldctosordenes.idPeriodo     =              "
		                + "?4                                 "
		                + "  ORDER BY tbldctosordenesdetalle.IDLOCAL         "
		                + "  ,tbldctosordenesdetalle.IDTIPOORDEN             "
		                + "  ,tbldctosordenesdetalle.IDORDEN",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaFinanciacion(int idLocal, int IdTipoOrden, int IdTipo, int idPeriodo);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle        "
		                + " FROM  tbldctosordenesdetalle           "
		                + " INNER JOIN tbldctosordenes             "
		                + " ON tbldctosordenesdetalle.IDLOCAL      "
		                + "              = tbldctosordenes.IDLOCAL "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN "
		                + "          = tbldctosordenes.IDTIPOORDEN "
		                + " AND  tbldctosordenesdetalle.IDORDEN    "
		                + "              = tbldctosordenes.IDORDEN "
		                + " INNER JOIN  tblterceros                "
		                + " ON tblterceros.idLocal                 "
		                + "       = tbldctosordenesdetalle.IDLOCAL "
		                + " AND tblterceros.idCliente              "
		                + "     = tbldctosordenesdetalle.idCliente "
		                + " WHERE tbldctosordenes.IDLOCAL        = "
		                + "?1                         "
		                + " AND tbldctosordenes.IDTIPOORDEN      = "
		                + "?2                     "
		                + " AND tbldctosordenes.idPeriodo        = "
		                + "?3                       "
		                + " AND tbldctosordenesdetalle.IDTIPO    = "
		                + "?4                          "
		                + " AND tbldctosordenesdetalle.idEstracto  "
		                + "              <> tblterceros.idEstracto",
		                nativeQuery = true)
			  public void retiraRegistrosEstratoAnterior(int idLocal, int IdTipoOrden, int idPeriodo, int IdTipo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle                 "
		                + "            (IDLOCAL                                "
		                + "            ,IDTIPOORDEN                            "
		                + "            ,IDORDEN                                "
		                + "            ,IDPLU                                  "
		                + "            ,CANTIDAD                               "
		                + "            ,IDTIPO                                 "
		                + "            ,PORCENTAJEIVA                          "
		                + "            ,VRVENTAUNITARIO                        "
		                + "            ,ESTADO                                 "
		                + "            ,NOMBREPLU                              "
		                + "            ,VRVENTAORIGINAL                        "
		                + "            ,VRCOSTO                                "
		                + "            ,VRDSCTOPIE                             "
		                + "            ,PORCENTAJEDSCTO                        "
		                + "            ,CANTIDADPEDIDA                         "
		                + "            ,STRIDLISTA                             "
		                + "            ,NOMBREUNIDADMEDIDA                     "
		                + "            ,comentario                             "
		                + "            ,item                                   "
		                + "            ,itemPadre                              "
		                + "            ,idEstadoTx                             "
		                + "            ,idTipoTx                               "
		                + "            ,fechaEntrega                           "
		                + "            ,idBodega                               "
		                + "            ,idSubcuenta                            "
		                + "            ,lecturaMedidor                         "
		                + "            ,idCliente                              "
		                + "            ,idEstracto                             "
		                + "            ,idRuta                                 "
		                + "            ,idNovedadLectura)                      "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL             "
		                + "       ,tbldctosordenesdetalle.IDTIPOORDEN          "
		                + "       ,tbldctosordenesdetalle.IDORDEN              "
		                + "       ,MAX(tmpAJU.idPlu) AS IDPLU                  "
		                + "       ,1 AS CANTIDAD                               "
		                + "       ,MAX(tmpAJU.idTipo) AS IDTIPO                "
		                + "       ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA  "
		                + "       ,SUM(ROUND(tbldctosordenesdetalle.cantidad * "
		                + "  tbldctosordenesdetalle.VRVENTAUNITARIO/10,0)*10)- "
		                + "        SUM(tbldctosordenesdetalle.cantidad*        "
		                + "    tbldctosordenesdetalle.VRVENTAUNITARIO)         "
		                + " 	                           AS VRVENTAUNITARIO  "
		                + "       ,0 AS estado                                 "
		                + "       ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU          "
		                + "  ,SUM(ROUND(tbldctosordenesdetalle.cantidad*       "
		                + "  tbldctosordenesdetalle.VRVENTAUNITARIO/10,0)*10)  "
		                + " 	                         AS VRVENTAORIGINAL    "
		                + "       ,0 AS  VRCOSTO                               "
		                + "       ,0 AS  VRDSCTOPIE                            "
		                + "       ,0 AS  PORCENTAJEDSCTO                       "
		                + "       ,1 AS CANTIDADPEDIDA                         "
		                + "       ,0 AS STRIDLISTA                             "
		                + "       ,MAX(NOMBREUNIDADMEDIDA)                     "
		                + "       ,'' AS comentario                            "
		                + "       ,MAX(tmpAJU.idPlu) AS item                   "
		                + "       ,MAX(itemPadre)                              "
		                + "       ,MAX(idEstadoTx)                             "
		                + "       ,MAX(idTipoTx)                               "
		                + "       ,MAX(fechaEntrega)                           "
		                + "       ,MAX(idBodega)                               "
		                + "       ,'' AS idSubcuenta                           "
		                + "       ,0 AS lecturaMedidor                         "
		                + "       ,MAX(tbldctos.idCliente)                     "
		                + "       ,MAX(idEstracto)                             "
		                + "       ,MAX(idRuta)                                 "
		                + "       ,0 AS idNovedadLectura                       "
		                + " FROM   tbldctos                                    "
		                + " INNER JOIN tbldctosordenesdetalle                  "
		                + " ON tbldctos.idLocal      =                         "
		                + "     tbldctosordenesdetalle.idLocal                 "
		                + " AND tbldctos.idTipoOrden =                         "
		                + "    tbldctosordenesdetalle.idTipoOrden              "
		                + " AND tbldctos.idOrden     =                         "
		                + "       tbldctosordenesdetalle.idOrden               "
		                + " INNER JOIN ( SELECT idLocal                        "
		                + "       ,idPlu                                       "
		                + "       ,nombrePlu                                   "
		                + "       ,porcentajeIva                               "
		                + "       ,idTipo                                      "
		                + "   FROM tblplus                                     "
		                + "   WHERE IDLOCAL   =                                "
		                + "?1                                     "
		                + "   AND idTipo      =                                "
		                + "?2 ) AS tmpAJU                              "
		                + " ON tmpAJU.idLocal                 =                "
		                + " tbldctos.idLocal                                   "
		                + " WHERE tbldctos.idLocal            =                "
		                + "?1                                     "
		                + " AND tbldctos.idTipoOrden          =                "
		                + "?3                                  "
		                + " AND tbldctos.idPeriodo            =                "
		                + "?4                                   "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal           "
		                + "       ,tbldctosordenesdetalle.idTipoOrden          "
		                + "       ,tbldctosordenesdetalle.idOrden   ",
		                nativeQuery = true)
			  public void ingresaTipo(int idLocal, int IdTipo, int IdTipoOrden, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle                 "
		                + "            (IDLOCAL                                "
		                + "            ,IDTIPOORDEN                            "
		                + "            ,IDORDEN                                "
		                + "            ,IDPLU                                  "
		                + "            ,CANTIDAD                               "
		                + "            ,IDTIPO                                 "
		                + "            ,PORCENTAJEIVA                          "
		                + "            ,VRVENTAUNITARIO                        "
		                + "            ,ESTADO                                 "
		                + "            ,NOMBREPLU                              "
		                + "            ,VRVENTAORIGINAL                        "
		                + "            ,VRCOSTO                                "
		                + "            ,VRDSCTOPIE                             "
		                + "            ,PORCENTAJEDSCTO                        "
		                + "            ,CANTIDADPEDIDA                         "
		                + "            ,STRIDLISTA                             "
		                + "            ,NOMBREUNIDADMEDIDA                     "
		                + "            ,comentario                             "
		                + "            ,item                                   "
		                + "            ,itemPadre                              "
		                + "            ,idEstadoTx                             "
		                + "            ,idTipoTx                               "
		                + "            ,fechaEntrega                           "
		                + "            ,idBodega                               "
		                + "            ,idSubcuenta                            "
		                + "            ,lecturaMedidor                         "
		                + "            ,idCliente                              "
		                + "            ,idEstracto                             "
		                + "            ,idRuta                                 "
		                + "            ,idNovedadLectura)                      "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL             "
		                + "       ,tbldctosordenesdetalle.IDTIPOORDEN          "
		                + "       ,tbldctosordenesdetalle.IDORDEN              "
		                + "       ,MAX(tmpAJU.idPlu) AS IDPLU                  "
		                + "       ,1 AS CANTIDAD                               "
		                + "       ,MAX(tmpAJU.idTipo) AS IDTIPO                "
		                + "       ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA, "
		                + " ROUND((ROUND(SUM(tbldctosordenesdetalle.cantidad * "
		                + " tbldctosordenesdetalle.VRVENTAUNITARIO)/100,0)*100)"
		                + "  - SUM(tbldctosordenesdetalle.cantidad *           "
		                + "  tbldctosordenesdetalle.VRVENTAUNITARIO),2)	       "
		                + " 	                        AS VRVENTAUNITARIO     "
		                + "       ,0 AS estado                                 "
		                + "       ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU          "
		                + "  ,SUM(ROUND(tbldctosordenesdetalle.cantidad*       "
		                + " tbldctosordenesdetalle.VRVENTAUNITARIO/100,0)*100) "
		                + " 	                         AS VRVENTAORIGINAL    "
		                + "       ,0 AS  VRCOSTO                               "
		                + "       ,0 AS  VRDSCTOPIE                            "
		                + "       ,0 AS  PORCENTAJEDSCTO                       "
		                + "       ,1 AS CANTIDADPEDIDA                         "
		                + "       ,0 AS STRIDLISTA                             "
		                + "       ,MAX(NOMBREUNIDADMEDIDA)                     "
		                + "       ,'' AS comentario                             "
		                + "       ,MAX(tmpAJU.idPlu) AS item                   "
		                + "       ,MAX(itemPadre)                              "
		                + "       ,MAX(idEstadoTx)                             "
		                + "       ,MAX(idTipoTx)                               "
		                + "       ,MAX(fechaEntrega)                           "
		                + "       ,MAX(idBodega)                               "
		                + "       ,'' AS idSubcuenta                           "
		                + "       ,0 AS lecturaMedidor                         "
		                + "       ,MAX(tbldctos.idCliente)                     "
		                + "       ,MAX(idEstracto)                             "
		                + "       ,MAX(idRuta)                                 "
		                + "       ,0 AS idNovedadLectura                       "
		                + " FROM   tbldctos                                    "
		                + " INNER JOIN tbldctosordenesdetalle                  "
		                + " ON tbldctos.idLocal      =                         "
		                + "     tbldctosordenesdetalle.idLocal                 "
		                + " AND tbldctos.idTipoOrden =                         "
		                + "    tbldctosordenesdetalle.idTipoOrden              "
		                + " AND tbldctos.idOrden     =                         "
		                + "       tbldctosordenesdetalle.idOrden               "
		                + " INNER JOIN ( SELECT idLocal                        "
		                + "       ,idPlu                                       "
		                + "       ,nombrePlu                                   "
		                + "       ,porcentajeIva                               "
		                + "       ,idTipo                                      "
		                + "   FROM tblplus                                     "
		                + "   WHERE IDLOCAL   =                                "
		                + "?1                                     "
		                + "   AND idTipo      =                                "
		                + "?2 ) AS tmpAJU                              "
		                + " ON tmpAJU.idLocal                 =                "
		                + " tbldctos.idLocal                                   "
		                + " WHERE tbldctos.idLocal            =                "
		                + "?1                                    "
		                + " AND tbldctos.idTipoOrden          =                "
		                + "?3                                 "
		                + " AND tbldctos.idPeriodo            =                "
		                + "?4                                   "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal           "
		                + "       ,tbldctosordenesdetalle.idTipoOrden          "
		                + "       ,tbldctosordenesdetalle.idOrden   ",
		                nativeQuery = true)
			  public void ingresaTipoCentena(int idLocal, int IdTipo, int IdTipoOrden, int idPeriodo );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle         "
		                + "            (IDLOCAL                      "
		                + "            ,IDTIPOORDEN                  "
		                + "            ,IDORDEN                      "
		                + "            ,IDPLU                        "
		                + "            ,CANTIDAD                     "
		                + "            ,IDTIPO                       "
		                + "            ,PORCENTAJEIVA                "
		                + "            ,VRVENTAUNITARIO              "
		                + "            ,ESTADO                       "
		                + "            ,NOMBREPLU                    "
		                + "            ,VRVENTAORIGINAL              "
		                + "            ,VRCOSTO                      "
		                + "            ,VRDSCTOPIE                   "
		                + "            ,PORCENTAJEDSCTO              "
		                + "            ,CANTIDADPEDIDA               "
		                + "            ,STRIDLISTA                   "
		                + "            ,NOMBREUNIDADMEDIDA           "
		                + "            ,comentario                   "
		                + "            ,item                         "
		                + "            ,itemPadre                    "
		                + "            ,idEstadoTx                   "
		                + "            ,idTipoTx                     "
		                + "            ,fechaEntrega                 "
		                + "            ,idBodega                     "
		                + "            ,idSubcuenta                  "
		                + "            ,lecturaMedidor               "
		                + "            ,idCliente                    "
		                + "            ,idEstracto                   "
		                + "            ,idRuta                       "
		                + "            ,idNovedadLectura)                   "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL          "
		                + "      ,tbldctosordenesdetalle.IDTIPOORDEN        "
		                + "      ,tbldctosordenesdetalle.IDORDEN            "
		                + "      ,tmpAJU.idPlu                              "
		                + "      ,1 AS CANTIDAD                             "
		                + "      ,MAX(tmpAJU.idTipo) AS IDTIPO              "
		                + "     ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA "
		                + "      ,MAX(tmpAJU.vrGeneral) AS VRVENTAUNITARIO  "
		                + "      ,0 AS estado                               "
		                + "      ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU        "
		                + "      ,MAX(tmpAJU.vrGeneral) AS VRVENTAORIGINAL  "
		                + "      ,0 AS  VRCOSTO                             "
		                + "      ,0 AS  VRDSCTOPIE                          "
		                + "      ,0 AS  PORCENTAJEDSCTO                     "
		                + "      ,1 AS CANTIDADPEDIDA                       "
		                + "      ,0 AS STRIDLISTA                           "
		                + "      ,MAX(NOMBREUNIDADMEDIDA)                   "
		                + " 	             AS NOMBREUNIDADMEDIDA          "
		                + "      ,MAX(tbldctosordenesdetalle.comentario)    "
		                + "                                 AS comentario   "
		                + "      ,MAX(tmpAJU.idPlu) AS item                 "
		                + "      ,MAX(itemPadre) As itemPadre               "
		                + "      ,MAX(tbldctosordenesdetalle.idEstadoTx)    "
		                + "                                 AS idEstadoTx   "
		                + "      ,MAX(tbldctosordenesdetalle.idTipoTx)      "
		                + "                                   AS idTipoTx   "
		                + "      ,MAX(tbldctosordenesdetalle.fechaEntrega)  "
		                + "    				 AS fechaEntrega    "
		                + "      ,MAX(idBodega) AS idBodega                 "
		                + "      ,'' AS idSubcuenta                         "
		                + "      ,0 AS lecturaMedidor                       "
		                + "      ,tbldctos.idCliente                        "
		                + "      ,MAX(idEstracto) AS idEstracto             "
		                + "      ,MAX(idRuta) AS idRuta                     "
		                + "      ,0 AS idNovedadLectura                     "
		                + " FROM   tbldctos                                 "
		                + " INNER JOIN tbldctosordenesdetalle               "
		                + " ON tbldctos.idLocal      =                      "
		                + "                  tbldctosordenesdetalle.idLocal "
		                + " AND tbldctos.idTipoOrden =                      "
		                + "              tbldctosordenesdetalle.idTipoOrden "
		                + " AND tbldctos.idOrden     =                      "
		                + "                  tbldctosordenesdetalle.idOrden "
		                + " INNER JOIN tbldctosordenes                      "
		                + " ON tbldctos.idLocal  =  tbldctosordenes.idLocal "
		                + " AND tbldctos.idTipoOrden =                      "
		                + "                    tbldctosordenes.idTipoOrden  "
		                + " AND tbldctos.idOrden = tbldctosordenes.idOrden  "
		                + " INNER JOIN ( SELECT idLocal                     "
		                + "      ,idPlu                                     "
		                + "      ,nombrePlu                                 "
		                + "      ,porcentajeIva                             "
		                + "      ,idTipo                                    "
		                + "    ,factorDespacho                              "
		                + "    ,vrGeneral                                   "
		                + "  FROM tblplus                                   "
		                + "  WHERE idTipo       =                           "
		                + "?1                                   "
		                + "  AND idCategoria =                              "
		                + "?2                              "
		                + "  AND idLocal        =                           "
		                + "?3 ) AS tmpAJU                      "
		                + " ON tmpAJU.idLocal  =  tbldctos.idLocal          "
		                + " WHERE tbldctos.idLocal            =             "
		                + "?3                                  "
		                + " AND tbldctos.idTipoOrden          =             "
		                + "?4                              "
		                + " AND tbldctos.idPeriodo            =             "
		                + "?5                                "
		                + " AND tbldctosordenes.cuotaVencida  =            "
		                + "?6                             "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal        "
		                + "      ,tbldctosordenesdetalle.idTipoOrden        "
		                + "      ,tbldctosordenesdetalle.idOrden            "
		                + "      ,tmpAJU.idPlu                              "
		                + "      ,tbldctos.idCliente   ",
		                nativeQuery = true)
			  public void ingresaOtroInteresUnaCuota(int IdTipo, int IdCategoria, int idLocal, int IdTipoOrden, int idPeriodo, int CuotaVencida );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle         "
		                + "            (IDLOCAL                      "
		                + "            ,IDTIPOORDEN                  "
		                + "            ,IDORDEN                      "
		                + "            ,IDPLU                        "
		                + "            ,CANTIDAD                     "
		                + "            ,IDTIPO                       "
		                + "            ,PORCENTAJEIVA                "
		                + "            ,VRVENTAUNITARIO              "
		                + "            ,ESTADO                       "
		                + "            ,NOMBREPLU                    "
		                + "            ,VRVENTAORIGINAL              "
		                + "            ,VRCOSTO                      "
		                + "            ,VRDSCTOPIE                   "
		                + "            ,PORCENTAJEDSCTO              "
		                + "            ,CANTIDADPEDIDA               "
		                + "            ,STRIDLISTA                   "
		                + "            ,NOMBREUNIDADMEDIDA           "
		                + "            ,comentario                   "
		                + "            ,item                         "
		                + "            ,itemPadre                    "
		                + "            ,idEstadoTx                   "
		                + "            ,idTipoTx                     "
		                + "            ,fechaEntrega                 "
		                + "            ,idBodega                     "
		                + "            ,idSubcuenta                  "
		                + "            ,lecturaMedidor               "
		                + "            ,idCliente                    "
		                + "            ,idEstracto                   "
		                + "            ,idRuta                       "
		                + "            ,idNovedadLectura)                   "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL          "
		                + "      ,tbldctosordenesdetalle.IDTIPOORDEN        "
		                + "      ,tbldctosordenesdetalle.IDORDEN            "
		                + "      ,tmpAJU.idPlu                              "
		                + "      ,1 AS CANTIDAD                             "
		                + "      ,MAX(tmpAJU.idTipo) AS IDTIPO              "
		                + "     ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA "
		                + "      ,MAX(tmpAJU.vrGeneral) AS VRVENTAUNITARIO  "
		                + "      ,0 AS estado                               "
		                + "      ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU        "
		                + "      ,MAX(tmpAJU.vrGeneral) AS VRVENTAORIGINAL  "
		                + "      ,0 AS  VRCOSTO                             "
		                + "      ,0 AS  VRDSCTOPIE                          "
		                + "      ,0 AS  PORCENTAJEDSCTO                     "
		                + "      ,1 AS CANTIDADPEDIDA                       "
		                + "      ,0 AS STRIDLISTA                           "
		                + "      ,MAX(NOMBREUNIDADMEDIDA)                   "
		                + " 	             AS NOMBREUNIDADMEDIDA          "
		                + "      ,MAX(tbldctosordenesdetalle.comentario)    "
		                + "                                 AS comentario   "
		                + "     ,MAX(tmpAJU.idPlu) AS item                  "
		                + "      ,MAX(itemPadre) As itemPadre               "
		                + "      ,MAX(tbldctosordenesdetalle.idEstadoTx)    "
		                + "                                 AS idEstadoTx   "
		                + "      ,MAX(tbldctosordenesdetalle.idTipoTx)      "
		                + "                                   AS idTipoTx   "
		                + "      ,MAX(tbldctosordenesdetalle.fechaEntrega)  "
		                + "    				 AS fechaEntrega    "
		                + "      ,MAX(idBodega) AS idBodega                 "
		                + "      ,'' AS idSubcuenta                         "
		                + "      ,0 AS lecturaMedidor                       "
		                + "      ,tbldctos.idCliente                        "
		                + "      ,MAX(idEstracto) AS idEstracto             "
		                + "      ,MAX(idRuta) AS idRuta                     "
		                + "      ,0 AS idNovedadLectura                     "
		                + " FROM   tbldctos                                 "
		                + " INNER JOIN tbldctosordenesdetalle               "
		                + " ON tbldctos.idLocal      =                      "
		                + "                  tbldctosordenesdetalle.idLocal "
		                + " AND tbldctos.idTipoOrden =                      "
		                + "              tbldctosordenesdetalle.idTipoOrden "
		                + " AND tbldctos.idOrden     =                      "
		                + "                  tbldctosordenesdetalle.idOrden "
		                + " INNER JOIN tbldctosordenes                      "
		                + " ON tbldctos.idLocal  =  tbldctosordenes.idLocal "
		                + " AND tbldctos.idTipoOrden =                      "
		                + "                    tbldctosordenes.idTipoOrden  "
		                + " AND tbldctos.idOrden = tbldctosordenes.idOrden  "
		                + " INNER JOIN ( SELECT idLocal                     "
		                + "         ,idPlu                                  "
		                + "         ,nombrePlu                              "
		                + "         ,porcentajeIva                          "
		                + "         ,idTipo                                 "
		                + "         ,factorDespacho                         "
		                + "         ,vrGeneral                              "
		                + "  FROM tblplus                                   "
		                + "  WHERE idTipo       =                           "
		                + "?1                                   "
		                + "  AND idCategoria =                              "
		                + "?2                              "
		                + "  AND idLocal        =                           "
		                + "?3 ) AS tmpAJU                      "
		                + " ON tmpAJU.idLocal   =  tbldctos.idLocal         "
		                + " WHERE tbldctos.idLocal            =             "
		                + "?3                                  "
		                + " AND tbldctos.idTipoOrden          =             "
		                + "?4                              "
		                + " AND tbldctos.idPeriodo            =             "
		                + "?5                                "
		                + " AND tbldctosordenes.cuotaVencida  >=            "
		                + "?6                             "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal        "
		                + "      ,tbldctosordenesdetalle.idTipoOrden        "
		                + "      ,tbldctosordenesdetalle.idOrden            "
		                + "      ,tmpAJU.idPlu                              "
		                + "      ,tbldctos.idCliente   ",
		                nativeQuery = true)
			  public void ingresaOtroInteresDosCuota(int IdTipo, int IdCategoria, int idLocal, int IdTipoOrden, int idPeriodo, int CuotaVencida );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle         "
		                + "            (IDLOCAL                      "
		                + "            ,IDTIPOORDEN                  "
		                + "            ,IDORDEN                      "
		                + "            ,IDPLU                        "
		                + "            ,CANTIDAD                     "
		                + "            ,IDTIPO                       "
		                + "            ,PORCENTAJEIVA                "
		                + "            ,VRVENTAUNITARIO              "
		                + "            ,ESTADO                       "
		                + "            ,NOMBREPLU                    "
		                + "            ,VRVENTAORIGINAL              "
		                + "            ,VRCOSTO                      "
		                + "            ,VRDSCTOPIE                   "
		                + "            ,PORCENTAJEDSCTO              "
		                + "            ,CANTIDADPEDIDA               "
		                + "            ,STRIDLISTA                   "
		                + "            ,NOMBREUNIDADMEDIDA           "
		                + "            ,comentario                   "
		                + "            ,item                         "
		                + "            ,itemPadre                    "
		                + "            ,idEstadoTx                   "
		                + "            ,idTipoTx                     "
		                + "            ,fechaEntrega                 "
		                + "            ,idBodega                     "
		                + "            ,idSubcuenta                  "
		                + "            ,lecturaMedidor               "
		                + "            ,idCliente                    "
		                + "            ,idEstracto                   "
		                + "            ,idRuta                       "
		                + "            ,idNovedadLectura)                   "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL          "
		                + "      ,tbldctosordenesdetalle.IDTIPOORDEN        "
		                + "      ,tbldctosordenesdetalle.IDORDEN            "
		                + "      ,tmpAJU.idPlu                              "
		                + "  ,MAX(tbldctosordenes.cuotaVencida) AS CANTIDAD "
		                + "      ,MAX(tmpAJU.idTipo) AS IDTIPO              "
		                + "     ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA "
		                + "      ,MAX(tmpAJU.vrGeneral) AS VRVENTAUNITARIO  "
		                + "      ,0 AS estado                               "
		                + "      ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU        "
		                + "      ,MAX(tmpAJU.vrGeneral) AS VRVENTAORIGINAL  "
		                + "      ,0 AS  VRCOSTO                             "
		                + "      ,0 AS  VRDSCTOPIE                          "
		                + "      ,0 AS  PORCENTAJEDSCTO                     "
		                + "      ,1 AS CANTIDADPEDIDA                       "
		                + "      ,0 AS STRIDLISTA                           "
		                + "      ,MAX(NOMBREUNIDADMEDIDA)                   "
		                + " 	             AS NOMBREUNIDADMEDIDA          "
		                + "      ,MAX(tbldctosordenesdetalle.comentario)    "
		                + "                                 AS comentario   "
		                + "     ,MAX(tmpAJU.idPlu) AS item                  "
		                + "      ,MAX(itemPadre) As itemPadre               "
		                + "      ,MAX(tbldctosordenesdetalle.idEstadoTx)    "
		                + "                                 AS idEstadoTx   "
		                + "      ,MAX(tbldctosordenesdetalle.idTipoTx)      "
		                + "                                   AS idTipoTx   "
		                + "      ,MAX(tbldctosordenesdetalle.fechaEntrega)  "
		                + "    				 AS fechaEntrega    "
		                + "      ,MAX(idBodega) AS idBodega                 "
		                + "      ,'' AS idSubcuenta                         "
		                + "      ,0 AS lecturaMedidor                       "
		                + "      ,tbldctos.idCliente                        "
		                + "      ,MAX(idEstracto) AS idEstracto             "
		                + "      ,MAX(idRuta) AS idRuta                     "
		                + "      ,0 AS idNovedadLectura                     "
		                + " FROM   tbldctos                                 "
		                + " INNER JOIN tbldctosordenesdetalle               "
		                + " ON tbldctos.idLocal      =                      "
		                + "                  tbldctosordenesdetalle.idLocal "
		                + " AND tbldctos.idTipoOrden =                      "
		                + "              tbldctosordenesdetalle.idTipoOrden "
		                + " AND tbldctos.idOrden     =                      "
		                + "                  tbldctosordenesdetalle.idOrden "
		                + " INNER JOIN tbldctosordenes                      "
		                + " ON tbldctos.idLocal  =  tbldctosordenes.idLocal "
		                + " AND tbldctos.idTipoOrden =                      "
		                + "                    tbldctosordenes.idTipoOrden  "
		                + " AND tbldctos.idOrden = tbldctosordenes.idOrden  "
		                + " INNER JOIN ( SELECT idLocal                     "
		                + "         ,idPlu                                  "
		                + "         ,nombrePlu                              "
		                + "         ,porcentajeIva                          "
		                + "         ,idTipo                                 "
		                + "         ,factorDespacho                         "
		                + "         ,vrGeneral                              "
		                + "  FROM tblplus                                   "
		                + "  WHERE idTipo       =                           "
		                + "?1                                   "
		                + "  AND idCategoria =                              "
		                + "?2                              "
		                + "  AND idLocal        =                           "
		                + "?3 ) AS tmpAJU                      "
		                + " ON tmpAJU.idLocal   =  tbldctos.idLocal         "
		                + " WHERE tbldctos.idLocal            =             "
		                + "?3                                  "
		                + " AND tbldctos.idTipoOrden          =             "
		                + "?4                              "
		                + " AND tbldctos.idPeriodo            =             "
		                + "?5                                "
		                + " AND tbldctosordenes.cuotaVencida  >=            "
		                + "?6                             "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal        "
		                + "      ,tbldctosordenesdetalle.idTipoOrden        "
		                + "      ,tbldctosordenesdetalle.idOrden            "
		                + "      ,tmpAJU.idPlu                              "
		                + "      ,tbldctos.idCliente   ",
		                nativeQuery = true)
			  public void ingresaInteresVrContanteXCuotaVencida(int IdTipo, int IdCategoria, int idLocal, int IdTipoOrden, int idPeriodo, int CuotaVencida );
			  
			  
			  
			  @Query(value = "SELECT sum( cantidad *   VRVENTAUNITARIO * ( 1 + porcentajeIva/100)) AS totalFactura " +
		              "FROM bdaquamovil.dbo.tbldctosordenesdetalle " +
		              "WHERE tbldctosordenesdetalle.idlocal = ?1 " +
		              "AND tbldctosordenesdetalle.idtipoorden IN (?2) " +
		              "AND tbldctosordenesdetalle.idorden = ?3 ",
		              nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> ObtenerValorFactura(int idLocal, List<Integer> idtipoorden, int idorden);
			  
			  
			  @Query(value = "SELECT COUNT(*) " +
		              "FROM bdaquamovil.dbo.tbldctosordenesdetalle " +
		              "WHERE tbldctosordenesdetalle.idlocal = ?1 " +
		              "AND tbldctosordenesdetalle.idtipoorden IN (?2) " +
		              "AND tbldctosordenesdetalle.idorden = ?3 ",
		              nativeQuery = true)
			  Integer ObtenerCantArticulos(int idLocal, List<Integer> idtipoorden, int idorden);
			  
			  
			  
			  @Query(value = "SELECT tmpDcto.IDPLU,                          "
		                + "       MIN(tmpDcto.CANTIDAD) AS cantidad,      "
		                + "       MAX(tmpDcto.NOMBREPLU) AS nombrePlu,    "
		                + "       SUM(tmpDcto.vrVentaUnitario)            "
		                + "                           AS vrVentaUnitario, "
		                + "       SUM(tmpDcto.PORCENTAJEIVA)              "
		                + "                           AS porcentajeIva,   "
		                + "       SUM(tmpDcto.VRCOSTO) AS vrCosto ,       "
		                + "       SUM(tmpDcto.item) AS item,              "
		                + "       SUM(tmpDcto.vrVentaConIva)              "
		                + "                         AS vrVentaConIva,     "
		                + "       SUM(tmpDcto.vrCostoConIva)              "
		                + "                             AS vrCostoConIva  "
		                + "FROM (                                         "
		                + "SELECT tbldctosordenesdetalle.IDPLU,           "
		                + "       tbldctosordenesdetalle.CANTIDAD,        "
		                + "       tbldctosordenesdetalle.NOMBREPLU,       "
		                + "   (tbldctosordenesdetalle.vrVentaUnitario    * "
		                + "  (1 - tbldctosordenesdetalle.porcentajeDscto / 100) * "
		                + "  (1 - tbldctosordenesdetalle.vrDsctoPie / 100))        "
		                + "                                   AS vrVentaUnitario, "
		                + "       tbldctosordenesdetalle.PORCENTAJEIVA,   "
		                + "       tbldctosordenesdetalle.VRCOSTO,         "
		                + "       tbldctosordenesdetalle.item,            "
		                + "  ((tbldctosordenesdetalle.CANTIDAD          * "
		                + "    tbldctosordenesdetalle.vrVentaUnitario ) *	"
		                + "  (1 - tbldctosordenesdetalle.porcentajeDscto  "
		                + "                                      / 100) * "
		                + "  (1 - tbldctosordenesdetalle.vrDsctoPie       "
		                + "                                      / 100))  "
		                + "                             AS vrVentaConIva, "
		                + "  (tbldctosordenesdetalle.CANTIDAD          *  "
		                + "  tbldctosordenesdetalle.VRCOSTO ) "
		                + "                             AS vrCostoConIva  "
		                + "FROM   tbldctos                                "
		                + "INNER JOIN tbldctosordenes                     "
		                + "ON  tbldctos.IDLOCAL            =              "
		                + "          tbldctosordenes.IDLOCAL  "
		                + "AND tbldctos.IDTIPOORDEN        =              "
		                + "      tbldctosordenes.IDTIPOORDEN  "
		                + "AND tbldctos.IDORDEN            =              "
		                + "          tbldctosordenes.IDORDEN  "
		                + "INNER JOIN tbldctosordenesdetalle              "
		                + "ON  tbldctosordenes.IDLOCAL     =              "
		                + "   tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN =              "
		                + "           tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "AND tbldctosordenes.IDORDEN     =              "
		                + "   tbldctosordenesdetalle.IDORDEN  "
		                + "WHERE tbldctos.IDLOCAL          =              "
		                + "?1                                "
		                + "AND tbldctos.IDTIPOORDEN        =              "
		                + "?2                            "
		                + "AND tbldctos.idOrden            =              "
		                + "?3                                     "
		                + "AND tbldctos.indicador          =              "
		                + "?4                                  "
		                + "UNION                                          "
		                + "SELECT tbldctosordenesdetalle.IDPLU,           "
		                + "       SUM(tbldctosordenesdetalle.CANTIDAD)    "
		                + "                                 AS CANTIDAD , "
		                + "       MAX(tbldctosordenesdetalle.NOMBREPLU)   "
		                + "                                 AS NOMBREPLU, "
		                + "   SUM(tbldctosordenesdetalle.VRVENTAUNITARIO) "
		                + "                           AS VRVENTAUNITARIO, "
		                + "   SUM(tbldctosordenesdetalle.PORCENTAJEIVA)   "
		                + "                             AS PORCENTAJEIVA, "
		                + "   SUM(tbldctosordenesdetalle.VRCOSTO)         "
		                + "                                   AS VRCOSTO, "
		                + "   MAX(tbldctosordenesdetalle.item) AS item,   "
		                + "   SUM(tbldctosordenesdetalle.CANTIDAD      *  "
		                + "       tbldctosordenesdetalle.VRVENTAUNITARIO) "
		                + "                             AS vrVentaConIva, "
		                + "  SUM(tbldctosordenesdetalle.CANTIDAD       *  "
		                + "  tbldctosordenesdetalle.VRCOSTO ) "
		                + "                             AS vrCostoConIva  "
		                + "FROM   tbldctos                                "
		                + "INNER JOIN tbldctosordenes                     "
		                + "ON  tbldctos.IDLOCAL            =              "
		                + "          tbldctosordenes.IDLOCAL  "
		                + "AND tbldctos.IDTIPOORDEN        =              "
		                + "      tbldctosordenes.IDTIPOORDEN  "
		                + "AND tbldctos.IDORDEN            =              "
		                + "          tbldctosordenes.IDORDEN  "
		                + "INNER JOIN tbldctosordenesdetalle              "
		                + "ON  tbldctosordenes.IDLOCAL     =              "
		                + "   tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN =              "
		                + "           tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "AND tbldctosordenes.IDORDEN     =              "
		                + "   tbldctosordenesdetalle.IDORDEN  "
		                + "WHERE tbldctos.IDLOCALCruce     =              "
		                + "?1                                "
		                + "AND tbldctos.IDTIPOORDENCRUCE   =              "
		                + "?2                             "
		                + "AND tbldctos.idOrdenCruce       =              "
		                + "?3                                    "
		                + "AND tbldctos.indicador          =              "
		                + "?4                                  "
		                + "GROUP BY tbldctosordenesdetalle.IDPLU    )     "
		                + "                                   AS tmpDcto  "
		                + "GROUP BY tmpDcto.IDPLU                         "
		                + "ORDER BY 7                                     ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaDevolucionOrden(int idLocal, int IdTipoOrden, int IdOrden, int Indicador);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle    "
		                + "FROM        tbldctosordenes           "
		                + "INNER JOIN  tbldctosordenesdetalle    "
		                + "ON tbldctosordenes.IDLOCAL      =     "
		                + "       tbldctosordenesdetalle.IDLOCAL "
		                + "AND tbldctosordenes.IDTIPOORDEN =     "
		                + "   tbldctosordenesdetalle.IDTIPOORDEN "
		                + "AND tbldctosordenes.IDORDEN     =     "
		                + "       tbldctosordenesdetalle.IDORDEN "
		                + "WHERE  tbldctosordenes.idLocal  =     "
		                + "?1                           "
		                + "AND  tbldctosordenes.IDLOG      =  ?2   ",
		                nativeQuery = true)
			  public void retiraDevolucion(int idLocal, int idLog );
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle              "
		                + "SET    tbldctosordenesdetalle.vrDsctoPie = "
		                + "?1                         "
		                + "WHERE EXISTS (                             "
		                + "   SELECT tbldctosordenes.*                "
		                + "   FROM tbldctosordenes                    "
		                + "   WHERE tbldctosordenes.idLocal      =    "
		                + "          tbldctosordenesdetalle.idLocal   "
		                + "   AND    tbldctosordenes.idTipoOrden =    "
		                + "      tbldctosordenesdetalle.idTipoOrden   "
		                + "   AND   tbldctosordenes.idOrden      =    "
		                + "            tbldctosordenesdetalle.idOrden "
		                + "   AND tbldctosordenes.idLocal        =    "
		                + "?2                            "
		                + "   AND tbldctosordenes.idTipoOrden    =    "
		                + "?3                        "
		                + "   AND tbldctosordenes.idLog          =    "
		                + "?4)", nativeQuery = true)
			  public void actualizaDescuentoPie(Double VrDsctoPie, int idLocal, int IdTipoOrden, int idLog );
			  
			  
			  
			  @Query(value = "SELECT tbldctosordenesdetalle.idPlu,			         "
		                + "       tbldctosordenesdetalle.nombrePlu,			 "
		                + "       tbldctosordenesdetalle.item,			         "
		                + "       tbldctosordenesdetalle.itemPadre,			 "
		                + "       tbldctosordenesdetalle.cantidad,			 "
		                + "       tbldctosordenesdetalle.vrCosto,		         "
		                + "       tbldctosordenesdetalle.vrVentaUnitario,	         "
		                + "       tbldctosordenesdetalle.vrVentaOriginal,	         "
		                + "       tbldctosordenesdetalle.porcentajeDscto,		 "
		                + "       tbldctosordenesdetalle.porcentajeIva,			 "
		                + "       (tbldctosordenesdetalle.cantidad        *		 "
		                + "       tbldctosordenesdetalle.vrVentaUnitario) /	         "
		                + "       ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100) )  "
		                + "                                     AS vrVentaSinIva,        "
		                + "       (tbldctosordenesdetalle.cantidad        *		 "
		                + "       tbldctosordenesdetalle.vrVentaUnitario)                "
		                + "                                     AS vrVentaConIva,        "
		                + "              (((tbldctosordenesdetalle.cantidad       *     "
		                + "              tbldctosordenesdetalle.vrVentaUnitario)  /     "
		                + " ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) *     "
		                + " ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100))     *     "
		                + " ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100)))     "
		                + "                                     AS vrVentaSinDscto,     "
		                + "      (((tbldctosordenesdetalle.cantidad        *		 "
		                + "       tbldctosordenesdetalle.vrVentaUnitario) /		"
		                + " ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) *     "
		                + " ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100))*     "
		                + " ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100))     *     "
		                + "        ( tbldctosordenesdetalle.porcentajeIva / 100 ))      "
		                + "                                      AS vrIvaVenta,         "
		                + "        tbldctosordenesdetalle.comentario,			 "
		                + "        tbldctosordenesdetalle.idEstadoTx,			 "
		                + "        tbldctosordenesdetalle.nombreUnidadMedida,		 "
		                + "        tmpPlu.vrCosto AS vrCostoActual,			 "
		                + "        (tbldctosordenesdetalle.cantidad *			 "
		                + "        tbldctosordenesdetalle.vrCosto ) AS vrCostoConIva,    "
		                + "        tmpPlu.existencia,				         "
		                + "        tmpPlu.nombreCategoria,				 "
		                + "        tmpPlu.nombreMarca,					"
		                + "        tmpPlu.nombreLinea					"
		                + "FROM   tbldctosordenesdetalle ,				"
		                + "       (SELECT  tblplusinventario.idLocal,			"
		                + "                tblplusinventario.idPlu,			"
		                + "                tblplusinventario.existencia,		"
		                + "                tblcategorias.nombreCategoria,		"
		                + "                tblmarcas.nombreMarca,			"
		                + "                tbllineas.nombreLinea,			"
		                + "                tblplus.vrCosto				"
		                + "        FROM    tblplus					"
		                + "        INNER JOIN tblmarcas					"
		                + "        ON tblplus.idMarca       =                           "
		                + "                   tblmarcas.idMarca				"
		                + "        INNER JOIN tblcategorias				"
		                + "        ON tblplus.idLinea       =				"
		                + "               tblcategorias.idLinea				"
		                + "        AND tblplus.idCategoria  =				"
		                + "           tblcategorias.IdCategoria				"
		                + "        AND tblplus.idLocal  =				"
		                + "           tblcategorias.IdLocal      			"
		                + "        INNER JOIN tbllineas					"
		                + "        ON tblcategorias.idLinea =				"
		                + "                   tbllineas.idLinea				"
		                + "        AND tblcategorias.idLocal =				"
		                + "                   tbllineas.idLocal				"
		                + "        INNER JOIN tblplusinventario				"
		                + "        ON tblplus.idPlu         =				"
		                + "                     tblplusinventario.idPlu                 "
		                + "        AND tblplus.idLocal         =	        	"
		                + "                     tblplusinventario.idLocal               "
		                + "        WHERE tblplusinventario.idLocal =                    "
		                + "?1                                              "
		                + "        AND   tblplusinventario.idBodega=                    "
		                + "?2 ) AS tmpPlu			                 "
		                + "WHERE EXISTS ( SELECT tbldctosordenes.*			 "
		                + "               FROM tbldctosordenes				"
		                + "               WHERE tbldctosordenes.idLocal     =		"
		                + "                       tbldctosordenesdetalle.idLocal	"
		                + "               AND   tbldctosordenes.idTipoOrden =           "
		                + "                   tbldctosordenesdetalle.idTipoOrden        "
		                + "               AND   tbldctosordenes.idOrden     =           "
		                + "                       tbldctosordenesdetalle.idOrden        "
		                + "               AND   tbldctosordenes.idLocal     =           "
		                + "?1                                              "
		                + "               AND   tbldctosordenes.idLog       =           "
		                + "?3                                                "
		                + "               AND   tbldctosordenes.idTipoOrden =           "
		                + "?4 )                                        "
		                + "AND  tmpPlu.idPlu    = tbldctosordenesdetalle.idPlu          "
		                + "AND  tmpPlu.idLocal  = tbldctosordenesdetalle.idLocal        "
		                + "ORDER BY tbldctosordenesdetalle.itemPadre,                   "
		                + "         tbldctosordenesdetalle.item                         ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaDetalle(int idLocal, int IdBodega, int IdLog, int IdTipoOrden);
			  
			  
			  
			  @Query(value = "SELECT tbldctosordenes.idCliente,                                      "

		                + "       tbldctosordenes.idUsuario,                        	      "
		                + "       tbldctosordenes.fechaOrden,                      	      "
		                + "       tbldctosordenes.idEstadoTx,                      	      "
		                + "       tmpDET.*						      "
		                + "FROM tbldctosordenes,					      "
		                + "    (						              "
		                + "SELECT tbldctosordenesdetalle.idLocal,              		      "
		                + "       tbldctosordenesdetalle.idTipoOrden,          		      "
		                + "       tbldctosordenesdetalle.idOrden,  			      "
		                + "       tbldctosordenes.idLog,  				      "
		                + "       COUNT(*) AS cantidadArticulos,			      "
		                + "       SUM(tbldctosordenesdetalle.cantidad      * 		      "
		                + "          tbldctosordenesdetalle.vrVentaUnitario )  		      "
		                + "                                 AS vrVentaConIva,  		      "
		                + "       SUM(tbldctosordenesdetalle.cantidad          *	      "
		                + "        (tbldctosordenesdetalle.vrVentaUnitario)    /              "
		                + "       ( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ) ))    "
		                + "                                              AS vrVentaSinIva,    "
		                + "       SUM(tbldctosordenesdetalle.vrCosto *  		      "
		                + "                       tbldctosordenesdetalle.cantidad)  	      "
		                + "                                              AS vrCostoConIva,    "
		                + "       SUM((tbldctosordenesdetalle.cantidad * 		      "
		                + "            tbldctosordenesdetalle.vrCosto ) /                     "
		                + "             (1 + (tbldctosordenesdetalle.porcentajeIva/100)))     "
		                + "                                              AS vrCostoSinIva,    "
		                + "       SUM((tbldctosordenesdetalle.cantidad  *                     "
		                + "        (tbldctosordenesdetalle.vrVentaUnitario  ) /	              "
		                + "       (( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ))) *  "
		                + "        ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) ) *     "
		                + "        ( 1 - ( tbldctosordenesdetalle.porcentajeDscto /  100 )))) "
		                + "                                               AS vrVentaSinDscto, "
		                + "       SUM(tbldctosordenesdetalle.cantidad   *                     "
		                + "        (tbldctosordenesdetalle.vrVentaUnitario)    *	      "
		                + "       ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) ) *      "
		                + "       ( 1 - ( tbldctosordenesdetalle.porcentajeDscto /  100))) -  "
		                + "       SUM(tbldctosordenesdetalle.cantidad          *	      "
		                + "        (tbldctosordenesdetalle.vrVentaUnitario)    *              "
		                + "       ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) )    *   "
		                + "       ( 1 - ( tbldctosordenesdetalle.porcentajeDscto /  100 )) /  "
		                + "       ( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ) ))    "
		                + "                                                    AS vrIvaVenta, "
		                + "       SUM((tbldctosordenesdetalle.cantidad        *               "
		                + "           tbldctosordenesdetalle.vrCosto) -                       "
		                + "           (tbldctosordenesdetalle.cantidad        *               "
		                + "           tbldctosordenesdetalle.vrCosto) /                       "
		                + "           ( 1 + tbldctosordenesdetalle.porcentajeIva / 100))      "
		                + "                                                   AS vrIvaCosto  "
		                + "FROM   tbldctosordenes				              "
		                + "INNER JOIN tbldctosordenesdetalle				      "
		                + "ON  tbldctosordenes.IDLOCAL     =  tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN = 				      "
		                + "                               tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "AND tbldctosordenes.IDORDEN =  tbldctosordenesdetalle.IDORDEN      "
		                + "GROUP BY tbldctosordenesdetalle.idLocal,              	      "
		                + "         tbldctosordenesdetalle.idTipoOrden,                       "
		                + "         tbldctosordenesdetalle.idOrden,          		      "
		                + "         tbldctosordenes.idLog) AS tmpDET     	              "
		                + "WHERE tbldctosordenes.idLocal  =   tmpDET.idLocal                  "
		                + "AND   tbldctosordenes.idTipoOrden =   tmpDET.idTipoOrden           "
		                + "AND   tbldctosordenes.idOrden     =    tmpDET.idOrden              "
		                + "AND   tmpDET.idLocal     =      				      "
		                + "?1                                                    "
		                + "AND   tmpDET.idTipoOrden =                       		      "
		                + "?2                                               "
		                + "AND   tmpDET.idLog       =       ?3                		      ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> liquidaOrdenFCH(int idLocal, int IdTipoOrden, int IdLog);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle               "
		                + "SET tbldctosordenesdetalle.IDTIPOORDEN    = "
		                + "?1                         ,"
		                + "    tbldctosordenesdetalle.IDORDEN        = "
		                + "?2                             ,"
		                + "    tbldctosordenesdetalle.cantidad       = "
		                + "(tbldctosordenesdetalle.cantidad *          "
		                + "?3)                         "
		                + "WHERE tbldctosordenesdetalle.IDLOCAL      = "
		                + "?4                             "
		                + "AND   tbldctosordenesdetalle.IDTIPOORDEN  = "
		                + "?5                         "
		                + "AND   tbldctosordenesdetalle.IDORDEN      = "
		                + "?6                             "
			                 , nativeQuery = true)
			  public void actualizaNota(int IdTipoOrdenNew, int IdOrdenNew, int xSignoOperacion, int idLocal, int IdTipoOrden, int IdOrden );
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle               "
		                + "SET tbldctosordenesdetalle.estado         = "
		                + "?1                    "
		                + "WHERE tbldctosordenesdetalle.IDLOCAL      = "
		                + "?2                            "
		                + "AND   tbldctosordenesdetalle.IDTIPOORDEN  = "
		                + "?3                         "
		                + "AND   tbldctosordenesdetalle.IDORDEN      = "
		                + "?4                             "
		                + "AND   tbldctosordenesdetalle.estado       = ?5 "
			                 , nativeQuery = true)
			  public void actualizaEstadoInventario(int xEstadoInventarioNew, int idLocal, int IdTipoOrden, int idOrden, int estado);
			  
			  
			  
			  
			  @Query(value = "SELECT   tbldctosordenesdetalle.idPlu,                      "
		                + "         tbldctosordenesdetalle.item,                      "
		                + "          tbldctosordenesdetalle.itemPadre,                "
		                + "         MIN(tbldctosordenesdetalle.nombrePlu)             "
		                + "                                            AS nombrePlu , "
		                + "         MIN(tbldctosordenesdetalle.cantidad) AS cantidad, "
		                + "         MIN( tbldctosordenesdetalle.vrVentaUnitario)      "
		                + "                                       AS vrVentaUnitario, "
		                + "         MIN( tbldctosordenesdetalle.vrVentaOriginal)      "
		                + "                                      AS vrVentaOriginal,  "
		                + "         MIN( tbldctosordenesdetalle.porcentajeDscto)    "
		                + "                                      AS porcentajeDscto,  "
		                + "         MIN(tbldctosordenesdetalle.cantidad         *    "
		                + "               tbldctosordenesdetalle.vrVentaUnitario )    "
		                + "                                       AS vrVentaConIva,   "
		                + "         MIN((tbldctosordenesdetalle.cantidad        *     "
		                + "               tbldctosordenesdetalle.vrVentaUnitario) /   "
		                + "   ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100)))   "
		                + "                                       AS vrVentaSinIva,   "
		                + "         MIN(tbldctosordenesdetalle.porcentajeIva)         "
		                + "                                      AS porcentajeIva,    "
		                + "        MAX(tblcategorias.nombreCategoria)                 "
		                + "                                       AS nombreCategoria, "
		                + "        MAX(tblmarcas.nombreMarca) AS nombreMarca,         "
		                + "         MIN( tbldctosordenesdetalle.vrCosto)              "
		                + "                                       AS vrCosto,         "
		                + "                   SUM(tbldctosordenesdetalle.vrCosto *    "
		                + "                       tbldctosordenesdetalle.cantidad)    "
		                + "                                      AS vrCostoConIva,    "
		                + "                SUM( (tbldctosordenesdetalle.cantidad *    "
		                + "                      tbldctosordenesdetalle.vrCosto ) /   "
		                + "      (1 + (tbldctosordenesdetalle.porcentajeIva/100)))    "
		                + "                                      AS vrCostoSinIva,    "
		                + "           MIN(((tbldctosordenesdetalle.cantidad       *   "
		                + "              tbldctosordenesdetalle.vrVentaUnitario)  /   "
		                + " ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) *   "
		                + " ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100))     *   "
		                + " ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100)))   "
		                + "                                     AS vrVentaSinDscto,   "
		                + "   SUM(((tbldctosordenesdetalle.cantidad        *          "
		                + "       tbldctosordenesdetalle.vrVentaUnitario) /           "
		                + " ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) *   "
		                + " ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100))     *   "
		                + " ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100))*   "
		                + "        ( tbldctosordenesdetalle.porcentajeIva / 100 ))    "
		                + "                                      AS vrIvaVenta       "
		                + "FROM   tblcategorias                                       "
		                + "INNER JOIN tblplus                                         "
		                + "INNER JOIN tblmarcas                                       "
		                + "ON tblplus.idMarca              = tblmarcas.idMarca        "
		                + "ON tblcategorias.idLinea        = tblplus.idLinea          "
		                + "AND tblcategorias.IdCategoria   = tblplus.idCategoria      "
		                + "AND tblcategorias.idLocal       = tblplus.idLocal          "
		                + "INNER JOIN tbldctosordenes                                 "
		                + "INNER JOIN tbldctosordenesdetalle                          "
		                + "ON tbldctosordenes.IDLOCAL      =                          "
		                + "                       tbldctosordenesdetalle.IDLOCAL      "
		                + "AND tbldctosordenes.IDTIPOORDEN =                          "
		                + "                   tbldctosordenesdetalle.IDTIPOORDEN      "
		                + "AND tbldctosordenes.IDORDEN     =                          "
		                + "                       tbldctosordenesdetalle.IDORDEN      "
		                + "ON tblplus.idPlu                =                          "
		                + "                         tbldctosordenesdetalle.IDPLU      "
		                + "AND tblplus.idLocal                =                       "
		                + "                         tbldctosordenesdetalle.IDLocal    "
		                + "AND   tbldctosordenes.idLocal     =                        "
		                + "?1                                            "
		                + "AND   tbldctosordenes.IDTIPOORDEN =                        "
		                + "?2                                        "
		                + "AND   tbldctosordenes.idOrden     =                        "
		                + "?3                                            "
		                + "GROUP BY tbldctosordenesdetalle.item,                      "
		                + "         tbldctosordenesdetalle.itemPadre,                 "
		                + "         tbldctosordenesdetalle.idPlu",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO2> detallaUnPedidoOrden(int idLocal, int IdTipoOrden, int IdOrden);
			  
			  
			  
			  
			  @Query(value = "SELECT tbllocales.idLocal,                   "
		                + "       tbllocales.nombreLocal,               "
		                + "       tbllocales.razonSocial,               "
		                + "       tbllocales.nit,                       "
		                + "       tbllocales.direccion,                 "
		                + "       tbllocales.ciudad,                    "
		                + "       tbllocales.telefono,                  "
		                + "       tbllocales.email,                     "
		                + "       tbllocales.txtFactura,                "
		                + "       tbllocales.resolucion,                "
		                + "       tbllocales.rango,                     "
		                + "       tbllocales.regimen,                    "
		                + "       tbldctos.idDcto                       "
		                + "FROM tbllocales,                             "
		                + "     tbldctos,                               "
		                + "     tbldctosordenes ,                       "
		                + "     tbldctosordenesdetalle                  "
		                + "WHERE tbldctosordenes.idOrden         =      "
		                + "            tbldctosordenesdetalle.idOrden   "
		                + "AND   tbldctosordenes.idTipoOrden     =      "
		                + "      tbldctosordenesdetalle.idTipoOrden     "
		                + "AND   tbldctosordenes.idLocal         =      "
		                + "            tbldctosordenesdetalle.idLocal   "
		                + "AND   tbldctosordenes.idLocal         =      "
		                + "                        tbllocales.idLocal   "
		                
		                
						+ "AND   tbldctosordenes.idTipoOrden     =      "
						+ "      tbldctos.idTipoOrden     "
						+ "AND   tbldctosordenes.idLocal         =      "
						+ "            tbldctos.idLocal   "
						+ "AND   tbldctosordenes.idOrden         =      "
						+ "                        tbldctos.idOrden   "
		                
		                
		                + "AND   tbldctosordenes.idOrden         =      "
		                + "?1                              "
		                + "AND   tbldctosordenes.idTipoOrden     =      "
		                + "?2                          "
		                + "AND   tbldctosordenes.idLocal         =      "
		                + "?3                             "
		                + "GROUP BY tbllocales.idLocal,                 "
		                + "       tbllocales.nombreLocal,               "
		                + "       tbllocales.razonSocial,               "
		                + "       tbllocales.nit,                       "
		                + "       tbllocales.direccion,                 "
		                + "       tbllocales.ciudad,                    "
		                + "       tbllocales.telefono,                  "
		                + "       tbllocales.email,                     "
		                + "       tbllocales.txtFactura,                "
		                + "       tbllocales.resolucion,                "
		                + "       tbllocales.rango,                     "
		                + "       tbllocales.regimen,                   "
		                + "       tbldctos.idDcto                       ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaUnLocalOrden(int IdOrden, int IdTipoOrden, int idLocal);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle   "
		                + " FROM tbldctos                       "
		                + " INNER JOIN  tbldctosordenesdetalle  "
		                + " ON tbldctos.IDLOCAL =               "
		                + "      tbldctosordenesdetalle.IDLOCAL "
		                + " AND tbldctos.IDTIPOORDEN =          "
		                + "  tbldctosordenesdetalle.IDTIPOORDEN "
		                + " AND tbldctos.IDORDEN =              "
		                + "      tbldctosordenesdetalle.IDORDEN "
		                + " WHERE tbldctos.IDLOCAL =            "
		                + "?1                      "
		                + " AND tbldctos.IDTIPOORDEN =          "
		                + "?2                  "
		                + " AND tbldctos.idPeriodo =            "
		                + "?3                    "
		                + " AND tbldctos.idCliente =           "
		                + "?4                   "
		                + " AND tbldctosordenesdetalle.IDTIPO = ?5 ",
		                nativeQuery = true)
			  public void retiraItemAjuste(int idLocal, int IdTipoOrden, int idPeriodo, String idCliente, int idTipo);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle                   "
		                + "            (IDLOCAL                                "
		                + "            ,IDTIPOORDEN                            "
		                + "            ,IDORDEN                                "
		                + "            ,IDPLU                                  "
		                + "            ,CANTIDAD                               "
		                + "            ,IDTIPO                                 "
		                + "            ,PORCENTAJEIVA                          "
		                + "            ,VRVENTAUNITARIO                        "
		                + "            ,ESTADO                                 "
		                + "            ,NOMBREPLU                              "
		                + "            ,VRVENTAORIGINAL                        "
		                + "            ,VRCOSTO                                "
		                + "            ,VRDSCTOPIE                             "
		                + "            ,PORCENTAJEDSCTO                        "
		                + "            ,CANTIDADPEDIDA                         "
		                + "            ,STRIDLISTA                             "
		                + "            ,NOMBREUNIDADMEDIDA                     "
		                + "            ,comentario                             "
		                + "            ,item                                   "
		                + "            ,itemPadre                              "
		                + "            ,idEstadoTx                             "
		                + "            ,idTipoTx                               "
		                + "            ,fechaEntrega                           "
		                + "            ,idBodega                               "
		                + "            ,idSubcuenta                            "
		                + "            ,lecturaMedidor                         "
		                + "            ,idCliente                              "
		                + "            ,idEstracto                             "
		                + "            ,idRuta                                 "
		                + "            ,idNovedadLectura)                      "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL             "
		                + "       ,tbldctosordenesdetalle.IDTIPOORDEN          "
		                + "       ,tbldctosordenesdetalle.IDORDEN              "
		                + "       ,MAX(tmpAJU.idPlu) AS IDPLU                  "
		                + "       ,1 AS CANTIDAD                               "
		                + "       ,MAX(tmpAJU.idTipo) AS IDTIPO                "
		                + "       ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA  "
		                + "       , SUM(ROUND(tbldctosordenesdetalle.cantidad* "
		                + "  tbldctosordenesdetalle.VRVENTAUNITARIO/10,0)*10)- "
		                + "        SUM(tbldctosordenesdetalle.cantidad*        "
		                + "    tbldctosordenesdetalle.VRVENTAUNITARIO)         "
		                + " 	                        AS VRVENTAUNITARIO     "
		                + "       ,0 AS estado                                 "
		                + "       ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU          "
		                + "  ,SUM(ROUND(tbldctosordenesdetalle.cantidad*       "
		                + "  tbldctosordenesdetalle.VRVENTAUNITARIO/10,0)*10)  "
		                + " 	                         AS VRVENTAORIGINAL    "
		                + "       ,0 AS  VRCOSTO                               "
		                + "       ,0 AS  VRDSCTOPIE                            "
		                + "       ,0 AS  PORCENTAJEDSCTO                       "
		                + "       ,1 AS CANTIDADPEDIDA                         "
		                + "       ,0 AS STRIDLISTA                             "
		                + "       ,MAX(NOMBREUNIDADMEDIDA)                     "
		                + "       ,'' As comentario                            "
		                + "       ,MAX(tmpAJU.idPlu) AS item                   "
		                + "       ,MAX(itemPadre)                              "
		                + "       ,MAX(idEstadoTx)                             "
		                + "       ,MAX(idTipoTx)                               "
		                + "       ,MAX(fechaEntrega)                           "
		                + "       ,MAX(idBodega)                               "
		                + "       ,'' AS idSubcuenta                           "
		                + "       ,0 AS lecturaMedidor                         "
		                + "       ,MAX(tbldctos.idCliente)                     "
		                + "       ,MAX(idEstracto)                             "
		                + "       ,MAX(idRuta)                                 "
		                + "       ,0 AS idNovedadLectura                       "
		                + " FROM   tbldctos                                    "
		                + " INNER JOIN tbldctosordenesdetalle                  "
		                + " ON tbldctos.idLocal      =                         "
		                + "     tbldctosordenesdetalle.idLocal                 "
		                + " AND tbldctos.idTipoOrden =                         "
		                + "    tbldctosordenesdetalle.idTipoOrden              "
		                + " AND tbldctos.idOrden     =                         "
		                + "       tbldctosordenesdetalle.idOrden               "
		                + " INNER JOIN ( SELECT idLocal                        "
		                + "       ,idPlu                                       "
		                + "       ,nombrePlu                                   "
		                + "       ,porcentajeIva                               "
		                + "       ,idTipo                                      "
		                + "   FROM tblplus                                     "
		                + "   WHERE IDLOCAL   =                                "
		                + "?1                                     "
		                + "   AND idTipo      =                                "
		                + "?2 ) AS tmpAJU                              "
		                + " ON tmpAJU.idLocal                 =                "
		                + " tbldctos.idLocal                                   "
		                + " WHERE tbldctos.idLocal            =                "
		                + "?1                                     "
		                + " AND tbldctos.idTipoOrden          =                "
		                + "?3                                 "
		                + " AND tbldctos.idPeriodo            =                "
		                + "?4                                  "
		                + " AND tbldctos.idCliente            =               "
		                + "?5                                  "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal           "
		                + "       ,tbldctosordenesdetalle.idTipoOrden          "
		                + "       ,tbldctosordenesdetalle.idOrden   ",
		                nativeQuery = true)
			  public void ingresaTipoxCliente(int idLocal, int idTipo, int IdTipoOrden, int idperiodo, String idCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle                 "
		                + "            (IDLOCAL                                "
		                + "            ,IDTIPOORDEN                            "
		                + "            ,IDORDEN                                "
		                + "            ,IDPLU                                  "
		                + "            ,CANTIDAD                               "
		                + "            ,IDTIPO                                 "
		                + "            ,PORCENTAJEIVA                          "
		                + "            ,VRVENTAUNITARIO                        "
		                + "            ,ESTADO                                 "
		                + "            ,NOMBREPLU                              "
		                + "            ,VRVENTAORIGINAL                        "
		                + "            ,VRCOSTO                                "
		                + "            ,VRDSCTOPIE                             "
		                + "            ,PORCENTAJEDSCTO                        "
		                + "            ,CANTIDADPEDIDA                         "
		                + "            ,STRIDLISTA                             "
		                + "            ,NOMBREUNIDADMEDIDA                     "
		                + "            ,comentario                             "
		                + "            ,item                                   "
		                + "            ,itemPadre                              "
		                + "            ,idEstadoTx                             "
		                + "            ,idTipoTx                               "
		                + "            ,fechaEntrega                           "
		                + "            ,idBodega                               "
		                + "            ,idSubcuenta                            "
		                + "            ,lecturaMedidor                         "
		                + "            ,idCliente                              "
		                + "            ,idEstracto                             "
		                + "            ,idRuta                                 "
		                + "            ,idNovedadLectura)                      "
		                + " SELECT  tbldctosordenesdetalle.IDLOCAL             "
		                + "       ,tbldctosordenesdetalle.IDTIPOORDEN          "
		                + "       ,tbldctosordenesdetalle.IDORDEN              "
		                + "       ,MAX(tmpAJU.idPlu) AS IDPLU                  "
		                + "       ,1 AS CANTIDAD                               "
		                + "       ,MAX(tmpAJU.idTipo) AS IDTIPO                "
		                + "       ,MAX(tmpAJU.porcentajeIva) AS PORCENTAJEIVA, "
		                + " ROUND((ROUND(SUM(tbldctosordenesdetalle.cantidad * "
		                + " tbldctosordenesdetalle.VRVENTAUNITARIO)/100,0)*100)"
		                + "  - SUM(tbldctosordenesdetalle.cantidad *           "
		                + "  tbldctosordenesdetalle.VRVENTAUNITARIO),2)	       "
		                + " 	                        AS VRVENTAUNITARIO     "
		                + "       ,0 AS estado                                 "
		                + "       ,MAX(tmpAJU.nombrePlu) AS NOMBREPLU          "
		                + "  ,SUM(ROUND(tbldctosordenesdetalle.cantidad*       "
		                + " tbldctosordenesdetalle.VRVENTAUNITARIO/100,0)*100) "
		                + " 	                         AS VRVENTAORIGINAL    "
		                + "       ,0 AS  VRCOSTO                               "
		                + "       ,0 AS  VRDSCTOPIE                            "
		                + "       ,0 AS  PORCENTAJEDSCTO                       "
		                + "       ,1 AS CANTIDADPEDIDA                         "
		                + "       ,0 AS STRIDLISTA                             "
		                + "       ,MAX(NOMBREUNIDADMEDIDA)                     "
		                + "       ,MAX(comentario)                             "
		                + "    ,MAX(tbldctosordenesdetalle.item)+ 1 AS item   "
		                + "       ,MAX(itemPadre)                              "
		                + "       ,MAX(idEstadoTx)                             "
		                + "       ,MAX(idTipoTx)                               "
		                + "       ,MAX(fechaEntrega)                           "
		                + "       ,MAX(idBodega)                               "
		                + "       ,'' AS idSubcuenta                           "
		                + "       ,0 AS lecturaMedidor                         "
		                + "       ,MAX(tbldctos.idCliente)                     "
		                + "       ,MAX(idEstracto)                             "
		                + "       ,MAX(idRuta)                                 "
		                + "       ,0 AS idNovedadLectura                       "
		                + " FROM   tbldctos                                    "
		                + " INNER JOIN tbldctosordenesdetalle                  "
		                + " ON tbldctos.idLocal      =                         "
		                + "     tbldctosordenesdetalle.idLocal                 "
		                + " AND tbldctos.idTipoOrden =                         "
		                + "    tbldctosordenesdetalle.idTipoOrden              "
		                + " AND tbldctos.idOrden     =                         "
		                + "       tbldctosordenesdetalle.idOrden               "
		                + " INNER JOIN tblLocales                              "
		                + " ON tblLocales.idLocal    =  tbldctos.idLocal       "
		                + " INNER JOIN ( SELECT idLocal                        "
		                + "       ,idPlu                                       "
		                + "       ,nombrePlu                                   "
		                + "       ,porcentajeIva                               "
		                + "       ,idTipo                                      "
		                + "   FROM tblplus                                     "
		                + "   WHERE IDLOCAL   =                                "
		                + "?1                                     "
		                + "   AND idTipo      =                                "
		                + "?2 ) AS tmpAJU                              "
		                + " ON tmpAJU.idLocal                 =                "
		                + " tbldctos.idLocal                                   "
		                + " WHERE tbldctos.idLocal            =                "
		                + "?1                                     "
		                + " AND tbldctos.idTipoOrden          =                "
		                + "?3                                 "
		                + " AND tbldctos.idPeriodo            =                "
		                + "?4                                   "
		                + " AND tbldctos.idCliente            =                "
		                + "?5                                  "
		                + " AND tblLocales.estadoAjusteCentena NOT IN (2)      "
		                + " GROUP BY  tbldctosordenesdetalle.idLocal           "
		                + "       ,tbldctosordenesdetalle.idTipoOrden          "
		                + "       ,tbldctosordenesdetalle.idOrden   ",
		                nativeQuery = true)
			  public void ingresaTipoCentenaxCliente(int idLocal, int idTipo, int IdTipoOrden, int idperiodo, String idCliente);
			  
			  
			  @Query(value = "SELECT tbldctosordenesdetalle.idPlu,				          "
		                + "       tbldctosordenesdetalle.nombrePlu,			          "
		                + "       tbldctosordenesdetalle.idTipo,            		      "
		                + "       tbldctosordenesdetalle.item,			        	  "
		                + "       tbldctosordenesdetalle.itemPadre,			          "
		                + "       tbldctosordenesdetalle.cantidad,			          "
		                + "       tbldctosordenesdetalle.vrCosto,		   		          "
		                + "       tbldctosordenesdetalle.vrVentaUnitario,	    		  "
		                + "       tbldctosordenesdetalle.vrVentaOriginal,			      "
		                + "       tbldctosordenesdetalle.porcentajeDscto,		    	  "
		                + "       tbldctosordenesdetalle.porcentajeIva,			      "
		                + "       (tbldctosordenesdetalle.cantidad          *		      "
		                + "       (tbldctosordenesdetalle.vrVentaUnitario)    /		      "
		                + "    ( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ) )) "
		                + "                                           AS vrVentaSinIva, "
		                + "           (tbldctosordenesdetalle.cantidad      * 		  "
		                + "                   tbldctosordenesdetalle.vrVentaUnitario )  "
		                + "                                          AS vrVentaConIva,  "
		                + "      ((tbldctosordenesdetalle.cantidad          *		      "
		                + "       (tbldctosordenesdetalle.vrVentaUnitario)    /		      "
		                + "  (( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ))) * "
		                + "      ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) ) * "
		                + "  ( 1 - ( tbldctosordenesdetalle.porcentajeDscto /  100 )))) "
		                + "                                        AS vrVentaSinDscto,  "
		                + "       (tbldctosordenesdetalle.cantidad          *		      "
		                + "       (tbldctosordenesdetalle.vrVentaUnitario)    *		      "
		                + "   ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) )   *  "
		                + "   ( 1 - ( tbldctosordenesdetalle.porcentajeDscto /100))) -  "
		                + "   (tbldctosordenesdetalle.cantidad          *		          "
		                + "   (tbldctosordenesdetalle.vrVentaUnitario)    *		          "
		                + "    ( 1 - ( tbldctosordenesdetalle.vrDsctoPie /  100 ) ) *   "
		                + "    ( 1 -(tbldctosordenesdetalle.porcentajeDscto/ 100 )) /   "
		                + "    ( 1 + ( tbldctosordenesdetalle.porcentajeIva /  100 ) )) "
		                + "                                              AS vrIvaVenta, "
		                + "        tbldctosordenesdetalle.comentario,			          "
		                + "        tbldctosordenesdetalle.idEstadoTx,			          "
		                + "        tbldctosordenesdetalle.nombreUnidadMedida,		      "
		                + "        tmpPlu.vrCosto AS vrCostoActual,			          "
		                + "        (tbldctosordenesdetalle.cantidad *			          "
		                + "        tbldctosordenesdetalle.vrCosto ) 		        	  "
		                + "                                     AS vrCostoConIva,		  "
		                + "        tmpPlu.existencia,				                 	  "
		                + "        tmpPlu.nombreCategoria,				              "
		                + "        tmpPlu.nombreMarca,					              "
		                + "        tmpPlu.nombreLinea,  			                      "
		                + "        tmpPlu.factorDespacho                                           "
		                + "FROM   tbldctosordenesdetalle ,				              "
		                + "       (SELECT  tblplusinventario.idLocal,			          "
		                + "                tblplusinventario.idPlu,			          "
		                + "                tblplusinventario.existencia,			      "
		                + "                tblcategorias.nombreCategoria,			      "
		                + "                tblmarcas.nombreMarca,				          "
		                + "                tbllineas.nombreLinea,				          "
		                + "                tblplus.vrCosto,"
		                + "                tblplus.factorDespacho				              "
		                + "        FROM    tblplus					                  "
		                + "        INNER JOIN tblmarcas					              "
		                + "        ON tblplus.idMarca       =                           "
		                + "                   tblmarcas.idMarca				          "
		                + "        INNER JOIN tblcategorias				              "
		                + "        ON tblplus.idLinea       =				              "
		                + "               tblcategorias.idLinea				          "
		                + "       AND tblplus.idLocal       =				              "
		                + "               tblcategorias.idLocal				          "
		                + "        AND tblplus.idCategoria  =				              "
		                + "           tblcategorias.IdCategoria				          "
		                + "        INNER JOIN tbllineas					              "
		                + "        ON tblcategorias.idLinea =				              "
		                + "                   tbllineas.idLinea				          "
		                + "        AND tblcategorias.idLocal =				              "
		                + "                   tbllineas.idLocal				          "
		                + "        INNER JOIN tblplusinventario				          "
		                + "        ON tblplus.idPlu         =				              "
		                + "                     tblplusinventario.idPlu                 "
		                + "        AND tblplus.idLocal         =				              "
		                + "                     tblplusinventario.idLocal                 "
		                + "        WHERE tblplusinventario.idLocal =                    "
		                + "?1                                              "
		                + "        AND   tblplusinventario.idBodega=                    "
		                + "?2 ) AS tmpPlu			                      "
		                + "WHERE EXISTS ( SELECT tbldctosordenes.*			          "
		                + "               FROM tbldctosordenes				          "
		                + "               WHERE tbldctosordenes.idLocal     =		      "
		                + "                       tbldctosordenesdetalle.idLocal		  "
		                + "               AND   tbldctosordenes.idTipoOrden =           "
		                + "                   tbldctosordenesdetalle.idTipoOrden        "
		                + "               AND   tbldctosordenes.idOrden     =           "
		                + "                       tbldctosordenesdetalle.idOrden        "
		                + "               AND   tbldctosordenes.idLocal     =           "
		                + "?1                                              "
		                + "               AND   tbldctosordenes.idTipoOrden =           "
		                + "?3                                          "
		                + "               AND   tbldctosordenes.idLog       =           "
		                + "?4   )                                           "
		                + "AND  tmpPlu.idPlu    = tbldctosordenesdetalle.idPlu          "
		                + "AND  tmpPlu.idLocal  = tbldctosordenesdetalle.idLocal        "
		                + "ORDER BY tbldctosordenesdetalle.itemPadre,                   "
		                + "         tbldctosordenesdetalle.item                         ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> listaOrden(int idLocal, int IdBodega, int IdTipoOrden, int IdLog);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle               "
		                + "SET tbldctosordenesdetalle.IDTIPOORDEN    = "
		                + "?1                         ,"
		                + "    tbldctosordenesdetalle.IDORDEN        = "
		                + "?2                              "
		                + "WHERE tbldctosordenesdetalle.IDLOCAL      = "
		                + "?3                             "
		                + "AND   tbldctosordenesdetalle.IDTIPOORDEN  = "
		                + "?4                         "
		                + "AND   tbldctosordenesdetalle.IDORDEN      = "
		                + "?5                             ",
		                nativeQuery = true)
			  public void actualiza(int xIdTipoOrdenNew, int xIdOrdenNew, int idLocal, int IdTipoOrden, int IdOrden);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle               "
		                + " SET item = tmpITM.rowId                   "
		                + " FROM tbldctosordenesdetalle               "
		                + " INNER JOIN (                              "
		                + " SELECT idLocal,                           "
		                + "        idTipoOrden,                       "
		                + " 	   idOrden, item,                     "
		                + " 	   row_number()                       "
		                + "        OVER (ORDER BY item ASC)           "
		                + " 	                 AS 'rowId'           "
		                + " FROM tbldctosordenesdetalle               "
		                + " WHERE tbldctosordenesdetalle.IDLOCAL   =  "
		                + "?1                            "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =  "
		                + "?2                       "
		                + " AND tbldctosordenesdetalle.idOrden     =  "
		                + "?3  ) AS tmpITM               "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =  "
		                + "                      tmpITM.IDLOCAL       "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =  "
		                + "                       tmpITM.IDTIPOORDEN  "
		                + " AND tbldctosordenesdetalle.IDORDEN     =  "
		                + "                           tmpITM.IDORDEN  "
		                + " AND tbldctosordenesdetalle.ITEM        =  "
		                + "                              tmpITM.ITEM  "
		                + " WHERE tbldctosordenesdetalle.IDLOCAL   =  "
		                + "?1                            "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =  "
		                + "?2                        "
		                + " AND tbldctosordenesdetalle.idOrden     = ?3 ",
		                nativeQuery = true)
			  public void actualizaCuotaNumero(int idLocal, int IdTipoOrden, int IdOrden);
			  
			  
			  
			  @Query(value = "SELECT   tbldctosordenesdetalle.idPlu,                     "
		                + "          tbldctosordenesdetalle.item,                     "
		                + "          tbldctosordenesdetalle.itemPadre,                "
		                + "         MIN(tbldctosordenesdetalle.comentario) AS nombrePlu ,   "
		                + "         MIN(tbldctosordenesdetalle.cantidad) AS cantidad, "
		                + "         MIN( tbldctosordenesdetalle.vrVentaUnitario)      "
		                + "                                       AS vrVentaUnitario, "
		                + "         MIN( tbldctosordenesdetalle.vrVentaOriginal)      "
		                + "                                      AS vrVentaOriginal,  "
		                + "         MIN  ( tbldctosordenesdetalle.porcentajeDscto)    "
		                + "                                      AS porcentajeDscto,  "
		                + "         SUM (tbldctosordenesdetalle.cantidad         *    "
		                + "               tbldctosordenesdetalle.vrVentaUnitario )    "
		                + "                                       AS vrVentaConIva,   "
		                + "         SUM((tbldctosordenesdetalle.cantidad        *     "
		                + "               tbldctosordenesdetalle.vrVentaUnitario) /   "
		                + "   ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100)))   "
		                + "                                       AS vrVentaSinIva,   "
		                + "         MIN(tbldctosordenesdetalle.porcentajeIva)         "
		                + "                                      AS porcentajeIva,    "
		                + "        MAX(tblcategorias.nombreCategoria)                 "
		                + "                                       AS nombreCategoria, "
		                + "        MAX(tblmarcas.nombreMarca) AS nombreMarca,         "
		                + "         MIN( tbldctosordenesdetalle.vrCosto)              "
		                + "                                       AS vrCosto,         "
		                + "                   SUM(tbldctosordenesdetalle.vrCosto *    "
		                + "                       tbldctosordenesdetalle.cantidad)    "
		                + "                                      AS vrCostoConIva,    "
		                + "                SUM( (tbldctosordenesdetalle.cantidad *    "
		                + "                      tbldctosordenesdetalle.vrCosto ) /   "
		                + "      (1 + (tbldctosordenesdetalle.porcentajeIva/100)))    "
		                + "                                      AS vrCostoSinIva,    "
		                + "           SUM(((tbldctosordenesdetalle.cantidad       *   "
		                + "              tbldctosordenesdetalle.vrVentaUnitario)  /   "
		                + " ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) *   "
		                + " ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100))     *   "
		                + " ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100)))   "
		                + "                                     AS vrVentaSinDscto,   "
		                + "   SUM(((tbldctosordenesdetalle.cantidad        *          "
		                + "       tbldctosordenesdetalle.vrVentaUnitario) /           "
		                + " ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) *   "
		                + " ( 1 - ( tbldctosordenesdetalle.vrDsctoPie / 100))     *   "
		                + " ( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100))*   "
		                + "        ( tbldctosordenesdetalle.porcentajeIva / 100 ))    "
		                + "                                      AS vrIvaVenta "
		                + "FROM   tblcategorias                                       "
		                + "INNER JOIN tblplus                                         "
		                + "INNER JOIN tblmarcas                                       "
		                + "ON tblplus.idMarca              = tblmarcas.idMarca        "
		                + "ON tblcategorias.idLinea        = tblplus.idLinea          "
		                + "AND tblcategorias.IdCategoria   = tblplus.idCategoria      "
		                + "INNER JOIN tbldctosordenes                                 "
		                + "INNER JOIN tbldctosordenesdetalle                          "
		                + "ON tbldctosordenes.IDLOCAL =                               "
		                + "                           tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN =                          "
		                + "                      tbldctosordenesdetalle.IDTIPOORDEN   "
		                + "AND tbldctosordenes.IDORDEN  =                             "
		                + "                           tbldctosordenesdetalle.IDORDEN  "
		                + "ON tblplus.idPlu  =  tbldctosordenesdetalle.IDPLU          "
		                + "AND tblplus.idLocal   = tbldctosordenesdetalle.IDLocal     "
		                + "AND   tbldctosordenes.idLocal     =                        "
		                + "?1                                            "
		                + "AND   tbldctosordenes.IDTIPOORDEN =                        "
		                + "?2                                        "
		                + "AND   tbldctosordenes.idOrden     =                        "
		                + "?3                                            "
		                + "GROUP BY tbldctosordenesdetalle.item,                      "
		                + "         tbldctosordenesdetalle.itemPadre,                 "
		                + "         tbldctosordenesdetalle.idPlu                  ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO2> detallaFinanciacion(int idLocal, int IdTipoOrden, int IdOrden);
			  
			  
			  
			  
			  @Query(value = " SELECT COUNT(tbldctosordenesdetalle.IDPLU)       "
		                + "                        AS cantidadArticulos,    "
		                + "      SUM(tbldctosordenesdetalle.cantidad     *  "
		                + "      tbldctosordenesdetalle.vrVentaUnitario )   "
		                + "                              AS vrVentaConIva,  "
		                + "       SUM(tbldctosordenesdetalle.cantidad    *  "
		                + "      tbldctosordenesdetalle.vrVentaUnitario /   "
		                + "   (1 +                                          "
		                + "   (tbldctosordenesdetalle.porcentajeIva/100)))  "
		                + "                              AS vrVentaSinIva,  "
		                + "   SUM(tbldctosordenesdetalle.cantidad        *  "
		                + "   tbldctosordenesdetalle.vrVentaUnitario)   -   "
		                + "    SUM(tbldctosordenesdetalle.cantidad       *  "
		                + "    tbldctosordenesdetalle.vrVentaUnitario    /  "
		                + "           (1 +                                  "
		                + "   (tbldctosordenesdetalle.porcentajeIva/100)))  "
		                + "                                   AS vrIva,     "
		                + "       MAX(tbldctosordenes.fechaOrden)           "
		                + "                        AS fechaOrden,           "
		                + "       MAX(tbldctosordenes.idOrden)              "
		                + "                            AS idOrden,          "
		                + "       MAX(tbldctosordenes.idLocal)              "
		                + "                            AS idLocal,          "
		                + "       MAX(tbldctosordenes.idTipoOrden)          "
		                + "                        AS idTipoOrden,          "
		                + "       MAX(tbldctosordenes.idOrden) AS idDcto,   "
		                + "       MAX(tbldctosordenes.fechaOrden)           "
		                + "                         AS fechaDcto,           "
		                + "       MAX(tbldctosordenes.idOrden)              "
		                + "                      AS idDctoNitCC,            "
		                + "       MAX(tblterceros.nombreTercero)            "
		                + "                    AS nombreTercero,            "
		                + "  MAX(tbldctosordenes.porcentajeInteresADiferir) "
		                + "                   AS porcentajeInteresADiferir, "
		                + "	  MAX(tbldctosordenes.vrInteresADiferir)    "
		                + "                           AS vrInteresADiferir  "
		                + " FROM tbldctosordenes                            "
		                + " INNER JOIN tbldctosordenesdetalle               "
		                + " ON tbldctosordenes.IDORDEN        =             "
		                + "       tbldctosordenesdetalle.idOrden            "
		                + " AND   tbldctosordenes.IDTIPOORDEN =             "
		                + "    tbldctosordenesdetalle.idTipoOrden           "
		                + " AND   tbldctosordenes.idLocal     =             "
		                + "        tbldctosordenesdetalle.idLocal           "
		                + " INNER JOIN tblterceros                          "
		                + " ON tbldctosordenes.idLocal       =              "
		                + "               tblterceros.idLocal               "
		                + " AND   tbldctosordenes.idCliente   =             "
		                + "                tblterceros.idCliente            "
		                + " WHERE tbldctosordenes.IDlocal     =             "
		                + "?1                                 "
		                + " AND   tbldctosordenes.IDTIPOORDEN =             "
		                + "?2                              "
		                + " AND   tbldctosordenes.idOrden     =             "
		                + "?3                                 "
		                + " AND tblterceros.idTipoTercero  = 1  ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO> liquidaUnCotizacion(int idLocal, int IdTipoOrden, int IdOrden);
	  
			  
			  
			  
			  @Query(value = " SELECT tbldctosordenes.IDLOCAL           "          
					  + "   ,tbldctosordenes.IDTIPOORDEN         "  
					  + "   ,tbldctosordenes.IDORDEN             " 
					  + "    ,tmpFIN.comentario                  "
					  + "   ,MAX(tbldctosordenes.idCliente)      "  
					  + "              AS idCliente              "
					  + "  ,MAX(tblterceros.nombreTercero)       "
					  + "                AS nombreTercero        "
					  + "   ,MAX(tbldctosordenes.FECHAORDEN)     "   
					  + "              AS fechaOrden             "
					  + "  ,MAX(tbldctosordenes.observacion)     "
					  + "                 AS observacion         "
					  + "  ,MAX(tbldctosordenes.idPeriodo)       " 
					  + "             AS idPeriodo               "
					  + "  ,MAX(tbldctosordenes.vrTotalDiferir)  "
					  + "  	                   AS vrCredito    "
					  + "  ,MAX(tbldctosordenes.cuotaDiferir)    "
					  + "                    AS cantidad         "
					  + "  ,SUM( tmpFIN.vrVentaUnitario *        "
					  + "    tmpFIN.cuotaFacturada )             "
					  + "                    AS vrFacturado      "
					  + "  ,SUM(tmpFIN.cuotaFacturada)           "
					  + "                 AS cuotaFacturada      "
					  + "  ,MAX(tbldctosordenes.vrTotalDiferir)- " 
					  + "  	   SUM( tmpFIN.vrVentaUnitario *   "
					  + "  	   tmpFIN.cuotaFacturada ) AS 	   "
					  + "  		      vrCreditoPendiente   "
					  + ",MAX(tblDctos.idDcto) AS  idDcto       "
					  + " FROM tbldctosordenes                   "
					  + "INNER JOIN tblDctos                     "
					  + "ON tblDctos.IDLOCAL = tbldctosordenes.IDLOCAL "
					  + "AND tblDctos.idTipoOrden = tbldctosordenes.idTipoOrden "
					  + "AND tblDctos.idOrden = tbldctosordenes.idOrden "
					  
					  + " INNER JOIN (                           "
					  + "  SELECT IDLOCAL                        "
					  + "      ,IDTIPOORDEN                      "
					  + "      ,comentario                       "
					  + "      ,IDORDEN                          "
					  + "      ,SUM(VRVENTAUNITARIO)             "
					  + "                AS vrVentaUnitario,     "
					  + "       CASE                             "
					  + "       WHEN itemPadre > 1 THEN 1        "
					  + "       ELSE  0                          "
					  + "       END AS cuotaFacturada            "
					  + "  FROM  tbldctosordenesdetalle          "
					  + "  WHERE IDLOCAL       =                 "
					  + "?1                         "
					  + "    AND   IDTIPOORDEN   =               "
					  + "?2                     "
					  + "   AND   IDTIPO   =  8                  "
					  + "   GROUP BY IDLOCAL                     "
					  + "      ,IDTIPOORDEN                      "
					  + "       ,comentario                      "
					  + "      ,IDORDEN                          "
					  + "    ,itemPadre ) AS tmpFIN              "
					  + "  ON tmpFIN.idLocal       =             "
					  + "              tbldctosordenes.idLocal   "
					  + "  AND tmpFIN.idTipoOrden  =             "
					  + "          tbldctosordenes.idTipoOrden   "
					  + "  AND tmpFIN.idOrden      =             "
					  + "              tbldctosordenes.idOrden   "
					  + "  INNER JOIN tblterceros                "
					  + "  ON tblterceros.idLocal  =             "
					  + "              tbldctosordenes.idLocal   "
					  + "  AND tblterceros.idCliente  =          "
					  + "           tbldctosordenes.idCliente    "
					  + "  WHERE tbldctosordenes.idLocal  =      " 
					  + "?1                        "   
					  + " AND   tbldctosordenes.IDTIPOORDEN =    "
					  + "?2                     "
					  + "  AND tbldctosordenes.cuotaDiferir > 0  "           
					  + "  AND tblterceros.idTipoTercero = 1     "
					  + "AND   tbldctosordenes.idCliente      = "
					  + "?3                     "                             
					  + "  GROUP BY tbldctosordenes.IDLOCAL      "     
					  + "      ,tbldctosordenes.IDTIPOORDEN      " 
					  + "       ,tmpFIN.comentario               "
					  + "      ,tbldctosordenes.IDORDEN          "                
					  + "  HAVING                                "
					  + "  (MAX(tbldctosordenes.vrTotalDiferir)- "
					  + "    SUM(tmpFIN.vrVentaUnitario *        "
					  + "        tmpFIN.cuotaFacturada)) != 0 ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO2> listaFinanciacion(int idLocal, int IdTipoOrden, String idCliente);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle        "
		                + " FROM tbldctosordenes                     "
		                + " INNER JOIN tbldctosordenesdetalle        "
		                + " ON tbldctosordenes.IDLOCAL =             "
		                + "           tbldctosordenesdetalle.IDLOCAL "
		                + " AND tbldctosordenes.IDTIPOORDEN =        "
		                + "       tbldctosordenesdetalle.IDTIPOORDEN "
		                + " AND tbldctosordenes.IDORDEN =            "
		                + "           tbldctosordenesdetalle.IDORDEN "
		                + " WHERE tbldctosordenesdetalle.IDLOCAL   = "
		                + "?1                           "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN = "
		                + "?2                       "
		                + " AND tbldctosordenesdetalle.itemPadre   = "
		                + "?3                         "
		                + " AND tbldctosordenes.IDORDEN            = ?4 ",
		                nativeQuery = true)
			  public void retiraItemNoFacturado(int idLocal, int idTipoOrden, int itemPadre, int IDORDEN);
			  
			  
			  
			  @Query(value = "SELECT DISTINCT IDPLU " +
		                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " 
		                 , nativeQuery = true)
			  Integer ObtenerIdPlu(int idLocal, int idOrden);
			  
			  
			  @Query(value = "SELECT DISTINCT comentario " +
		                 "FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 " 
		                 , nativeQuery = true)
			  String ObtenerComentario(int idLocal, int idOrden);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM bdaquamovil.dbo.tblDctosOrdenesDetalle " +
			                 "WHERE tblDctosOrdenesDetalle.IDLOCAL = ?1 " +
			                 "AND tblDctosOrdenesDetalle.IDORDEN = ?2 ",
			                 nativeQuery = true)
			  public void eliminaridOrden(int idLocal, int IDORDEN);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "DELETE FROM tbldctosordenesdetalle        "
		                + "FROM   tbldctosordenes                    "
		                + "INNER JOIN tbldctosordenesdetalle         "
		                + "ON  tbldctosordenes.IDLOCAL     =         "
		                + "          tbldctosordenesdetalle.IDLOCAL  "
		                + "AND tbldctosordenes.IDTIPOORDEN =         "
		                + "     tbldctosordenesdetalle.IDTIPOORDEN   "
		                + "AND tbldctosordenes.IDORDEN     =         "
		                + "         tbldctosordenesdetalle.IDORDEN   "
		                + "WHERE  tbldctosordenesdetalle.item   =    "
		                + "?1                              "
		                + "AND  tbldctosordenesdetalle.idLocal  =    "
		                + "?2                          "
		                + "AND    tbldctosordenes.idLog         =  ?3  ",
			                 nativeQuery = true)
			  public void retiraItem(int item, int idLocal, int idLog);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = "UPDATE tbldctosordenesdetalle                "
		                + "SET tbldctosordenesdetalle.vrVentaUnitario = "
		                + "?1                      "
		                + "WHERE  tbldctosordenesdetalle.idLocal =      "
		                + "?2                              "
		                + "AND tbldctosordenesdetalle.idTipoOrden =     "
		                + "?3                          "
		                + "AND tbldctosordenesdetalle.idOrden     =     "
		                + "?4                              "
		                + "AND tbldctosordenesdetalle.item        =  ?5   ",
			                 nativeQuery = true)
			  public void modificaItemNoFacturado(Double VrVentaUnitario, int idLocal, int IdTipoOrden, int IdOrden, int Item);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle   "
		                + " (IDLOCAL                             "
		                + " ,IDTIPOORDEN                         "
		                + " ,IDORDEN                             "
		                + " ,IDPLU                               "
		                + " ,CANTIDAD                            "
		                + " ,IDTIPO                              "
		                + " ,PORCENTAJEIVA                       "
		                + " ,VRVENTAUNITARIO                     "
		                + " ,ESTADO                              "
		                + " ,NOMBREPLU                           "
		                + " ,VRVENTAORIGINAL                     "
		                + " ,VRCOSTO                             "
		                + " ,VRDSCTOPIE                          "
		                + " ,PORCENTAJEDSCTO                     "
		                + " ,CANTIDADPEDIDA                      "
		                + " ,STRIDLISTA                          "
		                + " ,NOMBREUNIDADMEDIDA                  "
		                + " ,comentario                          "
		                + " ,item                                "
		                + " ,itemPadre                           "
		                + " ,idEstadoTx                          "
		                + " ,idTipoTx                            "
		                + " ,fechaEntrega                        "
		                + " ,idBodega                            "
		                + " ,idSubcuenta                         "
		                + " ,lecturaMedidor                      "
		                + " ,idCliente                           "
		                + " ,idEstracto                          "
		                + " ,idRuta                              "
		                + " ,idNovedadLectura)                   "
		                + " SELECT  tblplus.idLocal,             "
		                + "?1 AS idTipoOrden,   "
		                + "?2 AS idOrden,		 "
		                + " tblplus.idPlu,                       "
		                + "?3 AS cantidad,	 "                
		                + " tblplus.idTipo,                      "
		                + " tblplus.porcentajeIva,               "
		                + " tblplus.vrGeneral                    "
		                + "                  AS VRVENTAUNITARIO, "
		                + "  0 AS estado,			 "
		                + " tblplus.nombrePlu,                   "
		                + " tblplus.vrGeneral                    "
		                + "                  AS VRVENTAORIGINAL, "
		                + " tblplus.vrCosto                      "
		                + " ,00 as VRDSCTOPIE                    "
		                + " ,00 as PORCENTAJEDSCTO               "
		                + " ,00 as CANTIDADPEDIDA                "
		                + " ,1 AS STRIDLISTA                     "
		                + " ,'M3' AS  NOMBREUNIDADMEDIDA         "
		                + " ,'' AS comentario                    "
		                + " ,1 AS item                           "
		                + " ,1 AS itemPadre                      "
		                + " ,0 AS idEstadoTx                     "
		                + " ,0 AS idTipoTx                       "
		                + " ,GETDATE() AS fechaEntrega           "
		                + " ,1 AS idBodega                       "
		                + " ,'' AS idSubcuenta,                  "
		                + "?4 AS lecturaMedidor "                   
		                + " ,tblterceros.idCliente               "
		                + " ,tblplus.idEstracto                  "
		                + " ,tblterceros.idRuta,                 "
		                + "?5 AS idNovedadLectura "                     
		                + " FROM tblplus                         "
		                + " INNER JOIN tblmarcas                 "
		                + " ON tblplus.idMarca      =            "
		                + "         tblmarcas.idMarca            "
		                + " INNER JOIN tblcategorias             "
		                + " ON tblplus.idLinea      =            "
		                + "     tblcategorias.idLinea            "
		                + " AND tblplus.idLocal      =           "
		                + "      tblcategorias.idLocal           "
		                + " AND tblplus.idCategoria =            "
		                + "   tblcategorias.IdCategoria          "
		                + " INNER JOIN  tblterceros              "
		                + " ON tblterceros.idLocal  =            "
		                + "            tblplus.idLocal           "
		                + " AND tblterceros.idEstracto           "
		                + "       = tblplus.idEstracto           "
		                + " WHERE tblplus.idTipo    =            "
		                + "?6                        "
		                + " AND tblplus.idLocal     =            "
		                + "?7                       "
		                + " AND tblplus.idCategoria = 1          "
		                + " AND tblterceros.estado NOT IN (2)    "
		                + " AND tblterceros.idCliente =          "   
		                + "?8                    "                   
		                + " AND NOT EXISTS ( SELECT *            "
		                + " FROM tbldctosordenesdetalle          "
		                + " INNER JOIN  tblplus                  "
		                + " ON tblplus.idLocal =                 "
		                + "       tbldctosordenesdetalle.idLocal "
		                + " AND tblplus.idPlu =                  "
		                + "        tbldctosordenesdetalle.idPlu  "
		                + " INNER JOIN tblterceros tmpTER        "
		                + " ON tmpTER.idLocal =                  "
		                + "       tbldctosordenesdetalle.idLocal "
		                + " AND tmpTER.idCliente =               "
		                + "    tbldctosordenesdetalle.idCliente  "
		                + " WHERE tblplus.idTipo    =            "
		                + "?6                       "
		                + " AND tblplus.idLocal     =            "
		                + "?7                       "
		                + " AND tblplus.idCategoria = 1          "
		                + " AND                                  "
		                + " tbldctosordenesdetalle.idTipoOrden = "
		                + "?1                   "
		                + " AND                                  "
		                + " tbldctosordenesdetalle.idOrden     = "
		                + "?2                       "             
		                + "AND tmpTER.idCliente                = "
		                + " tblterceros.idCliente)",
			                 nativeQuery = true)
			  public void ingresaCreaLecturaConsumoUnCliente(int IdTipoOrden, int IdOrden, Double Cantidad, Double LecturaMedidor, int IdNovedadLectura, int IdTipo, int IdLocal, String IdCliente);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle           "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "            ,idEstracto                     "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT tbldctosordenesdetalle.IDLOCAL      "
		                + "       ,tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "       ,tbldctosordenesdetalle.IDORDEN      "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       , ( CANTIDAD - rangoMaximo )         "
		                + " 	                    AS cantidad        "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	            AS vrVentaUnitario         "
		                + "       ,tbldctosordenesdetalle.ESTADO       "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	          AS VRVENTAORIGINAL           "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,3 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,tbldctosordenesdetalle.comentario   "
		                + "       ,tmpRNG3.IDPLU AS item               "
		                + "       ,itemPadre                           "
		                + "       ,tbldctosordenesdetalle.idEstadoTx   "
		                + "       ,tbldctosordenesdetalle.idTipoTx     "
		                + "       ,tbldctosordenesdetalle.fechaEntrega "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,tbldctosordenesdetalle.idCliente    "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "    ( SELECT tblplus.idLocal,               "
		                + "            tblplus.idEstracto,             "
		                + "      SUM(tblplus.rangoMaximo)              "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1,4)           "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto ) AS tmpR14   "
		                + " ON tbldctosordenesdetalle.idLocal =        "
		                + "                        tmpR14.idLocal      "
		                + " AND tbldctosordenesdetalle.idEstracto =    "
		                + "                        tmpR14.idEstracto   "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "      tblplus.idPlu,                        "
		                + "  tblcategorias.nombreCategoria + ' ' +     "
		                + "    tblplus.nombrePlu AS nombrePlu,         "
		                + "    tblplus.vrGeneral,                      "
		                + "    tblplus.idTipo,                         "
		                + "    tblplus.idEstracto                      "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (5))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + " INNER JOIN  tbldctosordenes                "
		                + " ON 	tbldctosordenes.IDLOCAL =	       "
		                + "            tbldctosordenesdetalle.idLocal  "
		                + " AND	tbldctosordenes.IDTIPOORDEN =	       "
		                + "        tbldctosordenesdetalle.IDTIPOORDEN  "
		                + " AND	tbldctosordenes.IDORDEN =	       "
		                + "            tbldctosordenesdetalle.IDORDEN  "
		                + " WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =4  "
		                + " AND tbldctosordenesdetalle.idCliente    = "
		                + "?2                         "
		                + " AND tbldctosordenes.idPeriodo =            "
		                + "?3                           "
		                + "   AND tbldctosordenesdetalle.CANTIDAD    > "
		                + "                     tmpR14.rangoMaximo ",
			                 nativeQuery = true)
			  public void ingresaSuntuarioCliente( int IdLocal, String IdCliente, int idPeriodo);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle              "
		                + " SET CANTIDAD =                             "
		                + "  ( CANTIDAD - cantidadSuntuario )          "
		                + " FROM tbldctosordenesdetalle                "
		                + " INNER JOIN                                 "
		                + "   (SELECT                                  "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,      "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,  "
		                + "     tbldctosordenesdetalle_1.IDORDEN,      "
		                + "     tbldctosordenesdetalle_1.IDPLU,        "
		                + " 	( tbldctosordenesdetalle_1.CANTIDAD -  "
		                + " 		     tmpR14.rangoMaximo )      "
		                + " 		      AS cantidadSuntuario,    "
		                + "      tbldctosordenesdetalle_1.idCliente    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "       AS tbldctosordenesdetalle_1          "
		                + "   INNER JOIN                               "
		                + "    ( SELECT tblplus.idLocal,               "
		                + "            tblplus.idEstracto,             "
		                + "      SUM(tblplus.rangoMaximo)              "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                            "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1,4)           "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto ) AS tmpR14    "
		                + " ON tbldctosordenesdetalle_1.idLocal =      "
		                + "                        tmpR14.idLocal      "
		                + " AND tbldctosordenesdetalle_1.idEstracto =  "
		                + "                        tmpR14.idEstracto   "
		                + "  AND tbldctosordenesdetalle_1.CANTIDAD >   "
		                + "                        tmpR14.rangoMaximo  "
		                + " WHERE tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                            "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59"
		                + " AND tbldctosordenesdetalle_1.idCliente  = "
		                + "?2                         "
		                + " AND tbldctosordenesdetalle_1.IDTIPO     =4 "
		                + "                         ) AS tmpCAN        "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =   "
		                + "                           tmpCAN.IDLOCAL   "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                       tmpCAN.IDTIPOORDEN   "
		                + " AND tbldctosordenesdetalle.IDORDEN     =   "
		                + "                           tmpCAN.IDORDEN   "
		                + " AND tbldctosordenesdetalle.IDPLU       =   "
		                + "                             tmpCAN.IDPLU   "
		                + " AND tbldctosordenesdetalle.idCliente   =   "
		                + "                         tmpCAN.idCliente   "
		                + " AND  tbldctosordenesdetalle.strIdLista = 1",
			                 nativeQuery = true)
			  public void actualizaSuntuarioCliente( int IdLocal, String IdCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle         "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT                                     "
		                + "    tbldctosordenesdetalle.IDLOCAL          "
		                + "       ,tbldctosordenesdetalle.IDTIPOORDEN  "
		                + "       ,tbldctosordenesdetalle.IDORDEN      "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       ,( CANTIDAD -                        "
		                + " 	     tmpRNG.rangoMaximo)               "
		                + " 	            AS cantidad                "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	                    AS vrVentaUnitario "
		                + "       ,tbldctosordenesdetalle.ESTADO       "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "      ,tmpRNG3.vrGeneral AS VRVENTAORIGINAL "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,2 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,tbldctosordenesdetalle.comentario   "
		                + "       ,tmpRNG3.IDPLU  AS item              "
		                + "       ,itemPadre                           "
		                + "       ,tbldctosordenesdetalle.idEstadoTx   "
		                + "       ,tbldctosordenesdetalle.idTipoTx      "
		                + "       ,tbldctosordenesdetalle.fechaEntrega  "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,tbldctosordenesdetalle.idCliente    "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "      ( SELECT tblplus.idLocal,             "
		                + "               tblplus.idEstracto,          "
		                + "         SUM(tblplus.rangoMaximo)           "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1)             "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto )              "
		                + "                      AS tmpRNG             "
		                + " ON tbldctosordenesdetalle.idLocal          "
		                + "                  = tmpRNG.idLocal          "
		                + " AND tbldctosordenesdetalle.idEstracto      "
		                + "                      = tmpRNG.idEstracto   "
		                + "  INNER JOIN                                "
		                + "         ( SELECT tblplus.idLocal,          "
		                + "                 tblplus.idEstracto,        "
		                + "       SUM(tblplus.rangoMaximo)             "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (1,4)           "
		                + " GROUP BY tblplus.idLocal,                  "
		                + "          tblplus.idEstracto )              "
		                + "                       AS tmpRNG4           "
		                + "   ON tbldctosordenesdetalle.idLocal        "
		                + "                  = tmpRNG4.idLocal         "
		                + "  AND tbldctosordenesdetalle.idEstracto     "
		                + "              = tmpRNG4.idEstracto          "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "   tblplus.idPlu,                           "
		                + "   tblcategorias.nombreCategoria + ' ' +    "
		                + "   tblplus.nombrePlu AS nombrePlu,          "
		                + " 	      tblplus.vrGeneral,               "
		                + "              tblplus.idTipo,               "
		                + "              tblplus.idEstracto            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.idCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (4))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + " INNER JOIN  tbldctosordenes                "
		                + " ON 	tbldctosordenes.IDLOCAL =	       "
		                + "            tbldctosordenesdetalle.idLocal  "
		                + " AND	tbldctosordenes.IDTIPOORDEN =	       "
		                + "        tbldctosordenesdetalle.IDTIPOORDEN  "
		                + " AND	tbldctosordenes.IDORDEN =	       "
		                + "            tbldctosordenesdetalle.IDORDEN  "
		                + " WHERE tbldctosordenesdetalle.idLocal   =   "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =4  "
		                + " AND tbldctosordenesdetalle.idCliente    = "
		                + "?2                          "
		                + " AND tbldctosordenes.idPeriodo =            "
		                + "?3                          "
		                + " AND tbldctosordenesdetalle.strIdLista  =1  "
		                + " AND ( CANTIDAD - tmpRNG.rangoMaximo )  >0  "
		                + "   AND tbldctosordenesdetalle.CANTIDAD  <=  "
		                + "                     tmpRNG4.rangoMaximo ",
			                 nativeQuery = true)
			  public void ingresaComplementarioCliente( int IdLocal, String IdCliente, int idPeriodo);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE   tbldctosordenesdetalle               "
		                + " SET CANTIDAD =                              "
		                + "   ( CANTIDAD -                              "
		                + "     tmpCAN.cantidadComplementario )         "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN                                  "
		                + "   (SELECT                                   "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,       "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,   "
		                + "     tbldctosordenesdetalle_1.IDORDEN,       "
		                + "     tbldctosordenesdetalle_1.IDPLU,         "
		                + "     tbldctosordenesdetalle_1.CANTIDAD -     "
		                + " 		         tmpR14.rangoMaximo     "
		                + "           AS cantidadComplementario,        "
		                + "     tbldctosordenesdetalle_1.idCliente      "
		                + "  FROM  tbldctosordenesdetalle               "
		                + "           AS tbldctosordenesdetalle_1       "
		                + "  INNER JOIN                                 "
		                + "    (SELECT tblplus.idLocal,                 "
		                + "            tblplus.idEstracto,              "
		                + "            SUM(tblplus.rangoMaximo)         "
		                + " 		   AS rangoMaximo               "
		                + "  FROM  tblcategorias                        "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal      =             "
		                + "                     tblplus.idLocal         "
		                + " AND tblcategorias.idLinea     =             "
		                + "                     tblplus.idLinea         "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                 tblplus.idCategoria         "
		                + " WHERE   tblplus.idLocal       =             "
		                + "?1                             "
		                + " AND  tblplus.idLinea          = 1           "
		                + " AND  tblplus.idCategoria IN (1)             "
		                + " GROUP BY tblplus.idLocal,                   "
		                + "          tblplus.idEstracto) AS tmpR14      "
		                + " ON tbldctosordenesdetalle_1.IDLOCAL =       "
		                + "                              tmpR14.idLocal "
		                + " AND tbldctosordenesdetalle_1.idEstracto =   "
		                + "                           tmpR14.idEstracto "
		                + " AND tbldctosordenesdetalle_1.CANTIDAD   >   "
		                + "                    tmpR14.rangoMaximo       "
		                + " WHERE  tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59 "
		                + " AND tbldctosordenesdetalle_1.idCliente   = "
		                + "?2                          "
		                + " AND  tbldctosordenesdetalle_1.IDTIPO    =4  "
		                + "                       )  AS tmpCAN          "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =    "
		                + "                           tmpCAN.IDLOCAL    "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "                       tmpCAN.IDTIPOORDEN    "
		                + " AND tbldctosordenesdetalle.IDORDEN     =    "
		                + "                           tmpCAN.IDORDEN    "
		                + " AND tbldctosordenesdetalle.IDPLU       =    "
		                + "                             tmpCAN.IDPLU    "
		                + " AND tbldctosordenesdetalle.idCliente   =    "
		                + "                         tmpCAN.idCliente    "
		                + " AND tbldctosordenesdetalle.STRIDLISTA  = 1 ",
			                 nativeQuery = true)
			  public void actualizaComplementarioCliente( int IdLocal, String IdCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle           "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "            ,idEstracto                     "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT tbldctosordenesdetalle.IDLOCAL      "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       , ( CANTIDAD - rangoMaximo )         "
		                + " 	                    AS cantidad        "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	            AS vrVentaUnitario         "
		                + "       ,ESTADO                              "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "       ,tmpRNG3.vrGeneral                   "
		                + " 	          AS VRVENTAORIGINAL           "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,3 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,comentario                          "
		                + "       ,tmpRNG3.IDPLU AS item               "
		                + "       ,itemPadre                           "
		                + "       ,idEstadoTx                          "
		                + "       ,idTipoTx                            "
		                + "       ,fechaEntrega                        "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,idCliente                           "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "    ( SELECT tblplus.idLocal,               "
		                + "      SUM(tblplus.rangoMaximo)              "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10,19)           "
		                + " AND tblplus.idEstracto   =  1              "
		                + " GROUP BY tblplus.idLocal ) AS tmpR14       "
		                + " ON tbldctosordenesdetalle.idLocal =        "
		                + "                        tmpR14.idLocal      "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "      tblplus.idPlu,                        "
		                + "  tblcategorias.nombreCategoria + ' ' +     "
		                + "    tblplus.nombrePlu AS nombrePlu,         "
		                + "    tblplus.vrGeneral,                      "
		                + "    tblplus.idTipo,                         "
		                + "    tblplus.idEstracto                      "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10))            "
		                + "                   ) AS tmpRNG3             "
		                + " ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + "   WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =51 "
		                + " AND tbldctosordenesdetalle.idCliente    = "
		                + "?2                         "
		                + "   AND tbldctosordenesdetalle.CANTIDAD    > "
		                + "                     tmpR14.rangoMaximo ",
			                 nativeQuery = true)
			  public void ingresaClienteSuntuarioAlcantarillado( int IdLocal, String IdCliente);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE tbldctosordenesdetalle              "
		                + " SET CANTIDAD =                             "
		                + "  ( CANTIDAD - cantidadSuntuario )          "
		                + " FROM tbldctosordenesdetalle                "
		                + " INNER JOIN                                 "
		                + "   (SELECT                                  "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,      "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,  "
		                + "     tbldctosordenesdetalle_1.IDORDEN,      "
		                + "     tbldctosordenesdetalle_1.IDPLU,        "
		                + " 	( tbldctosordenesdetalle_1.CANTIDAD -  "
		                + " 		     tmpR14.rangoMaximo )      "
		                + " 		      AS cantidadSuntuario,    "
		                + "      tbldctosordenesdetalle_1.idCliente    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "       AS tbldctosordenesdetalle_1          "
		                + "   INNER JOIN                               "
		                + "   (SELECT  tblplus.idLocal,                "
		                + "        SUM(tblplus.rangoMaximo)            "
		                + " 	            AS rangoMaximo             "
		                + "    FROM tblcategorias                      "
		                + "    INNER JOIN tblplus                      "
		                + "    ON tblcategorias.idLocal      =         "
		                + "                     tblplus.idLocal        "
		                + "    AND tblcategorias.idLinea     =         "
		                + "                     tblplus.idLinea        "
		                + "    AND tblcategorias.IdCategoria =         "
		                + "                 tblplus.idCategoria        "
		                + "   WHERE       tblplus.idLocal =            "
		                + "?1                             "
		                + "   AND  tblplus.idLinea        = 1          "
		                + "   AND  tblplus.idCategoria   IN (10,19)     "
		                + "   AND  tblplus.idEstracto     = 1          "
		                + "   GROUP BY tblplus.idLocal) AS tmpR14      "
		                + "   ON tbldctosordenesdetalle_1.IDLOCAL =    "
		                + "                           tmpR14.idLocal   "
		                + "   AND tbldctosordenesdetalle_1.CANTIDAD >  "
		                + "                        tmpR14.rangoMaximo  "
		                + " WHERE tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59"
		                + " AND tbldctosordenesdetalle_1.IDTIPO     =51 "
		                + " AND tbldctosordenesdetalle_1.idCliente    = "
		                + "?2                          "
		                + "                         ) AS tmpCAN        "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =   "
		                + "                           tmpCAN.IDLOCAL   "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                       tmpCAN.IDTIPOORDEN   "
		                + " AND tbldctosordenesdetalle.IDORDEN     =   "
		                + "                           tmpCAN.IDORDEN   "
		                + " AND tbldctosordenesdetalle.IDPLU       =   "
		                + "                             tmpCAN.IDPLU   "
		                + " AND tbldctosordenesdetalle.idCliente   =   "
		                + "                         tmpCAN.idCliente   "
		                + " AND  tbldctosordenesdetalle.strIdLista = 1",
			                 nativeQuery = true)
			  public void actualizaClienteSuntuarioAlcantarillado( int IdLocal, String IdCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle         "
		                + "            (IDLOCAL                        "
		                + "            ,IDTIPOORDEN                    "
		                + "            ,IDORDEN                        "
		                + "            ,IDPLU                          "
		                + "            ,CANTIDAD                       "
		                + "            ,IDTIPO                         "
		                + "            ,PORCENTAJEIVA                  "
		                + "            ,VRVENTAUNITARIO                "
		                + "            ,ESTADO                         "
		                + "            ,NOMBREPLU                      "
		                + "            ,VRVENTAORIGINAL                "
		                + "            ,VRCOSTO                        "
		                + "            ,VRDSCTOPIE                     "
		                + "            ,PORCENTAJEDSCTO                "
		                + "            ,CANTIDADPEDIDA                 "
		                + "            ,STRIDLISTA                     "
		                + "            ,NOMBREUNIDADMEDIDA             "
		                + "            ,comentario                     "
		                + "            ,item                           "
		                + "            ,itemPadre                      "
		                + "            ,idEstadoTx                     "
		                + "            ,idTipoTx                       "
		                + "            ,fechaEntrega                   "
		                + "            ,idBodega                       "
		                + "            ,idSubcuenta                    "
		                + "            ,lecturaMedidor                 "
		                + "            ,idCliente                      "
		                + "            ,tmpRNG3.idEstracto             "
		                + "            ,idRuta                         "
		                + "            ,idNovedadLectura)              "
		                + " SELECT tbldctosordenesdetalle.IDLOCAL      "
		                + "       ,IDTIPOORDEN                         "
		                + "       ,IDORDEN                             "
		                + "       ,tmpRNG3.IDPLU                       "
		                + "       ,( CANTIDAD - tmpRNG.rangoMaximo)    "
		                + " 	                          AS cantidad  "
		                + "       ,tmpRNG3.IDTIPO                      "
		                + "       ,PORCENTAJEIVA                       "
		                + "      ,tmpRNG3.vrGeneral AS vrVentaUnitario "
		                + "       ,ESTADO                              "
		                + "       ,tmpRNG3.NOMBREPLU                   "
		                + "      ,tmpRNG3.vrGeneral AS VRVENTAORIGINAL "
		                + "       ,VRCOSTO                             "
		                + "       ,VRDSCTOPIE                          "
		                + "       ,PORCENTAJEDSCTO                     "
		                + "       ,CANTIDADPEDIDA                      "
		                + "       ,2 AS STRIDLISTA                     "
		                + "       ,NOMBREUNIDADMEDIDA                  "
		                + "       ,comentario                          "
		                + "       ,tmpRNG3.IDPLU AS item               "
		                + "       ,itemPadre                           "
		                + "       ,idEstadoTx                          "
		                + "       ,idTipoTx                            "
		                + "       ,fechaEntrega                        "
		                + "       ,idBodega                            "
		                + "       ,idSubcuenta                         "
		                + "       ,lecturaMedidor                      "
		                + "       ,idCliente                           "
		                + "       ,tmpRNG3.idEstracto                  "
		                + "       ,idRuta                              "
		                + "       ,idNovedadLectura                    "
		                + "   FROM tbldctosordenesdetalle              "
		                + "   INNER JOIN                               "
		                + "      ( SELECT  tblplus.idLocal,            "
		                + "        SUM(tblplus.rangoMaximo)            "
		                + "                            AS rangoMaximo  "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal = tblplus.idLocal "
		                + " AND tblcategorias.idLinea     =            "
		                + "                            tblplus.idLinea "
		                + " AND tblcategorias.IdCategoria =            "
		                + "                        tblplus.idCategoria "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10)            "
		                + " AND tblplus.idEstracto   =  1              "
		                + " GROUP BY tblplus.idLocal ) AS tmpRNG       "
		                + " ON tbldctosordenesdetalle.idLocal          "
		                + "                  = tmpRNG.idLocal          "
		                + "  INNER JOIN                                "
		                + "         ( SELECT tblplus.idLocal,          "
		                + "   SUM(tblplus.rangoMaximo)                 "
		                + "                  AS rangoMaximo            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.IdCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (10,19)           "
		                + " AND tblplus.idEstracto   =  1              "
		                + " GROUP BY tblplus.idLocal )                 "
		                + "                       AS tmpRNG4           "
		                + "   ON tbldctosordenesdetalle.idLocal        "
		                + "                  = tmpRNG4.idLocal         "
		                + " INNER JOIN (                               "
		                + " ( SELECT tblplus.idLocal,                  "
		                + "   tblplus.idPlu,                           "
		                + "   tblcategorias.nombreCategoria + ' ' +    "
		                + "   tblplus.nombrePlu AS nombrePlu,          "
		                + " 	      tblplus.vrGeneral,               "
		                + "              tblplus.idTipo,               "
		                + "              tblplus.idEstracto            "
		                + " FROM   tblcategorias                       "
		                + " INNER JOIN tblplus                         "
		                + " ON tblcategorias.idLocal      =            "
		                + "                 tblplus.idLocal            "
		                + " AND tblcategorias.idLinea     =            "
		                + "                 tblplus.idLinea            "
		                + " AND tblcategorias.idCategoria =            "
		                + "             tblplus.idCategoria            "
		                + " WHERE tblplus.idLocal   =                  "
		                + "?1                             "
		                + " AND tblplus.idLinea     =   1              "
		                + " AND tblplus.idCategoria IN (19))            "
		                + "                   ) AS tmpRNG3             "
		                + "   ON tbldctosordenesdetalle.idLocal      = "
		                + "                        tmpRNG3.idLocal     "
		                + " AND tbldctosordenesdetalle.idEstracto    = "
		                + "                     tmpRNG3.idEstracto     "
		                + "   WHERE tbldctosordenesdetalle.idLocal   = "
		                + "?1                             "
		                + " AND tbldctosordenesdetalle.idTipoOrden =59 "
		                + " AND tbldctosordenesdetalle.idTipo      =51 "
		                + " AND tbldctosordenesdetalle.strIdLista  =1  "
		                + " AND tbldctosordenesdetalle.idCliente    = "
		                + "?2                          "
		                + " AND ( CANTIDAD - tmpRNG.rangoMaximo )  >0  "
		                + "   AND tbldctosordenesdetalle.CANTIDAD  <=  "
		                + "                     tmpRNG4.rangoMaximo ",
			                 nativeQuery = true)
			  public void ingresaClienteComplementarioAlcantarillado( int IdLocal, String IdCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE   tbldctosordenesdetalle               "
		                + " SET CANTIDAD =                              "
		                + "   ( CANTIDAD -                              "
		                + "     tmpCAN.cantidadComplementario )         "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN                                  "
		                + "   (SELECT                                   "
		                + "     tbldctosordenesdetalle_1.IDLOCAL,       "
		                + "     tbldctosordenesdetalle_1.IDTIPOORDEN,   "
		                + "     tbldctosordenesdetalle_1.IDORDEN,       "
		                + "     tbldctosordenesdetalle_1.IDPLU,         "
		                + "     tbldctosordenesdetalle_1.CANTIDAD -     "
		                + " 		         tmpR14.rangoMaximo     "
		                + "           AS cantidadComplementario,        "
		                + "     tbldctosordenesdetalle_1.idCliente      "
		                + "  FROM  tbldctosordenesdetalle               "
		                + "           AS tbldctosordenesdetalle_1       "
		                + "  INNER JOIN                                 "
		                + "    (SELECT tblplus.idLocal,                 "
		                + "            SUM(tblplus.rangoMaximo)         "
		                + " 		   AS rangoMaximo               "
		                + "  FROM  tblcategorias                        "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal      =             "
		                + "                     tblplus.idLocal         "
		                + " AND tblcategorias.idLinea     =             "
		                + "                     tblplus.idLinea         "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                 tblplus.idCategoria         "
		                + " WHERE   tblplus.idLocal       =             "
		                + "?1                              "
		                + " AND  tblplus.idLinea          = 1           "
		                + " AND  tblplus.idCategoria IN (10)             "
		                + " AND  tblplus.idEstracto       = 1           "
		                + " GROUP BY tblplus.idLocal)                   "
		                + "                 AS tmpR14                   "
		                + " ON tbldctosordenesdetalle_1.IDLOCAL =       "
		                + "                    tmpR14.idLocal AND       "
		                + " tbldctosordenesdetalle_1.CANTIDAD   >       "
		                + "                    tmpR14.rangoMaximo       "
		                + " WHERE  tbldctosordenesdetalle_1.IDLOCAL   = "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle_1.IDTIPOORDEN=59 "
		                + " AND  tbldctosordenesdetalle_1.IDTIPO    =51 "
		                + " AND tbldctosordenesdetalle_1.idCliente    =  "
		                + "?2)  AS tmpCAN               "
		                + " ON tbldctosordenesdetalle.IDLOCAL      =    "
		                + "                           tmpCAN.IDLOCAL    "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "                       tmpCAN.IDTIPOORDEN    "
		                + " AND tbldctosordenesdetalle.IDORDEN     =    "
		                + "                           tmpCAN.IDORDEN    "
		                + " AND tbldctosordenesdetalle.IDPLU       =    "
		                + "                             tmpCAN.IDPLU    "
		                + " AND tbldctosordenesdetalle.idCliente   =    "
		                + "                         tmpCAN.idCliente    "
		                + " AND tbldctosordenesdetalle.STRIDLISTA  = 1 ",
			                 nativeQuery = true)
			  public void actualizaClienteComplementarioAlcantarillado( int IdLocal, String IdCliente);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle       "
		                + "            (IDLOCAL		     "
		                + "            ,IDTIPOORDEN		     "
		                + "            ,IDORDEN		     "
		                + "            ,IDPLU			     "
		                + "            ,CANTIDAD		     "
		                + "            ,IDTIPO		     "
		                + "            ,PORCENTAJEIVA		     "
		                + "            ,VRVENTAUNITARIO	     "
		                + "            ,ESTADO		     "
		                + "            ,NOMBREPLU		     "
		                + "            ,VRVENTAORIGINAL            "
		                + "            ,VRCOSTO                    "
		                + "            ,VRDSCTOPIE                 "
		                + "            ,PORCENTAJEDSCTO            "
		                + "            ,CANTIDADPEDIDA             "
		                + "            ,strIdLista                 "
		                + "            ,item			     "
		                + "            ,itemPadre		     "
		                + "            ,idEstadoTx		     "
		                + "            ,idTipoTx		     "
		                + "            ,lecturaMedidor             "
		                + "            ,idCliente		     "
		                + "            ,idEstracto                 "
		                + "            ,idRuta)		     "
		                + " SELECT   ?1 AS idLocal, "
		                + "?2  AS idTipoOrden,      "
		                + "?3  AS idOrden,	             "
		                + "   tmpCAT.idPlu, 		             "
		                + "   tbldctosordenesdetalle.cantidad,       "
		                + "   tmpCAT.idTipo, 		             "
		                + "   tmpCAT.porcentajeIva,                  "
		                + "   (tmpCAT.vrGeneral *                    "
		                + "?4)  AS vrVentaUnitario,         "
		                + "   0 AS estado,                           "
		                + "   tmpCAT.nombrePlu AS nombrePlu,         "
		                + "   (tmpCAT.vrGeneral *                    "
		                + "?4) AS VRVENTAORIGINAL           "
		                + "   ,0 AS VRCOSTO                          "
		                + "   ,0 AS VRDSCTOPIE                       "
		                + "   ,0 AS PORCENTAJEDSCTO                  "
		                + "   ,tbldctosordenesdetalle.cantidad       "
		                + "                        AS CANTIDADPEDIDA "
		                + "   ,tbldctosordenesdetalle.item       "
		                + "                           AS strIdLista  "
		                + "   ,tbldctosordenesdetalle.item  AS item, "
		                + "    1 AS itemPadre,        	             "
		                + "    0 AS idEstadoTx,                      "
		                + "    0 AS idTipoTx,                        "
		                + "    0 AS lecturaMedidor,                  "
		                + "    tbldctosordenesdetalle.idCliente,      "
		                + "    tbldctosordenesdetalle.idEstracto,       "
		                + "    tbldctosordenesdetalle.idRuta            "
		                + " FROM tbldctosordenesdetalle                 "
		                + " INNER JOIN  tbldctosordenes                 "
		                + " ON tbldctosordenesdetalle.IDLOCAL  =        "
		                + "                     tbldctosordenes.IDLOCAL "
		                + " AND tbldctosordenesdetalle.IDORDEN =        "
		                + "                     tbldctosordenes.IDORDEN "
		                + " AND  tbldctosordenesdetalle.IDTIPOORDEN =   "
		                + "                 tbldctosordenes.IDTIPOORDEN "
		                + " INNER JOIN                                  "
		                + " ( SELECT tblplus.idLocal,                   "
		                + "          tblplus.idTipo,                    "
		                + "          tblplus.idPlu,                     "
		                + "	     tblplus.porcentajeIva,             "
		                + "	     tblplus.vrGeneral,                 "
		                + "	 (tblcategorias.nombreCategoria + ' ' + "
		                + "	       tblplus.nombrePlu) AS nombrePlu, "
		                + "	     tblplus.idEstracto,                "
		                + "          tblplus.topeMaximo                 "
		                + " FROM tblcategorias                          "
		                + " INNER JOIN tblplus                          "
		                + " ON tblcategorias.idLocal  = tblplus.idLocal "
		                + " AND tblcategorias.idLinea = tblplus.idLinea "
		                + " AND tblcategorias.IdCategoria =             "
		                + "                         tblplus.idCategoria "
		                + " WHERE tblplus.idLocal =                     "
		                + "?1                              "
		                + " AND   tblplus.idTipo  =                     "
		                + "?5 ) AS tmpCAT                   "
		                + " ON tbldctosordenesdetalle.IDLOCAL =         "
		                + "                             tmpCAT.idLocal  "
		                + " AND tbldctosordenesdetalle.idEstracto  =    "
		                + "                           tmpCAT.idEstracto "
		                + " AND tmpCAT.topeMaximo  =                    "
		                + "           tbldctosordenesdetalle.strIdLista "
		                + " WHERE tbldctosordenesdetalle.idLocal   =    "
		                + "?1                              "
		                + " AND tbldctosordenesdetalle.IDTIPOORDEN =    "
		                + "?2                          "
		                + " AND tbldctosordenes.idCliente =            "
		                + "?6                           "
		                + " AND tbldctosordenes.idPeriodo =             "
		                + "?7                            "
		                + " AND (tmpCAT.vrGeneral *                     "
		                + "      tbldctosordenesdetalle.cantidad) != 0  "
		                + " AND  tbldctosordenesdetalle.idTipo = 4      ",
			                 nativeQuery = true)
			  public void ingresaCategoriaConsumoCliente( int IdLocal, int IdTipoOrden, int idOrden, int xIdSigno, int IdTipo, String idCliente, int idPeriodo);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tblDctosOrdenesDetalle      "
					  + "            (IDLOCAL                   "
					  + "            ,IDTIPOORDEN               "
					  + "            ,IDORDEN                   "
					  + "            ,IDPLU                     "
					  + "            ,CANTIDAD                  "
					  + "            ,IDTIPO                    "
					  + "            ,PORCENTAJEIVA             "
					  + "            ,VRVENTAUNITARIO           "
					  + "            ,ESTADO                    "
					  + "            ,NOMBREPLU                 "
					  + "            ,VRVENTAORIGINAL           "
					  + "            ,VRCOSTO                   "
					  + "            ,VRDSCTOPIE                "
					  + "            ,PORCENTAJEDSCTO           "
					  + "            ,CANTIDADPEDIDA            "
					  + "            ,vrCostoNegociado          "
					  + "            ,strIdBodega               "
					  + "            ,vrCostoResurtido          "
					  + "            ,STRIDLISTA                "
					  + "            ,STRIDREFERENCIA           "
					  + "            ,PESOTEORICO               "
					  + "            ,NOMBREUNIDADMEDIDA        "
					  + "            ,IDLOCALSUGERIDO           "
					  + "            ,IDBODEGASUGERIDO          "
					  + "            ,comentario                "
					  + "            ,item                      "
					  + "            ,itemPadre                 "
					  + "            ,idEstadoTx                "
					  + "            ,idTipoTx                  "
					  + "            ,idReferenciaOriginal      "
					  + "            ,idEstadoRefOriginal       "
					  + "            ,fechaEntrega              "
					  + "            ,idBodega                  "
					  + "            ,vrCostoIND                "
					  + "            ,idSubcuenta               "
					  + "            ,lecturaMedidor            "
					  + "            ,idCliente                 "
					  + "            ,idEstracto                "
					  + "            ,idRuta                    "
					  + "            ,idNovedadLectura          "
					  + "            ,fechaRegistroTx           "
					  + "            ,lecturaAnterior)          "
					  + " SELECT tblDctosOrdenesDetalle.IDLOCAL,"
					  + "?1 AS IDTIPOORDEN,     "
					  + "?2 AS IDORDEN              "
					  + "   ,IDPLU                              "
					  + "   ,CANTIDAD * (-1) AS cantidad        "
					  + "   ,IDTIPO                             "
					  + "   ,PORCENTAJEIVA                      "
					  + "   ,VRVENTAUNITARIO                    "
					  + "   ,ESTADO                             "
					  + "   ,NOMBREPLU                          "
					  + "   ,VRVENTAORIGINAL                    "
					  + "   ,VRCOSTO                            "
					  + "   ,VRDSCTOPIE                         "
					  + "   ,PORCENTAJEDSCTO                    "
					  + "   ,CANTIDADPEDIDA                     "
					  + "   ,vrCostoNegociado                   "
					  + "   ,strIdBodega                        "
					  + "   ,vrCostoResurtido                   "
					  + "   ,STRIDLISTA                         "
					  + "   ,STRIDREFERENCIA                    "
					  + "   ,PESOTEORICO                        "
					  + "   ,NOMBREUNIDADMEDIDA                 "
					  + "   ,IDLOCALSUGERIDO                    "
					  + "   ,IDBODEGASUGERIDO                   "
					  + "   ,comentario,                        "
					  + "?2 AS item                 "                
					  + "   ,itemPadre                          "
					  + "   ,idEstadoTx                         "
					  + "   ,idTipoTx                           "
					  + "   ,idReferenciaOriginal               "
					  + "   ,idEstadoRefOriginal                "
					  + "   ,fechaEntrega                       "
					  + "   ,idBodega                           "
					  + "   ,tblDctosOrdenesDetalle.vrCostoIND  "
					  + "   ,idSubcuenta                        "
					  + "   ,lecturaMedidor                     "
					  + "   ,tblDctosOrdenesDetalle.idCliente   "
					  + "   ,idEstracto                         "
					  + "   ,idRuta                             "
					  + "   ,idNovedadLectura                   "
					  + "   ,fechaRegistroTx                    "
					  + "   ,lecturaAnterior                    "
					  + " FROM        tblDctos                  "
					  + " INNER JOIN tblDctosOrdenesDetalle     "
					  + " ON tblDctos.IDLOCAL      =            "
					  + "    tblDctosOrdenesDetalle.IDLOCAL     "
					  + " AND tblDctos.IDTIPOORDEN =            "
					  + "  tblDctosOrdenesDetalle.IDTIPOORDEN   "
					  + " AND tblDctos.IDORDEN     =            "
					  + "    tblDctosOrdenesDetalle.IDORDEN     "
					  + " WHERE tblDctos.IDLOCAL =              "
					  + "?3                        "                
					  + " AND   tblDctos.idTipoOrden =          "
					  + "?4                    "                  
					  + " AND   tblDctos.idPeriodo   =          "
					  + "?5                      "                   
					  + " AND   tblDctos.idCliente   =         "
					  + "?6                     "                  
					  + " AND   tblDctosOrdenesDetalle.IDTIPO   "
					  + "            IN (4,21,22,51,25,24)	",
			                 nativeQuery = true)
			  public void ingresaAnulaConsumoUnCliente( int xIdTipoOrdenNew, int xIdOrdenNew, int idLocal, int IdTipoOrden, int idPeriodo, String idCliente);
			  
			  
			  @Query(value = " SELECT TOP 1 tbldctosordenesdetalle.idLocal,       "
					  + "        tbldctosordenesdetalle.idTipoOrden,       "
					  + " 	tbldctosordenesdetalle.idOrden               "
					  + " FROM      tbldctos                               "    
					  + " INNER JOIN tbldctosordenesdetalle                "    
					  + " ON tbldctos.IDLOCAL      =                       "    
					  + "                tbldctosordenesdetalle.IDLOCAL    "
					  + " AND tbldctos.IDTIPOORDEN =                       "    
					  + "            tbldctosordenesdetalle.IDTIPOORDEN    "
					  + " AND tbldctos.IDORDEN     =                       "    
					  + "                 tbldctosordenesdetalle.IDORDEN   "
					  + " AND tbldctos.idCliente   =                       "    
					  + "               tbldctosordenesdetalle.idCliente   "
					  + " WHERE  tbldctos.idLocal  =                       " 
					  + "?1                                 "                
					  + " AND tbldctosordenesdetalle.idTipoOrden IN (9,29) "            
					  + " AND  tbldctosordenesdetalle.idTipo = 4           "    
					  + " AND    tbldctos.idCliente =                     "  
					  + "?2                               "                
					  + " AND  tbldctos.idPeriodo  =                       "
					  + "?3                                 "                
					  + " ORDER BY IDORDEN DESC ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO2> listaLastOrdenFCH(int idLocal, String IdCliente, int IdPeriodo);
			  
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " UPDATE    tbldctosordenesdetalle                     "
		                + " SET       tbldctosordenesdetalle.lecturaMedidor =    "
		                + "?1                                "
		                + " FROM      tbldctos                                   "
		                + " INNER JOIN tbldctosordenesdetalle                    "
		                + " ON tbldctos.IDLOCAL      =                           "
		                + "                      tbldctosordenesdetalle.IDLOCAL  "
		                + " AND tbldctos.IDTIPOORDEN =                           "
		                + "                  tbldctosordenesdetalle.IDTIPOORDEN  "
		                + " AND tbldctos.IDORDEN     =                           "
		                + "                      tbldctosordenesdetalle.IDORDEN  "
		                + " AND tbldctos.idCliente   =                           "
		                + "                    tbldctosordenesdetalle.idCliente  "
		                + " WHERE  tbldctos.idLocal  =                           "
		                + "?2                                       "
		                + " AND  tbldctosordenesdetalle.idTipoOrden =            "
		                + "?3                                   "
		                + " AND  tbldctosordenesdetalle.idOrden =                "
		                + "?4                                       "                
		                + " AND  tbldctosordenesdetalle.idTipo = 4               "
		                + " AND  tbldctos.idPeriodo  =              ?5             ",
			                 nativeQuery = true)
			  public void actualizaLecturaLast( Double LecturaMedidor, int idLocal, int IdTipoOrden, int IdOrden, int idPeriodo);
			  
			  
			  
			  @Query(value = "SELECT tmpSaldo.idLocal,                       "
		                + "       tmpSaldo.IDTIPOORDEN,                   "
		                + "       tmpSaldo.idCliente,                     "
		                + "       tmpSaldo.idDcto,                        "
		                + "       tmpSaldo.idOrden,                       "
		                + "       tmpSaldo.fechaDcto,                     "
		                + "       tmpSaldo.fechaVcto,                     "
		                + "       tmpSaldo.diasVcto AS diasMora,          "
		                + "       tmpSaldo.vrSaldo,                       "
		                + "       tmpSaldo.indicador,                     "
		                + "       MAX(tmpSaldo.idDctoNitCC)               "
		                + "                             AS idDctoNitCC,   "
		                + "       (SELECT TOP 1 tblTerceros.nombreTercero "
		                + "        FROM    tblTerceros                    "
		                + "        WHERE   tblTerceros.idCliente =        "
		                + "                          tmpSaldo.idCliente   "
		                + "        AND   tblTerceros.idLocal   =          "
		                + "                          tmpSaldo.idLocal)  "
		                + "                              AS nombreTercero "
		                + "FROM                                           "
		                + "(SELECT tmpCXC.IDLOCAL,                        "
		                + "        tmpCXC.IDTIPOORDEN,                    "
		                + "        tmpCXC.idDcto,                         "
		                + "        tmpCXC.idOrden,                        "
		                + "       tmpCXC.indicador,                       "
		                + "       MAX(tmpCXC.idCliente) AS idCliente,     "
		                + "       MAX(tmpCXC.idDctoNitCC)                 "
		                + "                             AS idDctoNitCC,   "
		                + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,     "
		                + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,     "
		                + "       MIN(tmpCXC.fechaDcto) +                 "
		                + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,     "
		                + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) +  "
		                + "             MAX(tmpCXC.diasPlazo),GETDATE())  "
		                + "                             AS diasVcto,      "
		                + "       SUM(tmpCXC.vrBase) AS vrBase,           "
		                + "       SUM(tmpCXC.vrPago) AS vrPago,           "
		                + "       SUM(tmpCXC.vrIva) AS vrIva,             "
		                + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente, "
		                + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro, "
		                + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,       "
		                + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,       "
		                + "       SUM(tmpCXC.vrImpoconsumo)               "
		                + "                          AS vrImpoconsumo,    "
		                + "       ( SUM(tmpCXC.vrBase)               +    "
		                + "                SUM(tmpCXC.vrIva)         +    "
		                + "                SUM(tmpCXC.vrImpoconsumo) -    "
		                + "                SUM(tmpCXC.vrPago)        -    "
		                + "                SUM(tmpCXC.vrRteFuente)   -    "
		                + "                SUM(tmpCXC.vrDsctoFcro)   -    "
		                + "                SUM(tmpCXC.vrRteIva)      -    "
		                + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo     "
		                + "FROM                                           "
		                + "( SELECT tblDctos.idLocal,             	"
		                + "       tblDctos.idTipoOrden,                   "
		                + "       tblDctos.idDcto,              	        "
		                + "       tblDctos.idOrden,              	        "
		                + "       tblDctos.indicador,                     "
		                + "       tblDctos.idCliente,                     "
		                + "       tblDctos.vrBase,                        "
		                + "       tblDctos.vrPago,                        "
		                + "       tblDctos.vrIva,                         "
		                + "       tblDctos.vrImpoconsumo,                 "
		                + "       tblDctos.vrRteFuente,                   "
		                + "       tblDctos.vrDsctoFcro,                   "
		                + "       tblDctos.vrRteIva,                      "
		                + "       tblDctos.vrRteIca,                      "
		                + "       tblDctos.fechaDcto,                     "
		                + "       tblDctos.diasPlazo,                     "
		                + "       tblDctos.idDctoNitCC                    "
		                + "FROM   tblDctos                                "
		                + "WHERE  tblDctos.idLocal           =            "
		                + "?1                           "
		                + "AND    tblDctos.idTipoOrden       =            "
		                + "?2                       "
		                + "AND    tblDctos.idDctoCruce       =   0        "
		                + "AND    EXISTS (                                "
		                + "       SELECT *                                "
		                + "       FROM tblDctosOrdenesDetalle             "
		                + "       WHERE tblDctosOrdenesDetalle.idLocal =  "
		                + "                            tblDctos.idLocal   "
		                + "       AND tblDctosOrdenesDetalle.idTipoOrden  "
		                + "                                            =  "
		                + "                       tblDctos.idTipoOrden    "
		                + "      AND  tblDctosOrdenesDetalle.idOrden   =  "
		                + "                           tblDctos.idOrden )  "
		                + "AND    EXISTS (SELECT tblPagos.*	        "
		                + "               FROM   tblPagos		        "
		                + "               INNER JOIN tblPagosMedios       "
		                + "               ON  tblPagos.idLocal      =     "
		                + "                       tblPagosMedios.idLocal  "
		                + "               AND tblPagos.idTipoOrden  =     "
		                + "                   tblPagosMedios.idTipoOrden  "
		                + "               AND tblPagos.idRecibo     =     "
		                + "                      tblPagosMedios.idRecibo  "
		                + "               AND tblPagos.indicador    =     "
		                + "                     tblPagosMedios.indicador  "
		                + "               WHERE tblPagos.idLocal     =    "
		                + "                             tblDctos.idLocal  "
		                + "               AND   tblPagos.idTipoOrden =    "
		                + "                  (tblDctos.idTipoOrden + 50)  "
		                + "               AND   tblPagos.idDcto      =    "
		                + "                             tblDctos.idDcto   "
		                + "               AND   tblPagos.indicador   =    "
		                + "                           tblDctos.indicador  "
		                + "               AND   tblPagos.nitCC   =        "
		                + "                            tblDctos.idCliente "
		                + "               AND   tblPagos.idLog       =    "
		                + "?3                             "
		                + "               AND   tblPagos.idLocal     =    "
		                + "?1                           "
		                + "               AND   tblPagos.idTipoOrden =    "
		                + "?2 + 50 )                "
		                + " UNION				                "
		                + " SELECT tblDctos.idLocalCruce                  "
		                + "                      AS idLocal,              "
		                + "       tblDctos.idTipoOrdenCruce               "
		                + "                  AS idTipoOrden,              "
		                + "       tblDctos.idDctoCruce                    "
		                + "                      AS idDcto,               "
		                + "       tblDctos.idOrdenCruce AS idOrden,       "
		                + "       tblDctos.indicador,                     "
		                + "       tblDctos.idCliente,                     "
		                + "       tblDctos.vrBase,                        "
		                + "       tblDctos.vrPago,                        "
		                + "       tblDctos.vrIva,                         "
		                + "       tblDctos.vrImpoconsumo,                 "
		                + "       tblDctos.vrRteFuente,                   "
		                + "       tblDctos.vrDsctoFcro,                   "
		                + "       tblDctos.vrRteIva,                      "
		                + "       tblDctos.vrRteIca,                      "
		                + "       tblDctos.fechaDcto,                     "
		                + "       tblDctos.diasPlazo,                     "
		                + "       tblDctos.idDctoNitCC                    "
		                + "FROM   tblDctos                                "
		                + "WHERE  tblDctos.idLocal           =            "
		                + "?1                          "
		                + "AND    tblDctos.idTipoOrdenCruce  =            "
		                + "?2                       "
		                + "AND    tblDctos.idDctoCruce      != 0          "
		                + "AND    EXISTS (                                "
		                + "       SELECT *                                "
		                + "       FROM tblDctosOrdenesDetalle             "
		                + "       WHERE tblDctosOrdenesDetalle.idLocal =  "
		                + "                            tblDctos.idLocal   "
		                + "       AND tblDctosOrdenesDetalle.idTipoOrden  "
		                + "                                            =  "
		                + "                       tblDctos.idTipoOrden    "
		                + "      AND  tblDctosOrdenesDetalle.idOrden   =  "
		                + "                           tblDctos.idOrden )  "
		                + "AND    EXISTS (SELECT tblPagos.*	          "
		                + "               FROM   tblPagos		   "
		                + "               INNER JOIN tblPagosMedios       "
		                + "               ON  tblPagos.idLocal      =     "
		                + "                       tblPagosMedios.idLocal  "
		                + "               AND tblPagos.idTipoOrden  =     "
		                + "                   tblPagosMedios.idTipoOrden  "
		                + "               AND tblPagos.idRecibo     =     "
		                + "                      tblPagosMedios.idRecibo  "
		                + "               AND tblPagos.indicador    =     "
		                + "                     tblPagosMedios.indicador  "
		                + "               WHERE tblPagos.idLocal     =    "
		                + "                         tblDctos.idLocalCruce "
		                + "               AND   tblPagos.idTipoOrden =    "
		                + "               (tblDctos.idTipoOrdenCruce + 50)"
		                + "               AND   tblPagos.idDcto      =    "
		                + "                         tblDctos.idDctoCruce  "
		                + "               AND   tblPagos.indicador   =    "
		                + "                           tblDctos.indicador  "
		                + "               AND   tblPagos.nitCC   =        "
		                + "                            tblDctos.idCliente "
		                + "               AND   tblPagos.idLog       =    "
		                + "?3                            "
		                + "               AND   tblPagos.idLocal     =    "
		                + "?1                          "
		                + "               AND   tblPagos.idTipoOrden =    "
		                + "?2 + 50 )                "
		                + "UNION					        "
		                + "SELECT tblDctos.idLocal,                       "
		                + "       tblDctos.idTipoOrden,                   "
		                + "       tblDctos.idDctoCruce                    "
		                + "                      AS idDcto,               "
		                + "       tblDctos.idOrdenCruce AS idOrden,       "
		                + "       tblDctos.indicador,                     "
		                + "       tblDctos.idCliente,                     "
		                + "       tblDctos.vrBase,                        "
		                + "       tblDctos.vrPago,                        "
		                + "       tblDctos.vrIva,                         "
		                + "       tblDctos.vrImpoconsumo,                 "
		                + "       tblDctos.vrRteFuente,                   "
		                + "       tblDctos.vrDsctoFcro,                   "
		                + "       tblDctos.vrRteIva,                      "
		                + "       tblDctos.vrRteIca,                      "
		                + "       tblDctos.fechaDcto,                     "
		                + "       tblDctos.diasPlazo,                     "
		                + "       tblDctos.idDctoNitCC                    "
		                + "FROM   tblDctos                                "
		                + "WHERE  tblDctos.idLocal           =            "
		                + "?1                           "
		                + "AND    tblDctos.idTipoOrden       =            "
		                + "?2                       "
		                + "AND    tblDctos.idDctoCruce      != 0          "
		                + "AND    EXISTS (                                "
		                + "       SELECT *                                "
		                + "       FROM tblDctosOrdenesDetalle             "
		                + "       WHERE tblDctosOrdenesDetalle.idLocal =  "
		                + "                            tblDctos.idLocal   "
		                + "       AND tblDctosOrdenesDetalle.idTipoOrden  "
		                + "                                            =  "
		                + "                       tblDctos.idTipoOrden    "
		                + "      AND  tblDctosOrdenesDetalle.idOrden   =  "
		                + "                           tblDctos.idOrden )  "
		                + "AND    EXISTS (SELECT tblPagos.*	        "
		                + "               FROM   tblPagos		        "
		                + "               INNER JOIN tblPagosMedios       "
		                + "               ON  tblPagos.idLocal      =     "
		                + "                       tblPagosMedios.idLocal  "
		                + "               AND tblPagos.idTipoOrden  =     "
		                + "                   tblPagosMedios.idTipoOrden  "
		                + "               AND tblPagos.idRecibo     =     "
		                + "                      tblPagosMedios.idRecibo  "
		                + "               AND tblPagos.indicador    =     "
		                + "                     tblPagosMedios.indicador  "
		                + "               WHERE tblPagos.idLocal     =    "
		                + "                         tblDctos.idLocalCruce "
		                + "               AND   tblPagos.idTipoOrden =    "
		                + "                   (tblDctos.idTipoOrden + 50) "
		                + "               AND   tblPagos.idDcto      =    "
		                + "                         tblDctos.idDctoCruce  "
		                + "               AND   tblPagos.indicador   =    "
		                + "                           tblDctos.indicador  "
		                + "               AND   tblPagos.nitCC   =        "
		                + "                            tblDctos.idCliente "
		                + "               AND   tblPagos.idLog       =    "
		                + "?3                             "
		                + "               AND   tblPagos.idLocal     =    "
		                + "?1                           "
		                + "               AND   tblPagos.idTipoOrden =    "
		                + "?2 + 50 ) )    AS tmpCXC "
		                + "GROUP BY tmpCXC.IDLOCAL,                       "
		                + "         tmpCXC.IDTIPOORDEN,                   "
		                + "         tmpCXC.idDcto,                        "
		                + "         tmpCXC.idOrden,                       "
		                + "         tmpCXC.indicador                      "
		                + "HAVING ( SUM(tmpCXC.vrBase)        +           "
		                + "         SUM(tmpCXC.vrIva)         +           "
		                + "         SUM(tmpCXC.vrImpoconsumo) -           "
		                + "         SUM(tmpCXC.vrPago)        -           "
		                + "         SUM(tmpCXC.vrRteFuente)   -           "
		                + "         SUM(tmpCXC.vrDsctoFcro)   -           "
		                + "         SUM(tmpCXC.vrRteIva)      -           "
		                + "         SUM(tmpCXC.vrRteIca) ) > 1 )          "
		                + "                              AS tmpSaldo      "
		                + "GROUP BY tmpSaldo.idLocal,                     "
		                + "         tmpSaldo.IDTIPOORDEN,                 "
		                + "         tmpSaldo.idDcto,                      "
		                + "         tmpSaldo.idOrden,                     "
		                + "         tmpSaldo.fechaDcto,                   "
		                + "         tmpSaldo.fechaVcto,                   "
		                + "         tmpSaldo.diasVcto,                    "
		                + "         tmpSaldo.vrSaldo,                     "
		                + "         tmpSaldo.indicador,                   "
		                + "         tmpSaldo.idCliente                    "
		                + "ORDER BY tmpSaldo.fechaDcto                    ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO2> listaCuentaPlanilla(int idLocal, int IdTipoOrden, int IdLog);
			  
			  
			  
			  @Query(value = " SELECT tmpTOT.idLocal	                   "
		                + "       ,tmpTOT.idTipoOrden	                   "
		                + "       ,tmpTOT.idPlu                            "
		                + "       ,SUM(tmpTOT.vrMedio)                     "
		                + " 	           AS vrMedio,                     "
		                + " 		MAX(tmpPlu.nombrePlu)                  "
		                + " 		        AS nombrePlu,                  "
		                + " 		MAX(tmpPlu.idTipo)                     "
		                + " 		        AS idTipo,                     "
		                + "              MAX(tmpTOT.idDcto) AS idDcto      "
		                + " FROM ( SELECT                                  "
		                + "  tbldctosordenesdetalle.idLocal	           "
		                + "  ,tbldctosordenesdetalle.idTipoOrden	   "
		                + "  ,tbldctosordenesdetalle.idPlu		   "
		                + "  ,SUM( tbldctosordenesdetalle.cantidad *       "
		                + "  tbldctosordenesdetalle.vrVentaUnitario)       "
		                + " 		 AS vrMedio	                   "
		                + "       ,tbldctosordenesdetalle.idOrden          "
		                + "       ,MAX(tbldctos.idDcto) AS idDcto          "
		                + " FROM tbldctosordenesdetalle	                   "
		                + " INNER JOIN tbldctos                            "
		                + " ON tbldctos.IDLOCAL   = 			   "
		                + "      tbldctosordenesdetalle.idLocal		   "
		                + " AND tbldctos.IDTIPOORDEN = 			   "
		                + "  tbldctosordenesdetalle.idTipoOrden		   "
		                + " AND tbldctos.IDORDEN     = 		           "
		                + "      tbldctosordenesdetalle.idOrden	           "
		                + " WHERE tbldctos.idLocal     =      	           "
		                + "?1                                     "
		                + " AND tbldctos.idTipoOrden   =                   "
		                + "?2                                 "
		                + " AND tbldctos.idDcto         =                  "
		                + "?3                                      "
		                + " GROUP BY                                       "
		                + "  tbldctosordenesdetalle.idLocal	           "
		                + "  ,tbldctosordenesdetalle.idTipoOrden	   "
		                + "  ,tbldctosordenesdetalle.idPlu                 "
		                + "  ,tbldctosordenesdetalle.idOrden               "
		                + " UNION                                          "
		                + " SELECT tbldctos.idLocalCruce                   "
		                + "                           AS idLocal           "
		                + "  ,tbldctos.IDTIPOORDENCRUCE                    "
		                + " 	                   AS idTipoOrden          "
		                + "  ,tbldctosordenesdetalle.idPlu                 "
		                + "  ,SUM(tbldctosordenesdetalle.vrVentaUnitario   "
		                + "    * tbldctosordenesdetalle.CANTIDAD)          "
		                + " 	                            AS vrMedio     "
		                + "       ,tbldctosordenesdetalle.idOrden          "
		                + "        ,MAX(tbldctos.idDcto) AS idDcto         "
		                + "   FROM  tbldctos                               "
		                + "   INNER JOIN tbldctosordenesdetalle            "
		                + "   ON tbldctosordenesdetalle.idLocal      =     "
		                + "                           tbldctos.idLocal     "
		                + "   AND tbldctosordenesdetalle.idTipoOrden =     "
		                + "                       tbldctos.idTipoOrden     "
		                + "   AND tbldctosordenesdetalle.idOrden     =     "
		                + "                           tbldctos.idOrden     "
		                + "   WHERE tbldctos.idLocalCruce            =     "
		                + "?1                                     "
		                + "   AND tbldctos.idTipoOrdenCruce          =     "
		                + "?2                                "
		                + "   AND tbldctos.idDctoCruce               =     "
		                + "?3                                      "
		                + " GROUP BY tbldctos.idLocalCruce                 "
		                + "       ,tbldctos.IDTIPOORDENCRUCE               "
		                + "       ,tbldctosordenesdetalle.idPlu            "
		                + "       ,tbldctosordenesdetalle.idOrden          "
		                + " UNION                                          "
		                + " SELECT tblpagos.IdLocal,                       "
		                + "        tblpagos.idTipoOrden,                   "
		                + "        tblpagosmedios.IDPLU,                   "
		                + "        SUM(tblpagosmedios.vrMedio)             "
		                + " 	        * (-1) AS vrMedio,                 "
		                + "        0 AS idOrden,                           "
		                + "        0 AS iDcto                              "
		                + " FROM tblpagos                                  "
		                + " INNER JOIN tblpagosmedios                      "
		                + " ON tblpagos.idLocal      =                     "
		                + "        tblpagosmedios.idLocal                  "
		                + " AND tblpagos.idTipoOrden =                     "
		                + "    tblpagosmedios.idTipoOrden                  "
		                + " AND tblpagos.idRecibo    =                     "
		                + "       tblpagosmedios.idRecibo                  "
		                + " AND tblpagos.indicador   =                     "
		                + "      tblpagosmedios.indicador                  "
		                + " WHERE tblpagos.idLocal     =      	           "
		                + "?1                                     "
		                + " AND tblpagos.idTipoOrden   =                   "
		                + "?2                                 "
		                + " AND tblpagos.idDcto         =                  "
		                + "?3                                     "
		                + " GROUP BY tblpagos.IdLocal,                     "
		                + "        tblpagos.idTipoOrden,                   "
		                + "        tblpagosmedios.IDPLU )                  "
		                + " 	                  AS tmpTOT                "
		                + " INNER JOIN                                     "
		                + " ( SELECT tblplus.idLocal,                      "
		                + "   tblplus.idPlu,                               "
		                + "   RTRIM(tblcategorias.nombreCategoria)         "
		                + "                            + ' ' +             "
		                + "    tblplus.nombrePlu AS nombrePlu ,            "
		                + "    tblplus.idTipo                              "
		                + " FROM  tblcategorias                            "
		                + " INNER JOIN tblplus                             "
		                + " ON tblcategorias.idLocal      =                "
		                + "                  tblplus.idLocal               "
		                + " AND tblcategorias.IdCategoria =                "
		                + "              tblplus.idCategoria               "
		                + " AND tblcategorias.idLinea     =                "
		                + "                   tblplus.idLinea              "
		                + " WHERE  tblcategorias.idLocal =                 "
		                + "?1)  AS tmpPlu                         "
		                + " ON tmpPlu.idLocal = tmpTOT.idLocal             "
		                + " AND tmpPlu.idPlu = tmpTOT.idPlu                "
		                + " GROUP BY tmpTOT.idLocal	                   "
		                + "       ,tmpTOT.idTipoOrden	                   "
		                + "       ,tmpTOT.idPlu                            "
		                + " HAVING SUM(tmpTOT.vrMedio) != 0                "
		                + " ORDER BY 1,6 ",
		                nativeQuery = true)
			  List<TblDctosOrdenesDetalleDTO2> listaPagoParcial(int xIdLocal, int xIdTipoOrden, int xIdDcto);
			  
			  
			  @Modifying
			  @Transactional
			  @Query(value = " INSERT INTO tbldctosordenesdetalle   "
		                + "            (IDLOCAL                  "
		                + "            ,IDTIPOORDEN              "
		                + "            ,IDORDEN                  "
		                + "            ,IDPLU                    "
		                + "            ,CANTIDAD                 "
		                + "            ,IDTIPO                   "
		                + "            ,PORCENTAJEIVA            "
		                + "            ,VRVENTAUNITARIO          "
		                + "            ,ESTADO                   "
		                + "            ,NOMBREPLU                "
		                + "            ,VRVENTAORIGINAL          "
		                + "            ,VRCOSTO                  "
		                + "            ,VRDSCTOPIE               "
		                + "            ,PORCENTAJEDSCTO          "
		                + "            ,CANTIDADPEDIDA           "
		                + "            ,STRIDLISTA               "
		                + "            ,NOMBREUNIDADMEDIDA       "
		                + "            ,comentario               "
		                + "            ,item                     "
		                + "            ,itemPadre                "
		                + "            ,idEstadoTx               "
		                + "            ,idTipoTx                 "
		                + "            ,fechaEntrega             "
		                + "            ,idBodega                 "
		                + "            ,idSubcuenta              "
		                + "            ,lecturaMedidor           "
		                + "            ,idCliente                "
		                + "            ,idEstracto               "
		                + "            ,idRuta                   "
		                + "            ,idNovedadLectura)        "
		                + " SELECT bak_DctosOrdenesDetalle.IDLOCAL    "
		                + "      ,bak_DctosOrdenesDetalle.IDTIPOORDEN "
		                + "      ,bak_DctosOrdenesDetalle.IDORDEN     "
		                + "      ,IDPLU                               "
		                + "      ,CANTIDAD                            "
		                + "      ,IDTIPO                              "
		                + "      ,PORCENTAJEIVA                       "
		                + "      ,VRVENTAUNITARIO                     "
		                + "      ,bak_DctosOrdenesDetalle.ESTADO      "
		                + "      ,NOMBREPLU                           "
		                + "      ,VRVENTAORIGINAL                     "
		                + "      ,VRCOSTO                             "
		                + "      ,VRDSCTOPIE                          "
		                + "      ,PORCENTAJEDSCTO                     "
		                + "      ,CANTIDADPEDIDA                      "
		                + "      ,STRIDLISTA                          "
		                + "      ,NOMBREUNIDADMEDIDA                  "
		                + "      ,bak_DctosOrdenesDetalle.comentario  "
		                + "      ,item                                "
		                + "      ,itemPadre                           "
		                + "      ,bak_DctosOrdenesDetalle.idEstadoTx  "
		                + "      ,bak_DctosOrdenesDetalle.idTipoTx    "
		                + "     ,bak_DctosOrdenesDetalle.fechaEntrega "
		                + "      ,idBodega                            "
		                + "      ,idSubcuenta                         "
		                + "      ,lecturaMedidor                      "
		                + "      ,bak_DctosOrdenesDetalle.idCliente   "
		                + "      ,idEstracto                          "
		                + "      ,idRuta                              "
		                + "      ,idNovedadLectura                    "
		                + " FROM   bak_DctosOrdenes              "
		                + " INNER JOIN bak_DctosOrdenesDetalle   "
		                + " ON bak_DctosOrdenes.IDLOCAL      =   "
		                + "     bak_DctosOrdenesDetalle.IDLOCAL  "
		                + " AND bak_DctosOrdenes.IDTIPOORDEN =   "
		                + "  bak_DctosOrdenesDetalle.IDTIPOORDEN "
		                + " AND bak_DctosOrdenes.IDORDEN     =   "
		                + "     bak_DctosOrdenesDetalle.IDORDEN  "
		                + " WHERE   bak_DctosOrdenes.IDLOCAL =   "
		                + " ?1                                   "
		                + " AND bak_DctosOrdenes.IDTIPOORDEN     "
		                + "                     IN (7,9,29, 59)  "
		                + " AND bak_DctosOrdenes.idPeriodo =  ?2   ", 
		                nativeQuery = true)
			  public void ingresaOrdenesDetalle(int idLocal, int idPeriodo);
			  
			  
			  
			  
			  
}
