package com.marketing.Repository.dbaquamovil;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.marketing.Model.dbaquamovil.TblDctos;
import com.marketing.Projection.ReporteFeDTO;
import com.marketing.Projection.TblDctosDTO;
import com.marketing.Projection.TblDctosDTO2;
import com.marketing.Projection.TblDctosDTO3;
import com.marketing.Projection.TblDctosDTO4;

@Repository
public interface TblDctosRepo extends JpaRepository<TblDctos, Integer> {

	@Query("SELECT MAX(r.idDcto) FROM TblDctos r " +
			  "WHERE r.IDLOCAL = ?1 " +
			  "AND r.IDTIPOORDEN = 17 ")
	    Integer findMaxIdDcto(int IDLOCAL);
	
	  @Query(value = "SELECT idDcto " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDORDEN = ?2 " +
              "AND tblDctos.idCliente = ?3 ",
              nativeQuery = true)
	  Integer ObtenerIdDcto(int idLocal, int IDORDEN, String idCliente);
	  
	  @Query(value = "SELECT fechaDcto " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDORDEN = ?2 " +
              "AND tblDctos.idCliente = ?3 ",
              nativeQuery = true)
	  String ObtenerFechaDcto(int idLocal, int IDORDEN, String idCliente);
	  
	  
	  @Query(value = "SELECT fechaDcto " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDORDEN = ?2 ",
              nativeQuery = true)
	  String ObtenerFechaDctoInventario(int idLocal, int IDORDEN);
	  
	  @Query(value = "SELECT DISTINCT idCliente " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDTIPOORDEN = 17 ",
              nativeQuery = true)
	  List<String> ObtenerClientesPQR(int idLocal);
	  
	  @Query(value = "SELECT TOP 1 etapaSTR  " +
			  "FROM bdaquamovil.dbo.tblDctos " +
			  "WHERE tblDctos.IDLOCAL = ?1   " +
			  "AND tblDctos.IDPERIODO = ?2   " +
			  "AND tblDctos.IDCLIENTE = ?3	 ",
			  nativeQuery = true)
	  Integer ObtenerEtapaSTR(int idlocal, int idperiodo, String idCliente);
	  
	  @Query(value = "SELECT  idDcto " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idCliente = ?2 "+
              "AND tblDctos.IDTIPOORDEN = 17 ",
              nativeQuery = true)
	  List<Integer> ObtenerListaPQR(int idLocal, String idCliente);
	  
	  @Query(value = "SELECT  IDORDEN " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idDcto = ?2 " +
              "AND tblDctos.IDTIPOORDEN = 17 ",
              nativeQuery = true)
	  Integer ObtenerIDORDEN(int idLocal, int idDcto);
	  
	  @Query(value = "SELECT  IDORDEN " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idDcto IN ?2 "+
              "AND tblDctos.IDTIPOORDEN = 17 ",
              nativeQuery = true)
	  List<Integer> ObtenerListaIDORDEN(int idLocal, List<Integer> idDcto);
	  
	  @Query(value = "SELECT  IDORDEN " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDTIPOORDEN = ?2 " +
              "AND tblDctos.idPeriodo = ?3",
              nativeQuery = true)
	  List<Integer> ObtenerCantidadFacturas(int idLocal, int idTipoOrden, int idPeriodo );
	  
	  @Query(value = "SELECT  envioFE, COUNT(*) AS cuenta " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDTIPOORDEN = ?2 " +
              "AND tblDctos.idPeriodo = ?3 " +
              "group by envioFE ",
              nativeQuery = true)
	  List<ReporteFeDTO> ObtenerReporteFE(int idLocal, int idTipoOrden, int idPeriodo );
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = "DELETE FROM tbldctos " +
	                 "WHERE tbldctos.IDLOCAL = ?1 " +
	                 "AND tbldctos.IDTIPOORDEN   IN (7,9,29, 59) " +
	                 "AND tbldctos.idPeriodo =  ?2 ", nativeQuery = true)
	  public void retiraDctos(int idLocal, int idPeriodo);
	  
	  
	  
	  
	  @Query(value = " SELECT tblDctos.idLocal,             "                 
			  + "   tblDctos.idTipoOrden,                   "
			  + "   tblDctos.idDcto,                        "
			  + "   tblDctos.idOrden,                       "
			  + "   tblDctos.fechaDcto,                     "
			  + "   tblDctos.indicador,                     "
			  + "   tblDctos.idCliente,                     "
			  + "   tblDctos.vrBase,                        "
			  + "   tblDctos.vrIva,                         "
			  + "   tblDctos.vrCostoMV,                     "
			  + "   tblDctos.nombreTercero,                 "
			  + "   tblDctos.idDctoNitCC,                   "
			  + "   tblDctos.fechaDctoNitCC,                "
			  + "   tblDctos.idLocalCruce,                  "
			  + "   tblDctos.idTipoOrdenCruce,              "
			  + "   tblDctos.idDctoCruce,                   "
			  + "   (tblDctos.vrBase      +                 "
			  + "   tblDctos.vrIva       -                  "
			  + "   tblDctos.vrRteFuente -                  "
			  + "   tblDctos.vrRteIva) AS vrFactura,        "
			  + "   tblDctos.vrDescuento,                   "
			  + "   tblDctos.vrRteFuente,                   "
			  + "   (CASE WHEN                              "
			  + "         tblDctos.idTipoOrden = 1          "
			  + "   THEN    tblDctos.idDctoNitCC            "
			  + "   ELSE    STR(tblDctos.idDcto)            "
			  + "   END) AS idDctoStr,                      "
			  + "   (CASE WHEN                              "
			  + "         tblDctos.idTipoNegocio = 1        "
			  + "   THEN      'CONTADO'                     "
			  + "   ELSE      'CREDITO'                     "
			  + "   END) AS nombreTipoNegocio,              "
			  + "   tblDctos.idTipoNegocio,                 "
			  + "   ctrlUsuarios.aliasUsuario,              "
			  + "   tblTercerosRuta.nombreRuta,             "
			  + "   tblTerceroEstracto.nombreEstracto       "
			  + "                    AS nombreEstrato,      "
			  + "   tblDctosOrdenes.OBSERVACION,            "   
			  + "   tblTerceros.CC_Nit,                     "
			  + "   tblDctosPeriodo.fechaConRecargo         "
			  + "                            AS fechaVcto   "
			  + "   FROM   tblDctos                         "     
			  + "   INNER JOIN tblDctosOrdenes              "    
			  + "   ON tblDctosOrdenes.IDLOCAL              "
			  + "                    =tblDctos.IDLOCAL      "
			  + "   AND tblDctosOrdenes.IDTIPOORDEN =       "    
			  + "                tblDctos.IDTIPOORDEN       "
			  + "   AND tblDctosOrdenes.IDORDEN   =         "      
			  + "                  tblDctos.IDORDEN         "
			  + "   INNER JOIN tblTerceros                  "    
			  + "   ON tblTerceros.idLocal        =         "
			  + "                  tblDctos.IDLOCAL         "
			  + "   AND tblTerceros.idCliente     =         "        
			  + "                tblDctos.idCliente         "
			  + "   INNER JOIN tblDctosPeriodo              "
			  + "   ON tblDctosPeriodo.idLocal    =         "
			  + "                  tblDctos.idLocal         "
			  + "   AND tblDctosPeriodo.idPeriodo =         "
			  + "                tblDctos.idPeriodo         "
			  + "   INNER JOIN ctrlUsuarios                 "
			  + "   ON ctrlUsuarios.idLocal       =         "
			  + "                  tblDctos.IDLOCAL         "
			  + "   AND ctrlUsuarios.idUsuario    =         "
			  + "               tblDctos.idVendedor         "
			  + "   INNER JOIN tblTercerosRuta              "
			  + "   ON tblTercerosRuta.idLocal    =         "
			  + "               tblTerceros.IDLOCAL         "
			  + "   AND tblTercerosRuta.idRuta    =         "
			  + "                tblTerceros.idRuta         "
			  + "   INNER JOIN tblTerceroEstracto           "
			  + "   ON tblTerceroEstracto.idLocal =         "
			  + "               tblTerceros.IDLOCAL         "
			  + "   AND tblTerceroEstracto.idEstracto =     "
			  + "               tblTerceros.idEstracto      "
			  + "                  WHERE EXISTS             "                    
			  + "  ( SELECT *                               " 
			  + "    FROM   tblDctosOrdenes                 " 
			  + "    INNER JOIN tblDctosOrdenesDetalle      " 
			  + "    ON tblDctosOrdenes.IDLOCAL      =      " 
			  + "       tblDctosOrdenesDetalle.IDLOCAL      " 
			  + "    AND tblDctosOrdenes.IDTIPOORDEN =      " 
			  + "   tblDctosOrdenesDetalle.IDTIPOORDEN      "
			  + "    AND tblDctosOrdenes.IDORDEN     =      " 
			  + "       tblDctosOrdenesDetalle.IDORDEN      " 
			  + "    WHERE tblDctosOrdenes.IDLOCAL   =      " 
			  + "                     tblDctos.IDLOCAL      "
			  + "    AND tblDctosOrdenes.IDTIPOORDEN =      " 
			  + "                 tblDctos.IDTIPOORDEN      "
			  + "    AND tblDctosOrdenes.IDORDEN     =      " 
			  + "          tblDctos.IDORDEN)                "
			  + "    AND tblDctos.idLocal   =               " 
			  + "?1                              "                
			  + "    AND tblDctos.idPeriodo =               "  
			  + "?2                           "                       
			  + " AND tblDctos.idTipoOrden  IN             ("
			  + "?3 ,                    "
			  + "?4 )                    "  
			  + " AND tblDctos.indicador BETWEEN            "
			  + "?5      AND          "
			  + "?6                      " 
			  + " AND    tblTercerosRuta.idRuta =              "
			  + "?7                                 "                
			  + "    AND tblTerceros.IDTIPOTERCERO =1       "			 
			  + "    ORDER BY tblDctos.fechaDcto,           "      
			  + "             tblDctos.idTipoOrden,         "      
			  + "             tblDctos.idDcto",
              nativeQuery = true)
	  List<TblDctosDTO> listaRepNotaRuta(int idLocal, int idPeriodo, int IdTipoOrdenINI, int IdTipoOrdenFIN, int IndicadorINICIAL, int IndicadorFINNAL, int idRuta );
	  
	  
	  

	  @Query(value = " SELECT tblDctos.idLocal,                    "             
			  + "   tblDctos.idTipoOrden,                   "
			  + "   tblDctos.idDcto,                        "
			  + "   tblDctos.idOrden,                       "
			  + "   tblDctos.fechaDcto,                     "
			  + "   tblDctos.indicador,                     "
			  + "   tblDctos.idCliente,                     "
			  + "   tblDctos.vrBase,                        "
			  + "   tblDctos.vrIva,                         "
			  + "   tblDctos.vrCostoMV,                     "
			  + "   tblDctos.nombreTercero,                 "
			  + "   tblDctos.idDctoNitCC,                   "
			  + "   tblDctos.fechaDctoNitCC,                "
			  + "   tblDctos.idLocalCruce,                  "
			  + "   tblDctos.idTipoOrdenCruce,              "
			  + "   tblDctos.idDctoCruce,                   "
			  + "   (tblDctos.vrBase      +                 "
			  + "   tblDctos.vrIva       -                  "
			  + "   tblDctos.vrRteFuente -                  "
			  + "   tblDctos.vrRteIva) AS vrFactura,        "
			  + "   tblDctos.vrDescuento,                   "
			  + "   tblDctos.vrRteFuente,                   "
			  + "   (CASE WHEN                              "
			  + "         tblDctos.idTipoOrden = 1          "
			  + "   THEN    tblDctos.idDctoNitCC            "
			  + "   ELSE    STR(tblDctos.idDcto)            "
			  + "   END) AS idDctoStr,                      "
			  + "   (CASE WHEN                              "
			  + "         tblDctos.idTipoNegocio = 1        "
			  + "   THEN      'CONTADO'                     "
			  + "   ELSE      'CREDITO'                     "
			  + "   END) AS nombreTipoNegocio,              "
			  + "   tblDctos.idTipoNegocio,                 "
			  + "   ctrlUsuarios.aliasUsuario,              "
			  + "   tblTercerosRuta.nombreRuta,             "
			  + "   tblTerceroEstracto.nombreEstracto       "
			  + "                    AS nombreEstrato,      "
			  + "   tblDctosOrdenes.OBSERVACION,            "   
			  + "   tblTerceros.CC_Nit,                     "
			  + "   tblDctosPeriodo.fechaConRecargo         "
			  + "                            AS fechaVcto   "
			  + "   FROM   tblDctos                         "     
			  + "   INNER JOIN tblDctosOrdenes              "    
			  + "   ON tblDctosOrdenes.IDLOCAL              "
			  + "                    =tblDctos.IDLOCAL      "
			  + "   AND tblDctosOrdenes.IDTIPOORDEN =       "    
			  + "                tblDctos.IDTIPOORDEN       "
			  + "   AND tblDctosOrdenes.IDORDEN   =         "      
			  + "                  tblDctos.IDORDEN         "
			  + "   INNER JOIN tblTerceros                  "    
			  + "   ON tblTerceros.idLocal        =         "
			  + "                  tblDctos.IDLOCAL         "
			  + "   AND tblTerceros.idCliente     =         "        
			  + "                tblDctos.idCliente         "
			  + "   INNER JOIN tblDctosPeriodo              "
			  + "   ON tblDctosPeriodo.idLocal    =         "
			  + "                  tblDctos.idLocal         "
			  + "   AND tblDctosPeriodo.idPeriodo =         "
			  + "                tblDctos.idPeriodo         "
			  + "   INNER JOIN ctrlUsuarios                 "
			  + "   ON ctrlUsuarios.idLocal       =         "
			  + "                  tblDctos.IDLOCAL         "
			  + "   AND ctrlUsuarios.idUsuario    =         "
			  + "               tblDctos.idVendedor         "
			  + "   INNER JOIN tblTercerosRuta              "
			  + "   ON tblTercerosRuta.idLocal    =         "
			  + "               tblTerceros.IDLOCAL         "
			  + "   AND tblTercerosRuta.idRuta    =         "
			  + "                tblTerceros.idRuta         "
			  + "   INNER JOIN tblTerceroEstracto           "
			  + "   ON tblTerceroEstracto.idLocal =         "
			  + "               tblTerceros.IDLOCAL         "
			  + "   AND tblTerceroEstracto.idEstracto =     "
			  + "               tblTerceros.idEstracto      "
			  + "                  WHERE EXISTS             "                    
			  + "  ( SELECT *                               " 
			  + "    FROM   tblDctosOrdenes                 " 
			  + "    INNER JOIN tblDctosOrdenesDetalle      " 
			  + "    ON tblDctosOrdenes.IDLOCAL      =      " 
			  + "       tblDctosOrdenesDetalle.IDLOCAL      " 
			  + "    AND tblDctosOrdenes.IDTIPOORDEN =      " 
			  + "   tblDctosOrdenesDetalle.IDTIPOORDEN      "
			  + "    AND tblDctosOrdenes.IDORDEN     =      " 
			  + "       tblDctosOrdenesDetalle.IDORDEN      " 
			  + "    WHERE tblDctosOrdenes.IDLOCAL   =      " 
			  + "                     tblDctos.IDLOCAL      "
			  + "    AND tblDctosOrdenes.IDTIPOORDEN =      " 
			  + "                 tblDctos.IDTIPOORDEN      "
			  + "    AND tblDctosOrdenes.IDORDEN     =      " 
			  + "          tblDctos.IDORDEN)                "
			  + "    AND tblDctos.idLocal   =               " 
			  +" ?1                             "                
			  + "    AND tblDctos.idPeriodo =               "  
			  + "?2                           "                       
			  + " AND tblDctos.idTipoOrden  IN             ("
			  + "?3 ,                    "
			  + "?4 )                    "  
			  + " AND tblDctos.indicador BETWEEN            "
			  + "?5       AND          "
			  + "?6                     " 
			  + "    AND tblTerceros.IDTIPOTERCERO =1       "			 
			  + "    ORDER BY tblDctos.fechaDcto,           "      
			  + "             tblDctos.idTipoOrden,         "      
			  + "             tblDctos.idDcto",
              nativeQuery = true)
	  List<TblDctosDTO> listaRepNota(int idLocal, int idPeriodo, int IdTipoOrdenINI, int IdTipoOrdenFIN, int IndicadorINICIAL, int IndicadorFINNAL);
	  
	  
	  
	  
	  
	  @Query(value = "SELECT tblDctos.IDLOCAL,            "
              + "        IDTIPOORDEN,               "
              + " 	   IDORDEN,                   "
              + " 	   idDcto,                    "
              + " 	   tblDctos.idCliente,        "
              + " 	   tblTerceros.numeroMedidor, "
              + " 	   fechaDcto,                 "
              + " 	   GETDATE() AS fechaAbono,   "
              + " 	   vrBase,                    "
              + " 	   vrPago,                    "
              + "?1  AS vrAbono,         "
              + " 	    (vrBase - "
              + "?1 ) AS vrSaldo,         "
              + " 	   tblTerceros.nombreTercero, "
              + " 	   idPeriodo                  "
              + " FROM     tblDctos                 "
              + " INNER JOIN tblTerceros            "
              + " ON tblTerceros.idLocal            "
              + "                = tblDctos.IDLOCAL "
              + " AND tblTerceros.idCliente         "
              + "              = tblDctos.idCliente "
              + " WHERE tblDctos.IDLOCAL   =        "
              + "?2                    "
              + " AND IDTIPOORDEN          =        "
              + "?3                 "
              + " AND tblDctos.idCliente   =        "
              + "?4                  "
              + " AND tblDctos.idPeriodo   =        "
              + "?5 ",
              nativeQuery = true)
	  List<TblDctosDTO> listaDctoRepAbono(int ValorAbono, int idLocal, int xIdTipoOrden, String idCliente, int idPeriodo);
	  
	  
	  
	  @Query(value = "SELECT tblDctosOrdenesDetalle.IDPLU,             "
              + "       tblDctosOrdenesDetalle.NOMBREPLU,         "
              + "       tblDctosOrdenesDetalle.VRVENTAUNITARIO,   "
              + " 	  tblDctosOrdenesDetalle.idCliente,         "
              + " 	  tblTerceros.nombreTercero,                "
              + " 	  tblDctosOrdenes.idperiodo                 "
              + " FROM     tblDctosOrdenes                        "
              + " INNER JOIN tblDctosOrdenesDetalle               "
              + " ON tblDctosOrdenes.IDLOCAL      =               "
              + "                 tblDctosOrdenesDetalle.IDLOCAL  "
              + " AND tblDctosOrdenes.IDTIPOORDEN =               "
              + "             tblDctosOrdenesDetalle.IDTIPOORDEN  "
              + " AND tblDctosOrdenes.IDORDEN    =                "
              + "                 tblDctosOrdenesDetalle.IDORDEN  "
              + " INNER JOIN tblTerceros                          "
              + " ON tblTerceros.idLocal =                        "
              + "                 tblDctosOrdenesDetalle.IDLOCAL  "
              + " AND tblTerceros.idCliente =                     "
              + "               tblDctosOrdenesDetalle.idCliente  "
              + " WHERE tblDctosOrdenes.idLocal                =  "
              + "?1                                   "
              + " AND   tblDctosOrdenes.IDTIPOORDEN            =  "
              + "?2                              "
              + " AND tblDctosOrdenes.idPeriodo                =  "
              + "?3                                 "
              + " AND tblDctosOrdenesDetalle.IDTIPO NOT IN (4,6)  "
              + " AND tblDctosOrdenesDetalle.VRVENTAUNITARIO!=0   "
              + " ORDER BY tblDctosOrdenesDetalle.IDPLU,          "
              + "      tblTerceros.nombreTercero",
              nativeQuery = true)
	  List<TblDctosDTO> listaNovedad(int idLocal, int xIdTipoOrden, int idPeriodo);
	  
	  
	  @Query(value = " SELECT tblDctos.idLocal,                   "                                                       
			  + "  tblDctos.idTipoOrden,                   "
			  + "  tblDctos.idDcto,                        "
			  + "  tblDctos.idOrden,                       "
			  + "  tblDctos.fechaDcto,                     "
			  + "  MAX(tblDctos.indicador)                 "
			  + "            AS indicador,                 "    
			  + "  MAX(tblDctos.idCliente)                 "
			  + "            AS  idCliente,                "    
			  + "  MAX(tblDctos.vrBase )                   "
			  + "            AS  vrBase,                   "  
			  + "  MAX(tblDctos.vrIva)                     "
			  + "             AS    vrIva,                 "     
			  + "  MAX(tblDctos.vrCostoMV)                 "
			  + "           AS   vrCostoMV,                "
			  + "  MAX(tblDctos.nombreTercero)             "
			  + "         AS    nombreTercero,             "
			  + "  MAX(tblDctos.idDctoNitCC)               "
			  + "          AS    idDctoNitCC,              "
			  + "  MAX(tblDctos.fechaDctoNitCC)            "
			  + "           AS  fechaDctoNitCC,            "
			  + "  MAX(tblDctos.idLocalCruce)              "
			  + "            AS    idLocalCruce,           " 
			  + "  MAX(tblDctos.idTipoOrdenCruce)          "
			  + "           AS  idTipoOrdenCruce,          " 
			  + "  MAX(tblDctos.idDctoCruce)               "
			  + "                 AS  idDctoCruce,         "     
			  + "  SUM ( CANTIDAD *                        "
			  + "       VRVENTAUNITARIO)                   "
			  + " 	               AS vrFactura,         "
			  + "  MAX(tblDctos.vrDescuento)               "
			  + "                  AS vrDescuento,         "          
			  + "  MAX(tblDctos.vrRteFuente)               "
			  + "                 AS vrRteFuente ,         "          
			  + "  (CASE WHEN                              "
			  + "        tblDctos.idTipoOrden = 1          "
			  + "  THEN    MAX(tblDctos.idDctoNitCC)       "     
			  + "  ELSE    STR(tblDctos.idDcto)            "
			  + "  END) AS idDctoStr,                      "
			  + "  (CASE WHEN                              "
			  + "        MAX(tblDctos.idTipoNegocio) = 1   "     
			  + "  THEN      'CONTADO'                     "
			  + "  ELSE      'CREDITO'                     "
			  + "  END) AS nombreTipoNegocio,              "
			  + "  MAX(tblDctos.idTipoNegocio)             "
			  + "                       AS idTipoNegocio,  "               
			  + "  MAX(ctrlUsuarios.aliasUsuario)          "
			  + "                       AS aliasUsuario ,  "            
			  + "  MAX(tblTercerosRuta.nombreRuta)         "
			  + "                         AS nombreRuta ,  "           
			  + "  MAX(tblTerceroEstracto.nombreEstracto)  "      
			  + "                       AS nombreEstrato,  "    
			  + "  MAX(tblDctosOrdenes.OBSERVACION)        "
			  + "                        AS OBSERVACION,   "            
			  + "  MAX(tblTerceros.CC_Nit) AS CC_Nit ,     "                
			  + "  MAX(tblDctosPeriodo.fechaConRecargo)    "     
			  + "                           AS fechaVcto   "
			  + "  FROM   tblDctos                         "     
			  + "  INNER JOIN tblDctosOrdenes              "    
			  + "  ON tblDctosOrdenes.IDLOCAL              "
			  + "                   =tblDctos.IDLOCAL      "
			  + "  AND tblDctosOrdenes.IDTIPOORDEN =       "    
			  + "               tblDctos.IDTIPOORDEN       "
			  + "  AND tblDctosOrdenes.IDORDEN   =         "      
			  + "                 tblDctos.IDORDEN         "
			  + "                                          "
			  + "  INNER JOIN tblDctosOrdenesDetalle       "          
			  + "  ON tblDctosOrdenesDetalle.IDLOCAL       "       
			  + "                   =tblDctos.IDLOCAL      "
			  + " AND tblDctosOrdenesDetalle.IDTIPOORDEN = "           
			  + "               tblDctos.IDTIPOORDEN       "
			  + "  AND tblDctosOrdenesDetalle.IDORDEN   =  "             
			  + "                 tblDctos.IDORDEN         "
			  + "  INNER JOIN tblTerceros                  "    
			  + "  ON tblTerceros.idLocal        =         "
			  + "                 tblDctos.IDLOCAL         "
			  + "  AND tblTerceros.idCliente     =         "        
			  + "               tblDctos.idCliente         "
			  + "  INNER JOIN tblDctosPeriodo              "
			  + "  ON tblDctosPeriodo.idLocal    =         "
			  + "                 tblDctos.idLocal         "
			  + "  AND tblDctosPeriodo.idPeriodo =         "
			  + "               tblDctos.idPeriodo         "
			  + "  INNER JOIN ctrlUsuarios                 "
			  + "  ON ctrlUsuarios.idLocal       =         "
			  + "                 tblDctos.IDLOCAL         "
			  + "  AND ctrlUsuarios.idUsuario    =         "
			  + "              tblDctos.idVendedor         "
			  + "  INNER JOIN tblTercerosRuta              "
			  + "  ON tblTercerosRuta.idLocal    =         "
			  + "              tblTerceros.IDLOCAL         "
			  + "  AND tblTercerosRuta.idRuta    =         "
			  + "               tblTerceros.idRuta         "
			  + "  INNER JOIN tblTerceroEstracto           "
			  + "  ON tblTerceroEstracto.idLocal =         "
			  + "              tblTerceros.IDLOCAL         "
			  + "  AND tblTerceroEstracto.idEstracto =     "
			  + "              tblTerceros.idEstracto      "
			  + "                                          "
			  + "   WHERE                                  "
			  + "                                          "
			  + "        tblDctos.idLocal   =              "  
			  + "   ?1                                    "    
			  + "       AND tblDctos.idPeriodo =           "      
			  + "   ?2                                 "                
			  + "    AND tblDctos.idTipoOrden  IN (?3, ?4)     "                 
			  + "    AND tblDctos.indicador BETWEEN        "    
			  + "   ?5       AND                            "
			  + "   ?6                                      "
			  + "       AND tblTerceros.IDTIPOTERCERO =1   "
			  + " 	  GROUP BY tblDctos.idLocal,         "                        
			  + "      tblDctos.idTipoOrden,               "    
			  + "      tblDctos.idDcto,                    "    
			  + "      tblDctos.idOrden,                   "    
			  + "      tblDctos.fechaDcto                  "
			  + "       ORDER BY tblDctos.fechaDcto,       "          
			  + " 		       tblDctos.idTipoOrden,     "          
			  + " 			   tblDctos.idDcto           ",
              nativeQuery = true)
	  List<TblDctosDTO2> listaRepNotas(int idLocal, int idPeriodo, int IdTipoOrdenINI, int IdTipoOrdenFIN, int IndicadorINICIAL, int IndicadorFINNAL);
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                "
              + "       tmpSaldo.IDTIPOORDEN,            "
              + "       tmpSaldo.idDcto,                 "
              + "       tmpSaldo.fechaDcto,              "
              + "       tmpSaldo.idCliente,              "
              + "       tblTerceros.idRuta,              "
              + "       tblTerceros.ordenRuta,           "
              + "      MAX(tmpSaldo.vrSaldo) AS vrSaldo, "
              + "       MAX(tmpSaldo.vrPago) AS vrPago,  "
              + "       MAX(tmpSaldo.idDctoNitCC)        "
              + "                        AS idDctoNitCC, "
              + "       MAX(tblTerceros.nombreTercero)   "
              + "                      AS nombreTercero, "
              + "      MAX(tblTerceros.direccionTercero) "
              + "                   AS direccionTercero, "
              + " MAX(tblTerceroEstracto.nombreEstracto) "
              + "                      AS nombreEstrato, "
              + "      MAX(tblTercerosRuta.nombreCiclo   "
              + "                            + '-' +     "
              + "      tblTercerosRuta.nombreRuta)       "
              + "                          AS nombreRuta,"
              + "       MAX(tblTerceros.CC_Nit)          "
              + "                        AS CC_Nit       "
              + " FROM                                   "
              + " (SELECT tmpCXC.IDLOCAL,                "
              + "         tmpCXC.IDTIPOORDEN,            "
              + "         tmpCXC.idDcto,                 "
              + "         tmpCXC.idOrden,                "
              + "         tmpCXC.indicador,              "
              + "         tmpCXC.idCliente,              "
              + "         MAX(tmpCXC.idDctoNitCC)        "
              + "                        AS idDctoNitCC, "
              + "         MAX(tmpCXC.diasPlazo)          "
              + "                          AS diasPlazo, "
              + "    MIN(tmpCXC.fechaDcto) AS fechaDcto, "
              + "    MIN(tmpCXC.fechaDcto) +             "
              + "    MAX(tmpCXC.diasPlazo) AS fechaVcto, "
              + "         SUM(tmpCXC.vrBase) AS vrBase,  "
              + "         SUM(tmpCXC.vrPago) AS vrPago,  "
              + "         SUM(tmpCXC.vrIva) AS vrIva,    "
              + "         SUM(tmpCXC.vrImpoconsumo)      "
              + "                      AS vrImpoconsumo, "
              + "         SUM(tmpCXC.vrRteFuente)        "
              + "                        AS vrRteFuente, "
              + "         SUM(tmpCXC.vrDsctoFcro)        "
              + "                        AS vrDsctoFcro, "
              + "      SUM(tmpCXC.vrRteIva) AS vrRteIva, "
              + "      SUM(tmpCXC.vrRteIca) AS vrRteIca, "
              + "     (SUM(tmpCXC.vrBase)      +         "
              + "      SUM(tmpCXC.vrIva)         +       "
              + "      SUM(tmpCXC.vrImpoconsumo) -       "
              + "      SUM(tmpCXC.vrPago)        -       "
              + "      SUM(tmpCXC.vrRteFuente)   -       "
              + "      SUM(tmpCXC.vrDsctoFcro)   -       "
              + "      SUM(tmpCXC.vrRteIva)      -       "
              + "      SUM(tmpCXC.vrRteIca)) AS vrSaldo  "
              + " FROM                                   "
              + " (SELECT tblDctos.idLocalCruce          "
              + "                            AS idLocal, "
              + "         tblDctos.idTipoOrdenCruce      "
              + "                        AS idTipoOrden, "
              + "        tblDctos.idDctoCruce AS idDcto, "
              + "      tblDctos.idOrdenCruce AS idOrden, "
              + "         tblDctos.indicador,            "
              + "         tblDctos.idCliente,            "
              + "         tblDctos.vrBase,               "
              + "         tblDctos.vrPago,               "
              + "         tblDctos.vrIva,                "
              + "         tblDctos.vrImpoconsumo,        "
              + "         tblDctos.vrRteFuente,          "
              + "         tblDctos.vrDsctoFcro,          "
              + "         tblDctos.vrRteIva,             "
              + "         tblDctos.vrRteIca,             "
              + "         tblDctos.fechaDcto,            "
              + "         tblDctos.diasPlazo,            "
              + "         tblDctos.idDctoNitCC           "
              + " FROM   tblDctos                        "
              + " WHERE  tblDctos.idLocal           =    "
              + "?1                          "
              + " AND    tblDctos.idTipoOrdenCruce  =    "
              + "?2                      "
              + " AND    tblDctos.idDctoCruce      != 0  "
              + " AND    tblDctos.idPeriodo         =    "
              + "?3                        "
              + " UNION                                  "
              + " SELECT tblDctos.idLocal,               "
              + "        tblDctos.idTipoOrden,           "
              + "        tblDctos.idDcto,                "
              + "        tblDctos.idOrden,               "
              + "        tblDctos.indicador,             "
              + "        tblDctos.idCliente,             "
              + "        tblDctos.vrBase,                "
              + "        tblDctos.vrPago,                "
              + "        tblDctos.vrIva,                 "
              + "        tblDctos.vrImpoconsumo,         "
              + "        tblDctos.vrRteFuente,           "
              + "        tblDctos.vrDsctoFcro,           "
              + "        tblDctos.vrRteIva,              "
              + "        tblDctos.vrRteIca,              "
              + "        tblDctos.fechaDcto,             "
              + "        tblDctos.diasPlazo,             "
              + "        tblDctos.idDctoNitCC            "
              + " FROM   tblDctos                        "
              + " WHERE  tblDctos.idLocal           =    "
              + "?1                          "
              + " AND    tblDctos.idTipoOrden       =    "
              + "?2                      "
              + " AND    tblDctos.idDctoCruce       = 0  "
              + " AND    tblDctos.idPeriodo         =    "
              + "?3                        "
              + " UNION                                  "
              + " SELECT tblDctos.idLocal,               "
              + "        tblDctos.idTipoOrden,           "
              + "        tblDctos.idDctoCruce AS idDcto, "
              + "      tblDctos.idOrdenCruce AS idOrden, "
              + "        tblDctos.indicador,             "
              + "        tblDctos.idCliente,             "
              + "        tblDctos.vrBase,                "
              + "        tblDctos.vrPago,                "
              + "        tblDctos.vrIva,                 "
              + "        tblDctos.vrImpoconsumo,         "
              + "        tblDctos.vrRteFuente,           "
              + "        tblDctos.vrDsctoFcro,           "
              + "        tblDctos.vrRteIva,              "
              + "        tblDctos.vrRteIca,              "
              + "        tblDctos.fechaDcto,             "
              + "        tblDctos.diasPlazo,             "
              + "        tblDctos.idDctoNitCC            "
              + " FROM   tblDctos                        "
              + " WHERE  tblDctos.idLocal           =    "
              + "?1                          "
              + " AND    tblDctos.idTipoOrden       =    "
              + "?2                      "
              + " AND    tblDctos.idTipoOrdenCruce  = 0  "
              + " AND    tblDctos.idDctoCruce      != 0  "
              + " AND    tblDctos.idPeriodo         =    "
              + "?3  )  AS tmpCXC          "
              + " GROUP BY tmpCXC.IDLOCAL,               "
              + "          tmpCXC.IDTIPOORDEN,           "
              + "          tmpCXC.idDcto,                "
              + "          tmpCXC.idOrden,               "
              + "          tmpCXC.indicador,             "
              + "          tmpCXC.idCliente              "
              + " HAVING (SUM(tmpCXC.vrBase) +           "
              + "  SUM(tmpCXC.vrIva)         +           "
              + "  SUM(tmpCXC.vrImpoconsumo) -           "
              + "  SUM(tmpCXC.vrPago)        -           "
              + "  SUM(tmpCXC.vrRteFuente)   -           "
              + "  SUM(tmpCXC.vrDsctoFcro)   -           "
              + "  SUM(tmpCXC.vrRteIva)      -           "
              + "  SUM(tmpCXC.vrRteIca) ) > 1 )          "
              + "               AS tmpSaldo              "
              + " INNER JOIN tblTerceros                 "
              + " ON  tmpSaldo.idLocal    =              "
              + "                    tblTerceros.idLocal "
              + " AND tmpSaldo.idCliente  =              "
              + "                  tblTerceros.idCliente "
              + " INNER JOIN tblTerceroEstracto          "
              + " ON tblTerceros.idLocal =               "
              + "             tblTerceroEstracto.idLocal "
              + " AND tblTerceros.idEstracto =           "
              + "          tblTerceroEstracto.idEstracto "
              + " INNER JOIN tblTercerosRuta             "
              + " ON tblTerceros.idLocal =               "
              + "                tblTercerosRuta.idLocal "
              + " AND tblTerceros.idRuta =               "
              + "                tblTercerosRuta.idRuta  "
              + " AND EXISTS                             "
              + "  (SELECT *                             "
              + "   FROM   tblDctosOrdenes               "
              + "   INNER JOIN tblDctosOrdenesDetalle    "
              + "   ON tblDctosOrdenes.IDLOCAL      =    "
              + "         tblDctosOrdenesDetalle.IDLOCAL "
              + "   AND tblDctosOrdenes.IDTIPOORDEN =    "
              + "     tblDctosOrdenesDetalle.IDTIPOORDEN "
              + "   AND tblDctosOrdenes.IDORDEN     =    "
              + "         tblDctosOrdenesDetalle.IDORDEN "
              + "   WHERE tblDctosOrdenes.IDLOCAL   =    "
              + "         tblDctosOrdenesDetalle.IDLOCAL "
              + "   AND tblDctosOrdenes.IDTIPOORDEN =    "
              + "     tblDctosOrdenesDetalle.IDTIPOORDEN "
              + "   AND tblDctosOrdenes.IDORDEN =        "
              + "         tblDctosOrdenesDetalle.IDORDEN "
              + "   AND tblDctosOrdenes.idLocal  =       "
              + "                       tmpSaldo.idLocal "
              + "   AND tblDctosOrdenes.IDTIPOORDEN    = "
              + "                   tmpSaldo.IDTIPOORDEN "
              + "   AND tblDctosOrdenes.IDORDEN  =       "
              + "                      tmpSaldo.IDORDEN) "
              + " WHERE tblTerceros.idTipoTercero = 1	   "
              + " AND tblTerceros.idLocal =              "
              + "?1                            "
              + " GROUP BY tmpSaldo.idLocal,             "
              + "          tmpSaldo.IDTIPOORDEN,         "
              + "          tmpSaldo.idDcto,              "
              + "          tmpSaldo.fechaDcto,           "
              + "          tmpSaldo.fechaVcto,           "
              + "          tmpSaldo.idCliente,           "
              + "          tblTerceros.idRuta ,          "
              + "          tblTerceros.ordenRuta         "
              + " ORDER BY tblTerceros.idRuta,           "
              + " 	     tblTerceros.ordenRuta",
              nativeQuery = true)
	  List<TblDctosDTO> listaCxCPeriodoAll(int idLocal, int xIdTipoOrden, int idPeriodo);
	  
	  
	  
	  
	  @Query(value = " SELECT tmpSaldo.idLocal,                     "
              + "  tmpSaldo.IDTIPOORDEN,                       "
              + "  tmpSaldo.idDcto,                            "
              + "  tmpSaldo.fechaDcto,                         "
              + "  tmpSaldo.idCliente,                         "
              + "  tblTerceros.idRuta,                         "
              + "  tblTerceros.ordenRuta,                      "
              + "  MAX(tmpSaldo.vrSaldo) AS vrSaldo,           "
              + "  MAX(tmpSaldo.vrPago) AS vrPago,      	 "
              + "  MAX(tmpSaldo.idDctoNitCC) AS idDctoNitCC,   "
              + "  MAX(tblTerceros.nombreTercero)              "
              + "                            AS nombreTercero, "
              + "  MAX(tblTerceros.direccionTercero)           "
              + "                         AS direccionTercero, "
              + "  MAX(tblTerceroEstracto.nombreEstracto)      "
              + "                            AS nombreEstrato, "
              + "  MAX(tblTercerosRuta.nombreCiclo             "
              + "                          + '-' +             "
              + "   tblTercerosRuta.nombreRuta) AS nombreRuta  "
              + " FROM                                         "
              + " (SELECT tmpCXC.IDLOCAL,                      "
              + "         tmpCXC.IDTIPOORDEN,                  "
              + "         tmpCXC.idDcto,                       "
              + "         tmpCXC.idOrden,                      "
              + "         tmpCXC.indicador,                    "
              + "         tmpCXC.idCliente,                    "
              + "         MAX(tmpCXC.idDctoNitCC)              "
              + "                              AS idDctoNitCC, "
              + "         MAX(tmpCXC.diasPlazo) AS diasPlazo,  "
              + "         MIN(tmpCXC.fechaDcto) AS fechaDcto,  "
              + "         MIN(tmpCXC.fechaDcto) +              "
              + "          MAX(tmpCXC.diasPlazo) AS fechaVcto, "
              + "         SUM(tmpCXC.vrBase) AS vrBase,        "
              + "         SUM(tmpCXC.vrPago) AS vrPago,        "
              + "         SUM(tmpCXC.vrIva) AS vrIva,          "
              + "         SUM(tmpCXC.vrImpoconsumo)            "
              + "                            AS vrImpoconsumo, "
              + "         SUM(tmpCXC.vrRteFuente)              "
              + "                              AS vrRteFuente, "
              + "         SUM(tmpCXC.vrDsctoFcro)              "
              + "                              AS vrDsctoFcro, "
              + "         SUM(tmpCXC.vrRteIva) AS vrRteIva,    "
              + "         SUM(tmpCXC.vrRteIca) AS vrRteIca,    "
              + "        ( SUM(tmpCXC.vrBase)      +           "
              + "          SUM(tmpCXC.vrIva)         +         "
              + "          SUM(tmpCXC.vrImpoconsumo) -         "
              + "          SUM(tmpCXC.vrPago)        -         "
              + "          SUM(tmpCXC.vrRteFuente)   -         "
              + "          SUM(tmpCXC.vrDsctoFcro)   -         "
              + "          SUM(tmpCXC.vrRteIva)      -         "
              + "          SUM(tmpCXC.vrRteIca) ) AS vrSaldo   "
              + " FROM                                         "
              + " (SELECT tblDctos.idLocalCruce AS idLocal,    "
              + "         tblDctos.idTipoOrdenCruce            "
              + "                              AS idTipoOrden, "
              + "         tblDctos.idDctoCruce AS idDcto,      "
              + "         tblDctos.idOrdenCruce AS idOrden,    "
              + "         tblDctos.indicador,                  "
              + "         tblDctos.idCliente,                  "
              + "         tblDctos.vrBase,                     "
              + "         tblDctos.vrPago,                     "
              + "         tblDctos.vrIva,                      "
              + "         tblDctos.vrImpoconsumo,              "
              + "         tblDctos.vrRteFuente,                "
              + "         tblDctos.vrDsctoFcro,                "
              + "         tblDctos.vrRteIva,                   "
              + "         tblDctos.vrRteIca,                   "
              + "         tblDctos.fechaDcto,                  "
              + "         tblDctos.diasPlazo,                  "
              + "         tblDctos.idDctoNitCC                 "
              + " FROM   tblDctos                              "
              + " INNER JOIN                                   "
              + " ( SELECT tblTerceros.idLocal,                "
              + "        tblTerceros.idCliente,                "
              + "        MAX(tblDctos.idPeriodo) AS idPeriodo  "
              + "   FROM tblTerceros                           "
              + "   INNER JOIN tblDctos                        "
              + "   ON tblDctos.idLocal  = tblTerceros.idLocal "
              + "   AND tblDctos.idCliente =                   "
              + "                       tblTerceros.idCliente  "
              + "   WHERE tblTerceros.idLocal =                "
              + "?1                                "
              + "   AND tblDctos.idTipoOrden  =                "
              + "?2                            "
              + "   AND tblTerceros.estado    = 2              "
              + "   GROUP BY tblTerceros.idLocal,              "
              + "        tblTerceros.idCliente ) AS tmpTER     "
              + " ON tmpTER.idLocal = tblDctos.idLocal         "
              + " AND tmpTER.idPeriodo =  tblDctos.idPeriodo 	 "
              + " AND tmpTER.idCliente = tblDctos.idCliente 	 "
              + " WHERE  tblDctos.idLocal           =          "
              + "?1                               "
              + " AND    tblDctos.idTipoOrdenCruce  =          "
              + "?2                            "
              + " AND    tblDctos.idDctoCruce      != 0        "
              + " UNION                                        "
              + " SELECT tblDctos.idLocal,                     "
              + "    tblDctos.idTipoOrden,                     "
              + "    tblDctos.idDcto,                          "
              + "    tblDctos.idOrden,                         "
              + "    tblDctos.indicador,                       "
              + "    tblDctos.idCliente,                       "
              + "    tblDctos.vrBase,                          "
              + "    tblDctos.vrPago,                          "
              + "    tblDctos.vrIva,                           "
              + "    tblDctos.vrImpoconsumo,                   "
              + "    tblDctos.vrRteFuente,                     "
              + "    tblDctos.vrDsctoFcro,                     "
              + "    tblDctos.vrRteIva,                        "
              + "    tblDctos.vrRteIca,                        "
              + "    tblDctos.fechaDcto,                       "
              + "    tblDctos.diasPlazo,                       "
              + "    tblDctos.idDctoNitCC                      "
              + " FROM   tblDctos                              "
              + " INNER JOIN                                   "
              + " ( SELECT tblTerceros.idLocal,                "
              + "        tblTerceros.idCliente,                "
              + "        MAX(tblDctos.idPeriodo) AS idPeriodo  "
              + "   FROM tblTerceros                           "
              + "   INNER JOIN tblDctos                        "
              + "   ON tblDctos.idLocal = tblTerceros.idLocal  "
              + "   AND tblDctos.idCliente =                   "
              + "                        tblTerceros.idCliente "
              + "   WHERE tblTerceros.idLocal =                "
              + "?1                               "
              + "   AND tblDctos.idTipoOrden  =                "
              + "?2                             "
              + "   AND tblTerceros.estado    = 2              "
              + "   GROUP BY tblTerceros.idLocal,              "
              + "        tblTerceros.idCliente) AS tmpTER      "
              + " ON tmpTER.idLocal = tblDctos.idLocal         "
              + " AND tmpTER.idPeriodo = tblDctos.idPeriodo 	 "
              + " AND tmpTER.idCliente = tblDctos.idCliente 	 "
              + " WHERE  tblDctos.idLocal           =          "
              + "?1                              "
              + "  AND    tblDctos.idTipoOrden       =         "
              + "?2                            "
              + "  AND    tblDctos.idDctoCruce       = 0       "
              + "  UNION                                       "
              + "  SELECT tblDctos.idLocal,                    "
              + "   tblDctos.idTipoOrden,                      "
              + "   tblDctos.idDctoCruce AS idDcto,            "
              + "   tblDctos.idOrdenCruce AS idOrden,          "
              + "   tblDctos.indicador,                        "
              + "   tblDctos.idCliente,                        "
              + "   tblDctos.vrBase,                           "
              + "   tblDctos.vrPago,                           "
              + "   tblDctos.vrIva,                            "
              + "   tblDctos.vrImpoconsumo,                    "
              + "   tblDctos.vrRteFuente,                      "
              + "   tblDctos.vrDsctoFcro,                      "
              + "   tblDctos.vrRteIva,                         "
              + "   tblDctos.vrRteIca,                         "
              + "   tblDctos.fechaDcto,                        "
              + "   tblDctos.diasPlazo,                        "
              + "   tblDctos.idDctoNitCC                       "
              + "  FROM   tblDctos                             "
              + " INNER JOIN                                   "
              + " ( SELECT tblTerceros.idLocal,                "
              + "        tblTerceros.idCliente,                "
              + "        MAX(tblDctos.idPeriodo) AS idPeriodo  "
              + "   FROM tblTerceros                           "
              + "   INNER JOIN tblDctos                        "
              + "   ON tblDctos.idLocal  = tblTerceros.idLocal "
              + "   AND tblDctos.idCliente    =                "
              + "                        tblTerceros.idCliente "
              + "   WHERE tblTerceros.idLocal =                "
              + "?1                                "
              + "   AND tblDctos.idTipoOrden  =                "
              + "?2                           "
              + "   AND tblTerceros.estado    = 2              "
              + "   GROUP BY tblTerceros.idLocal,              "
              + "        tblTerceros.idCliente ) AS tmpTER     "
              + " ON tmpTER.idLocal = tblDctos.idLocal         "
              + " AND tmpTER.idPeriodo = tblDctos.idPeriodo 	 "
              + " AND tmpTER.idCliente =  tblDctos.idCliente 	 "
              + "  WHERE  tblDctos.idLocal           =         "
              + "?1                               "
              + "   AND    tblDctos.idTipoOrden       =        "
              + "?2                            "
              + "   AND tblDctos.idTipoOrdenCruce  = 0         "
              + "   AND tblDctos.idDctoCruce != 0 ) AS tmpCXC  "
              + "   GROUP BY tmpCXC.IDLOCAL,                   "
              + "    tmpCXC.IDTIPOORDEN,                       "
              + "    tmpCXC.idDcto,                            "
              + "    tmpCXC.idOrden,                           "
              + "    tmpCXC.indicador,                         "
              + "    tmpCXC.idCliente                          "
              + "   HAVING ( SUM(tmpCXC.vrBase) +              "
              + "    SUM(tmpCXC.vrIva)         +               "
              + "    SUM(tmpCXC.vrImpoconsumo) -               "
              + "    SUM(tmpCXC.vrPago)        -               "
              + "    SUM(tmpCXC.vrRteFuente)   -               "
              + "    SUM(tmpCXC.vrDsctoFcro)   -               "
              + "    SUM(tmpCXC.vrRteIva)      -               "
              + "    SUM(tmpCXC.vrRteIca) ) > 1 ) AS tmpSaldo  "
              + "   INNER JOIN tblTerceros                     "
              + "   ON tmpSaldo.idLocal = tblTerceros.idLocal  "
              + "   AND tmpSaldo.idCliente  =                  "
              + "                       tblTerceros.idCliente  "
              + "   INNER JOIN tblTerceroEstracto              "
              + "   ON  tblTerceros.idLocal =                  "
              + "                  tblTerceroEstracto.idLocal  "
              + "   AND  tblTerceros.idEstracto =              "
              + "               tblTerceroEstracto.idEstracto  "
              + "   INNER JOIN tblTercerosRuta                 "
              + "   ON  tblTerceros.idLocal =                  "
              + "                      tblTercerosRuta.idLocal "
              + "   AND  tblTerceros.idRuta =                  "
              + "                      tblTercerosRuta.idRuta  "
              + "   WHERE tblTerceros.idTipoTercero = 1	 "
              + "   AND tblTerceros.idLocal         =          "
              + "?1                               "
              + "   AND tblTerceros.estado          = 2        "
              + "   GROUP BY tmpSaldo.idLocal,                 "
              + "   tmpSaldo.IDTIPOORDEN,                      "
              + "   tmpSaldo.idDcto,                           "
              + "   tmpSaldo.fechaDcto,                        "
              + "   tmpSaldo.fechaVcto,                        "
              + "   tmpSaldo.idCliente,                        "
              + "   tblTerceros.idRuta ,                       "
              + "   tblTerceros.ordenRuta                      "
              + "   ORDER BY tblTerceros.idRuta,               "
              + "   	       tblTerceros.ordenRuta ",
              nativeQuery = true)
	  List<TblDctosDTO> listaCxCSuspendidoAll(int idLocal, int xIdTipoOrden);
	  
	  
	  
	  @Query(value = "SELECT tblDctos.idCliente AS idCliente,            "
              + "       MAX(tblTerceros.CC_Nit) AS CC_Nit,      "
              + "       MAX(tblTerceros.nombreTercero)         "
              + "	                 AS nombreTercero,       "
              + "	  MAX(tblTerceros.direccionTercero)      "
              + "                     AS direccionTercero,     "
              + "  CAST(SUM(tblDctosOrdenesDetalle.cantidad *  "
              + "      tblDctosOrdenesDetalle.vrVentaUnitario) "
              + "		    AS DECIMAL(16,2)) AS vrBase "
              + "FROM  tblTerceros                             "
              + "INNER JOIN tblDctos                           "
              + "ON tblTerceros.idLocal = tblDctos.IDLOCAL     "
              + "AND tblTerceros.idCliente =                   "
              + "                           tblDctos.idCliente "
              + "INNER JOIN tblDctosOrdenesDetalle             "
              + "ON tblDctosOrdenesDetalle.idLocal  =          "
              + "                             tblDctos.IDLOCAL "
              + "AND tblDctosOrdenesDetalle.idTipoOrden        "
              + "                       = tblDctos.idTipoOrden "
              + "AND tblDctosOrdenesDetalle.idOrden =          "
              + "                             tblDctos.idOrden "
              + "WHERE tblTerceros.idLocal          =          "
              + "?1                                "
              + "AND   tblDctos.IDTIPOORDEN         IN ("
              + "?2 , ?3 )             "
              + "AND   tblDctos.idPeriodo      BETWEEN "
              + "?4  AND           "
              + "?5                 "
              + "AND   tblDctos.indicador =                    "
              + "?6                       "
              + "AND tblDctosOrdenesDetalle.idTipo < 100       "
              + "GROUP BY tblDctos.idCliente                   "
              + "HAVING SUM(tblDctos.vrBase)!=0                "
              + "ORDER BY 3 ",
              nativeQuery = true)
	  List<TblDctosDTO> listaRepMediosMagneticosDian(int idLocal, int IdTipoOrdenINI, int IdTipoOrdenFIN, int IdPeriodoInicial, int IdPeriodoFinal, int Indicador);
	  
	  
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                      "
              + "       tmpSaldo.IDTIPOORDEN,                  "
              + "       tmpSaldo.idDcto,                       "
              + "       tmpSaldo.fechaDcto,                    "
              + "       tmpSaldo.fechaVcto,                    "
              + " MAX (tblTerceros.direccionTercero) AS direccionTercero,"
              + " MAX (tblTerceros.CC_Nit) AS CC_Nit,          "
              + " MAX (tmpSaldo.vrPago) AS vrPago,             "             
              + "       tmpSaldo.idCliente,                    "
              + "       tmpSaldo.diasVcto AS diasMora,         "
              + "       tmpSaldo.vrSaldo,                      "
              + "       tmpSaldo.indicador,                    "

              + "       MAX(tmpSaldo.nombreTercero)            "
              + "                            AS nombreTercero, "
              + "       DATEDIFF(DAY,tmpSaldo.fechaDcto,      "
              + "?1 ) AS edadFra,                  "
              + "       MAX(tmpSaldo.nombreVendedor)           "
              + "                            AS nombreVendedor, "
              + "       tmpSaldo.nombreRuta,                   "
              + "       tmpSaldo.nombreEstrato                 "
              + "FROM                                          "
              + "(SELECT tmpCXC.IDLOCAL,                       "
              + "        tmpCXC.IDTIPOORDEN,                   "
              + "        tmpCXC.idDcto,                        "
              + "        tmpCXC.idOrden,                       "
              + "       tmpCXC.indicador,                      "
              + "       tmpCXC.idCliente,                      "
              + "       MAX(tmpCXC.idDctoNitCC)                "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,    "
              + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,    "
              + "       MIN(tmpCXC.fechaDcto) +                "
              + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,    "
              + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) + "
              + "             MAX(tmpCXC.diasPlazo),          "
              + "?1 ) AS diasVcto,                 "
              + "       SUM(tmpCXC.vrBase) AS vrBase,          "
              + "       SUM(tmpCXC.vrPago) AS vrPago,          "
              + "       SUM(tmpCXC.vrIva) AS vrIva,            "
              + "       SUM(tmpCXC.vrImpoconsumo)              "
              + "                          AS vrImpoconsumo,   "
              + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente,"
              + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro,"
              + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,      "
              + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,      "
              + "       ( SUM(tmpCXC.vrBase)               +   "
              + "                SUM(tmpCXC.vrIva)         +   "
              + "                SUM(tmpCXC.vrImpoconsumo) -   "
              + "                SUM(tmpCXC.vrPago)        -   "
              + "                SUM(tmpCXC.vrRteFuente)   -   "
              + "                SUM(tmpCXC.vrDsctoFcro)   -   "
              + "                SUM(tmpCXC.vrRteIva)      -   "
              + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo,   "
              + "         MAX(tmpCXC.nombreTercero)            "
              + "                             AS nombreTercero,"
              + "         MAX(tmpCXC.idVendedor) AS idVendedor,"
              + "         MAX(tmpCXC.nombreVendedor)           "
              + "                            AS nombreVendedor, "
              + "         tmpCXC.nombreRuta,	                 "
              + "	   tmpCXC.nombreEstrato          	 "
              + "FROM                                          "
              + "(SELECT tblDctos.idLocalCruce                 "
              + "                      AS idLocal,             "
              + "       tblDctos.idTipoOrdenCruce              "
              + "                  AS idTipoOrden,             "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC,                  "
              + "       tblDctos.nombreTercero,                "
              + "       tblDctos.idVendedor,                   "
              + "       (SELECT ctrlUsuarios.aliasUsuario      "
              + "        FROM ctrlUsuarios                     "
              + "        WHERE ctrlUsuarios.idUsuario  =       "
              + "                        tblDctos.idVendedor   "
              + "        AND ctrlUsuarios.idLocal      =       "
              + "                           tblDctos.idLocal)  "
              + "                            AS nombreVendedor, "
              + "       (SELECT tblTercerosRuta.nombreRuta     "
              + "	   FROM tblTercerosRuta                  "
              + "	   INNER JOIN tblTerceros                "
              + "        ON tblTercerosRuta.idLocal            "
              + "			 = tblTerceros.idLocal   "
              + "	   AND tblTercerosRuta.idRuta            "
              + "	                  =tblTerceros.idRuta    "
              + "	   WHERE tblTerceros.idLocal             "
              + "			  = tblDctos.IDLOCAL     "
              + "        AND tblTerceros.idCliente             "
              + "			= tblDctos.idCliente)    "
              + "				AS nombreRuta,   "
              + "    (SELECT tblTerceroEstracto.nombreEstracto "
              + "	   FROM tblTerceroEstracto               "
              + "        INNER JOIN tblTerceros                "
              + "	   ON tblTerceroEstracto.idLocal         "
              + "		          =tblTerceros.idLocal   "
              + "	   AND tblTerceroEstracto.idEstracto     "
              + "			=tblTerceros.idEstracto  "
              + "	   WHERE tblTerceros.idLocal             "
              + "		         = tblDctos.IDLOCAL      "
              + "        AND tblTerceros.idCliente             "
              + "			= tblDctos.idCliente)    "
              + "			       AS nombreEstrato  "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?2                           "
              + "AND    tblDctos.idTipoOrdenCruce  =           "
              + "?3                       "
              + "AND    tblDctos.idDctoCruce      != 0         "
              + "AND    tblDctos.idPeriodo         =           "
              + "?4                         "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.idOrden,                      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC,                  "
              + "       tblDctos.nombreTercero,                "
              + "       tblDctos.idVendedor,                   "
              + "       (SELECT ctrlUsuarios.aliasUsuario      "
              + "        FROM ctrlUsuarios                     "
              + "        WHERE ctrlUsuarios.idUsuario  =       "
              + "                        tblDctos.idVendedor   "
              + "        AND ctrlUsuarios.idLocal      =       "
              + "                           tblDctos.idLocal)  "
              + "                            AS nombreVendedor, "
              + "       (SELECT tblTercerosRuta.nombreRuta     "
              + "	   FROM tblTercerosRuta                  "
              + "	   INNER JOIN tblTerceros                "
              + "        ON tblTercerosRuta.idLocal            "
              + "			 = tblTerceros.idLocal   "
              + "	   AND tblTercerosRuta.idRuta            "
              + "	                  =tblTerceros.idRuta    "
              + "	   WHERE tblTerceros.idLocal             "
              + "			  = tblDctos.IDLOCAL     "
              + "        AND tblTerceros.idCliente             "
              + "			= tblDctos.idCliente)    "
              + "				AS nombreRuta,   "
              + "    (SELECT tblTerceroEstracto.nombreEstracto "
              + "	   FROM tblTerceroEstracto               "
              + "        INNER JOIN tblTerceros                "
              + "	   ON tblTerceroEstracto.idLocal         "
              + "		          =tblTerceros.idLocal   "
              + "	   AND tblTerceroEstracto.idEstracto     "
              + "			=tblTerceros.idEstracto  "
              + "	   WHERE tblTerceros.idLocal             "
              + "		         = tblDctos.IDLOCAL      "
              + "        AND tblTerceros.idCliente             "
              + "			= tblDctos.idCliente)    "
              + "			       AS nombreEstrato  "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?2                          "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                       "
              + "AND    tblDctos.idDctoCruce       = 0         "
              + "AND    tblDctos.idPeriodo         =           "
              + "?4                         "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC,                  "
              + "       tblDctos.nombreTercero,                "
              + "       tblDctos.idVendedor,                   "
              + "       (SELECT ctrlUsuarios.aliasUsuario      "
              + "        FROM ctrlUsuarios                     "
              + "        WHERE ctrlUsuarios.idUsuario  =       "
              + "                        tblDctos.idVendedor   "
              + "        AND ctrlUsuarios.idLocal      =       "
              + "                           tblDctos.idLocal)  "
              + "                            AS nombreVendedor, "
              + "       (SELECT tblTercerosRuta.nombreRuta     "
              + "	   FROM tblTercerosRuta                  "
              + "	   INNER JOIN tblTerceros                "
              + "        ON tblTercerosRuta.idLocal            "
              + "			 = tblTerceros.idLocal   "
              + "	   AND tblTercerosRuta.idRuta            "
              + "	                  =tblTerceros.idRuta    "
              + "	   WHERE tblTerceros.idLocal             "
              + "			  = tblDctos.IDLOCAL     "
              + "        AND tblTerceros.idCliente             "
              + "			= tblDctos.idCliente)    "
              + "				AS nombreRuta,   "
              + "    (SELECT tblTerceroEstracto.nombreEstracto "
              + "	   FROM tblTerceroEstracto               "
              + "        INNER JOIN tblTerceros                "
              + "	   ON tblTerceroEstracto.idLocal         "
              + "		          =tblTerceros.idLocal   "
              + "	   AND tblTerceroEstracto.idEstracto     "
              + "			=tblTerceros.idEstracto  "
              + "	   WHERE tblTerceros.idLocal             "
              + "		         = tblDctos.IDLOCAL      "
              + "        AND tblTerceros.idCliente             "
              + "			= tblDctos.idCliente)    "
              + "			       AS nombreEstrato  "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?2                          "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                     "
              + "AND    tblDctos.idTipoOrdenCruce  = 0         "
              + "AND    tblDctos.idDctoCruce      != 0         "
              + "AND    tblDctos.idPeriodo         =           "
              + "?4                        "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "                          )  AS tmpCXC        "
              + "GROUP BY tmpCXC.IDLOCAL,                      "
              + "         tmpCXC.IDTIPOORDEN,                  "
              + "         tmpCXC.idDcto,                       "
              + "         tmpCXC.idOrden,                      "
              + "         tmpCXC.indicador,                    "
              + "         tmpCXC.idCliente,                     "
              + "	    tmpCXC.nombreRuta,                   "
              + "    	    tmpCXC.nombreEstrato                 "
              + "HAVING ( SUM(tmpCXC.vrBase)        +          "
              + "         SUM(tmpCXC.vrIva)         +          "
              + "         SUM(tmpCXC.vrImpoconsumo) -          "
              + "         SUM(tmpCXC.vrPago)        -          "
              + "         SUM(tmpCXC.vrRteFuente)   -          "
              + "         SUM(tmpCXC.vrDsctoFcro)   -          "
              + "         SUM(tmpCXC.vrRteIva)      -          "
              + "         SUM(tmpCXC.vrRteIca) ) < 0 )         "
              + "                              AS tmpSaldo     "
              + "INNER JOIN tblTerceros   "
              + "ON 	tblTerceros.idlocal = 	tmpSaldo.idLocal   "
              + "AND   tblTerceros.idCliente = tmpSaldo.idCliente   "
              + "AND   tblTerceros.idtipoTercero = 1   "
              
              
              + "WHERE    tmpSaldo.indicador BETWEEN           "
              + "?5 AND             "
              + "?6                   "
              + "GROUP BY tmpSaldo.idLocal,                    "
              + "         tmpSaldo.IDTIPOORDEN,                "
              + "         tmpSaldo.idDcto,                     "
              + "         tmpSaldo.fechaDcto,                  "
              + "         tmpSaldo.fechaVcto,                  "
              + "         tmpSaldo.idCliente,                  "
              + "         tmpSaldo.diasVcto,                   "
              + "         tmpSaldo.vrSaldo,                    "
              + "         tmpSaldo.indicador,                   "
              + "       tmpSaldo.nombreRuta,                   "
              + "	tmpSaldo.nombreEstrato                   "
              + "ORDER BY tmpSaldo.fechaDcto                   ",
              nativeQuery = true)
	  List<TblDctosDTO> listaSaldoFavor(String fecha, int idLocal, int IdTipoOrden, int IdPeriodo, int IndicadorInicial, int IndicadorFinal );
	  
	  
	  
	  
	  @Query(value = "SELECT idCliente " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idDcto = ?2 " +
              "AND tblDctos.IDTIPOORDEN = 9 " +
              "AND tblDctos.indicador = 1 ",
              nativeQuery = true)
	  String ObtenerIdCliente(int idLocal, int idDcto);
	  
	  
	  @Query(value = "SELECT idCliente " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDORDEN = ?2 ",
              nativeQuery = true)
	  String ObtenerIdClientePorIdOrden(int idLocal, int idOrden);
	  
	  
	  @Query(value = "SELECT MAX(tbldctos.idDcto)    "
              + "                 AS maxIdDcto  "
              + "FROM tbldctos                  "
              + "WHERE tbldctos.idLocal     =   "
              + "?1                "
              + "AND  tbldctos.idTipoOrden  =   "
              + "?2            "
              + "AND  tbldctos.indicador    = ?3  ",
              nativeQuery = true)
	    Integer maximoDctoLocalIndicador(int IDLOCAL, int IdTipoOrden, int Indicador);
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = "INSERT INTO tbldctos (idLocal,             "
              + "                      idTipoOrden,         "
              + "                      idOrden,             "
              + "                      idDcto,              "
              + "                      indicador,           "
              + "                      fechaDcto,           "
              + "                      vrBase,              "
              + "                      vrPago,              "
              + "                      idEstado,            "
              + "                      vrIva,               "
              + "                      idTipoNegocio,       "
              + "                      vrRteFuente,         "
              + "                      vrDescuento,         "
              + "                      vrRteIva,            "
              + "                      vrRteIca,            "
              + "                      nombreTercero,       "
              + "                      idUsuario,           "
              + "                      idCliente,           "
              + "                      diasPlazo,           "
              + "                      descuentoComercial,  "
              + "                      idCausa,             "
              + "                      idDctoNitCC,         " //22
              + "                      fechaDctoNitCC,      " //23
              + "                      vrPagarDctoNitCC,    "
              + "                      vrDsctoFcro,         "
              + "                      vrCostoMV,           "
              + "                      idLocalCruce,        "
              + "                      idTipoOrdenCruce,    "
              + "                      idDctoCruce,         "
              + "                      idPeriodo,           "
              + "                      idVendedor,          "
              + "                      vrImpoconsumo,       "
              + "                      vrCostoIND,          "
              + "                      idOrdenCruce,        "
              + "                      etapaSTR,            "
              + "                      envioFE)             "
              + "VALUES ( ?1,"
              + "?2,"
              + "?3,"
              + "?4,"
              + "?5,"
              + "?6,"
              + "?7,"
              + "?8,"
              + "?9,"
              + "?10,"
              + "?11,"
              + "?12,"
              + "?13,"
              + "?14,"
              + "?15,"
              + "?16,"
              + "?17,"
              + "?18,"
              + "?19,"
              + "?20,"
              + "?21,"
              + "?22,"
              + "?23,"
              + "?24,"
              + "?25,"
              + "?26,"
              + "?27,"
              + "?28,"
              + "?29,"
              + "?30,"
              + "?31,"
              + "?32,"
              + "?33,"
              + "?34,"
              + "?35,"
              + "?36)", nativeQuery = true)
	  public void ingresaDcto(int idLocal, int IdTipoOrden, int IdOrden, int IdDcto, int Indicador, String FechaDctoSqlServer, Double VrBaseSinRedondeo, int VrPago, int Estado, Double VrIva, 
			 int IdTipoNegocio, int VrRteFuente, Double VrDescuento, int VrRteIva, int VrRteIca, String NombreTercero, int IdUsuario, String IdCliente, int DiasPlazo, int PorcentajeDscto, 
			 int IdCausa, String IdDctoNitCC, String FechaDctoNitCCSqlServer, int VrPagarDctoNitCC, int VrDsctoFcro, Double VrCostoMV, int IdLocalCruce, int IdTipoOrdenCruce, int IdDctoCruce, 
			 int IdPeriodo, int IdVendedor, Double VrImpoconsumo, Double VrCostoIND, int IdOrdenCruce, int EtapaSTR, int EnvioFE);
	  
	  
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = "UPDATE tblDctos                                                     "
              + " SET vrBase = (tmpDET.vrVentaConIva - tmpDET.vrIvaVenta)            "
              + "    ,vrIva  =  tmpDET.vrIvaVenta                                    "
              + " FROM tblDctos                                                      "
              + " INNER JOIN                                                         "
              + " (SELECT tblDctosOrdenesDetalle.IDLOCAL,                            "
              + "         tblDctosOrdenesDetalle.IDTIPOORDEN,                        "
              + " 	    tblDctosOrdenesDetalle.IDORDEN,                            "
              + " 	    tblDctos_2.idPeriodo,                                      "
              + " 	    COUNT(*) AS cantidadArticulos,                             "
              + "         SUM(tblDctosOrdenesDetalle.CANTIDAD *                      "
              + " 	     tblDctosOrdenesDetalle.VRVENTAUNITARIO) AS vrVentaConIva, "
              + "         SUM((tblDctosOrdenesDetalle.CANTIDAD *                     "
              + "     		tblDctosOrdenesDetalle.VRVENTAUNITARIO)        "
              + "             / (1 + tblDctosOrdenesDetalle.PORCENTAJEIVA / 100))    "
              + " 			                             AS vrVentaSinIva, "
              + "         SUM((((tblDctosOrdenesDetalle.CANTIDAD *                   "
              + " 		           tblDctosOrdenesDetalle.VRVENTAUNITARIO) /   "
              + " 		(1 + tblDctosOrdenesDetalle.PORCENTAJEIVA / 100))      "
              + " 		* (1 - tblDctosOrdenesDetalle.VRDSCTOPIE / 100))       "
              + "             * (1 - tblDctosOrdenesDetalle.PORCENTAJEDSCTO / 100))  "
              + " 						  AS vrVentaSinDscto,  "
              + " 	    tmpIVA.vrIvaVenta                                          "
              + "  FROM tblDctos AS tblDctos_2                                       "
              + "  INNER JOIN  tblDctosOrdenesDetalle                                "
              + "  ON tblDctos_2.IDLOCAL = tblDctosOrdenesDetalle.IDLOCAL            "
              + "  AND tblDctos_2.IDTIPOORDEN = tblDctosOrdenesDetalle.IDTIPOORDEN   "
              + "  AND tblDctos_2.IDORDEN = tblDctosOrdenesDetalle.IDORDEN           "
              + "  LEFT OUTER JOIN                                                   "
              + "  (SELECT tblDctosOrdenesDetalle_1.IDLOCAL,                         "
              + " 		 tblDctosOrdenesDetalle_1.IDTIPOORDEN,                     "
              + " 		 tblDctosOrdenesDetalle_1.IDORDEN,                         "
              + " 		 SUM(((tblDctosOrdenesDetalle_1.CANTIDAD                   "
              + " 		           * tblDctosOrdenesDetalle_1.VRVENTAUNITARIO)     "
              + "          * (1 - tblDctosOrdenesDetalle_1.VRDSCTOPIE / 100))        "
              + " 	* (1 - tblDctosOrdenesDetalle_1.PORCENTAJEDSCTO / 100)) -      "
              + " 		SUM((((tblDctosOrdenesDetalle_1.CANTIDAD *                 "
              + " 					 tblDctosOrdenesDetalle_1.VRVENTAUNITARIO)     "
              + "            * (1 - tblDctosOrdenesDetalle_1.VRDSCTOPIE / 100))      "
              + " 		   * (1 - tblDctosOrdenesDetalle_1.PORCENTAJEDSCTO / 100)) "
              + " 		   / (1 + tblDctosOrdenesDetalle_1.PORCENTAJEIVA / 100))   "
              + " 		                                          AS vrIvaVenta    "
              + "   FROM tblDctos AS tblDctos_1                                      "
              + "   INNER JOIN tblDctosOrdenesDetalle AS tblDctosOrdenesDetalle_1    "
              + "   ON tblDctos_1.IDLOCAL = tblDctosOrdenesDetalle_1.IDLOCAL         "
              + "   AND tblDctos_1.IDTIPOORDEN =tblDctosOrdenesDetalle_1.IDTIPOORDEN "
              + "   AND tblDctos_1.IDORDEN = tblDctosOrdenesDetalle_1.IDORDEN        "
              + "   WHERE tblDctosOrdenesDetalle_1.IDTIPO < 100                      "
              + "   GROUP BY tblDctosOrdenesDetalle_1.IDLOCAL,                       "
              + " 		   tblDctosOrdenesDetalle_1.IDTIPOORDEN,                   "
              + " 		   tblDctosOrdenesDetalle_1.IDORDEN) AS tmpIVA             "
              + "   ON tmpIVA.IDLOCAL = tblDctosOrdenesDetalle.IDLOCAL               "
              + "   AND tmpIVA.IDTIPOORDEN = tblDctosOrdenesDetalle.IDTIPOORDEN      "
              + "   AND tmpIVA.IDORDEN = tblDctosOrdenesDetalle.IDORDEN              "
              + "   GROUP BY tblDctosOrdenesDetalle.IDLOCAL,                         "
              + " 	       tblDctosOrdenesDetalle.IDTIPOORDEN,                     "
              + " 		   tblDctosOrdenesDetalle.IDORDEN,                         "
              + " 		   tblDctos_2.idPeriodo,                                   "
              + " 		   tmpIVA.vrIvaVenta) AS tmpDET                            "
              + " ON tblDctos.IDLOCAL = tmpDET.IDLOCAL                               "
              + " AND tblDctos.IDTIPOORDEN = tmpDET.IDTIPOORDEN                      "
              + " AND tblDctos.IDORDEN = tmpDET.IDORDEN                              "
              + " WHERE  tmpDET.IDLOCAL =                                            "
              + "?1                                   "
              + " AND tmpDET.IDTIPOORDEN = "
              + "?2                               "
              + " AND tmpDET.idPeriodo = ?3 " , nativeQuery = true)
	  public void actualizaDcto(int idLocal, int IdTipoOrden, int idPeriodo);
	  
	  
	  @Query(value = "SELECT * " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idtipoorden IN (?2) " +
              "AND tblDctos.idCliente = ?3 " +
              "AND tblDctos.idPeriodo = ?4 ",
              nativeQuery = true)
	  List<TblDctosDTO> ObtenerIdDctoxPeriodo(int idLocal, List<Integer> idtipoorden, String idCliente, int idPeriodo);
	  
	  
	  
	  @Query(value = "SELECT IDORDEN " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idtipoorden = ?2 " +
              "AND tblDctos.idDcto = ?3 ",
              nativeQuery = true)
	  Integer ObtenerIdOrden(int idLocal, int idtipoorden, int idDcto);
	  
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                      "
              + "       tmpSaldo.IDTIPOORDEN,                  "
              + "       tmpSaldo.idDcto,                       "
              + "       tmpSaldo.fechaDcto,                    "
              + "       tmpSaldo.fechaVcto,                    "
              + "       tmpSaldo.diasVcto AS diasMora,         "
              + "       tmpSaldo.vrSaldo,                      "
              + "       tmpSaldo.indicador,                    "
              + "       MAX(tmpSaldo.idDctoNitCC)              "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpSaldo.idOrden) AS idOrden       "
              + "FROM                                          "
              + "(SELECT tmpCXC.IDLOCAL,                       "
              + "        tmpCXC.IDTIPOORDEN,                   "
              + "        tmpCXC.idDcto,                        "
              + "        tmpCXC.idOrden,                       "
              + "       tmpCXC.indicador,                      "
              + "       MAX(tmpCXC.idDctoNitCC)                "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,    "
              + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,    "
              + "       MIN(tmpCXC.fechaDcto) +                "
              + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,    "
              + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) + "
              + "             MAX(tmpCXC.diasPlazo),GETDATE()) "
              + "                             AS diasVcto,     "
              + "       SUM(tmpCXC.vrBase) AS vrBase,          "
              + "       SUM(tmpCXC.vrPago) AS vrPago,          "
              + "       SUM(tmpCXC.vrIva) AS vrIva,            "
              + "       SUM(tmpCXC.vrImpoconsumo)              "
              + "                          AS vrImpoconsumo,   "
              + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente,"
              + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro,"
              + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,      "
              + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,      "
              + "       ( SUM(tmpCXC.vrBase)               +   "
              + "                SUM(tmpCXC.vrIva)         +   "
              + "                SUM(tmpCXC.vrImpoconsumo) -   "
              + "                SUM(tmpCXC.vrPago)        -   "
              + "                SUM(tmpCXC.vrRteFuente)   -   "
              + "                SUM(tmpCXC.vrDsctoFcro)   -   "
              + "                SUM(tmpCXC.vrRteIva)      -   "
              + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo    "
              + "FROM                                          "
              + "(SELECT tblDctos.idLocalCruce                 "
              + "                      AS idLocal,             "
              + "       tblDctos.idTipoOrdenCruce              "
              + "                  AS idTipoOrden,             "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                                   "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrdenCruce  =           "
              + "?3                               "
              + "AND    tblDctos.idDctoCruce       =           "
              + "?4                                   "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.idOrden,                      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                                   "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                               "
              + "AND    tblDctos.idDcto            =           "
              + "?4                                    "
              + "AND    tblDctos.idDctoCruce       = 0         "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                                   "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                               "
              + "AND    tblDctos.idTipoOrdenCruce  = 0         "
              + "AND    tblDctos.idDctoCruce       =           "
              + "?4                                    "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "                          )  AS tmpCXC        "
              + "GROUP BY tmpCXC.IDLOCAL,                      "
              + "         tmpCXC.IDTIPOORDEN,                  "
              + "         tmpCXC.idDcto,                       "
              + "         tmpCXC.idOrden,                      "
              + "         tmpCXC.indicador )   AS tmpSaldo     "
              + "GROUP BY tmpSaldo.idLocal,                    "
              + "         tmpSaldo.IDTIPOORDEN,                "
              + "         tmpSaldo.idDcto,                     "
              + "         tmpSaldo.fechaDcto,                  "
              + "         tmpSaldo.fechaVcto,                  "
              + "         tmpSaldo.diasVcto,                   "
              + "         tmpSaldo.vrSaldo,                    "
              + "         tmpSaldo.indicador                   "
              + "ORDER BY tmpSaldo.fechaDcto                   ",
              nativeQuery = true)
	  List<TblDctosDTO> listaSaldoDctoFCH(int idLocal, String idCliente, String IdTipoOrden, int IdDcto);
	  
	  
	  
	  @Query(value = "SELECT tbldctos.IDLOCAL,             "
              + "       tbldctos.IDTIPOORDEN,         "
              + "       tbldctos.IDORDEN,             "
              + "       tbldctos.idDcto,              "
              + "       tbldctos.indicador,           "
              + "       tbldctos.idCliente,           "
              + "       tbldctos.fechaDcto,           "
              + "       tbldctos.vrBase,              "
              + "       tbldctos.vrPago,              "
              + "       tbldctos.idEstado,            "
              + "       tbldctos.vrIva,               "
              + "       tbldctos.idTipoNegocio,       "
              + "       tbldctos.vrRteFuente,         "
              + "       tbldctos.vrDescuento,         "
              + "       tbldctos.vrRteIva,            "
              + "       tbldctos.nombreTercero,       "
              + "       tbldctos.IDUSUARIO,           "
              + "       tbldctos.diasPlazo,           "
              + "       tbldctos.descuentoComercial,  "
              + "       tbldctos.idCausa,             "
              + "       tbldctos.idDctoNitCC,         "
              + "       tbldctos.fechaDctoNitCC,      "
              + "       tbldctos.vrPagarDctoNitCC,    "
              + "       tbldctos.vrDsctoFcro,         "
              + "       tbldctos.vrCostoMV,           "
              + "       tbldctos.idLocalCruce,        "
              + "       tbldctos.idTipoOrdenCruce,    "
              + "       tbldctos.idDctoCruce,         "
              + "       tbldctos.idPeriodo,           "
              + "       tbldctos.idVendedor,          "
              + "       tbldctos.vrImpoconsumo        "
              + "FROM tbldctos                        "
              + "WHERE tbldctos.idLocal    =          "
              + "?1                      "
              + "AND  tbldctos.idTipoOrden =          "
              + "?2                  "
              + "AND  tbldctos.idOrden     =          "
              + "?3                      "
              + "AND  tbldctos.indicador   =          "
              + "?4                    ",
              nativeQuery = true)
	  List<TblDctosDTO> listaUnDctoOrden(int idLocal, int IdTipoOrden, int IdOrden, int Indicador);
	  
	  
	  
	  @Query(value = "SELECT tblDctos.idLocal,                   "
              + "       tblDctos.idTipoOrden,               "
              + "       tblDctos.idDcto,                    "
              + "       tblDctos.fechaDcto,                 "
              + "       tblDctos.indicador,                 "
              + "       tblDctos.idCliente,                 "
              + "       tblDctos.vrBase,                    "
              + "       tblDctos.vrIva,                     "
              + "       tblDctos.vrRteFuente,               "
              + "       tblDctos.vrDescuento,               "
              + "       tblDctos.vrRteIva,                  "
              + "       tblDctos.vrRteIca,                  "
              + "       tblDctos.vrCostoMV,                 "
              + "       tblDctos.nombreTercero,             "
              + "       tblDctos.vrImpoconsumo,             "
              + "    	  tblDctos.idLocalCruce,              "
              + "       tblDctos.idTipoOrdenCruce,          "
              + "	  tblDctos.idOrdenCruce,              "
              + "       tblDctos.idDctoCruce,               "
              + "       tmpORD.diasPlazo,                   "
              + "       tmpORD.observacion,                 "
              + "       tblAgendaLogVisitas.fechaTx,        "
              + "     ( SELECT ctrlUsuarios.nombreUsuario   "
              + "       FROM   ctrlUsuarios                 "
              + "       WHERE ctrlUsuarios.idusuario =      "
              + "                 tblDctos.idVendedor       "
              + "       AND  ctrlUsuarios.idLocal =         "
              + "                     tblDctos.idLocal)     "
              + "                        AS nombreVendedor, "
              + "       tblDctos.idDctoNitCC,               "
              + "       tblDctos.fechaDctoNitCC,            "
              + "       tblDctos.cufe,                      "
              + "       tblDctos.qr                         "                
              + "FROM   tblDctos,                           "
              + "   ( SELECT MAX(tblDctosOrdenes.formaPago) "
              + "                             AS diasPlazo, "
              + "          MAX(tblDctosOrdenes.observacion) "
              + "                           AS observacion, "
              + "            tblDctosOrdenes.idLocal,       "
              + "            tblDctosOrdenes.idTipoOrden,   "
              + "            tblDctosOrdenes.idOrden,       "
              + "            tblDctosOrdenes.idLog          "
              + "     FROM   tblDctosOrdenes                "
              + "     INNER JOIN tblDctosOrdenesDetalle     "
              + "     ON tblDctosOrdenes.IDLOCAL      =     "
              + "        tblDctosOrdenesDetalle.IDLOCAL     "
              + "     AND tblDctosOrdenes.IDTIPOORDEN =     "
              + "        tblDctosOrdenesDetalle.IDTIPOORDEN "
              + "     AND tblDctosOrdenes.IDORDEN     =     "
              + "        tblDctosOrdenesDetalle.IDORDEN     "
              + "     GROUP BY tblDctosOrdenes.idLocal,     "
              + "            tblDctosOrdenes.idTipoOrden,   "
              + "            tblDctosOrdenes.idOrden,       "
              + "            tblDctosOrdenes.idLog )        "
              + "                                AS tmpORD  "
              + "INNER JOIN tblAgendaLogVisitas             "
              + "ON tblAgendaLogVisitas.idLog =          "
              + "                              tmpORD.idLog "
              + "AND tblAgendaLogVisitas.idLocal =          "
              + "                            tmpORD.idLocal "
              + "WHERE tblDctos.idLocal        =            "
              + "?1                            "
              + "AND tblDctos.idTipoOrden      =            "
              + "?2                        "
              + "AND tblDctos.idOrden          =            "
              + "?3                            "
              + "AND tblDctos.idLocal          =            "
              + "                         tmpORD.idLocal    "
              + "AND tblDctos.idTipoOrden          =        "
              + "                       tmpORD.idTipoOrden  "
              + "AND tblDctos.idOrden          =            "
              + "                           tmpORD.idOrden  ",
              nativeQuery = true)
	  List<TblDctosDTO> listaUnDctoFCH(int idLocal, int IdTipoOrden, int IdOrden);
	  
	  
	  
	  @Query(value = "SELECT tmpDcto.idCliente              "
              + "      ,SUM(tmpDcto.cuotaVencida)      "
              + "                      AS cuotaVencida "
              + "	 ,SUM(tmpDcto.vrBase) AS vrBase  "
              + "FROM                                  "
              + "(SELECT tblDctos.idCliente            "
              + "        ,tblDctosOrdenes.cuotaVencida "
              + "       ,tblDctos.vrBase               "
              + "FROM     tblDctos                     "
              + "INNER JOIN  tblDctosOrdenes           "
              + "ON tblDctos.IDLOCAL =                 "
              + "              tblDctosOrdenes.IDLOCAL "
              + "AND tblDctos.IDTIPOORDEN =            "
              + "          tblDctosOrdenes.IDTIPOORDEN "
              + "AND tblDctos.IDORDEN =                "
              + "              tblDctosOrdenes.IDORDEN "
              + "WHERE tblDctos.IDLOCAL =              "
              + "?1                  "
              + "AND tblDctos.idPeriodo =              "
              + "?2               "
              + "AND tblDctos.IDTIPOORDEN = 9          "
              + "AND tblDctos.idCliente   =            "
              + "?3               "
              + "UNION "
              + "SELECT tblDctos.idCliente             "
              + "        ,tblDctosOrdenes.cuotaVencida "
              + "       ,tblDctos.vrBase               "
              + "FROM     tblDctos                     "
              + "INNER JOIN  tblDctosOrdenes           "
              + "ON tblDctos.IDLOCAL =                 "
              + "              tblDctosOrdenes.IDLOCAL "
              + "AND tblDctos.IDTIPOORDEN =            "
              + "          tblDctosOrdenes.IDTIPOORDEN "
              + "AND tblDctos.IDORDEN =                "
              + "              tblDctosOrdenes.IDORDEN "
              + "WHERE tblDctos.IDLOCAL =              "
              + "?1                                    "
              + "AND tblDctos.idPeriodo =              "
              + "?2                      "
              + "AND tblDctos.IDTIPOORDEN = 29          "
              + "AND tblDctos.idCliente   =              "
              + "?3) AS tmpDcto   "
              + "GROUP BY tmpDcto.idCliente",
              nativeQuery = true)
	  List<TblDctosDTO> listaUnDctoClienteFCH(int idLocal, int idperiodo, String idCliente);
	  
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = "UPDATE tblDctosOrdenes          "
              + " SET cuotaVencida = 0           "
              + " FROM tblDctos                  "
              + " INNER JOIN tblDctosOrdenes     "
              + " ON tblDctos.IDLOCAL      =     "
              + "        tblDctosOrdenes.IDLOCAL "
              + " AND tblDctos.IDTIPOORDEN =     "
              + "    tblDctosOrdenes.IDTIPOORDEN "
              + " AND tblDctos.IDORDEN    =      "
              + "        tblDctosOrdenes.IDORDEN "
              + " WHERE tblDctos.IDLOCAL =       "
              + "?1                 "
              + " AND tblDctos.idPeriodo =       "
              + "?2               "
              + " AND tblDctos.IDTIPOORDEN =     "
              + "?3             "
              + " AND tblDctos.idCliente   =    "
              + "?4 " , nativeQuery = true)
	  public void actualizaUnaCuotaVencidaxAnticipo(int idLocal, int idPeriodo, int IdTipoOrden, String idCliente );
	  
	  
	  @Query(value = "SELECT IDORDEN " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.idOrdenCruce = ?2 " +
              "AND tblDctos.idCliente = ?3 ",
              nativeQuery = true)
	  Integer ObtenerIdOrdenPorCruce(int idLocal, int idOrdenCruce, String idCliente);
	  
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = " UPDATE tbldctos  "
              + "   SET vrBase =            "
              + "?1             "
              + "WHERE tbldctos.IDLOCAL   = "
              + "?2            "
              + "AND tbldctos.idTipoOrden = "
              + "?3        "
              + "AND tbldctos.idOrden   = ?4 ",
              nativeQuery = true)
	  public void modificaCobroPermanente(Double VrBase, int idLocal ,int IdTipoOrden, int IdOrden );
	  
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = " UPDATE tbldctos                                  "
              + " SET    vrBase = tmpLIQ.vrBase                    "
              + " FROM  tbldctos                                   "
              + " INNER JOIN                                       "
              + "  (SELECT tbldctosordenesdetalle.IDLOCAL,         "
              + "          tbldctosordenesdetalle.IDTIPOORDEN,     "
              + " 	     tbldctosordenesdetalle.IDORDEN,         "
              + "          SUM(tbldctosordenesdetalle.CANTIDAD *   "
              + " 	     tbldctosordenesdetalle.VRVENTAUNITARIO) "
              + " 			                  AS vrBase  "
              + " FROM            tbldctos AS tbldctos_1           "
              + " INNER JOIN  tbldctosordenesdetalle               "
              + " ON tbldctos_1.IDLOCAL      =                     "
              + "       tbldctosordenesdetalle.IDLOCAL             "
              + " AND tbldctos_1.IDTIPOORDEN =                     "
              + "    tbldctosordenesdetalle.IDTIPOORDEN            "
              + " AND tbldctos_1.IDORDEN     =                     "
              + "        tbldctosordenesdetalle.IDORDEN            "
              + " WHERE         tbldctos_1.IDLOCAL =               "
              + "?1                                   "
              + " AND  tbldctos_1.idPeriodo        =               "
              + "?2                                 "
              + " AND  tbldctos_1.idTipoOrden      =               "
              + "?3                               "
              + " AND tbldctos_1.idCliente         =              "
              + "?4                                "
              + " GROUP BY tbldctosordenesdetalle.IDLOCAL,         "
              + "          tbldctosordenesdetalle.IDTIPOORDEN,     "
              + " 		 tbldctosordenesdetalle.IDORDEN)     "
              + " 		 AS tmpLIQ                           "
              + " ON  tbldctos.IDLOCAL = tmpLIQ.IDLOCAL            "
              + " AND tbldctos.IDTIPOORDEN = tmpLIQ.IDTIPOORDEN    "
              + " AND tbldctos.IDORDEN = tmpLIQ.IDORDEN ",
              nativeQuery = true)
	  public void actualizaDctoxCliente(int idLocal ,int idPeriodo, int IdTipoOrden, String IdCliente );
	  
	  
	  
	  @Query(value = "SELECT tbldctos.IDLOCAL,             "
              + "       tbldctos.IDTIPOORDEN,         "
              + "       tbldctos.IDORDEN,             "
              + "       tbldctos.idDcto,              "
              + "       tbldctos.indicador,           "
              + "       tbldctos.idCliente,           "
              + "       tbldctos.fechaDcto,           "
              + "       tbldctos.vrBase,              "
              + "       tbldctos.vrPago,              "
              + "       tbldctos.idEstado,            "
              + "       tbldctos.vrIva,               "
              + "       tbldctos.idTipoNegocio,       "
              + "       tbldctos.vrRteFuente,         "
              + "       tbldctos.vrDescuento,         "
              + "       tbldctos.vrRteIva,            "
              + "       tbldctos.nombreTercero,       "
              + "       tbldctos.IDUSUARIO,           "
              + "       tbldctos.diasPlazo,           "
              + "       tbldctos.descuentoComercial,  "
              + "       tbldctos.idCausa,             "
              + "       tbldctos.idDctoNitCC,         "
              + "       tbldctos.fechaDctoNitCC,      "
              + "       tbldctos.vrPagarDctoNitCC,    "
              + "       tbldctos.vrDsctoFcro,         "
              + "       tbldctos.vrCostoMV,           "
              + "       tbldctos.idLocalCruce,        "
              + "       tbldctos.idTipoOrdenCruce,    "
              + "       tbldctos.idDctoCruce,         "
              + "       tbldctos.idPeriodo,           "
              + "       tbldctos.idVendedor,          "
              + "       tbldctos.vrImpoconsumo        "
              + "FROM tbldctos                        "
              + "WHERE tbldctos.idLocal    =          "
              + "?1                      "
              + "AND  tbldctos.idTipoOrden =          "
              + "?2                  "
              + "AND  tbldctos.idDcto      =          "
              + "?3                      "
              + "AND  tbldctos.idPeriodo   =   ?4       ",
              nativeQuery = true)
	  List<TblDctosDTO> listaPeriodoDcto(int idLocal, int IdTipoOrden, int IdDcto, int idperiodo);
	  
	  
	  
	  @Query(value = "SELECT tbldctos.idDcto            "
              + "FROM tbldctos                        "
              + "WHERE tbldctos.idLocal    =          "
              + "?1                      "
              + "AND  tbldctos.idTipoOrden =          "
              + "?2                  "
              + "AND  tbldctos.idDcto      =          "
              + "?3                       "
              + "AND  tbldctos.idPeriodo   =    ?4      ",
              nativeQuery = true)
	  Integer existeDctoPeriodo(int idLocal, int IdTipoOrden, int IdDcto, int idperiodo);
	  
	  
	  @Query(value = "SELECT tbldctos.vrPago      "
              + "FROM tbldctos               "
              + "WHERE tbldctos.idLocal    = "
              + "?1             "
              + "AND  tbldctos.idTipoOrden = "
              + "?2         "
              + "AND  tbldctos.idDcto      = "
              + "?3              "
              + "AND  tbldctos.idPeriodo   = "
              + "?4           "
              + "AND  tbldctos.vrPago    > 0 ",
              nativeQuery = true)
	  Integer existeVrPagoDctoPeriodo(int idLocal, int IdTipoOrden, int IdDcto, int idperiodo);
	  
	  
	  @Query(value = "SELECT tbldctos.IDLOCAL,             "
              + "       tbldctos.IDTIPOORDEN,         "
              + "       tbldctos.IDORDEN,             "
              + "       tbldctos.idDcto,              "
              + "       tbldctos.indicador,           "
              + "       tbldctos.idCliente,           "
              + "       tbldctos.fechaDcto,           "
              + "       tbldctos.vrBase,              "
              + "       tbldctos.vrPago,              "
              + "       tbldctos.idEstado,            "
              + "       tbldctos.vrIva,               "
              + "       tbldctos.idTipoNegocio,       "
              + "       tbldctos.vrRteFuente,         "
              + "       tbldctos.vrDescuento,         "
              + "       tbldctos.vrRteIva,            "
              + "       tbldctos.nombreTercero,       "
              + "       tbldctos.IDUSUARIO,           "
              + "       tbldctos.diasPlazo,           "
              + "       tbldctos.descuentoComercial,  "
              + "       tbldctos.idCausa,             "
              + "       tbldctos.idDctoNitCC,         "
              + "       tbldctos.fechaDctoNitCC,      "
              + "       tbldctos.vrPagarDctoNitCC,    "
              + "       tbldctos.vrDsctoFcro,         "
              + "       tbldctos.vrCostoMV,           "
              + "       tbldctos.idLocalCruce,        "
              + "       tbldctos.idTipoOrdenCruce,    "
              + "       tbldctos.idDctoCruce,         "
              + "       tbldctos.idPeriodo,           "
              + "       tbldctos.idVendedor,          "
              + "       tbldctos.vrImpoconsumo,       "
              + "       tbldctos.cufe                 "
              + "FROM tbldctos                        "
              + "WHERE tbldctos.idLocal    =          "
              + "?1                      "
              + "AND  tbldctos.idTipoOrden =          "
              + "?2                  "
              + "AND  tbldctos.idDcto      =          "
              + "?3                       "
              + "AND  tbldctos.indicador   =    ?4      ",
              nativeQuery = true)
	  List<TblDctosDTO> listaUnDcto(int idLocal, int IdTipoOrden, int IdDcto, int Indicador);
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = "UPDATE tbldctos                         "
              + "SET tbldctos.vrPago         =           "
              + "                tbldctos.vrPago +       "
              + "?1,                         "
              + "    tbldctos.vrRteFuente    =           "
              + "           tbldctos.vrRteFuente +       "
              + "?2,                    "
              + "    tbldctos.vrDsctoFcro    =           "
              + "           tbldctos.vrDsctoFcro +       "
              + "?3,                    "
              + "    tbldctos.vrRteIva       =           "
              + "           tbldctos.vrRteIva    +       "
              + "?4,                       "
              + "    tbldctos.vrRteIca       =           "
              + "           tbldctos.vrRteIca    +       "
              + "?5                        "
              + "WHERE tbldctos.IDLOCAL      =           "
              + "?6                         "
              + "AND   tbldctos.IDTIPOORDEN  =           "
              + "?7                     "
              + "AND   tbldctos.idDcto       =           "
              + "?8                          "
              + "AND   tbldctos.indicador    =           "
              + "?9                       ",
              nativeQuery = true)
	  public void actualizaPago(Double  VrPago ,Double VrRteFuente, Double VrDsctoFcro, Double VrRteIva, Double VrRteIca, int idLocal, int IdTipoOrden, int IdDcto, int Indicador );
	  
	  
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                      "
              + "       tmpSaldo.IDTIPOORDEN,                  "
              + "       tmpSaldo.idDcto,                       "
              + "       tmpSaldo.fechaDcto,                    "
              + "       tmpSaldo.fechaVcto,                    "
              + "       tmpSaldo.diasVcto AS diasMora,         "
              + "       tmpSaldo.vrSaldo,                      "
              + "       tmpSaldo.indicador,                    "
              + "       MAX(tmpSaldo.idDctoNitCC)              "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpSaldo.idOrden) AS idOrden       "
              + "FROM                                          "
              + "(SELECT tmpCXC.IDLOCAL,                       "
              + "        tmpCXC.IDTIPOORDEN,                   "
              + "        tmpCXC.idDcto,                        "
              + "        tmpCXC.idOrden,                       "
              + "       tmpCXC.indicador,                      "
              + "       MAX(tmpCXC.idDctoNitCC)                "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,    "
              + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,    "
              + "       MIN(tmpCXC.fechaDcto) +                "
              + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,    "
              + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) + "
              + "             MAX(tmpCXC.diasPlazo),GETDATE()) "
              + "                             AS diasVcto,     "
              + "       SUM(tmpCXC.vrBase) AS vrBase,          "
              + "       SUM(tmpCXC.vrPago) AS vrPago,          "
              + "       SUM(tmpCXC.vrIva) AS vrIva,            "
              + "       SUM(tmpCXC.vrImpoconsumo)              "
              + "                          AS vrImpoconsumo,   "
              + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente,"
              + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro,"
              + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,      "
              + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,      "
              + "       ( SUM(tmpCXC.vrBase)               +   "
              + "                SUM(tmpCXC.vrIva)         +   "
              + "                SUM(tmpCXC.vrImpoconsumo) -   "
              + "                SUM(tmpCXC.vrPago)        -   "
              + "                SUM(tmpCXC.vrRteFuente)   -   "
              + "                SUM(tmpCXC.vrDsctoFcro)   -   "
              + "                SUM(tmpCXC.vrRteIva)      -   "
              + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo    "
              + "FROM                                          "
              + "(SELECT tblDctos.idLocalCruce                 "
              + "                      AS idLocal,             "
              + "       tblDctos.idTipoOrdenCruce              "
              + "                  AS idTipoOrden,             "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrdenCruce  =           "
              + "?3                      "
              + "AND    tblDctos.idDctoCruce       =           "
              + "?4                           "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.idOrden,                      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                      "
              + "AND    tblDctos.idDcto            =           "
              + "?4                           "
              + "AND    tblDctos.idDctoCruce       = 0         "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                      "
              + "AND    tblDctos.idTipoOrdenCruce  = 0         "
              + "AND    tblDctos.idDctoCruce       =           "
              + "?4                           "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "                          )  AS tmpCXC        "
              + "GROUP BY tmpCXC.IDLOCAL,                      "
              + "         tmpCXC.IDTIPOORDEN,                  "
              + "         tmpCXC.idDcto,                       "
              + "         tmpCXC.idOrden,                      "
              + "         tmpCXC.indicador                     "
              + "HAVING ( SUM(tmpCXC.vrBase)        +          "
              + "         SUM(tmpCXC.vrIva)         +          "
              + "         SUM(tmpCXC.vrImpoconsumo) -          "
              + "         SUM(tmpCXC.vrPago)        -          "
              + "         SUM(tmpCXC.vrRteFuente)   -          "
              + "         SUM(tmpCXC.vrDsctoFcro)   -          "
              + "         SUM(tmpCXC.vrRteIva)      -          "
              + "         SUM(tmpCXC.vrRteIca) ) > 1 )         "
              + "                              AS tmpSaldo     "
              + "GROUP BY tmpSaldo.idLocal,                    "
              + "         tmpSaldo.IDTIPOORDEN,                "
              + "         tmpSaldo.idDcto,                     "
              + "         tmpSaldo.fechaDcto,                  "
              + "         tmpSaldo.fechaVcto,                  "
              + "         tmpSaldo.diasVcto,                   "
              + "         tmpSaldo.vrSaldo,                    "
              + "         tmpSaldo.indicador                   "
              + "ORDER BY tmpSaldo.fechaDcto                   ",
              nativeQuery = true)
	  List<TblDctosDTO> listaCuentaDetalladoClienteFCH(int idLocal, String idCliente, int IdTipoOrden, int IdDcto);
	  
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                      "
              + "       tmpSaldo.IDTIPOORDEN,                  "
              + "       tmpSaldo.idDcto,                       "
              + "       tmpSaldo.fechaDcto,                    "
              + "       tmpSaldo.fechaVcto,                    "
              + "       tmpSaldo.diasVcto AS diasMora,         "
              + "       tmpSaldo.vrSaldo,                      "
              + "       tmpSaldo.indicador,                    "
              + "       MAX(tmpSaldo.idDctoNitCC)              "
              + "                             AS idDctoNitCC,  "
              + "       tmpSaldo.idOrden                       "
              + "FROM                                          "
              + "(SELECT tmpCXC.IDLOCAL,                       "
              + "        tmpCXC.IDTIPOORDEN,                   "
              + "        tmpCXC.idDcto,                        "
              + "        tmpCXC.idOrden,                       "
              + "       tmpCXC.indicador,                      "
              + "       MAX(tmpCXC.idDctoNitCC)                "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,    "
              + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,    "
              + "       MIN(tmpCXC.fechaDcto) +                "
              + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,    "
              + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) + "
              + "             MAX(tmpCXC.diasPlazo),GETDATE()) "
              + "                             AS diasVcto,     "
              + "       SUM(tmpCXC.vrBase) AS vrBase,          "
              + "       SUM(tmpCXC.vrPago) AS vrPago,          "
              + "       SUM(tmpCXC.vrIva) AS vrIva,            "
              + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente,"
              + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro,"
              + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,      "
              + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,      "
              + "       ( SUM(tmpCXC.vrBase)               +   "
              + "                SUM(tmpCXC.vrIva)         +   "
              + "                SUM(tmpCXC.vrImpoconsumo) -   "
              + "                SUM(tmpCXC.vrPago)        -   "
              + "                SUM(tmpCXC.vrRteFuente)   -   "
              + "                SUM(tmpCXC.vrDsctoFcro)   -   "
              + "                SUM(tmpCXC.vrRteIva)      -   "
              + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo    "
              + "FROM                                          "
              + "(SELECT tblDctos.idLocalCruce                 "
              + "                      AS idLocal,             "
              + "       tblDctos.idTipoOrdenCruce              "
              + "                  AS idTipoOrden,             "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrdenCruce  =           "
              + "?3                     "
              + "AND    tblDctos.idDctoCruce      != 0         "
              + "AND    tblDctos.idPeriodo         =           "
              + "?4                           "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.idOrden,                      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                         "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                     "
              + "AND    tblDctos.idDctoCruce       = 0         "
              + "AND    tblDctos.idPeriodo         =           "
              + "?4                            "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "     AND tblDctosOrdenesDetalle.idTipoOrden = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =           "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                      "
              + "AND    tblDctos.idTipoOrdenCruce  = 0         "
              + "AND    tblDctos.idDctoCruce      != 0         "
              + "AND    tblDctos.idPeriodo         =           "
              + "?4                             "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "                          )  AS tmpCXC        "
              + "GROUP BY tmpCXC.IDLOCAL,                      "
              + "         tmpCXC.IDTIPOORDEN,                  "
              + "         tmpCXC.idDcto,                       "
              + "         tmpCXC.idOrden,                      "
              + "         tmpCXC.indicador                     "
              + "HAVING ( SUM(tmpCXC.vrBase)        +          "
              + "         SUM(tmpCXC.vrIva)         +          "
              + "         SUM(tmpCXC.vrImpoconsumo) -          "
              + "         SUM(tmpCXC.vrPago)        -          "
              + "         SUM(tmpCXC.vrRteFuente)   -          "
              + "         SUM(tmpCXC.vrDsctoFcro)   -          "
              + "         SUM(tmpCXC.vrRteIva)      -          "
              + "         SUM(tmpCXC.vrRteIca) ) > 1 )         "
              + "                              AS tmpSaldo     "
              + "GROUP BY tmpSaldo.idLocal,                    "
              + "         tmpSaldo.IDTIPOORDEN,                "
              + "         tmpSaldo.idDcto,                     "
              + "         tmpSaldo.idOrden,                    "
              + "         tmpSaldo.fechaDcto,                  "
              + "         tmpSaldo.fechaVcto,                  "
              + "         tmpSaldo.diasVcto,                   "
              + "         tmpSaldo.vrSaldo,                    "
              + "         tmpSaldo.indicador                   "
              + "ORDER BY tmpSaldo.fechaDcto                   ",
              nativeQuery = true)
	  List<TblDctosDTO> listaCuentaPeriodoCliente(int idLocal, String idCliente, int IdTipoOrden, int idPeriodo);
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                      "
              + "       tmpSaldo.IDTIPOORDEN,                  "
              + "       tmpSaldo.idDcto,                       "
              + "       tmpSaldo.fechaDcto,                    "
              + "       tmpSaldo.fechaVcto,                    "
              + "       tmpSaldo.diasVcto AS diasMora,         "
              + "       tmpSaldo.vrSaldo,                      "
              + "       tmpSaldo.indicador,                    "
              + "       MAX(tmpSaldo.idDctoNitCC)              "
              + "                             AS idDctoNitCC   "
              + "FROM                                          "
              + "(SELECT tmpCXC.IDLOCAL,                       "
              + "        tmpCXC.IDTIPOORDEN,                   "
              + "        tmpCXC.idDcto,                        "
              + "        tmpCXC.idOrden,                       "
              + "       tmpCXC.indicador,                      "
              + "       MAX(tmpCXC.idDctoNitCC)                "
              + "                             AS idDctoNitCC,  "
              + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,    "
              + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,    "
              + "       MIN(tmpCXC.fechaDcto) +                "
              + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,    "
              + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) + "
              + "             MAX(tmpCXC.diasPlazo),GETDATE()) "
              + "                             AS diasVcto,     "
              + "       SUM(tmpCXC.vrBase) AS vrBase,          "
              + "       SUM(tmpCXC.vrPago) AS vrPago,          "
              + "       SUM(tmpCXC.vrIva) AS vrIva,            "
              + "       SUM(tmpCXC.vrImpoconsumo)              "
              + "                          AS vrImpoconsumo,   "
              + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente,"
              + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro,"
              + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,      "
              + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,      "
              + "       ( SUM(tmpCXC.vrBase)               +   "
              + "                SUM(tmpCXC.vrIva)         +   "
              + "                SUM(tmpCXC.vrImpoconsumo) -   "
              + "                SUM(tmpCXC.vrPago)        -   "
              + "                SUM(tmpCXC.vrRteFuente)   -   "
              + "                SUM(tmpCXC.vrDsctoFcro)   -   "
              + "                SUM(tmpCXC.vrRteIva)      -   "
              + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo    "
              + "FROM                                          "
              + "(SELECT tblDctos.idLocalCruce                 "
              + "                      AS idLocal,             "
              + "       tblDctos.idTipoOrdenCruce              "
              + "                  AS idTipoOrden,             "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrdenCruce  =           "
              + "?3                      "
              + "AND    tblDctos.idDctoCruce       =           "
              + "?4                           "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.idOrden,                      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                      "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                      "
              + "AND    tblDctos.idDcto            =           "
              + "?4                           "
              + "AND    tblDctos.idDctoCruce       = 0         "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "UNION                                         "
              + "SELECT tblDctos.idLocal,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.idDctoCruce                   "
              + "                      AS idDcto,              "
              + "       tblDctos.idOrdenCruce AS idOrden,      "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.idCliente,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrPago,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDsctoFcro,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.diasPlazo,                    "
              + "       tblDctos.idDctoNitCC                   "
              + "FROM   tblDctos                               "
              + "WHERE  tblDctos.idLocal           =           "
              + "?1                          "
              + "AND   tblDctos.idCliente          =          "
              + "?2                       "
              + "AND    tblDctos.idTipoOrden       =           "
              + "?3                      "
              + "AND    tblDctos.idTipoOrdenCruce  = 0         "
              + "AND    tblDctos.idDctoCruce       =           "
              + "?4                           "
              + "AND    EXISTS (                               "
              + "       SELECT *                               "
              + "       FROM tblDctosOrdenesDetalle            "
              + "       WHERE tblDctosOrdenesDetalle.idLocal = "
              + "                            tblDctos.idLocal  "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden "
              + "                                            = "
              + "                       tblDctos.idTipoOrden   "
              + "      AND  tblDctosOrdenesDetalle.idOrden   = "
              + "                           tblDctos.idOrden ) "
              + "                          )  AS tmpCXC        "
              + "GROUP BY tmpCXC.IDLOCAL,                      "
              + "         tmpCXC.IDTIPOORDEN,                  "
              + "         tmpCXC.idDcto,                       "
              + "         tmpCXC.idOrden,                      "
              + "         tmpCXC.indicador                     "
              + "HAVING ( SUM(tmpCXC.vrBase)        +          "
              + "         SUM(tmpCXC.vrIva)         +          "
              + "         SUM(tmpCXC.vrImpoconsumo) -          "
              + "         SUM(tmpCXC.vrPago)        -          "
              + "         SUM(tmpCXC.vrRteFuente)   -          "
              + "         SUM(tmpCXC.vrDsctoFcro)   -          "
              + "         SUM(tmpCXC.vrRteIva)      -          "
              + "         SUM(tmpCXC.vrRteIca) ) > 1 )         "
              + "                              AS tmpSaldo     "
              + "GROUP BY tmpSaldo.idLocal,                    "
              + "         tmpSaldo.IDTIPOORDEN,                "
              + "         tmpSaldo.idDcto,                     "
              + "         tmpSaldo.fechaDcto,                  "
              + "         tmpSaldo.fechaVcto,                  "
              + "         tmpSaldo.diasVcto,                   "
              + "         tmpSaldo.vrSaldo,                    "
              + "         tmpSaldo.indicador                   "
              + "ORDER BY tmpSaldo.fechaDcto                   ",
              nativeQuery = true)
	  List<TblDctosDTO> listaCuentaDetalladoOrdenFCH(int idLocal, String idCliente, int IdTipoOrden, int idcto);
	  
	  
	  @Query(value = "SELECT tmpSaldo.idLocal,                       "
              + "       tmpSaldo.IDTIPOORDEN,                   "
              + "       tmpSaldo.idCliente,                     "
              + "       tmpSaldo.idDcto,                        "
              + "       tmpSaldo.idOrden,                       "
              + "       tmpSaldo.fechaDcto,                     "
              + "       tmpSaldo.fechaVcto,                     "
              + "       tmpSaldo.diasVcto AS diasMora,          "
              + "       tmpSaldo.vrSaldo,                       "
              + "       tmpSaldo.indicador,                     "
              + "       MAX(tmpSaldo.idDctoNitCC)               "
              + "                             AS idDctoNitCC,   "
              + "       (SELECT TOP 1 tblTerceros.nombreTercero "
              + "        FROM    tblTerceros                    "
              + "        WHERE   tblTerceros.idCliente =        "
              + "                          tmpSaldo.idCliente   "
              + "        AND   tblTerceros.idLocal   =          "
              + "                          tmpSaldo.idLocal)  "
              + "                              AS nombreTercero "
              + "FROM                                           "
              + "(SELECT tmpCXC.IDLOCAL,                        "
              + "        tmpCXC.IDTIPOORDEN,                    "
              + "        tmpCXC.idDcto,                         "
              + "        tmpCXC.idOrden,                        "
              + "       tmpCXC.indicador,                       "
              + "       MAX(tmpCXC.idCliente) AS idCliente,     "
              + "       MAX(tmpCXC.idDctoNitCC)                 "
              + "                             AS idDctoNitCC,   "
              + "       MAX(tmpCXC.diasPlazo) AS diasPlazo,     "
              + "       MIN(tmpCXC.fechaDcto) AS fechaDcto,     "
              + "       MIN(tmpCXC.fechaDcto) +                 "
              + "       MAX(tmpCXC.diasPlazo) AS fechaVcto,     "
              + "       DATEDIFF(DAY,  MIN(tmpCXC.fechaDcto) +  "
              + "             MAX(tmpCXC.diasPlazo),GETDATE())  "
              + "                             AS diasVcto,      "
              + "       SUM(tmpCXC.vrBase) AS vrBase,           "
              + "       SUM(tmpCXC.vrPago) AS vrPago,           "
              + "       SUM(tmpCXC.vrIva) AS vrIva,             "
              + "       SUM(tmpCXC.vrRteFuente) AS vrRteFuente, "
              + "       SUM(tmpCXC.vrDsctoFcro) AS vrDsctoFcro, "
              + "       SUM(tmpCXC.vrRteIva) AS vrRteIva,       "
              + "       SUM(tmpCXC.vrRteIca) AS vrRteIca,       "
              + "       SUM(tmpCXC.vrImpoconsumo)               "
              + "                          AS vrImpoconsumo,    "
              + "       ( SUM(tmpCXC.vrBase)               +    "
              + "                SUM(tmpCXC.vrIva)         +    "
              + "                SUM(tmpCXC.vrImpoconsumo) -    "
              + "                SUM(tmpCXC.vrPago)        -    "
              + "                SUM(tmpCXC.vrRteFuente)   -    "
              + "                SUM(tmpCXC.vrDsctoFcro)   -    "
              + "                SUM(tmpCXC.vrRteIva)      -    "
              + "         SUM(tmpCXC.vrRteIca) ) AS vrSaldo     "
              + "FROM                                           "
              + "( SELECT tblDctos.idLocal,             	"
              + "       tblDctos.idTipoOrden,                   "
              + "       tblDctos.idDcto,              	        "
              + "       tblDctos.idOrden,              	        "
              + "       tblDctos.indicador,                     "
              + "       tblDctos.idCliente,                     "
              + "       tblDctos.vrBase,                        "
              + "       tblDctos.vrPago,                        "
              + "       tblDctos.vrIva,                         "
              + "       tblDctos.vrImpoconsumo,                 "
              + "       tblDctos.vrRteFuente,                   "
              + "       tblDctos.vrDsctoFcro,                   "
              + "       tblDctos.vrRteIva,                      "
              + "       tblDctos.vrRteIca,                      "
              + "       tblDctos.fechaDcto,                     "
              + "       tblDctos.diasPlazo,                     "
              + "       tblDctos.idDctoNitCC                    "
              + "FROM   tblDctos                                "
              + "WHERE  tblDctos.idLocal           =            "
              + "?1                          "
              + "AND    tblDctos.idTipoOrden       =            "
              + "?2                       "
              + "AND    tblDctos.idDctoCruce       =   0        "
              + "AND    EXISTS (                                "
              + "       SELECT *                                "
              + "       FROM tblDctosOrdenesDetalle             "
              + "       WHERE tblDctosOrdenesDetalle.idLocal =  "
              + "                            tblDctos.idLocal   "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden  "
              + "                                            =  "
              + "                       tblDctos.idTipoOrden    "
              + "      AND  tblDctosOrdenesDetalle.idOrden   =  "
              + "                           tblDctos.idOrden )  "
              + "AND    EXISTS (SELECT tblPagos.*	        "
              + "               FROM   tblPagos		        "
              + "               INNER JOIN tblPagosMedios       "
              + "               ON  tblPagos.idLocal      =     "
              + "                       tblPagosMedios.idLocal  "
              + "               AND tblPagos.idTipoOrden  =     "
              + "                   tblPagosMedios.idTipoOrden  "
              + "               AND tblPagos.idRecibo     =     "
              + "                      tblPagosMedios.idRecibo  "
              + "               AND tblPagos.indicador    =     "
              + "                     tblPagosMedios.indicador  "
              + "               WHERE tblPagos.idLocal     =    "
              + "                             tblDctos.idLocal  "
              + "               AND   tblPagos.idTipoOrden =    "
              + "                  (tblDctos.idTipoOrden + 50)  "
              + "               AND   tblPagos.idDcto      =    "
              + "                             tblDctos.idDcto   "
              + "               AND   tblPagos.indicador   =    "
              + "                           tblDctos.indicador  "
              + "               AND   tblPagos.nitCC   =        "
              + "                            tblDctos.idCliente "
              + "               AND   tblPagos.idLog       =    "
              +"?3                             "
              + "               AND   tblPagos.idLocal     =    "
              + "?1                          "
              + "               AND   tblPagos.idTipoOrden =    "
              + "?2 + 50 )                "
              + " UNION				                "
              + " SELECT tblDctos.idLocalCruce                  "
              + "                      AS idLocal,              "
              + "       tblDctos.idTipoOrdenCruce               "
              + "                  AS idTipoOrden,              "
              + "       tblDctos.idDctoCruce                    "
              + "                      AS idDcto,               "
              + "       tblDctos.idOrdenCruce AS idOrden,       "
              + "       tblDctos.indicador,                     "
              + "       tblDctos.idCliente,                     "
              + "       tblDctos.vrBase,                        "
              + "       tblDctos.vrPago,                        "
              + "       tblDctos.vrIva,                         "
              + "       tblDctos.vrImpoconsumo,                 "
              + "       tblDctos.vrRteFuente,                   "
              + "       tblDctos.vrDsctoFcro,                   "
              + "       tblDctos.vrRteIva,                      "
              + "       tblDctos.vrRteIca,                      "
              + "       tblDctos.fechaDcto,                     "
              + "       tblDctos.diasPlazo,                     "
              + "       tblDctos.idDctoNitCC                    "
              + "FROM   tblDctos                                "
              + "WHERE  tblDctos.idLocal           =            "
              + "?1                          "
              + "AND    tblDctos.idTipoOrdenCruce  =            "
              + "?2                       "
              + "AND    tblDctos.idDctoCruce      != 0          "
              + "AND    EXISTS (                                "
              + "       SELECT *                                "
              + "       FROM tblDctosOrdenesDetalle             "
              + "       WHERE tblDctosOrdenesDetalle.idLocal =  "
              + "                            tblDctos.idLocal   "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden  "
              + "                                            =  "
              + "                       tblDctos.idTipoOrden    "
              + "      AND  tblDctosOrdenesDetalle.idOrden   =  "
              + "                           tblDctos.idOrden )  "
              + "AND    EXISTS (SELECT tblPagos.*	          "
              + "               FROM   tblPagos		   "
              + "               INNER JOIN tblPagosMedios       "
              + "               ON  tblPagos.idLocal      =     "
              + "                       tblPagosMedios.idLocal  "
              + "               AND tblPagos.idTipoOrden  =     "
              + "                   tblPagosMedios.idTipoOrden  "
              + "               AND tblPagos.idRecibo     =     "
              + "                      tblPagosMedios.idRecibo  "
              + "               AND tblPagos.indicador    =     "
              + "                     tblPagosMedios.indicador  "
              + "               WHERE tblPagos.idLocal     =    "
              + "                         tblDctos.idLocalCruce "
              + "               AND   tblPagos.idTipoOrden =    "
              + "               (tblDctos.idTipoOrdenCruce + 50)"
              + "               AND   tblPagos.idDcto      =    "
              + "                         tblDctos.idDctoCruce  "
              + "               AND   tblPagos.indicador   =    "
              + "                           tblDctos.indicador  "
              + "               AND   tblPagos.nitCC   =        "
              + "                            tblDctos.idCliente "
              + "               AND   tblPagos.idLog       =    "
              + "?3                             "
              + "               AND   tblPagos.idLocal     =    "
              + "?1                           "
              + "               AND   tblPagos.idTipoOrden =    "
              + "?2 + 50 )                "
              + "UNION					        "
              + "SELECT tblDctos.idLocal,                       "
              + "       tblDctos.idTipoOrden,                   "
              + "       tblDctos.idDctoCruce                    "
              + "                      AS idDcto,               "
              + "       tblDctos.idOrdenCruce AS idOrden,       "
              + "       tblDctos.indicador,                     "
              + "       tblDctos.idCliente,                     "
              + "       tblDctos.vrBase,                        "
              + "       tblDctos.vrPago,                        "
              + "       tblDctos.vrIva,                         "
              + "       tblDctos.vrImpoconsumo,                 "
              + "       tblDctos.vrRteFuente,                   "
              + "       tblDctos.vrDsctoFcro,                   "
              + "       tblDctos.vrRteIva,                      "
              + "       tblDctos.vrRteIca,                      "
              + "       tblDctos.fechaDcto,                     "
              + "       tblDctos.diasPlazo,                     "
              + "       tblDctos.idDctoNitCC                    "
              + "FROM   tblDctos                                "
              + "WHERE  tblDctos.idLocal           =            "
              + "?1                           "
              + "AND    tblDctos.idTipoOrden       =            "
              + "?2                       "
              + "AND    tblDctos.idDctoCruce      != 0          "
              + "AND    EXISTS (                                "
              + "       SELECT *                                "
              + "       FROM tblDctosOrdenesDetalle             "
              + "       WHERE tblDctosOrdenesDetalle.idLocal =  "
              + "                            tblDctos.idLocal   "
              + "       AND tblDctosOrdenesDetalle.idTipoOrden  "
              + "                                            =  "
              + "                       tblDctos.idTipoOrden    "
              + "      AND  tblDctosOrdenesDetalle.idOrden   =  "
              + "                           tblDctos.idOrden )  "
              + "AND    EXISTS (SELECT tblPagos.*	        "
              + "               FROM   tblPagos		        "
              + "               INNER JOIN tblPagosMedios       "
              + "               ON  tblPagos.idLocal      =     "
              + "                       tblPagosMedios.idLocal  "
              + "               AND tblPagos.idTipoOrden  =     "
              + "                   tblPagosMedios.idTipoOrden  "
              + "               AND tblPagos.idRecibo     =     "
              + "                      tblPagosMedios.idRecibo  "
              + "               AND tblPagos.indicador    =     "
              + "                     tblPagosMedios.indicador  "
              + "               WHERE tblPagos.idLocal     =    "
              + "                         tblDctos.idLocalCruce "
              + "               AND   tblPagos.idTipoOrden =    "
              + "                   (tblDctos.idTipoOrden + 50) "
              + "               AND   tblPagos.idDcto      =    "
              + "                         tblDctos.idDctoCruce  "
              + "               AND   tblPagos.indicador   =    "
              + "                           tblDctos.indicador  "
              + "               AND   tblPagos.nitCC   =        "
              + "                            tblDctos.idCliente "
              + "               AND   tblPagos.idLog       =    "
              + "?3                             "
              + "               AND   tblPagos.idLocal     =    "
              + "?1                           "
              + "               AND   tblPagos.idTipoOrden =    "
              + "?2 + 50 ) )    AS tmpCXC "
              + "GROUP BY tmpCXC.IDLOCAL,                       "
              + "         tmpCXC.IDTIPOORDEN,                   "
              + "         tmpCXC.idDcto,                        "
              + "         tmpCXC.idOrden,                       "
              + "         tmpCXC.indicador                      "
              + "HAVING ( SUM(tmpCXC.vrBase)        +           "
              + "         SUM(tmpCXC.vrIva)         +           "
              + "         SUM(tmpCXC.vrImpoconsumo) -           "
              + "         SUM(tmpCXC.vrPago)        -           "
              + "         SUM(tmpCXC.vrRteFuente)   -           "
              + "         SUM(tmpCXC.vrDsctoFcro)   -           "
              + "         SUM(tmpCXC.vrRteIva)      -           "
              + "         SUM(tmpCXC.vrRteIca) ) > 1 )          "
              + "                              AS tmpSaldo      "
              + "GROUP BY tmpSaldo.idLocal,                     "
              + "         tmpSaldo.IDTIPOORDEN,                 "
              + "         tmpSaldo.idDcto,                      "
              + "         tmpSaldo.idOrden,                     "
              + "         tmpSaldo.fechaDcto,                   "
              + "         tmpSaldo.fechaVcto,                   "
              + "         tmpSaldo.diasVcto,                    "
              + "         tmpSaldo.vrSaldo,                     "
              + "         tmpSaldo.indicador,                   "
              + "         tmpSaldo.idCliente                    "
              + "ORDER BY tmpSaldo.fechaDcto                    ",
              nativeQuery = true)
	  List<TblDctosDTO> listaCuentaPlanilla(int idLocal, int IdTipoOrden, int idLog);
	  
	  
	  
	  @Query(value = "SELECT tbldctos.IDLOCAL,             "
              + "       tbldctos.IDTIPOORDEN,         "
              + "       tbldctos.IDORDEN,             "
              + "       tbldctos.idDcto,              "
              + "       tbldctos.indicador,           "
              + "       tbldctos.idCliente,           "
              + "       tbldctos.fechaDcto,           "
              + "       tbldctos.vrBase,              "
              + "       tbldctos.vrPago,              "
              + "       tbldctos.idEstado,            "
              + "       tbldctos.vrIva,               "
              + "       tbldctos.idTipoNegocio,       "
              + "       tbldctos.vrRteFuente,         "
              + "       tbldctos.vrDescuento,         "
              + "       tbldctos.vrRteIva,            "
              + "       tbldctos.nombreTercero,       "
              + "       tbldctos.IDUSUARIO,           "
              + "       tbldctos.diasPlazo,           "
              + "       tbldctos.descuentoComercial,  "
              + "       tbldctos.idCausa,             "
              + "       tbldctos.idDctoNitCC,         "
              + "       tbldctos.fechaDctoNitCC,      "
              + "       tbldctos.vrPagarDctoNitCC,    "
              + "       tbldctos.vrDsctoFcro,         "
              + "       tbldctos.vrCostoMV,           "
              + "       tbldctos.idLocalCruce,        "
              + "       tbldctos.idTipoOrdenCruce,    "
              + "       tbldctos.idDctoCruce,         "
              + "       tbldctos.idPeriodo,           "
              + "       tbldctos.idVendedor,          "
              + "       tbldctos.vrImpoconsumo,       "
              + "       tbldctos.cufe                 "
              + "FROM tbldctos                        "
              + "WHERE tbldctos.idLocal    =          "
              + "?1                     "
              + "AND  tbldctos.idTipoOrden =          "
              + "?2                  "
              + "AND  tbldctos.idCliente      =      "
              + "?3                   "
              + "AND  tbldctos.idPeriodo   =    ?4      ",
              nativeQuery = true)
	  List<TblDctosDTO> listaUnDctoPeriodoCliente(int idLocal, int IdTipoOrden, String IdCliente, int idPeriodo);
	  
	  
	  
	  @Query(value = "    SELECT 11 AS idTipoNegocio,                                    "          
	            + "     tblDctos.idDcto    AS idDctoNitCC,                            "          
	            + "     MAX(tblDctosPeriodo.fechaFinal)                               "          
	            + "                             AS fechaDctoSiigo,                    "          
	            + "     'COP' AS  SiglaMoneda,                                        "          
	            + "     tmpCAT.cuentaContableCredito                                  "          
	            + "                            AS idSubcuenta,                        "          
	            + "     MAX(tblTerceros.CC_Nit) AS idCliente, 	                       "          
	            + "     0.0 AS vrDebito,  		                                       "          
	            + "      ROUND(SUM(tblDctosOrdenesDetalle.cantidad *                  "          
	            + "       vrVentaUnitario),2)  AS vrCredito,                          "          
	            + "      MAX(tblDctos.nombreTercero) AS observacion,                  "          
	            + "      '' AS textoVacio,                                            "          
	            + "      MAX(tblTerceros.idRuta) AS idRuta,                           "          
				+ " 	 tmpCAT.idPlu                                                  "          
	            + "      FROM       tblDctosOrdenesDetalle                            "          
	            + "      INNER JOIN tblDctos                                          "          
	            + "      ON tblDctos.idLocal =                                        "          
	            + "                   tblDctosOrdenesDetalle.IDLOCAL                  "          
	            + "      AND tblDctos.idtipoorden =                                   "          
	            + "                   tblDctosOrdenesDetalle.idtipoorden              "          
	            + "      AND tblDctos.idorden    =                                    "          
	            + "                   tblDctosOrdenesDetalle.idorden                  "          
	            + "      INNER JOIN tblDctosPeriodo                                   "          
	            + "      ON tblDctos.idLocal = tblDctosPeriodo.IDLOCAL                "          
	            + "     AND tblDctos.idPeriodo = tblDctosPeriodo.idPeriodo            "          
	            + "      INNER JOIN                                                   "          
	            + "      (SELECT tblPlus.idLocal,                                     "          
	            + "      tblPlus.idPlu,                                               "          
	            + "       tblPlus.idTipo,                                             "          
	            + "     (tblCategorias.nombreCategoria + ' ' +                        "          
	            + "                tblPlus.nombrePlu) AS nombrePlu,                   "          
	            + "       tblPlus.cuentaContableCredito                               "          
	            + "      FROM  tblCategorias                                          "          
	            + "      INNER JOIN tblPlus                                           "          
	            + "      ON tblCategorias.idLocal = tblPlus.idLocal                   "          
	            + "      AND tblCategorias.idLinea = tblPlus.idLinea                  "          
	            + "      AND tblCategorias.IdCategoria =                              "          
	            + "                         tblPlus.idCategoria) AS tmpCAT            "          
	            + "     ON tmpCAT.idLocal = tblDctosOrdenesDetalle.idLocal            "          
	            + "      AND tmpCAT.idPlu  = tblDctosOrdenesDetalle.idPlu             "          
	            + "    INNER JOIN tblTerceros                                         "          
	            + "      ON tblTerceros.idLocal = tblDctos.idLocal                    "          
	            + "      AND tblTerceros.idCliente  = tblDctos.idCliente              "          
	            + "      WHERE tblDctos.idLocal   =                                   "          
	            + "     ?1                                                           "          
	            + "      AND tblDctos.idTipoOrden IN (9 , 29)                         "          
	            + "      AND tblDctos.idPeriodo   =                                   "          
	            + "     ?2                                                        "          
	            + "      AND (tblDctosOrdenesDetalle.cantidad *                       "          
	            + "                            vrVentaUnitario) != 0                  "          
	            + "      AND tmpCAT.idTipo < 100                                      "          
	            + "      GROUP BY tblDctosOrdenesDetalle.idLocal,                     "          
	            + "      	 tmpCAT.cuentaContableCredito,                             "          
	            + "              tblDctos.idDcto,		   	                           "          
	            + "              tblDctos.idCliente,                                  "          
				+ " 			 tmpCAT.idPlu                                          "          
	            + "      HAVING SUM(tblDctosOrdenesDetalle.cantidad *                 "          
	            + "                                 vrVentaUnitario) > 0              "          
	            + "      UNION 					                                   "          
	            + "      SELECT 11 AS tipoComprobante,                                "          
	            + "     tblDctos.idDcto    AS conscutivoComprobante,                  "          
	            + "     MAX(tblDctosPeriodo.fechaFinal)                               "          
	            + "                             AS fechaElaboracion,                  "          
	            + "     'COP' AS  SiglaMoneda,                                        "          
	            + "     tmpCAT.cuentaContableCredito                                  "          
	            + "                            AS codCuentaContable,                  "          
	            + "     MAX(tblTerceros.CC_Nit) AS idCliente, 	                       "          
	            + "     ROUND(SUM(tblDctosOrdenesDetalle.cantidad *                   "          
	            + "      vrVentaUnitario),2) * (-1.0) AS debito,                      "          
	            + "      0.0 AS credito,  				                               "          
	            + "      MAX(tblDctos.nombreTercero) AS observacion,                  "          
	            + "      '' AS textoVacio,                                            "          
	            + "      MAX(tblTerceros.idRuta) AS idRuta,                           "          
				+ " 	 tmpCAT.idPlu                                                  "          
	            + "      FROM       tblDctosOrdenesDetalle                            "          
	            + "      INNER JOIN tblDctos                                          "          
	            + "      ON tblDctos.idLocal =                                        "          
	            + "                    tblDctosOrdenesDetalle.IDLOCAL                 "          
	            + "      AND tblDctos.idtipoorden =                                   "          
	            + "                    tblDctosOrdenesDetalle.idtipoorden             "          
	            + "      AND tblDctos.idorden    =                                    "          
	            + "                    tblDctosOrdenesDetalle.idorden                 "          
	            + "      INNER JOIN tblDctosPeriodo                                   "          
	            + "      ON tblDctos.idLocal = tblDctosPeriodo.IDLOCAL                "          
	            + "      AND tblDctos.idPeriodo = tblDctosPeriodo.idPeriodo           "          
	            + "      INNER JOIN                                                   "          
	            + "      (SELECT tblPlus.idLocal,                                     "          
	            + "              tblPlus.idPlu,                                       "          
	            + "      	    tblPlus.idTipo,                                        "          
	            + "             (tblCategorias.nombreCategoria + ' ' +                "          
	            + "                        tblPlus.nombrePlu) AS nombrePlu,           "          
	            + "      	    tblPlus.cuentaContableCredito                          "          
	            + "      FROM  tblCategorias                                          "          
	            + "      INNER JOIN tblPlus                                           "          
	            + "      ON tblCategorias.idLocal = tblPlus.idLocal                   "          
	            + "      AND tblCategorias.idLinea = tblPlus.idLinea                  "          
	            + "      AND tblCategorias.IdCategoria =                              "          
	            + "                         tblPlus.idCategoria) AS tmpCAT            "          
	            + "      ON tmpCAT.idLocal = tblDctosOrdenesDetalle.idLocal           "          
	            + "      AND tmpCAT.idPlu  = tblDctosOrdenesDetalle.idPlu             "          
	            + "      INNER JOIN tblTerceros                                       "          
	            + "      ON tblTerceros.idLocal = tblDctos.idLocal                    "          
	            + "      AND tblTerceros.idCliente  = tblDctos.idCliente              "          
	            + "      WHERE tblDctos.idLocal   =                                   "          
	            + "     ?1                                                           "          
	            + "      AND tblDctos.idTipoOrden IN (9 , 29)                         "          
	            + "      AND tblDctos.idPeriodo   =                                   "          
	            + "     ?2                                                        "          
	            + "      AND (tblDctosOrdenesDetalle.cantidad *                       "          
	            + "                            vrVentaUnitario) != 0                  "          
	            + "      AND tmpCAT.idTipo < 100                                      "          
	            + "      GROUP BY tblDctosOrdenesDetalle.idLocal,                     "          
	            + "      	 tmpCAT.cuentaContableCredito,                             "          
	            + "              tblDctos.idDcto,		   	                           "          
	            + "              tblDctos.idCliente,                                  "          
				+ " 			 tmpCAT.idPlu                                          "          
	            + "      HAVING SUM(tblDctosOrdenesDetalle.cantidad *                 "          
	            + "                                 vrVentaUnitario) < 0 	           "          
	            + "      UNION                                                        "          
	            + "      SELECT 11 AS tipoComprobante,                                "          
	            + "     tblDctos.idDcto    AS conscutivoComprobante,                  "          
	            + "      MAX(tblDctosPeriodo.fechaFinal)                              "          
	            + "                              AS fechaElaboracion,                 "          
	            + "       'COP' AS  SiglaMoneda,                                      "          
	            + "      tmpCAT.cuentaContableDebito                                  "          
	            + "                            AS codCuentaContable,                  "          
	            + "     MAX(tblTerceros.CC_Nit) AS idCliente, 	                       "          
	            + "       ROUND(SUM(tblDctosOrdenesDetalle.cantidad *                 "          
	            + "       vrVentaUnitario),2)  AS debito,                             "          
	            + "      0.0 AS credito,                                              "          
	            + "      MAX(tblDctos.nombreTercero) AS observacion,                  "          
	            + "      '' AS textoVacio,                                            "          
	            + "      MAX(tblTerceros.idRuta) AS idRuta,                           "          
				+ " 	 tmpCAT.idPlu                                                  "          
	            + "      FROM       tblDctosOrdenesDetalle                            "          
	            + "      INNER JOIN tblDctos                                          "          
	            + "      ON tblDctos.idLocal =                                        "          
	            + "                     tblDctosOrdenesDetalle.IDLOCAL                "          
	            + "      AND tblDctos.idtipoorden =                                   "          
	            + "                    tblDctosOrdenesDetalle.idtipoorden             "          
	            + "      AND tblDctos.idorden    =                                    "          
	            + "                    tblDctosOrdenesDetalle.idorden                 "          
	            + "      INNER JOIN tblDctosPeriodo                                   "          
	            + "      ON tblDctos.idLocal = tblDctosPeriodo.IDLOCAL                "          
	            + "      AND tblDctos.idPeriodo = tblDctosPeriodo.idPeriodo           "          
	            + "      INNER JOIN                                                   "          
	            + "      (SELECT tblPlus.idLocal,                                     "          
	            + "      tblPlus.idPlu,                                               "          
	            + "       tblPlus.idTipo,                                             "          
	            + "     (tblCategorias.nombreCategoria + ' ' +                        "          
	            + "      tblPlus.nombrePlu) AS nombrePlu,                             "          
	            + "       tblPlus.cuentaContableDebito                                "          
	            + "      FROM  tblCategorias                                          "          
	            + "      INNER JOIN tblPlus                                           "          
	            + "      ON tblCategorias.idLocal = tblPlus.idLocal                   "          
	            + "      AND tblCategorias.idLinea = tblPlus.idLinea                  "          
	            + "      AND tblCategorias.IdCategoria =                              "          
	            + "                     tblPlus.idCategoria) AS tmpCAT                "          
	            + "     ON tmpCAT.idLocal = tblDctosOrdenesDetalle.idLocal            "          
	            + "      AND tmpCAT.idPlu  = tblDctosOrdenesDetalle.idPlu             "          
	            + "    INNER JOIN tblTerceros                                         "          
	            + "      ON tblTerceros.idLocal = tblDctos.idLocal                    "          
	            + "      AND tblTerceros.idCliente  = tblDctos.idCliente              "          
	            + "      WHERE tblDctos.idLocal   =                                   "          
	            + "     ?1                                                           "          
	            + "      AND tblDctos.idTipoOrden IN (9 , 29)                         "          
	            + "      AND tblDctos.idPeriodo   =                                   "          
	            + "     ?2                                                        "          
	            + "      AND (tblDctosOrdenesDetalle.cantidad *                       "          
	            + "                            vrVentaUnitario) != 0                  "          
	            + "      AND tmpCAT.idTipo < 100                                      "          
	            + "      GROUP BY tblDctosOrdenesDetalle.idLocal,                     "          
	            + "      	 tmpCAT.cuentaContableDebito,                              "          
	            + "              tblDctos.idDcto,		   	                           "          
	            + "              tblDctos.idCliente,                                  "          
				+ " 			 tmpCAT.idPlu                                          "          
	            + "      HAVING SUM(tblDctosOrdenesDetalle.cantidad *                 "          
	            + "                       vrVentaUnitario) > 0  		               "          
	            + "      UNION    				                                       "          
	            + "      SELECT 11 AS tipoComprobante,                                "          
	            + "     tblDctos.idDcto    AS conscutivoComprobante,                  "          
	            + "      MAX(tblDctosPeriodo.fechaFinal)                              "          
	            + "                            AS fechaElaboracion,                   "          
	            + "     'COP' AS  SiglaMoneda,                                        "          
	            + "      tmpCAT.cuentaContableDebito                                  "          
	            + "                            AS codCuentaContable,                  "          
	            + "     MAX(tblTerceros.CC_Nit) AS idCliente, 	                       "          
	            + "     0 AS debito,        		                                   "          
	            + "     ROUND(SUM(tblDctosOrdenesDetalle.cantidad *                   "          
	            + "     vrVentaUnitario),2) * (-1.0) AS  credito,                     "          
	            + "      MAX(tblDctos.nombreTercero) AS observacion,                  "          
	            + "      '' AS textoVacio,                                            "          
	            + "      MAX(tblTerceros.idRuta) AS idRuta,                           "          
				+ " 	 tmpCAT.idPlu                                                  "          
	            + "      FROM       tblDctosOrdenesDetalle                            "          
	            + "      INNER JOIN tblDctos                                          "          
	            + "      ON tblDctos.idLocal =                                        "          
	            + "                          tblDctosOrdenesDetalle.IDLOCAL           "          
	            + "      AND tblDctos.idtipoorden =                                   "          
	            + "                      tblDctosOrdenesDetalle.idtipoorden           "          
	            + "      AND tblDctos.idorden    =                                    "          
	            + "                          tblDctosOrdenesDetalle.idorden           "          
	            + "      INNER JOIN tblDctosPeriodo                                   "          
	            + "      ON tblDctos.idLocal = tblDctosPeriodo.IDLOCAL                "          
	            + "      AND tblDctos.idPeriodo = tblDctosPeriodo.idPeriodo           "          
	            + "      INNER JOIN                                                   "          
	            + "      (SELECT tblPlus.idLocal,                                     "          
	            + "      tblPlus.idPlu,                                               "          
	            + "       tblPlus.idTipo,                                             "          
	            + "     (tblCategorias.nombreCategoria + ' ' +                        "          
	            + "      tblPlus.nombrePlu) AS nombrePlu,                             "          
	            + "       tblPlus.cuentaContableDebito                                "          
	            + "      FROM  tblCategorias                                          "          
	            + "      INNER JOIN tblPlus                                           "          
	            + "      ON tblCategorias.idLocal = tblPlus.idLocal                   "          
	            + "      AND tblCategorias.idLinea = tblPlus.idLinea                  "          
	            + "      AND tblCategorias.IdCategoria =                              "          
	            + "                         tblPlus.idCategoria) AS tmpCAT            "          
	            + "     ON tmpCAT.idLocal = tblDctosOrdenesDetalle.idLocal            "          
	            + "      AND tmpCAT.idPlu  = tblDctosOrdenesDetalle.idPlu             "          
	            + "    INNER JOIN tblTerceros                                         "          
	            + "      ON tblTerceros.idLocal = tblDctos.idLocal                    "          
	            + "      AND tblTerceros.idCliente  = tblDctos.idCliente              "          
	            + "      WHERE tblDctos.idLocal   =                                   "          
	            + "     ?1                                                           "          
	            + "      AND tblDctos.idTipoOrden IN (9 , 29)                         "          
	            + "      AND tblDctos.idPeriodo   =                                   "          
	            + "     ?2                                                        "          
	            + "      AND (tblDctosOrdenesDetalle.cantidad *                       "          
	            + "                            vrVentaUnitario) != 0                  "          
	            + "      AND tmpCAT.idTipo < 100                                      "          
	            + "      GROUP BY tblDctosOrdenesDetalle.idLocal,                     "          
	            + "      	 tmpCAT.cuentaContableDebito,                              "          
	            + "              tblDctos.idDcto,		   	                           "          
	            + "              tblDctos.idCliente,                                  "          
				+ " 			 tmpCAT.idPlu                                          "          
	            + "      HAVING SUM(tblDctosOrdenesDetalle.cantidad *                 "          
	            + "                vrVentaUnitario) < 0                               "          
	            + "    	     ORDER BY 1,2,6,7 DESC                                 ",
              nativeQuery = true)
	  List<TblDctosDTO3> listaComprobanteDetallado(int idLocal, int idPeriodo);
	  
	  
	  
	  
	  @Query(value = "SELECT 11 AS idTipoNegocio,                       "
              + " 	  MAX(tblDctos.idPeriodo)                      "
              + "                          AS idDctoNitCC, "
              + "       MAX(tblDctosPeriodo.fechaFinal)              "
              + "                               AS fechaDctoSiigo, "
              + "       'COP' AS  SiglaMoneda,                       "
              + " 	  tmpCAT.cuentaContableCredito                 "
              + " 	                         AS idSubcuenta, "
              + "       MAX(tblLocales.idNit) AS idCliente, 	       "
              + "       0 AS vrDebito,                                 "
              + "       ROUND(SUM(tblDctosOrdenesDetalle.cantidad *  "
              + "                    vrVentaUnitario),0) AS vrCredito, "
              + " 	  'comprobante facturacion' AS observacion,    "
              + "       '' AS textoVacio                             "
              + " FROM       tblDctosOrdenesDetalle                  "
              + " INNER JOIN tblDctos                                "
              + " ON tblDctos.idLocal =                              "
              + "                    tblDctosOrdenesDetalle.IDLOCAL  "
              + " AND tblDctos.idtipoorden =                         "
              + "                 tblDctosOrdenesDetalle.idtipoorden "
              + " AND tblDctos.idorden    =                          "
              + "                     tblDctosOrdenesDetalle.idorden "
              + " INNER JOIN tblDctosPeriodo                         "
              + " ON tblDctos.idLocal = tblDctosPeriodo.IDLOCAL      "
              + " AND tblDctos.idPeriodo = tblDctosPeriodo.idPeriodo "
              + " INNER JOIN                                         "
              + " (SELECT tblPlus.idLocal,                           "
              + "         tblPlus.idPlu,                             "
              + " 	    tblPlus.idTipo,                            "
              + "        (tblCategorias.nombreCategoria + ' ' +      "
              + "                   tblPlus.nombrePlu) AS nombrePlu, "
              + " 	    tblPlus.cuentaContableCredito              "
              + " FROM  tblCategorias                                "
              + " INNER JOIN tblPlus                                 "
              + " ON tblCategorias.idLocal = tblPlus.idLocal         "
              + " AND tblCategorias.idLinea = tblPlus.idLinea        "
              + " AND tblCategorias.IdCategoria =                    "
              + "                    tblPlus.idCategoria) AS tmpCAT  "
              + " ON tmpCAT.idLocal = tblDctosOrdenesDetalle.idLocal "
              + " AND tmpCAT.idPlu  = tblDctosOrdenesDetalle.idPlu   "
              + " INNER JOIN tblLocales                              "
              + " ON tblLocales.idLocal =                            "
              + "                     tblDctosOrdenesDetalle.idLocal "
              + " WHERE tblDctos.idLocal   =                         "
              + "?1   "
              + " AND tblDctos.idTipoOrden IN  (9 , 29)              "
              + " AND tblDctos.idPeriodo   =                         "
              + "?2 "
              + " AND (tblDctosOrdenesDetalle.cantidad *             "
              + "                           vrVentaUnitario) != 0    "
              + " AND tmpCAT.idTipo < 100                            "
              + " GROUP BY tblDctosOrdenesDetalle.idLocal,           "
              + " 	 tmpCAT.cuentaContableCredito                  "
              + " HAVING SUM(tblDctosOrdenesDetalle.cantidad *       "
              + "                            vrVentaUnitario) != 0   "
              + " UNION                                              "
              + " SELECT 11 AS tipoComprobante,                      "
              + " 	   MAX(tblDctos.idPeriodo)                     "
              + "                          AS conscutivoComprobante, "
              + "       MAX(tblDctosPeriodo.fechaFinal)              "
              + "                               AS fechaElaboracion, "
              + "        'COP' AS  SiglaMoneda,                      "
              + " 	   tmpCAT.cuentaContableDebito                 "
              + " 	                         AS codCuentaContable, "
              + "       MAX(tblLocales.idNit) AS idCliente, 	       "
              + "       ROUND(SUM(tblDctosOrdenesDetalle.cantidad *  "
              + "                    vrVentaUnitario),0) AS debito,  "
              + "       0 AS credito,                                "
              + " 	  'comprobante facturacion' AS observacion,    "
              + "       '' AS textoVacio                             "
              + " FROM       tblDctosOrdenesDetalle                  "
              + " INNER JOIN tblDctos                                "
              + " ON tblDctos.idLocal =                              "
              + "                     tblDctosOrdenesDetalle.IDLOCAL "
              + " AND tblDctos.idtipoorden =                         "
              + "                 tblDctosOrdenesDetalle.idtipoorden "
              + " AND tblDctos.idorden    =                          "
              + "                     tblDctosOrdenesDetalle.idorden "
              + " INNER JOIN tblDctosPeriodo                         "
              + " ON tblDctos.idLocal = tblDctosPeriodo.IDLOCAL      "
              + " AND tblDctos.idPeriodo = tblDctosPeriodo.idPeriodo "
              + " INNER JOIN                                         "
              + " (SELECT tblPlus.idLocal,                           "
              + "         tblPlus.idPlu,                             "
              + " 	    tblPlus.idTipo,                            "
              + "        (tblCategorias.nombreCategoria + ' ' +      "
              + "         tblPlus.nombrePlu) AS nombrePlu,           "
              + " 	    tblPlus.cuentaContableDebito               "
              + " FROM  tblCategorias                                "
              + " INNER JOIN tblPlus                                 "
              + " ON tblCategorias.idLocal = tblPlus.idLocal         "
              + " AND tblCategorias.idLinea = tblPlus.idLinea        "
              + " AND tblCategorias.IdCategoria =                    "
              + "                    tblPlus.idCategoria) AS tmpCAT  "
              + " ON tmpCAT.idLocal = tblDctosOrdenesDetalle.idLocal "
              + " AND tmpCAT.idPlu  = tblDctosOrdenesDetalle.idPlu   "
              + " INNER JOIN tblLocales                              "
              + " ON tblLocales.idLocal =                            "
              + "                    tblDctosOrdenesDetalle.idLocal  "
              + " WHERE tblDctos.idLocal   =                         "
              + "?1  "
              + " AND tblDctos.idTipoOrden IN (9 , 29)               "
              + " AND tblDctos.idPeriodo   =                         "
              + "?2                                                  "
              + " AND (tblDctosOrdenesDetalle.cantidad *             "
              + "                              vrVentaUnitario) != 0 "
              + " AND tmpCAT.idTipo < 100                            "
              + " GROUP BY tblDctosOrdenesDetalle.idLocal,           "
              + " 	 tmpCAT.cuentaContableDebito                   "
              + " HAVING SUM(tblDctosOrdenesDetalle.cantidad *       "
              + "                  vrVentaUnitario) != 0  ",
              nativeQuery = true)
	  List<TblDctosDTO3> listaComprobanteAgrupado(int idLocal, int idPeriodo);
	  
	  
	  
//	  @Query(value = " SELECT 11 AS idTipoNegocio,                              "                
//			  + "  (tblPagos.idRecibo)                                       "
//			  + "                 AS idDctoNitCC,                  "
//			  + "   MAX(tblPagos.idDcto) AS comentario,                     "
//			  + "  (tblPagos.fechaPago) AS fechaDctoSiigo,                 "
//			  + "   'COP' AS  SiglaMoneda,                                   "
//			  + "   MAX(tblMediosPago.cuentaContable)                        "
//			  + "                     AS idSubcuenta,                  "
//			  + "   MAX(tblTerceros.CC_Nit) AS idCliente,                    "
//			  + "   CAST(ROUND(SUM(tblPagosMedios.vrMedio),2)                "
//			  + "             AS DECIMAL(10,2))  AS vrDebito,                "
//			  + "   0.0 AS vrCredito,                                          "
//			  + "   MAX(tblTerceros.nombreTercero)                           "
//			  + "                        AS observacion,                     "
//			  + "   '' AS textoVacio,                                        "
//			  + "   MAX(tblTerceros.idRuta) AS idRuta  	                   "
//			  + " FROM tblPagos                                              "
//			  + " INNER JOIN tblPagosMedios                                  "
//			  + " ON tblPagos.idLocal = tblPagosMedios.idLocal               "
//			  + " AND tblPagos.idTipoOrden =                                 "
//			  + "                    tblPagosMedios.idTipoOrden              "
//			  + " AND tblPagos.idRecibo =                                    "
//			  + "                       tblPagosMedios.idRecibo              "
//			  + " AND tblPagos.indicador =                                   "
//			  + "                      tblPagosMedios.indicador              "
//			  + " INNER JOIN tblMediosPago                                   "
//			  + " ON tblMediosPago.idLocal  =                                "
//			  + "            tblPagosMedios.idLocal                          "
//			  + " AND tblMediosPago.idMedio =                                "
//			  + "             tblPagosMedios.idMedio                         "
//			  + " INNER JOIN tblTerceros                                     "
//			  + " ON tblTerceros.idLocal    =                                "
//			  + "                    tblPagos.idLocal                        "
//			  + " AND tblTerceros.idCliente =  tblPagos.nitCC                "
//			  + " INNER JOIN tblPlus                                         "
//			  + " ON tblPlus.idLocal        =                                "
//			  + "                      tblPagosMedios.idLocal                "
//			  + " AND tblPlus.idPlu         =                                "
//			  + "                        tblPagosMedios.idPLu	               "
//			  + " WHERE tblPagos.idLocal     = ?1                           "
//			  + " AND   tblPagos.idTipoOrden = 9                             "
//			  + " AND   tblPagos.idPeriodo   = ?2                        "
//			  + " AND   tblPagosMedios.vrMedio != 0                          "
//			  + " GROUP BY tblPagos.idLocal,                                 "
//			  + "          tblPagos.idTipoOrden,                             "
//			  + "          tblPagos.idRecibo,                                "
//			  + "          tblPagos.fechaPago                                "
//			  + " UNION                                                      "
//			  + " /****TOTAL ACUEDUCTO****/                                  "
//			  + " SELECT   11 AS tipoComprobante,                            "
//			  + " (tblPagos.idRecibo)                                        "
//			  + "                 AS conscutivoComprobante,                  "
//			  + "  MAX(tblPagos.idDcto) AS descripcion,                      "
//			  + " (tblPagos.fechaPago) AS fechaElaboracion,                  "
//			  + "  'COP' AS  SiglaMoneda,                                    "
//			  + " MAX(tblMediosPago.cuentaCxC)                               "
//			  + " AS codCuentaContable, 					                   "
//			  + " MAX(tblTerceros.CC_Nit) AS idCliente,                      "
//			  + " 0.0 AS vrDebito,                                           "
//			  + " CAST(ROUND(SUM(tblPagosMedios.vrMedio),2)                  "
//			  + "            AS DECIMAL(10,2)) AS vrCredito,                   "
//			  + " MAX(tblTerceros.nombreTercero) AS observacion,             "
//			  + "   '' AS textoVacio,                                        "
//			  + "   MAX(tblTerceros.idRuta) AS idRuta  	                   "
//			  + " FROM tblPagos                                              "
//			  + " INNER JOIN tblPagosMedios                                  "
//			  + " ON tblPagos.idLocal = tblPagosMedios.idLocal               "
//			  + " AND tblPagos.idTipoOrden =                                 "
//			  + "                     tblPagosMedios.idTipoOrden             "
//			  + " AND tblPagos.idRecibo = tblPagosMedios.idRecibo            "
//			  + " AND tblPagos.indicador =                                   "
//			  + "                       tblPagosMedios.indicador             "
//			  + " 				                                           "
//			  + " INNER JOIN tblMediosPago                                   "
//			  + " ON tblMediosPago.idLocal = tblPagosMedios.idLocal          "
//			  + " AND tblMediosPago.idMedio = tblPagosMedios.idMedio 	   	   "							   
//			  + " 									                       "
//			  + " INNER JOIN tblTerceros                                     "
//			  + " ON tblTerceros.idLocal = tblPagos.idLocal                  "
//			  + " AND tblTerceros.idCliente = tblPagos.nitCC                 "
//			  + " INNER JOIN tblPlus                                         "
//			  + " ON tblPlus.idLocal = tblPagosMedios.idLocal                "
//			  + " AND tblPlus.idPlu = tblPagosMedios.idPLu                   "
//			  + " WHERE tblPagos.idLocal     = ?1                           "
//			  + " AND   tblPagos.idTipoOrden = 9                             "
//			  + " AND   tblPagos.idPeriodo   = ?2                        "
//			  + " AND   tblPagosMedios.vrMedio != 0                          "
//			  + " AND tblPlus.idTipo IN (4,6,19,20,21,22,23,                 "
//			  + "                104,106,119,120,121,122,23,123)             "
//			  + " GROUP BY tblPagos.idLocal,                                 "
//			  + "          tblPagos.idTipoOrden,                             "
//			  + "          tblPagos.idRecibo,                                "
//			  + "          tblPagos.fechaPago                                "
//			  + " UNION                                                      "
//			  + " /****OTROS***/                                             "
//			  + " SELECT   11 AS tipoComprobante,                            "
//			  + "      (tblPagos.idRecibo)                                   "
//			  + "                      AS conscutivoComprobante,             "
//			  + "       MAX(tblPagos.idDcto) AS descripcion,                 "
//			  + "      (tblPagos.fechaPago) AS fechaElaboracion,             "
//			  + "       'COP' AS  SiglaMoneda,                               "
//			  + "       (tblPlus.cuentaRecaudoCredito)                       "
//			  + "                       AS codCuentaContable,                "
//			  + "       MAX(tblTerceros.CC_Nit) AS idCliente,                "
//			  + "       0.0 AS vrDebito,                                     "
//			  + "      CAST(ROUND(SUM(tblPagosMedios.vrMedio),2)             "
//			  + "                AS DECIMAL(10,2))  AS vrCredito,              "
//			  + " MAX(tblTerceros.nombreTercero) AS observacion,             "
//			  + "   '' AS textoVacio,                                        "
//			  + "   MAX(tblTerceros.idRuta) AS idRuta  	                   "
//			  + " FROM tblPagos                                              "
//			  + " INNER JOIN tblPagosMedios                                  "
//			  + " ON tblPagos.idLocal = tblPagosMedios.idLocal               "
//			  + " AND tblPagos.idTipoOrden =                                 "
//			  + "                     tblPagosMedios.idTipoOrden             "
//			  + " AND tblPagos.idRecibo = tblPagosMedios.idRecibo            "
//			  + " AND tblPagos.indicador =                                   "
//			  + "                       tblPagosMedios.indicador             "
//			  + " INNER JOIN tblTerceros                                     "
//			  + " ON tblTerceros.idLocal = tblPagos.idLocal                  "
//			  + " AND tblTerceros.idCliente = tblPagos.nitCC                 "
//			  + " INNER JOIN tblPlus                                         "
//			  + " ON tblPlus.idLocal = tblPagosMedios.idLocal                "
//			  + " AND tblPlus.idPlu = tblPagosMedios.idPLu                   "
//			  + " WHERE tblPagos.idLocal     = ?1                           "
//			  + " AND   tblPagos.idTipoOrden = 9                             "
//			  + " AND   tblPagos.idPeriodo   = ?2                        "
//			  + " AND   tblPagosMedios.vrMedio != 0                          "
//			  + " AND tblPlus.idTipo NOT IN (4,6,19,20,21,22,23,             "
//			  + "                   104,106,119,120,121,122,123)             "
//			  + " GROUP BY tblPagos.idLocal,                                 "
//			  + "          tblPagos.idTipoOrden,                             "
//			  + "          tblPagos.idRecibo,                                "
//			  + "          tblPagos.fechaPago,                               "
//			  + " 	      tblPlus.cuentaRecaudoCredito                     "
//			  + " ORDER BY 2,7 DESC                                          ",
//              nativeQuery = true)
//	  List<TblDctosDTO3> listaComprobanteRecaudoDetallado(int idLocal, int idPeriodo); 
	  
	  
	  
	  @Query(value = "     SELECT 11 AS idTipoNegocio,                                "                                                      
				 + "      (tblPagos.idRecibo)                                       "                        
				 + "                     AS idDctoNitCC,                            "                        
				 + "       MAX(tblPagos.idDcto) AS comentario,                      "                        
				 + "      (tblPagos.fechaPago) AS fechaDctoSiigo,                   "                        
				 + "       'COP' AS  SiglaMoneda,                                   "                        
				 + "       (tblPlus.cuentaRecaudoDebito)                            "                     
				 + "                         AS idSubcuenta,                        "                        
				 + "       MAX(tblTerceros.CC_Nit) AS idCliente,                    "                        
				 + "       CAST(ROUND(SUM(tblPagosMedios.vrMedio),2)                "                        
				 + "                 AS DECIMAL(10,2))  AS vrDebito,                "                        
				 + "       0.0 AS vrCredito,                                        "                        
				 + "       MAX(tblTerceros.nombreTercero)                           "                        
				 + "                            AS observacion,                     "                        
				 + "       '' AS textoVacio,                                        "                        
				 + "       MAX(tblPlus.idplu) AS idPlu  	                         "                 
				 + "     FROM tblPagos                                              "                        
				 + "                                                                "                        
				 + "     INNER JOIN tblPagosMedios                                  "                        
				 + "     ON tblPagos.idLocal = tblPagosMedios.idLocal               "                        
				 + "     AND tblPagos.idTipoOrden = tblPagosMedios.idTipoOrden      "                            
				 + "     AND tblPagos.idRecibo =    tblPagosMedios.idRecibo         "                         
				 + "     AND tblPagos.indicador =   tblPagosMedios.indicador 		"          	                			   
				 + "     INNER JOIN tblTerceros                                     "                        
				 + "     ON tblTerceros.idLocal    =  tblPagos.idLocal              "                              
				 + "     AND tblTerceros.idCliente =  tblPagos.nitCC    			 "                         
				 + "     INNER JOIN tblPlus                                         "                        
				 + "     ON tblPlus.idLocal        =   tblPagosMedios.idLocal       "                             
				 + "     AND tblPlus.idPlu         =    tblPagosMedios.idPLu	     "                         
				 + "                                                                "                        
				 + "     WHERE tblPagos.idLocal     = ?1                           "                        
				 + "     AND   tblPagos.idTipoOrden = 9                             "                        
				 + "     AND   tblPagos.idPeriodo   = ?2                        "                        
				 + "     AND   tblPagosMedios.vrMedio != 0                          "                  
				 + "     GROUP BY tblPagos.idLocal,                                 "                        
				 + "              tblPagos.idTipoOrden,                             "                        
				 + "              tblPagos.idRecibo,                                "                        
				 + "              tblPagos.fechaPago,                               "          
				+ " 			  tblPlus.cuentaRecaudoDebito                        "          
				 + "    UNION                                                       "                        
				 + "     /****TOTAL ACUEDUCTO****/                                  "                        
				 + "     SELECT   11 AS tipoComprobante,                            "                        
				 + "     (tblPagos.idRecibo)                                        "                        
				 + "                     AS conscutivoComprobante,                  "                        
				 + "      MAX(tblPagos.idDcto) AS descripcion,                      "                        
				 + "     (tblPagos.fechaPago) AS fechaElaboracion,                  "                        
				 + "      'COP' AS  SiglaMoneda,                                    "                        
			     + "     (tblPlus.cuentaRecaudoCredito)                             "                     
		         + "                                                                "                        
		         + "                                                                "                        
				 + "     AS codCuentaContable, 					                 "                         
				 + "     MAX(tblTerceros.CC_Nit) AS idCliente,                      "                        
				 + "     0.0 AS vrDebito,                                           "                        
				 + "     CAST(ROUND(SUM(tblPagosMedios.vrMedio),2)                  "                        
				 + "                AS DECIMAL(10,2)) AS vrCredito,                 "                        
				 + "     MAX(tblTerceros.nombreTercero) AS observacion,             "                        
				 + "       '' AS textoVacio,                                        "                        
				 + "       MAX(tblPlus.idplu) AS idPlu 	                            "                 
				 + "     FROM tblPagos                                              "                        
				 + "     INNER JOIN tblPagosMedios                                  "                        
				 + "     ON tblPagos.idLocal = tblPagosMedios.idLocal               "                        
				 + "     AND tblPagos.idTipoOrden =                                 "                        
				 + "                         tblPagosMedios.idTipoOrden             "                        
				 + "     AND tblPagos.idRecibo = tblPagosMedios.idRecibo            "                        
				 + "     AND tblPagos.indicador =                                   "                        
				 + "                           tblPagosMedios.indicador             "                       							   			   									                       
				 + "     INNER JOIN tblTerceros                                     "                        
				 + "     ON tblTerceros.idLocal = tblPagos.idLocal                  "                        
				 + "     AND tblTerceros.idCliente = tblPagos.nitCC                 "                        
				 + "     INNER JOIN tblPlus                                         "                        
				 + "     ON tblPlus.idLocal = tblPagosMedios.idLocal                "                        
				 + "     AND tblPlus.idPlu = tblPagosMedios.idPLu                   "                        
				 + "     WHERE tblPagos.idLocal     = ?1                           "                        
				 + "     AND   tblPagos.idTipoOrden = 9                             "                        
				 + "     AND   tblPagos.idPeriodo   = ?2                        "                        
				 + "     AND   tblPagosMedios.vrMedio != 0                          "                        
				 + "     AND tblPlus.idTipo IN (4,6,19,20,21,22,23,                 "                        
				 + "                    104,106,119,120,121,122,23,123)             "                   
				 + "     GROUP BY tblPagos.idLocal,                                 "                        
				 + "              tblPagos.idTipoOrden,                             "                        
				 + "              tblPagos.idRecibo,                                "                        
				 + "              tblPagos.fechaPago,                               "          
				+ " 			  tblPlus.cuentaRecaudoCredito                       "          
				 + "     UNION                                                      "                        
				 + "     /****OTROS***/                                             "                        
				 + "     SELECT   11 AS tipoComprobante,                            "                        
				 + "          (tblPagos.idRecibo)                                   "                        
				 + "                          AS conscutivoComprobante,             "                        
				 + "           MAX(tblPagos.idDcto) AS descripcion,                 "                        
				 + "          (tblPagos.fechaPago) AS fechaElaboracion,             "                        
				 + "           'COP' AS  SiglaMoneda,                               "                        
				 + "           (tblPlus.cuentaRecaudoCredito)                       "                        
				 + "                           AS codCuentaContable,                "                        
				 + "           MAX(tblTerceros.CC_Nit) AS idCliente,                "                        
				 + "           0.0 AS vrDebito,                                     "                        
				 + "          CAST(ROUND(SUM(tblPagosMedios.vrMedio),2)             "                        
				 + "                    AS DECIMAL(10,2))  AS vrCredito,            "                        
				 + "     MAX(tblTerceros.nombreTercero) AS observacion,             "                        
				 + "       '' AS textoVacio,                                        "                        
				 + "       MAX(tblPlus.idplu) AS idPlu 	                            "                 
				 + "     FROM tblPagos                                              "                        
				 + "     INNER JOIN tblPagosMedios                                  "                        
				 + "     ON tblPagos.idLocal = tblPagosMedios.idLocal               "                        
				 + "     AND tblPagos.idTipoOrden =                                 "                        
				 + "                         tblPagosMedios.idTipoOrden             "                        
				 + "     AND tblPagos.idRecibo = tblPagosMedios.idRecibo            "                        
				 + "     AND tblPagos.indicador =                                   "                        
				 + "                           tblPagosMedios.indicador             "                        
				 + "     INNER JOIN tblTerceros                                     "                        
				 + "     ON tblTerceros.idLocal = tblPagos.idLocal                  "                        
				 + "     AND tblTerceros.idCliente = tblPagos.nitCC                 "                        
				 + "     INNER JOIN tblPlus                                         "                        
				 + "     ON tblPlus.idLocal = tblPagosMedios.idLocal                "                        
				 + "     AND tblPlus.idPlu = tblPagosMedios.idPLu                   "                        
				 + "     WHERE tblPagos.idLocal     = ?1                           "                        
				 + "     AND   tblPagos.idTipoOrden = 9                             "                        
				 + "     AND   tblPagos.idPeriodo   = ?2                        "                        
				 + "     AND   tblPagosMedios.vrMedio != 0                          "                        
				 + "     AND tblPlus.idTipo NOT IN (4,6,19,20,21,22,23,             "                        
				 + "                       104,106,119,120,121,122,123)             "                
				 + "     GROUP BY tblPagos.idLocal,                                 "                        
				 + "              tblPagos.idTipoOrden,                             "                        
				 + "              tblPagos.idRecibo,                                "                        
				 + "              tblPagos.fechaPago,                               "                        
				 + "     	      tblPlus.cuentaRecaudoCredito                       "                         
				 + "     ORDER BY 2 ASC,8 DESC                                      ",
              nativeQuery = true)
	  List<TblDctosDTO3> listaComprobanteRecaudoDetallado(int idLocal, int idPeriodo);
	  
	  
	  
	  
	  @Query(value = "SELECT 11 AS idTipoNegocio,                        "
              + "        MAX(tblDctos.idPeriodo)                      "
              + "                       AS idDctoNitCC,     "
              + "        MAX(tblDctos.fechaDcto) AS fechaDctoSiigo, "
              + "        'COP' AS  SiglaMoneda,                       "
              + " 	   tmpCAT.cuentaContableDebito                   "
              + "                  	          AS codCuentaContable, "
              + " 	   MAX(tblLocales.idNit) AS idCliente, 		"
              + "        0 AS vrDebito,                                 "
              + "        ROUND(SUM(tblPagosMedios.vrMedio),0)         "
              + "                                         AS vrCredito, "
              + " 	   'comprobante facturacion' AS observacion,    "
              + " 	   '' AS textoVacio                             "
              + " FROM     tblDctos                                   "
              + " INNER JOIN tblPagos                                 "
              + " ON tblDctos.IDLOCAL = tblPagos.idLocal              "
              + " AND tblDctos.IDTIPOORDEN = tblPagos.idTipoOrden     "
              + " AND tblDctos.idCliente = tblPagos.nitCC             "
              + " AND tblDctos.idDcto = tblPagos.idDcto               "
              + " INNER JOIN tblPagosMedios                           "
              + " ON tblPagos.idLocal = tblPagosMedios.idLocal        "
              + " AND tblPagos.idTipoOrden =                          "
              + "                         tblPagosMedios.idTipoOrden  "
              + " AND tblPagos.idRecibo = tblPagosMedios.idRecibo     "
              + " AND tblPagos.indicador = tblPagosMedios.indicador   "
              + " INNER JOIN                                          "
              + " (SELECT tblPlus.idLocal,                            "
              + "         tblPlus.idPlu,                              "
              + " 		tblPlus.idTipo,                         "
              + "        (tblCategorias.nombreCategoria + ' ' +       "
              + "                 tblPlus.nombrePlu) AS nombrePlu,    "
              + " 		tblPlus.cuentaContableDebito           "
              + " FROM  tblCategorias                                 "
              + " INNER JOIN tblPlus                                  "
              + " ON tblCategorias.idLocal = tblPlus.idLocal          "
              + " AND tblCategorias.idLinea = tblPlus.idLinea         "
              + " AND tblCategorias.IdCategoria =                     "
              + "                  tblPlus.idCategoria) AS tmpCAT     "
              + " ON tmpCAT.idLocal = tblPagosMedios.idLocal          "
              + " AND tmpCAT.idPlu = tblPagosMedios.idPlu             "
              + " INNER JOIN tblLocales                               "
              + " ON tblLocales.idLocal = tblPagosMedios.idLocal      "
              + " WHERE tblDctos.idLocal   =                         "
              + "?1   "
              + " AND tblDctos.idTipoOrden IN  (9 , 29)               "
              + " AND tblDctos.idPeriodo   =                          "
              + "?2 "
              + " AND (tblPagosMedios.vrMedio) != 0                   "
              + " AND tmpCAT.idTipo < 100                             "
              + " GROUP BY tblPagosMedios.idLocal,                    "
              + " 		 tmpCAT.cuentaContableDebito            "
              + " HAVING SUM(tblPagosMedios.vrMedio) != 0             "
              + " UNION                                               "
              + " SELECT 11 AS tipoComprobante,                         "
              + "        MAX(tblDctos.idPeriodo)                        "
              + "                       AS conscutivoComprobante,       "
              + "        MAX(tblDctos.fechaDcto) AS fechaElaboracion,   "
              + "        'COP' AS  SiglaMoneda,                         "
              + " 	   MAX(tblMediosPago.cuentaContable)              "
              + "                  	          AS codCuentaContable,   "
              + " 	   MAX(tblLocales.idNit) AS idCliente, 		      "
              + " 	   ROUND(SUM(tblPagosMedios.vrMedio),0) AS debito,"
              + "        0 AS credito,                                  "
              + " 	   'comprobante facturacion' AS observacion,      "
              + " 	   '' AS textoVacio                               "
              + " FROM     tblDctos                                     "
              + " INNER JOIN tblPagos                                   "
              + " ON tblDctos.IDLOCAL = tblPagos.idLocal                "
              + " AND tblDctos.IDTIPOORDEN = tblPagos.idTipoOrden       "
              + " AND tblDctos.idCliente = tblPagos.nitCC               "
              + " AND tblDctos.idDcto = tblPagos.idDcto                 "
              + " INNER JOIN tblPagosMedios                             "
              + " ON tblPagos.idLocal = tblPagosMedios.idLocal          "
              + " AND tblPagos.idTipoOrden = tblPagosMedios.idTipoOrden "
              + " AND tblPagos.idRecibo = tblPagosMedios.idRecibo       "
              + " AND tblPagos.indicador = tblPagosMedios.indicador     "
              + " INNER JOIN tblMediosPago                              "
              + " ON tblMediosPago.idLocal = tblPagosMedios.idLocal     "
              + " AND tblMediosPago.idMedio = tblPagosMedios.idMedio    "
              + " INNER JOIN                                            "
              + " (SELECT tblPlus.idLocal,                              "
              + "         tblPlus.idPlu,                                "
              + " 		tblPlus.idTipo,                               "
              + "        (tblCategorias.nombreCategoria + ' ' +         "
              + "                 tblPlus.nombrePlu) AS nombrePlu,      "
              + " 		tblPlus.cuentaContableDebito                  "
              + " FROM  tblCategorias                                   "
              + " INNER JOIN tblPlus                                    "
              + " ON tblCategorias.idLocal = tblPlus.idLocal            "
              + " AND tblCategorias.idLinea = tblPlus.idLinea           "
              + " AND tblCategorias.IdCategoria =                       "
              + "                  tblPlus.idCategoria) AS tmpCAT       "
              + " ON tmpCAT.idLocal = tblPagosMedios.idLocal            "
              + " AND tmpCAT.idPlu = tblPagosMedios.idPlu               "
              + " INNER JOIN tblLocales                                 "
              + " ON tblLocales.idLocal = tblPagosMedios.idLocal        "
              + " WHERE tblDctos.idLocal   =                           "
              + "?1   "
              + " AND tblDctos.idTipoOrden IN  (9 , 29)               "
              + " AND tblDctos.idPeriodo   =                          "
              + "?2 "
              + " AND (tblPagosMedios.vrMedio) != 0                     "
              + " AND tmpCAT.idTipo < 100                               "
              + " GROUP BY tblPagosMedios.idLocal                       "
              + " HAVING SUM(tblPagosMedios.vrMedio) != 0",
              nativeQuery = true)
	  List<TblDctosDTO3> listaComprobanteRecaudoAgrupado(int idLocal, int idPeriodo);
	  
	  
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = "INSERT INTO tbldctos (idLocal,             "
              + "                      idTipoOrden,         "
              + "                      idOrden,             "
              + "                      idDcto,              "
              + "                      indicador,           "
              + "                      fechaDcto,           "
              + "                      vrBase,              "
              + "                      vrPago,              "
              + "                      idEstado,            "
              + "                      vrIva,               "
              + "                      idTipoNegocio,       "
              + "                      vrRteFuente,         "
              + "                      vrDescuento,         "
              + "                      vrRteIva,            "
              + "                      vrRteIca,            "
              + "                      nombreTercero,       "
              + "                      idUsuario,           "
              + "                      idCliente,           "
              + "                      diasPlazo,           "
              + "                      descuentoComercial,  "
              + "                      idCausa,             "
              + "                      idDctoNitCC,         "
              + "                      fechaDctoNitCC,      "
              + "                      vrPagarDctoNitCC,    "
              + "                      vrDsctoFcro,         "
              + "                      vrCostoMV,           "
              + "                      idLocalCruce,        "
              + "                      idTipoOrdenCruce,    "
              + "                      idDctoCruce,         "
              + "                      idPeriodo,           "
              + "                      idVendedor,          "
              + "                      vrImpoconsumo,       "
              + "                      vrCostoIND,          "
              + "                      idOrdenCruce,        "
              + "                      etapaSTR,            "
              + "                      envioFE,             "
              + "                      fechaPagoInicio,     "
              + "                      fechaPagoFin)        "
              + "VALUES ( ?1,"
              + "?2,"
              + "?3,"
              + "?4,"
              + "?5,"
              + "?6,"
              + "?7,"
              + "?8,"
              + "?9,"
              + "?10,"
              + "?11,"
              + "?12,"
              + "?13,"
              + "?14,"
              + "?15,"
              + "?16,"
              + "?17,"
              + "?18,"
              + "?19,"
              + "?20,"
              + "?21,"
              + "?22,"
              + "?23,"
              + "?24,"
              + "?25,"
              + "?26,"
              + "?27,"
              + "?28,"
              + "?29,"
              + "?30,"
              + "?31,"
              + "?32,"
              + "?33,"
              + "?34,"
              + "?35,"
              + "?36,"
              + "?37,"
              + "?38)", nativeQuery = true)
	  public void ingresaDctoNE(int idLocal, int IdTipoOrden, int IdOrden, int IdDcto, int Indicador, String FechaDctoSqlServer, Double VrBaseSinRedondeo, int VrPago, int Estado, Double VrIva, 
			 int IdTipoNegocio, int VrRteFuente, Double VrDescuento, int VrRteIva, int VrRteIca, String NombreTercero, int IdUsuario, String IdCliente, int DiasPlazo, int PorcentajeDscto, 
			 int IdCausa, String IdDctoNitCC, String FechaDctoNitCCSqlServer, int VrPagarDctoNitCC, int VrDsctoFcro, Double VrCostoMV, int IdLocalCruce, int IdTipoOrdenCruce, int IdDctoCruce, 
			 int IdPeriodo, int IdVendedor, Double VrImpoconsumo, Double VrCostoIND, int IdOrdenCruce, int EtapaSTR, int EnvioFE,  String fechaPagoInicio, String fechaPagoFin);
	  
	  
	  
	  
	  @Modifying
	  @Transactional
	  @Query(value = " UPDATE tblDctos      "
              + " SET  IDORDEN =     "
              + "?1 ,     "
              + "      vrBase =      "
              + "?2,         "
              + "      vrPago =      "
              + "?2          "
              + " WHERE  idLocal   = "
              + "?3     "
              + " AND  IDTIPOORDEN = "
              + "?4   "
              + " AND  idDcto      = ?5 ",
              nativeQuery = true)
	  public void actualizaDctoNE(int xIdOrdenNew, Double xVrBase, int idLocal, int IdTipoOrden, int IdDcto);
	  
	  
	  
	  @Query(value = "SELECT  MAX(tbldctos.idDcto)   "
              + "                  AS idDcto        "
              + "FROM   tbldctos                "
              + "INNER JOIN tbltipoorden        "
              + "ON tbldctos.idTipoOrden      = "
              + "  tbltipoorden.idTipoOrden     "
              + "WHERE tbldctos.idLocal       = "
              + "?1                "
              + "AND   tbltipoorden.idAlcance = ?2 ",
              nativeQuery = true)
	  Integer maximoDctoLocalAlcance(int idLocal, int xIdAlcance);
	  
	  
	  @Query(value = "SELECT  MAX(tbldctos.idDcto)   "
              + "                  AS idDcto        "
              + "FROM   tbldctos                "
              + "WHERE tbldctos.idLocal       = "
              + "?1                ",
              nativeQuery = true)
	  Integer maximoDcto(int idLocal);
	  
	  @Query(value =  "                                                               "
		         + "      SELECT tblDctos.IDLOCAL,                                 "
		         + "            tblDctos.IDTIPOORDEN,                              "
		         + "     	  tblDctos.idOrden,                                    "
		         + "     	  tblDctos.idDcto,                                     "
		         + "     	  tblDctos.fechaDcto,                                  "
		         + "     	  tblDctos.idCliente,                                  "
		         + "     	  tblDctos.nombreTercero,                              "
		         + "     	 (tblDctos.vrBase +                                    "
		         + "            tblDctos.vrIva -                                   "
		         + "     	  tblDctos.vrDescuento -                               "
		         + "            tblDctos.vrRteFuente -                             "
		         + "     	  tblDctos.vrRteIva)                                   "
		         + "                           AS vrFactura,                       "
		         + "            tblDctos.envioFE,                                  "
		         + "            tblDctos.idDctoNitCC,                              "
		         + "            tblDctos.cufe,                                     "
				 + "			 tblDctosOrdenes.OBSERVACION AS observacion        "
		         + "     FROM     tblDctos                                         "
				 + "	  INNER JOIN tblDctosOrdenes                               "
				 + "	  ON tblDctos.IDLOCAL = tblDctosOrdenes.IDLOCAL            "
				 + "	  AND tblDctos.IDORDEN = tblDctosOrdenes.IDORDEN           "
		         + "     WHERE tblDctos.idLocal   = ?1                             "
		         + "     AND tblDctos.IDTIPOORDEN BETWEEN                          "
		         + "      600 AND 699                                              "
		         + "     AND tblDctos.indicador   =   1                            "
		         + "AND tblDctos.fechaDcto  BETWEEN                                "
		         + "?2 AND                                                         "
		         + "?3                                                             ",
              nativeQuery = true)
	  List<TblDctosDTO4> listaFechaDocumentoSoporte(int idLocal, String fechaInicial, String fechaFinal);
	  
	  
	  
	  @Query(value =  "SELECT tblDctos.idLocal,            "
              + "       tblDctos.IDTIPOORDEN,        "
              + "	  tblDctos.idDcto,             "
              + "	  tblDctos.fechaDcto,          "
              + "	  tblDctos.idCliente,          "
              + "	  tblDctos.nombreTercero,      "
              + "	 (tblDctos.vrBase +            "
              + "       tblDctos.vrIva -             "
              + "	  tblDctos.vrDescuento -       "
              + "       tblDctos.vrRteFuente -       "
              + "	  tblDctos.vrRteIva)           "
              + "                      AS vrFactura, "
              + "       CASE tblDctos.envioFE        "
              + "       WHEN 1 THEN 'Ingreso FE'     "
              + "       WHEN 2 THEN 'Finalizado OK'  "
              + "   WHEN 6 THEN 'Error fra con PayU' "
              + "  WHEN 11 THEN 'Error fra sin PayU' "
              + "     WHEN 7 THEN 'Error boton PayU' "
              + "  WHEN 8 THEN 'Error mail con PayU' "
              + "  WHEN 9 THEN 'Error mail sin PayU' "
              + "       WHEN 0 THEN ''               "
              + "       END   AS comentario,         "
              + "       tblDctos.envioFE,            "
              + "       tblDctos.cufe                "
              + "FROM     tblDctos                   "
              + "WHERE tblDctos.idLocal   =    ?1      "
              + "AND ( tblDctos.IDTIPOORDEN =   ?2     "
              + "OR   tblDctos.IDTIPOORDEN = 28 )    "
              + "AND tblDctos.indicador   =   1      "
              + "AND tblDctos.idPeriodo   =  ?3       ",
           nativeQuery = true)
	  List<TblDctosDTO4> listaFechaMapeoApi(int idLocal, int IDTIPOORDEN, int idPeriodo);
	  
	  
	  @Query(value =  "SELECT tblDctos.IDLOCAL,                      "
              + "       tblDctos.IDTIPOORDEN,                  "
              + "       tblDctos.IDORDEN,                      "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrBase + tblDctos.vrIva AS vrSaldo, "
              + "       tblDctos.vrImpoconsumo,                "
              + "       tblDctos.idDctoNitCC,                  "
              + "       DATEDIFF(DAY,tblDctos.fechaDcto      + "
              + "             tblDctos.diasPlazo ,GETDATE())   "
              + "                               AS diasMora,   "
              + "       (SELECT COUNT(*) AS numeroArticulo     "
              + "        FROM   tblDctosOrdenes                "
              + "        INNER JOIN tblDctosOrdenesDetalle     "
              + "        ON tblDctosOrdenes.IDLOCAL         =  "
              + "              tblDctosOrdenesDetalle.IDLOCAL  "
              + "        AND tblDctosOrdenes.IDTIPOORDEN    =  "
              + "          tblDctosOrdenesDetalle.IDTIPOORDEN  "
              + "        AND tblDctosOrdenes.IDORDEN        =  "
              + "              tblDctosOrdenesDetalle.IDORDEN  "
              + "        WHERE tblDctosOrdenes.IDLOCAL      =  "
              + "                            tblDctos.IDLOCAL  "
              + "        AND   tblDctosOrdenes.IDTIPOORDEN  =  "
              + "                        tblDctos.IDTIPOORDEN  "
              + "        AND   tblDctosOrdenes.IDORDEN      =  "
              + "                           tblDctos.IDORDEN)  "
              + "                           AS numeroArticulo, "
              + "        ( SELECT tblTipoOrden.nombreTipoOrden "
              + "          FROM tblTipoOrden                   "
              + "          WHERE tblTipoOrden.idTipoOrden   =  "
              + "                        tblDctos.idTipoOrden) "
              + "                           AS nombreTipoOrden "
              + "FROM tblDctos           "
              + "WHERE tblDctos.idLocal                     =  "
              + "?1                                            "
              + "AND   tblDctos.idTipoOrden                 IN "
              + "  ( 9,29 )                                      "
              + "AND   tblDctos.idCliente                   =  "
              + "?2                            "
              + "AND   tblDctos.fechaDcto BETWEEN              "
              + "?3     AND                                    "
              + "?4                                            "
              + "AND   tblDctos.indicador BETWEEN              "
              + "?5   AND                "
              + "?6                        "
              + "ORDER BY tblDctos.fechaDcto DESC              ",
           nativeQuery = true)
	  List<TblDctosDTO4> listaHistoriaDetalle(int idLocal,  String idCliente, String FechaInicial, String FechaFinal, int IndicadorInicia, int IndicadorFinal );
	  
	  
	  
	  @Query(value =  "SELECT tblDctos.IDLOCAL,                      "
              + "       tblDctos.idTipoOrden,                  "
              + "       tblDctos.IDORDEN,                      "
              + "       tblDctos.idDcto,                       "
              + "       tblDctos.indicador,                    "
              + "       tblDctos.fechaDcto,                    "
              + "       tblDctos.vrBase,                       "
              + "       tblDctos.vrIva,                        "
              + "       tblDctos.vrRteFuente,                  "
              + "       tblDctos.vrDescuento,                  "
              + "       tblDctos.vrRteIva,                     "
              + "       tblDctos.vrRteIca,                     "
              + "       tblDctos.idDctoNitCC,                  "
              + "       tblDctos.vrImpoconsumo,                "
              + "      tblDctos.idDctoCruce,                  "
              + "       (SELECT COUNT(*) AS numeroArticulo     "
              + "        FROM   tblDctosOrdenes                "
              + "        INNER JOIN tblDctosOrdenesDetalle     "
              + "        ON tblDctosOrdenes.IDLOCAL         =  "
              + "              tblDctosOrdenesDetalle.IDLOCAL  "
              + "        AND tblDctosOrdenes.IDTIPOORDEN    =  "
              + "          tblDctosOrdenesDetalle.IDTIPOORDEN  "
              + "        AND tblDctosOrdenes.IDORDEN        =  "
              + "              tblDctosOrdenesDetalle.IDORDEN  "
              + "        WHERE tblDctosOrdenes.IDLOCAL      =  "
              + "                            tblDctos.IDLOCAL  "
              + "        AND   tblDctosOrdenes.IDTIPOORDEN  =  "
              + "                        tblDctos.IDTIPOORDEN  "
              + "        AND   tblDctosOrdenes.IDORDEN      =  "
              + "                           tblDctos.IDORDEN)  "
              + "                           AS numeroArticulo, "
              + "        ( SELECT tblTipoOrden.nombreTipoOrden "
              + "          FROM tblTipoOrden                   "
              + "          WHERE tblTipoOrden.idTipoOrden   =  "
              + "                        tblDctos.idTipoOrden) "
              + "                           AS nombreTipoOrden "
          //    + "       tblDctos.vrRteCree                     "
              + "FROM tblDctos                                "
              + "WHERE tblDctos.idLocal                     =  "
              + "?1                               "
              + "AND   tblDctos.idTipoOrden                 IN "
              + "  (9,29)            "
              + "AND   tblDctos.idCliente                   =  "
              + "?2                            "
              + "AND   tblDctos.fechaDcto BETWEEN              "
              + "?3     AND                                    "
              + "?4                                            "
              + "AND   tblDctos.indicador BETWEEN              "
              + "?5   AND                "
              + "?6                        "
              + "ORDER BY tblDctos.fechaDcto DESC              ",
           nativeQuery = true)
	  List<TblDctosDTO4> listaOrdenPeriodo(int idLocal,  String idCliente, String FechaInicial, String FechaFinal, int IndicadorInicia, int IndicadorFinal );
	  
	  
	  
	  
	  
	  @Query(value = "           SELECT [IDLOCAL]                           "          
			  + "                ,[IDTIPOORDEN]                        "          
			  + "                ,[IDORDEN]                            "          
			  + "                ,[idDcto]                             "          
			  + "                ,[fechaDcto]                          "          
			  + "                ,[nombreTercero]                      "  
			  + "                ,[idCliente]                      " 
			  + "                ,[IDUSUARIO]                          "          
			  + "            FROM [BDAquamovil].[dbo].[tblDctos]       "          
			  + "            Where idlocal = ?1                       "          
			  + "            and IDTIPOORDEN = ?2                      "          
			  + "            and idDcto = ?3                            ",
              nativeQuery = true)
	  List<TblDctosDTO> listaOrdenDeTrabajo(int idLocal, int IdTipoOrden, int idDcto);
	  
	  
	  @Query(value = "          SELECT  tblDctos.IDLOCAL                                "          
			  + "                ,IDTIPOORDEN                                      "          
			  + "                ,IDORDEN                                          "          
			  + "                ,idDcto                                           "          
			  + "                ,idCliente                                        "          
			  + "                ,fechaDcto                                        "          
			  + "                ,nombreTercero                                    "          
			  + "                ,tblDctos.IDUSUARIO                               "          
			  + "                ,idPeriodo                                        "          
			  + "          	  ,ctrlUsuarios.nombreUsuario                        "          
			  + "            FROM BDAquamovil.dbo.tblDctos                         "          
			  + "            INNER JOIN BDAquamovil.dbo.ctrlUsuarios               "          
			  + "            ON tblDctos.IDLOCAL = ctrlUsuarios.idLocal            "          
			  + "            AND tblDctos.IDUSUARIO = ctrlUsuarios.idUsuario       "          
			  + "            where tblDctos.idlocal = ?1                          "          
			  + "            and tblDctos.IDTIPOORDEN = ?2                         "          
			  + "            and tblDctos.idPeriodo = ?3                       " ,
              nativeQuery = true)
	  List<TblDctosDTO> listaReporteOrdenDeTrabajo(int idLocal, int IdTipoOrden, int idPeriodo);
	  
	  
	  
	  @Query(value = "   SELECT [idDcto]                          "          
			  + "    FROM [bdaquamovil].[dbo].[tblDctos]     "          
			  + "    where idlocal = ?1                      "          
			  + "    and idPeriodo = ?2                      " 
			  + "    and IDTIPOORDEN IN (9,29)               "
			  + "    AND cufe IS NOT NULL                    "          
			  + "    AND LTRIM(RTRIM(cufe)) <> '';           " ,
              nativeQuery = true)
	  List<TblDctosDTO> listaPeriodoEnvioDIAN(int idLocal, int idPeriodo);
	  
	  
	  @Query(value = "SELECT  idDctoNitCC " +
              "FROM bdaquamovil.dbo.tblDctos " +
              "WHERE tblDctos.IDLOCAL = ?1 " +
              "AND tblDctos.IDTIPOORDEN = ?2 ",
              nativeQuery = true)
	  List<String> ObtenerListaIdDctoNitcc(int idLocal, int idTipoOrden);
}
