package com.marketing.Repository.dbaquamovil;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.marketing.Model.dbaquamovil.TblDctosOrdenes;
import com.marketing.Projection.ReporteSuiDTO;
import com.marketing.Projection.TblDctosOrdenesDTO;


@Repository
public interface TblDctosOrdenesRepo extends JpaRepository<TblDctosOrdenes, Integer> {

	 @Query("SELECT MAX(r.IDORDEN) FROM TblDctosOrdenes r "+
			 "WHERE r.IDLOCAL = ?1 " +
			 "AND r.IDTIPOORDEN  IN (17, 67) ")
	    Integer findMaxIDORDEN(int idLocal);
	 
	// Modificamos el IDTIPOORDEN de 67 a 17
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tblDctosOrdenes SET IDTIPOORDEN = 17 " +
		                 "WHERE IDTIPOORDEN = 67 AND tblDctosOrdenes.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenes.IDUSUARIO = ?2 " +
		                 "AND tblDctosOrdenes.IDORDEN = ?3", nativeQuery = true)
		  public void actualizarIdTipoOrden(int idLocal, int IDUSUARIO, int IDORDEN);
		  
		  // Obtener el IDTIPOORDEN, el IDUSUARIO y el IDORDEN del IDORDEN Maximo
		  @Query( value = "SELECT * " +
				  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
				  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
				  		  "AND tblDctosOrdenes.IDUSUARIO = ?2 " +
				  		  "AND IDORDEN = (SELECT MAX(IDORDEN) FROM bdaquamovil.dbo.tblDctosOrdenes WHERE IDLOCAL = ?1 AND IDUSUARIO = ?2)", nativeQuery = true)
		  List<TblDctosOrdenesDTO> ObtenerIdTipoOrdenAndIdUsuarioAndIdOrden(int IDLOCAL, int IDUSUARIO);
		  
		  
//		  @Query( value = "SELECT tblDctosOrdenes.idCliente " +
//		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
//		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
//		  		  "AND tblDctosOrdenes.IDUSUARIO = ?2 " +
//		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 67 "+
//		  		  "AND IDORDEN = (SELECT MAX(IDORDEN) FROM bdaquamovil.dbo.tblDctosOrdenes WHERE IDLOCAL = ?1 AND IDUSUARIO = ?2)", nativeQuery = true)
//		  Integer ObtenerIdCliente(int IDLOCAL, int IDUSUARIO);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.idCliente " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDUSUARIO = ?2 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 67 "+
		  		  "AND IDORDEN = ?3 ", nativeQuery = true)
		  Integer ObtenerIdCliente(int IDLOCAL, int IDUSUARIO, int idOrden);
		  
		  
		// Eliminamos los registros del IDORDEN de ese momento
		  @Modifying
		  @Transactional
		  @Query(value = "DELETE FROM bdaquamovil.dbo.tblDctosOrdenes " +
		                 "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenes.IDORDEN = ?2 " +
		                 "AND tblDctosOrdenes.IDTIPOORDEN = 67", nativeQuery = true)
		  public void eliminarRegistrosOrdenes(int idLocal, int IDORDEN);
		  
		  
		  @Query( value = "SELECT DISTINCT tblDctosOrdenes.idCliente " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		  "AND tblDctosOrdenes.ESTADO = 0 "
		  		  , nativeQuery = true)
		  List <String> ObtenerIdClienteIdTipoOrden17(int IDLOCAL);
		  
		  @Query( value = "SELECT DISTINCT tblDctosOrdenes.numeroOrden " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		  "AND tblDctosOrdenes.idCliente = ?2 " +
		  		  "AND tblDctosOrdenes.ESTADO = 0 "
		  		  , nativeQuery = true)
		  List <String> ObtenerListaIdOrden(int IDLOCAL, String idCliente);
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDLOG " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " + 
		  		  "AND tblDctosOrdenes.IDUSUARIO = ?2 " +
		  		  "AND tblDctosOrdenes.numeroOrden = ?3 "+
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 67 "
		  		  , nativeQuery = true)
		  Integer ObtenerIdLog(int IDLOCAL, Integer IDUSUARIO, int numeroOrden);
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDLOG " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " + 
		  		  "AND tblDctosOrdenes.idCliente = ?2 " +
		  		  "AND tblDctosOrdenes.IDORDEN = ?3 "+
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 "
		  		  , nativeQuery = true)
		  Integer ObtenerIdLog17(int IDLOCAL, String idCliente, int IDORDEN);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.idCliente " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		  "AND tblDctosOrdenes.IDORDEN = ?2"
		  		  , nativeQuery = true)
		  Integer ObtenerIdClientePorIdORden(int IDLOCAL, int IDORDEN);
		  
		// Modificamos el ESTADO a 1 Cuando se finaliza por completo la pqr 
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tblDctosOrdenes SET ESTADO = 1 " +
		                 "WHERE IDTIPOORDEN = 17 AND tblDctosOrdenes.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenes.IDORDEN = ?2 ", nativeQuery = true)
		  public void actualizarEstadoA1(int idLocal, int IDORDEN);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.FECHAORDEN " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		  "AND tblDctosOrdenes.IDORDEN = ?2"
		  		  , nativeQuery = true)
		  String ObtenerFechaRadicacion(int IDLOCAL, int IDORDEN);
		  
		  
		  @Query("SELECT MAX(r.numeroOrden) FROM TblDctosOrdenes r "+
					 "WHERE r.IDLOCAL = ?1 " +
					 "AND r.IDTIPOORDEN = 17 ")
			    Integer findMaxNumeroOrden(int idLocal);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDORDEN " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " + 
		  		  "AND tblDctosOrdenes.numeroOrden = ?2 "+
		  		  "AND tblDctosOrdenes.idCliente = ?3 "+
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 "
		  		  , nativeQuery = true)
		  Integer ObtenerIdOrden(int IDLOCAL,  int numeroOrden, String idCliente);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDORDEN " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " + 
		  		  "AND tblDctosOrdenes.IDLOG = ?2 "+
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 67 "
		  		  , nativeQuery = true)
		  Integer ObtenerIdOrdenDelIdLog(int IDLOCAL,  int idLog);
		  
		  @Query( value = "SELECT tblDctosOrdenes.numeroOrden " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 "+
		  		  "AND tblDctosOrdenes.IDORDEN = ?2 ", nativeQuery = true)
		  Integer ObtenerNumeroOrden(int IDLOCAL, int IDORDEN);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDTIPOORDEN " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDORDEN = ?2 " + 
		  		  "AND tblDctosOrdenes.IDLOG = ?3 ", nativeQuery = true)
		  Integer ObtenerTipoOrden(int IDLOCAL, int IDORDEN, int IDLOG);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDTIPOORDEN " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.idCliente = ?2 " + 
		  		  "AND tblDctosOrdenes.IDUSUARIO = ?3 " +
		  		  "AND IDTIPOORDEN = 67 ", nativeQuery = true)
		  Integer ObtenerTipoOrdenCliente(int IDLOCAL, String idCliente, int IDUSUARIO);
		  
		  
			// Actualizamos la FECHAENTREGA del IDORDEN
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tblDctosOrdenes SET FECHAENTREGA = ?3 " +
		                 "WHERE IDTIPOORDEN = 17 AND tblDctosOrdenes.IDLOCAL = ?1 " +
		                 "AND tblDctosOrdenes.IDORDEN = ?2 ", nativeQuery = true)
		  public void actualizarFECHAENTREGA(int idLocal, int IDORDEN, Timestamp FECHAENTREGA);
	
		  
		  @Query( value = "SELECT tblDctosOrdenes.ordenCompra " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 67 "+
		  		  "AND tblDctosOrdenes.IDORDEN = ?2 ", nativeQuery = true)
		  String ObtenerOrdenCompra(int IDLOCAL, int IDORDEN);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.numeroOrden " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " + 
		  		  "AND tblDctosOrdenes.IDORDEN IN ?2 "+
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		 "AND   CONVERT(VARCHAR(10), tblDctosOrdenes.FECHAORDEN, 23) " +
		  		  "BETWEEN ?3 AND  ?4 "
		  		  , nativeQuery = true)
		  List<Integer> ObtenerListaNumeroOrden(int IDLOCAL, List<Integer> IDORDEN, String fechaInicial, String fechaFinal );
		  
		  
		  @Query( value = "SELECT DISTINCT tblDctosOrdenes.idCliente " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
				  "JOIN bdaquamovil.dbo.tblDctos " +
		  		  "ON tblDctosOrdenes.IDLOCAL = tblDctos.IDLOCAL " + 
				  "AND tblDctosOrdenes.IDTIPOORDEN = tblDctos.IDTIPOORDEN " +
		  		  "AND tblDctosOrdenes.IDORDEN = tblDctos.IDORDEN " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " + 
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		  "AND   CONVERT(VARCHAR(10), tblDctosOrdenes.FECHAORDEN, 23) " +
		  		  "BETWEEN ?2 AND  ?3 "
		  		  , nativeQuery = true)
		  List<String> ObtenerListaClientesFecha(int IDLOCAL,  String fechaInicial, String fechaFinal );
		  
		  
		  
		  @Query( value = "SELECT tblCiudades.idDpto, " +
		  		  "CASE " +
		  		  "WHEN  tblLocales.idDptoCiudad<=9999 THEN SUBSTRING(LTRIM(RTRIM(STR(tblLocales.idDptoCiudad))), 2, 5) " +
		  		  "ELSE SUBSTRING(LTRIM(RTRIM(STR(tblLocales.idDptoCiudad))), 3, 6) " +
		  		  "END AS idCiudad, " +
		  		  "0 AS tipoAcentamiento, " +
		  		  "tblDctosOrdenes.numeroOrden, " +
		  		  "CONVERT(VARCHAR(12), tblDctosOrdenes.FECHAORDEN, 34) AS fechaRadicacion, " + 
		  		  "tmpTRAMITE.tipoTramite, " +
		  		  "tmpCAUSA.nombreCausa, " +
		  		  "'000' AS codigoCausaResolucion, " +
		  		  "tblDctosOrdenes.idCliente, " +
		  		  "tblDctosOrdenes.ordenCompra, " +
		  		  "tmpRESPUESTA.tipoRespuesta, " +
		  		  "CONVERT(VARCHAR(12), tblDctos.fechaDcto, 34) AS fechaDcto, " +
		  		  "tblDctos.idDcto, " +
		  		  "CONVERT(VARCHAR(12), tblDctos.fechaDcto, 34) AS fechaEjecucion, " +
		  		  "tmpNOTIFICACION.tipoNotificacion, " +
		  		  "CONVERT(VARCHAR(12), tblDctosOrdenes.FECHAENTREGA, 34) AS FECHAENTREGA " +
		  		  
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "JOIN bdaquamovil.dbo.tblLocales " +
		  		  "ON tblDctosOrdenes.IDLOCAL = tblLocales.idLocal " +
		  		  
		  		  "JOIN bdaquamovil.dbo.tblCiudades " +
		  		  "ON tblLocales.idDptoCiudad  = tblCiudades.IDCIUDAD " +
		  		  
		  		  "JOIN ( SELECT 	   tblDctosOrdenesDetalle.IDLOCAL, " +
		  		  "tblDctosOrdenesDetalle.IDTIPOORDEN, " +
		  		  "tblDctosOrdenesDetalle.IDORDEN, " +
		  		  "tblPlus.vrGeneral AS tipoTramite " +
		  		  "FROM  bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		  		  "JOIN  bdaquamovil.dbo.tblPlus " +
		  		  "ON tblDctosOrdenesDetalle.IDLOCAL = tblPlus.idLocal " +
		  		  "AND tblDctosOrdenesDetalle.IDPLU = tblPlus.idPlu " +
		  		  "WHERE tblPlus.idLinea = 200 " +
		  		  "AND tblPlus.idCategoria = 12 ) AS tmpTRAMITE " +
		  		  "ON tmpTRAMITE.IDLOCAL = tblDctosOrdenes.IDLOCAL " +
		  		  "AND tmpTRAMITE.IDTIPOORDEN = tblDctosOrdenes.IDTIPOORDEN " +
		  		  "AND tmpTRAMITE.IDORDEN = tblDctosOrdenes.IDORDEN " +
		  		  
		  		  "JOIN (	  SELECT tblDctosOrdenesDetalle.IDLOCAL, " +
		  		  "tblDctosOrdenesDetalle.IDTIPOORDEN, " +
		  		  "tblDctosOrdenesDetalle.IDORDEN, " +
		  		  "SUBSTRING(tblPlus.nombrePlu,1,1) AS nombreCausa " +
		  		  "FROM  bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		  		  "JOIN  bdaquamovil.dbo.tblPlus " +
		  		  "ON tblDctosOrdenesDetalle.IDLOCAL = tblPlus.idLocal " +
		  		  "AND tblDctosOrdenesDetalle.IDPLU = tblPlus.idPlu " +
		  		  "WHERE tblPlus.idLinea = 200 " +
		  		  "AND tblPlus.idCategoria = 11	) AS tmpCAUSA " +
		  		  "ON tmpCAUSA.IDLOCAL = tblDctosOrdenes.IDLOCAL " +
		  		  "AND tmpCAUSA.IDTIPOORDEN = tblDctosOrdenes.IDTIPOORDEN " +
		  		  "AND tmpCAUSA.IDORDEN = tblDctosOrdenes.IDORDEN " +
		  		  
		  		  "JOIN ( SELECT 	   tblDctosOrdenesDetalle.IDLOCAL, " +
		  		  "tblDctosOrdenesDetalle.IDTIPOORDEN, " +
		  		  "tblDctosOrdenesDetalle.IDORDEN, " +
		  		  "tblPlus.vrGeneral AS tipoRespuesta " +
		  		  "FROM  bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		  		  "JOIN  bdaquamovil.dbo.tblPlus " +
		  		  "ON tblDctosOrdenesDetalle.IDLOCAL = tblPlus.idLocal " +
		  		  "AND tblDctosOrdenesDetalle.IDPLU = tblPlus.idPlu " +
		  		  "WHERE tblPlus.idLinea = 200 " +
		  		  "AND tblPlus.idCategoria = 15 ) AS tmpRESPUESTA " +
		  		  "ON tmpRESPUESTA.IDLOCAL = tblDctosOrdenes.IDLOCAL " +
		  		  "AND tmpRESPUESTA.IDTIPOORDEN = tblDctosOrdenes.IDTIPOORDEN " +
		  		  "AND tmpRESPUESTA.IDORDEN = tblDctosOrdenes.IDORDEN " +
		  		  
		  		  
		  		  "JOIN ( SELECT 	   tblDctosOrdenesDetalle.IDLOCAL, " +
		  		  "tblDctosOrdenesDetalle.IDTIPOORDEN, " +
		  		  "tblDctosOrdenesDetalle.IDORDEN, " +
		  		  "tblPlus.vrGeneral AS tipoNotificacion " +
		  		  "FROM  bdaquamovil.dbo.tblDctosOrdenesDetalle " +
		  		  "JOIN  bdaquamovil.dbo.tblPlus " +
		  		  "ON tblDctosOrdenesDetalle.IDLOCAL = tblPlus.idLocal " +
		  		  "AND tblDctosOrdenesDetalle.IDPLU = tblPlus.idPlu " +
		  		  "WHERE tblPlus.idLinea = 200 " +
		  		  "AND tblPlus.idCategoria = 16 ) AS tmpNOTIFICACION " +
		  		  "ON tmpNOTIFICACION.IDLOCAL = tblDctosOrdenes.IDLOCAL " +
		  		  "AND tmpNOTIFICACION.IDTIPOORDEN = tblDctosOrdenes.IDTIPOORDEN " +
		  		  "AND tmpNOTIFICACION.IDORDEN = tblDctosOrdenes.IDORDEN " +
		  		  
		  		  "JOIN bdaquamovil.dbo.tblDctos " +
		  		  "ON tblDctosOrdenes.IDLOCAL  = tblDctos.IDLOCAL " +
		  		  "AND tblDctosOrdenes.IDORDEN  = tblDctos.IDORDEN " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN  = tblDctos.IDTIPOORDEN " +
		  		  
		  		  "WHERE tblDctosOrdenes.idLocal= ?1 " +
		  		  "AND   tblDctosOrdenes.IDTIPOORDEN = 17 " +
		  		  "AND   CONVERT(VARCHAR(10), tblDctosOrdenes.FECHAORDEN, 23) " +
		  		  "BETWEEN ?2 AND  ?3 "
		  		  , nativeQuery = true)
		  List<ReporteSuiDTO> ObtenerReporteSUI(int idLocal, String fechaInicial, String fechaFinal);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "DELETE FROM tbldctosordenes " +
		                 "WHERE tbldctosordenes.IDLOCAL =  ?1 " +
		                 "AND tbldctosordenes.IDTIPOORDEN IN (7,9,29, 59) " +
		                 "AND tbldctosordenes.idPeriodo =  ?2 ", nativeQuery = true)
		  public void retiraOrdenes(int idLocal, int idPeriodo);
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "INSERT INTO tbldctosordenes " +
		                 "(IDLOCAL " +
		                 ",IDTIPOORDEN " +
		                 ",IDORDEN " +
		                 ",FECHAORDEN " +
		                 ",ESTADO " +
		                 ",idCliente " +
		                 ",IDUSUARIO " +
		                 ",IDORIGEN " +
		                 ",IDLOG " +
		                 ",FECHAENTREGA " +
		                 ",TIPODCTO " +
		                 ",DIRECCIONDESPACHO " +
		                 ",EMAIL " +
		                 ",FAX " +
		                 ",CONTACTO " +
		                 ",OBSERVACION " +
		                 ",CIUDADDESPACHO " +
		                 ",FORMAPAGO " +
		                 ",ordenCompra " +
		                 ",descuentoComercial " +
		                 ",impuestoVenta  " +
		                 ",idRazon " +
		                 ",idEstadoTx " +
		                 ",idTipoTx " +
		                 ",numeroOrden " +
		                 ",idResponsable " +
		                 ",diasHistoria " +
		                 ",diasInventario " +
		                 ",idBodegaOrigen " +
		                 ",idBodegaDestino " +
		                 ",idPeriodo " +
		                 ",vrTotalDiferir " +
		                 ",cuotaDiferir " +
		                 ",porcentajeInteresADiferir " +
		                 ",vrInteresADiferir " +
		                 ",comentario " +
		                 ",historiaConsumo " +
		                 ",promedio  " +
		                 ",cuotaVencida " +
		                 ",estadoCorte " +
		                 ",fechaPagoUltimo " +
		                 ",vrPagoUltimo " +
		                 ",promedioEstrato " +
		                 ",fechaInicioContrato " +
		                 ",vrSalarioBasico " +
		                 ",vrSubsidioTransporte " +
		                 ",fechaFinContrato " +
		                 ",idContrato " +
		                 ",idMedio " +
		                 ",entidadMedio " +
		                 ",cuentaMedio) " +
		                 "SELECT  bak_DctosOrdenes.* " +
		                 "FROM    bak_DctosOrdenes " +
		                 "WHERE EXISTS ( " +
		                 "SELECT * " +
		                 "FROM bak_DctosOrdenesDetalle " +
		                 "WHERE bak_DctosOrdenes.IDLOCAL   = bak_DctosOrdenesDetalle.IDLOCAL " +
		                 "AND bak_DctosOrdenes.IDTIPOORDEN = bak_DctosOrdenesDetalle.IDTIPOORDEN " +
		                 "AND bak_DctosOrdenes.IDORDEN  = bak_DctosOrdenesDetalle.IDORDEN ) " +
		                 "AND  bak_DctosOrdenes.IDLOCAL =  ?1 " +
		                 "AND  bak_DctosOrdenes.IDTIPOORDEN IN (7,9,29, 59) " +
		                 "AND  bak_DctosOrdenes.idPeriodo  = ?2 ", nativeQuery = true)
		  public void ingresaOrdenes(int idLocal, int idPeriodo);
		  
		  
		  
		  
		  
		  @Query( value = " SELECT tbldctosordenes.IDLOCAL           "
	                + "   ,tbldctosordenes.IDTIPOORDEN         "
	                + "   ,tbldctosordenes.IDORDEN             "
	                + "   ,MAX(tbldctosordenes.idCliente)      "
	                + "              AS idCliente              "
	                + "  ,MAX(tblterceros.nombreTercero)       "
	                + "                AS nombreTercero        "
	                + "   ,MAX(tbldctosordenes.FECHAORDEN)     "
	                + "              AS fechaOrden             "
	                + "  ,MAX(tbldctosordenes.observacion)     "
	                + "                 AS observacion         "
	                + "  ,MAX(tbldctosordenes.idPeriodo)       "
	                + "             AS idPeriodo               "
	                + "  ,MAX(tbldctosordenes.vrTotalDiferir)  "
	                + "  	                   AS vrCredito    "
	                + "  ,MAX(tbldctosordenes.cuotaDiferir)    "
	                + "                    AS cantidad         "
	                + "  ,SUM( tmpFIN.vrVentaUnitario *        "
	                + "    tmpFIN.cuotaFacturada )             "
	                + "                    AS vrCreditoPagado      "
	                + "  ,SUM(tmpFIN.cuotaFacturada)           "
	                + "                 AS itemPadre      "
	                + "  ,MAX(tbldctosordenes.vrTotalDiferir)- "
	                + "  	   SUM( tmpFIN.vrVentaUnitario *   "
	                + "  	   tmpFIN.cuotaFacturada ) AS 	   "
	                + "  		      vrSaldo   "
	                + " FROM tbldctosordenes                   "
	                + " INNER JOIN (                           "
	                + "  SELECT IDLOCAL                        "
	                + "      ,IDTIPOORDEN                      "
	                + "      ,IDORDEN                          "
	                + "      ,SUM(VRVENTAUNITARIO)             "
	                + "                AS vrVentaUnitario,     "
	                + "       CASE                             "
	                + "       WHEN itemPadre > 1 THEN 1        "
	                + "       ELSE  0                          "
	                + "       END AS cuotaFacturada            "
	                + "  FROM  tbldctosordenesdetalle          "
	                + "  WHERE IDLOCAL       =                 "
	                + "?1                          "
	                + "    AND   IDTIPOORDEN   =               "
	                + "?2                      "
	                + "   AND   IDTIPO   =  8                  "
	                + "   GROUP BY IDLOCAL                     "
	                + "      ,IDTIPOORDEN                      "
	                + "      ,IDORDEN                          "
	                + "    ,itemPadre ) AS tmpFIN              "
	                + "  ON tmpFIN.idLocal       =             "
	                + "              tbldctosordenes.idLocal   "
	                + "  AND tmpFIN.idTipoOrden  =             "
	                + "          tbldctosordenes.idTipoOrden   "
	                + "  AND tmpFIN.idOrden      =             "
	                + "              tbldctosordenes.idOrden   "
	                + "  INNER JOIN tblterceros                "
	                + "  ON tblterceros.idLocal  =             "
	                + "              tbldctosordenes.idLocal   "
	                + "  AND tblterceros.idCliente  =          "
	                + "           tbldctosordenes.idCliente    "
	                + "  WHERE tbldctosordenes.idLocal  =      "
	                + "?1                         "
	                + "    AND tbldctosordenes.idTipoOrden =   "
	                + "?2                      "
	                + "  AND tbldctosordenes.cuotaDiferir > 0  "
	                + "  AND tblterceros.idTipoTercero    = 1  "
	                + "  GROUP BY tbldctosordenes.IDLOCAL      "
	                + "      ,tbldctosordenes.IDTIPOORDEN      "
	                + "      ,tbldctosordenes.IDORDEN          "
	                + "  HAVING                                "
	                + "  (MAX(tbldctosordenes.vrTotalDiferir)- "
	                + "    SUM(tmpFIN.vrVentaUnitario *        "
	                + "        tmpFIN.cuotaFacturada)) > 0 ", nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDetalleFinanciacion(int idLocal, int xIdTipoOrden);
		  
		  
		  
		  
		  @Query( value = " SELECT tbldctosordenes.IDLOCAL           "
	                + "   ,tbldctosordenes.IDTIPOORDEN         "
	                + "   ,tbldctosordenes.IDORDEN             "
	                + "   ,MAX(tbldctosordenes.idCliente)      "
	                + "              AS idCliente              "
	                + "  ,MAX(tblterceros.nombreTercero)       "
	                + "                AS nombreTercero        "
	                + "   ,MAX(tbldctosordenes.FECHAORDEN)     "
	                + "              AS fechaOrden             "
	                + "  ,MAX(tbldctosordenes.observacion)     "
	                + "                 AS observacion         "
	                + "  ,MAX(tbldctosordenes.idPeriodo)       "
	                + "             AS idPeriodo               "
	                + "  ,MAX(tbldctosordenes.vrTotalDiferir)  "
	                + "  	                   AS vrCredito    "
	                + "  ,MAX(tbldctosordenes.cuotaDiferir)    "
	                + "                    AS cantidad         "
	                + "  ,SUM( tmpFIN.vrVentaUnitario *        "
	                + "    tmpFIN.cuotaFacturada )             "
	                + "                    AS vrFacturado      "
	                + "  ,SUM(tmpFIN.cuotaFacturada)           "
	                + "                 AS cuotaFacturada      "
	                + "  ,MAX(tbldctosordenes.vrTotalDiferir)- "
	                + "  	   SUM( tmpFIN.vrVentaUnitario *   "
	                + "  	   tmpFIN.cuotaFacturada ) AS 	   "
	                + "  		      vrCreditoPendiente   "
	                + " FROM tbldctosordenes                   "
	                + " INNER JOIN (                           "
	                + "  SELECT IDLOCAL                        "
	                + "      ,IDTIPOORDEN                      "
	                + "      ,IDORDEN                          "
	                + "      ,SUM(VRVENTAUNITARIO)             "
	                + "                AS vrVentaUnitario,     "
	                + "       CASE                             "
	                + "       WHEN itemPadre > 1 THEN 1        "
	                + "       ELSE  0                          "
	                + "       END AS cuotaFacturada            "
	                + "  FROM  tbldctosordenesdetalle          "
	                + "  WHERE IDLOCAL       =                 "
	                + "?1                          "
	                + "    AND   IDTIPOORDEN   =               "
	                + "?2                      "
	                + "   AND   IDTIPO   =  8                  "
	                + "   GROUP BY IDLOCAL                     "
	                + "      ,IDTIPOORDEN                      "
	                + "      ,IDORDEN                          "
	                + "    ,itemPadre ) AS tmpFIN              "
	                + "  ON tmpFIN.idLocal       =             "
	                + "              tbldctosordenes.idLocal   "
	                + "  AND tmpFIN.idTipoOrden  =             "
	                + "          tbldctosordenes.idTipoOrden   "
	                + "  AND tmpFIN.idOrden      =             "
	                + "              tbldctosordenes.idOrden   "
	                + "  INNER JOIN tblterceros                "
	                + "  ON tblterceros.idLocal  =             "
	                + "              tbldctosordenes.idLocal   "
	                + "  AND tblterceros.idCliente  =          "
	                + "           tbldctosordenes.idCliente    "
	                + "  WHERE tbldctosordenes.idLocal  =      "
	                + "?1                          "
	                + "    AND tbldctosordenes.idTipoOrden =   "
	                + "?2                      "
	                + "    AND tbldctosordenes.idPeriodo   =   "
	                + "?3                        "                
	                + "  AND tbldctosordenes.cuotaDiferir =    "
	                + "?4                         "
	                + "  AND tblterceros.idTipoTercero    = 1  "
	                + "  GROUP BY tbldctosordenes.IDLOCAL      "
	                + "      ,tbldctosordenes.IDTIPOORDEN      "
	                + "      ,tbldctosordenes.IDORDEN ", nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDetalleFinanciacionCuotaDiferir(int idLocal, int xIdTipoOrden, int idPeriodo, Double xCuotaDiferir);
		  
		  
		  
		  
		  @Query( value = " SELECT tbldctos.IDLOCAL                 "
	                + "       ,tbldctos.IDTIPOORDEN           "
	                + "       ,tbldctos.IDORDEN               "
	                + "       ,idDcto                         "
	                + "       ,MAX(tbldctos.idCliente)        "
	                + " 	              AS idCliente        "
	                + " 	  ,MAX(tblterceros.nombreTercero) "
	                + " 	                AS nombreTercero  "
	                + "       ,MAX(tbldctos.fechaDcto)        "
	                + " 	              AS fechaOrden       "
	                + "     ,MAX(tbldctosordenes.observacion) "
	                + " 	                  AS observacion  "
	                + "       ,MAX(tbldctos.idPeriodo)        "
	                + " 	                    AS idPeriodo  "
	                + "  ,MAX(tbldctosordenes.vrTotalDiferir) "
	                + "	                   AS vrCredito   "
	                + "  ,MAX(tbldctosordenes.cuotaDiferir)   "
	                + " 	                   AS cantidad    "
	                + "      ,SUM( tmpFIN.vrVentaUnitario *   "
	                + " 	   tmpFIN.cuotaFacturada )        "
	                + " 	                   AS vrFacturado "
	                + " 	  ,SUM(tmpFIN.cuotaFacturada)     "
	                + " 	              AS cuotaFacturada   "
	                + " ,MAX(tbldctosordenes.vrTotalDiferir)- "
	                + " 	   SUM( tmpFIN.vrVentaUnitario *  "
	                + " 	   tmpFIN.cuotaFacturada ) AS 	  "
	                + " 		      vrCreditoPendiente  "
	                + "       ,MAX(tmpFIN.idPlu) AS idPlu     "
	                + "       ,MAX(tmpFIN.NOMBREPLU)          "
	                + "                          AS nombrePlu "
	                + "   FROM tbldctos                       "
	                + "   INNER JOIN tbldctosordenes          "
	                + "   ON tbldctos.idLocal      =          "
	                + "              tbldctosordenes.idLocal  "
	                + "   AND tbldctos.idTipoOrden =          "
	                + "         tbldctosordenes.idTipoOrden   "
	                + "   AND tbldctos.idOrden     =          "
	                + "             tbldctosordenes.idOrden   "
	                + "   INNER JOIN (                        "
	                + "   SELECT IDLOCAL                      "
	                + "       ,IDTIPOORDEN                    "
	                + "       ,IDORDEN                        "
	                + "       ,SUM(VRVENTAUNITARIO)           "
	                + " 	              AS vrVentaUnitario  "
	                + "    ,MAX(tbldctosordenesdetalle.idPLU) "
	                + "                             AS idPLU  "
	                + " ,MAX(tbldctosordenesdetalle.NOMBREPLU)"
	                + "                         AS nombrePlu  "
	                + " ,CASE                                 "
	                + "     WHEN itemPadre > 1 THEN 1         "
	                + "     ELSE  0                           "
	                + " END AS cuotaFacturada                 "
	                + "   FROM  tbldctosordenesdetalle        "
	                + "   WHERE IDLOCAL       =               "
	                + "?1                         "
	                + "   AND   IDTIPOORDEN   =               "
	                + "?2                     "
	                + "    AND   IDTIPO   !=  8                "
	                + "   GROUP BY IDLOCAL                    "
	                + "       ,IDTIPOORDEN                    "
	                + "       ,IDORDEN                        "
	                + " 	  ,itemPadre ) AS tmpFIN          "
	                + "   ON tmpFIN.idLocal       =           "
	                + "       tbldctosordenes.idLocal         "
	                + "   AND tmpFIN.idTipoOrden  =           "
	                + "     tbldctosordenes.idTipoOrden       "
	                + "   AND tmpFIN.idOrden      =           "
	                + "        tbldctosordenes.idOrden        "
	                + "   INNER JOIN tblterceros              "
	                + "   ON tblterceros.idLocal  =           "
	                + "             tbldctos.idLocal          "
	                + "   AND tblterceros.idCliente  =        "
	                + "             tbldctos.idCliente        "
	                + "   WHERE tbldctos.idLocal  =           "
	                + "?1                        "
	                + "   AND tbldctos.idTipoORden=           "
	                + "?2                     "
	                + "   AND tbldctos.vrBase     <> 0         "
	                + "   AND                                 "
	                + " tblterceros.idTipoTercero = 1         "
	                + "   GROUP BY tbldctos.IDLOCAL           "
	                + "       ,tbldctos.IDTIPOORDEN           "
	                + "       ,tbldctos.IDORDEN               "
	                + "       ,idDcto ", nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDetalleCobroPermanente(int idLocal, int xIdTipoOrden);
		  
		  
	//ACTUAL	  
		  @Query( value = "                    SELECT tbldctos.idLocal,                                               "                                       
	                + "                      tbldctos.idOrden,                                                    "                                    
	                + "                      tbldctos.idDcto,                                                     "                                    
	                + "                      tbldctos.idPeriodo,                                                  "                                    
	                + "                      tbldctos.fechaDcto,                                                  "                                    
	                + "                      tbldctos.idCliente,                                                  "                                    
	                + "              	   tbldctos.nombreTercero,                                                "                                    
	                + "              	   tbldctosordenes.promedio,                                              "                                    
	                + "                      tbldctosordenes.promedioEstrato,                                     "                                    
	                + "                      tbldctosordenes.cuotaVencida,                                        "                                    
	                + "                      (CASE WHEN (tbldctosordenes.cuotaVencida = 0)                        "                                    
	                + "                           THEN 0 WHEN (tbldctosordenes.cuotaVencida > 0)                  "                                    
	                + "                           THEN (tbldctosordenes.cuotaVencida * 30)                        "                                    
	                + "              			                     END) AS diasMora,                            "                                    
	                + "              	    'FIN. '+ stuff(tmpDET.comentario, 1,                                  "                                    
	                + "              	    charindex(' CTA', tmpDET.comentario), '')                             "                                    
	                + "              					      AS financiacion,                                    "                                    
	                + "                      (tmpDET.comentario) AS textoFinanciacion,                            "                                    
	                + "                      tbldctosordenes.comentario,                                          "                                    
	                + "              	   tblTerceros.email,                                                     "                                    
	                + "              	   tbldctosordenes.DIRECCIONDESPACHO                                      "                                    
	                + "              		                          AS direccionTercero,                        "                                    
	                + "              	   tbldctosordenes.historiaConsumo,                                       "                                    
	                + "              	   tblterceros.numeroMedidor,                                             "                                    
	                + "              	   tblmedidores.marcaMedidor,                                             "                                    
	                + "                      tblterceros.fechaInstalacionMedidor,                                 "                                    
	                + "              	   tblterceros.CC_Nit,                                                    "                                    
	                + "              	   tblterceros.direccionCobro,                                            "                                    
	                + "              	   tblterceros.codigoCatastral,                                           "                                    
	                + "                      tblterceros.ordenRuta,                                               "                                    
	                + "              	   tmpDET.idRuta,                                                         "                                    
	                + "              	   tmpDET.nombreRuta,                                                     "                                    
	                + "              	   tmpDET.idEstracto,                                                     "                                    
	                + "              	   tmpDET.codigoClaseUso,                                                 "                                    
	                + "              	   tmpDET.nombreEstracto,                                                 "                                    
	                + "              	   tbldctosperiodo.fechaInicial,                                          "                                    
	                + "              	   tbldctosperiodo.fechaFinal,                                            "                                    
	                + "              	   tbldctosperiodo.fechaConRecargo,                                       "                                    
	                + "              	   tbldctosperiodo.fechaSinRecargo,                                       "                                    
	                + "              	   tbldctosperiodo.nombrePeriodo,                                         "                                    
	                + "              	   (tmpLEC.lecturaMedidor) AS lecturaActual,                              "                                    
	                + "              	   tmpLEC.lecturaAnterior,                                                "                                    
	                + "              	   tmpCON.consumo,                                                        "                                    
	                + "                      tmpLEC.nombreCausa,                                                  "                                    
	                + "              	   (CASE WHEN (tbldctosordenes.cuotaVencida) >=                           "                                    
	                + "                                (tbllocales.cuotaSuspension)	                              "                                    
	                + "                           THEN (tbllocales.txtSuspension)                                 "                                    
	                + "                              		        END) AS txtSuspension,                        "                                    
	                + "                      tbldctosordenes.fechaPagoUltimo AS fechaPagoUltimo,                  "                                    
	                + "                      tbldctosordenes.vrPagoUltimo AS vrPagoUltimo,                        "                                    
	                + "                      0.0 AS vrBase,                                                       "                                    
	                + "                      0.0 AS vrIva,                                                        "                                    
	                + "                      0.0 AS vrFactura,                                                    "                                    
	                + "                      tmpDET.idTipo AS idTipoNegativo,                                     "                                    
	                + "                      CASE WHEN tmpDET.VRVENTAUNITARIO<0                                   "                                    
	                + "                            THEN CONVERT(numeric(10,2),                                    "                                    
	                + "                           ABS(tmpDET.VRVENTAUNITARIO* tmpDET.CANTIDAD))                   "                                    
	                + "                              ELSE 0 END AS vrTipoNegativo,                                "                                    
	                + "                      tmpDET.CANTIDAD,                                                     "                                    
	                + "                      tmpDET.VRVENTAUNITARIO,                                              "                                    
	                + "                      tmpDET.PORCENTAJEIVA,                                                "                                    
	                + "                      tmpDET.idPlu,                                                        "                                    
	                + "                      tmpCAT.NOMBREPLU,                                                    "                                    
	                + "                    CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                  "                                    
	                + "                    ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2))                                  "                                    
	                + "                                                AS vrBaseUnitarioSinIva,                   "                                    
	                + "                    CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                  "                                    
	                + "                    ( 1+ tmpDET.PORCENTAJEIVA/100 ),2) *                                   "                                    
	                + "                     tmpDET.CANTIDAD *                                                     "                                    
	                + "                     tmpDET.PORCENTAJEIVA/100.0 ) AS vrIvaUnitario,                        "                                    
	                + "                    CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                  "                                    
	                + "                     ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2) *                                "                                    
	                + "                     tmpDET.CANTIDAD) AS vrVentaUnitarioSinIva,                            "                                    
	                + "                      tbldctos.vrRteFuente,                                                "                                    
	                + "                      tbldctos.vrRteIva,                                                   "                                    
	                + "                      1.0 AS porcentajeRteFuente,                                          "                                    
	                + "                      6 AS taxId_RteFuente,                                                "                                    
	                + "                      1.0 AS porcentajeRteIva,                                             "                                    
	                + "                      5 AS taxId_RteIva,                                                   "                                    
	                + "                      1 AS taxId_Iva,                                                      "                                    
	                + "                    CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                  "                                    
	                + "                    ( 1+ tmpDET.PORCENTAJEIVA/100.0 ) *                                    "                                    
	                + "                     tmpDET.CANTIDAD *                                                     "                                    
	                + "                    1.0 / 100.00,2)) AS vrUnitarioRteFuente,                               "                                    
	                + "                    CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                  "                                    
	                + "                     ( 1+ tmpDET.PORCENTAJEIVA/100 ) *                                     "                                    
	                + "                     tmpDET.CANTIDAD *                                                     "                                    
	                + "                     tmpDET.PORCENTAJEIVA/100.0 *                                          "                                    
	                + "                     1.0 / 100.00,2)) AS vrUnitarioRteIva,                                 "                                    
	                + "                     tbldctos.cufe                                                         "                                    
	                + "                     ,ISNULL(tmpDEU.vrDeudaAnterior,0) AS vrDeudaAnterior                  "                                    
	                + "                      ,tmpCAT.idProducto                                                   "                                    
	                + "                    FROM tbldctos				                                          "                                    
	                + "                    INNER JOIN                                                             "                                    
	                + "                    (SELECT tbldctosordenesdetalle.idLocal,                                "                                    
	                + "                       CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29                   "                                    
	                + "                       THEN 9 ELSE tbldctosordenesdetalle.IDTIPOORDEN                      "                                    
	                + "                       END AS IDTIPOORDEN,                                                 "                                    
	                + "                       CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29                   "                                    
	                + "                       THEN idOrdenCruce                                                   "                                    
	                + "                       ELSE tbldctosordenesdetalle.idOrden                                 "                                    
	                + "                       END AS idOrden,                                                     "                                    
	                + "                       tbldctosordenesdetalle.idPlu,                                       "                                    
	                + "                       tbldctosordenesdetalle.idTipo,                                      "                                    
	                + "                       tbldctosordenesdetalle.CANTIDAD,                                    "                                    
	                + "                       tbldctosordenesdetalle.VRVENTAUNITARIO,                             "                                    
	                + "                      (tbldctosordenesdetalle.PORCENTAJEIVA)                               "                                    
	                + "                                                        AS PORCENTAJEIVA,                  "                                    
	                + "                       tbldctosordenesdetalle.nombrePlu,                                   "                                    
	                + "                       tbltercerosruta.idRuta,                                             "                                    
	                + "              	    tbltercerosruta.nombreCiclo + '-' +                                   "                                    
	                + "                               tbltercerosruta.nombreRuta AS nombreRuta,                   "                                    
	                + "              	    tblterceroestracto.idEstracto,                                        "                                    
	                + "              	    tblterceroestracto.codigoClaseUso,                                    "                                    
	                + "              	    tblterceroestracto.nombreEstracto,                                    "                                    
	                + "                       tbldctosordenesdetalle.comentario                                   "                                    
	                + "                FROM tbldctos                                                              "                                    
	                + "                INNER JOIN tbldctosordenesdetalle                                          "                                    
	                + "                ON tbldctos.IDLOCAL = tbldctosordenesdetalle.IDLOCAL                       "                                    
	                + "                AND tbldctos.IDTIPOORDEN =                                                 "                                    
	                + "                                       tbldctosordenesdetalle.IDTIPOORDEN                  "                                    
	                + "                AND tbldctos.IDORDEN = tbldctosordenesdetalle.IDORDEN                      "                                    
	                + "                INNER JOIN tbltercerosruta                                                 "                                    
	                + "                ON tbldctosordenesdetalle.IDLOCAL =                                        "                                    
	                + "                                                  tbltercerosruta.idLocal                  "                                    
	                + "                AND tbldctosordenesdetalle.idRuta =                                        "                                    
	                + "                                                   tbltercerosruta.idRuta                  "                                    
	                + "                INNER JOIN tblterceroestracto                                              "                                    
	                + "                ON tbldctosordenesdetalle.IDLOCAL =                                        "                                    
	                + "                                               tblterceroestracto.idLocal                  "                                    
	                + "                AND tbldctosordenesdetalle.idEstracto =                                    "                                    
	                + "                                            tblterceroestracto.idEstracto                  "                                    
	                + "                WHERE tbldctos.idLocal =                                                   "                                    
	                + "               ?1                                                                         "                                    
	                + "                AND tbldctos.idPeriodo =                                                   "                                    
	                + "               ?3                                                                      "                                    
	                + "                AND tbldctos.idTipoOrden IN (9,29)                                         "                                    
	                + "                AND tbldctosordenesdetalle.VRVENTAUNITARIO!=0                              "                                    
	                + "                AND tbldctosordenesdetalle.CANTIDAD != 0) AS tmpDET 					      "                                    
	                + "               ON tbldctos.IDLOCAL = tmpDET.IDLOCAL                                        "                                    
	                + "               AND tbldctos.IDTIPOORDEN = tmpDET.IDTIPOORDEN                               "                                    
	                + "               AND tbldctos.IDORDEN = tmpDET.IDORDEN                                       "                                    
	                + "               INNER JOIN                                                                  "                                    
	                + "               (SELECT tblplus.idLocal                                                     "                                    
	                + "                      ,tblplus.idPlu                                                       "                                    
	                + "                      ,RTRIM(LTRIM(                                                        "                                    
	                + "                      tblcategorias.nombreCategoria)) + ' ' +                              "                                    
	                + "                       tblplus.nombrePlu AS nombrePlu,                                     "                                    
	                + "                       tblcategorias.idProducto                                            "                                    
	                + "                FROM tblcategorias                                                         "                                    
	                + "                INNER JOIN tblplus                                                         "                                    
	                + "                ON tblcategorias.idLocal = tblplus.idLocal                                 "                                    
	                + "                AND tblcategorias.idLinea = tblplus.idLinea                                "                                    
	                + "                AND tblcategorias.idCategoria = tblplus.idCategoria                        "                                    
	                + "                WHERE tblplus.idLocal =                                                    "                                    
	                + "               ?1 ) AS tmpCAT                                                             "                                    
	                + "               ON tbldctos.idLocal = tmpCAT.idLocal                                        "                                    
	                + "               AND tmpDET.idPlu = tmpCAT.idPlu                                             "                                    
	                + "               INNER JOIN  tbldctosordenes                                                 "                                    
	                + "               ON tbldctosordenes.IDLOCAL = tbldctos.IDLOCAL                               "                                    
	                + "               AND tbldctosordenes.IDTIPOORDEN = tbldctos.IDTIPOORDEN                      "                                    
	                + "               AND tbldctosordenes.IDORDEN = tbldctos.IDORDEN                              "                                    
	                + "               INNER JOIN tbllocales                                                       "                                    
	                + "               ON tbllocales.idLocal = tbldctosordenes.IDLOCAL                             "                                    
	                + "               INNER JOIN tblterceros                                                      "                                    
	                + "               ON tbldctos.IDLOCAL = tblterceros.idLocal                                   "                                    
	                + "               AND tbldctos.idCliente = tblterceros.idCliente                              "                                    
	                + "               INNER JOIN tbldctosperiodo                                                  "                                    
	                + "               ON tbldctos.IDLOCAL = tbldctosperiodo.idLocal                               "                                    
	                + "               AND tbldctos.idPeriodo = tbldctosperiodo.idPeriodo                          "          
					+ "          	                                                                              "          
	                + "                                                                                           "          
	                + "               INNER JOIN (SELECT                                                          "          
	                + "                       CTE.IDLOCAL,                                                        "          
	                + "                       CTE.idCliente,                                                      "          
	                + "                       CTE.idOrden,                                                        "          
	                + "                       CTE.nombreCausa AS nombreCausa,                                     "             
	                + "              CONVERT(int, CTE.lecturaMedidor) AS lecturaMedidor,                          "                   
	                + "              CONVERT(int, CTE.lecturaAnterior) AS lecturaAnterior                         "          
	                + "              FROM (                                                                       "          
	                + "                 SELECT                                                                    "          
	                + "                 tbldctosordenesdetalle.IDLOCAL,                                           "          
	                + "                 tbldctosordenesdetalle.idCliente,                                         "                    
	                + "                 tbldctosordenesdetalle.idOrden,                                           "                    
	                + "                 tbltipocausanota.nombreCausa AS nombreCausa,                              "                    
	                + "                 CONVERT(int, tbldctosordenesdetalle.lecturaMedidor) AS lecturaMedidor,    "                                         
	                + "                 CONVERT(int, tbldctosordenesdetalle.lecturaAnterior) AS lecturaAnterior,  "          
	                + "                 ROW_NUMBER() OVER (PARTITION BY tbldctosordenesdetalle.idCliente          "          
					+ "          	   ORDER BY tbldctosordenesdetalle.idOrden DESC) AS rn                        "          
	                + "                 FROM tbldctosordenesdetalle                                               "                           
	                + "                 INNER JOIN tbldctos ON                                                    "          
	                + "                 tbldctosordenesdetalle.IDLOCAL = tbldctos.IDLOCAL                         "                        
	                + "                 AND tbldctosordenesdetalle.IDTIPOORDEN = tbldctos.IDTIPOORDEN             "                                   
	                + "                 AND tbldctosordenesdetalle.IDORDEN = tbldctos.IDORDEN                     "                            
	                + "                 INNER JOIN tbltipocausanota ON                                            "          
	                + "                 tbltipocausanota.idCausa = tbldctosordenesdetalle.idNovedadLectura        "                                        
	                + "                 WHERE tbltipocausanota.idTipoTabla = 2                                    "                        
	                + "                 AND tbldctosordenesdetalle.idTipo = 4                                     "                       
	                + "                 AND tbldctosordenesdetalle.idLocal = ?1                                  "                                               
	                + "                 AND tbldctos.idPeriodo = ?3                                           "                          
	                + "                 AND tbldctos.idTipoOrden IN (9,29)                                        "                           
	                + "                 AND tbldctos.idCliente IN (?2)                                         "          
	                + "                 ) AS CTE                                                                  "          
	                + "                 WHERE rn = 1                                                              "          
	                + "                   ) AS tmpLEC                                                             "          
					+ "          	                                                                              "          
	                + "                                                                                           "          
	                + "                                                                                           "          
	                + "                ON tmpLEC.IDLOCAL = tbldctos.IDLOCAL                                       "                                    
	                + "                AND tmpLEC.idCliente = tbldctos.idCliente                                  "                                                     
	                + "               INNER JOIN tblmedidores                                                     "                                    
	                + "               ON tblmedidores.idLocal =tblterceros.IDLOCAL                                "                                    
	                + "               AND tblmedidores.idMedidor = tblterceros.idMedidor                          "                                    
	                + "               INNER JOIN 									                              "                       
	                + "               (SELECT tbldctos.IDLOCAL,                                                   "                                    
	                + "                       tbldctos.idcliente,                                                 "                                    
	                + "              	    SUM(tbldctosordenesdetalle.CANTIDAD)                                  "                                    
	                + "              	                                     AS consumo                           "                                    
	                + "               FROM tbldctos                                                               "                                    
	                + "               INNER JOIN tbldctosordenesdetalle                                           "                                    
	                + "               ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL                        "                                    
	                + "               AND tbldctos.idTipoOrden =                                                  "                                    
	                + "                                 tbldctosordenesdetalle.idTipoOrden   					  "                                    
	                + "               AND tbldctos.idOrden =                                                      "                                    
	                + "                                 tbldctosordenesdetalle.idOrden                            "                                    
	                + "                                                                                           "                                    
	                + "               WHERE tbldctosordenesdetalle.IDTIPO = 4                                     "                                    
	            	+ "          	      AND tbldctos.IDLOCAL= ?1                                               "                                    
	            	+ "          	      AND tbldctos.idPeriodo =  ?3                                        "                                    
	            	+ "          		   AND tbldctos.idCliente IN  (?2)                                     "                                     
	            	+ "          		   AND tbldctos.IDTIPOORDEN IN (9, 29)                                    "                                    
	                + "               GROUP BY tbldctos.IDLOCAL,                                                  "                                    
	                + "                       tbldctos.idcliente) AS tmpCON 									"          	          	   
	                + "               ON tmpCON.IDLOCAL = tbldctos.IDLOCAL                                        "                                    
	                + "               AND tmpCON.idCliente= tbldctos.idCliente                                    "                                          
	                + "               LEFT JOIN  (                                                                "                                    
	                + "               SELECT tmpSUB.idLocal,                                                      "                                    
	                + "                      tmpSUB.idTipoOrden,                                                  "                                    
	                + "                      tmpSUB.idOrden,                                                      "                                    
	                + "                     SUM(tmpSUB.vrVentaUnitario) AS vrDeudaAnterior                        "                                    
	                + "               FROM                                                                        "                                    
	                + "               (SELECT tbldctos.idLocal,                                                   "                                    
	                + "                      tbldctos.idTipoOrden,                                                "                                    
	                + "                      tbldctos.idOrden,                                                    "                                    
	                + "                      tbldctosordenesdetalle.vrVentaUnitario,                              "                                    
	                + "                      tbldctosordenesdetalle.idOrden AS allReg,                            "                                    
	              	+ "               tbldctosordenesdetalle.IDPLU                                                "                                     
	                + "               FROM tbldctos                                                               "                                    
	                + "               INNER JOIN tbldctosordenesdetalle                                           "                                    
	                + "               ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL                        "                                    
	                + "               AND tbldctos.idTipoOrden =                                                  "                                    
	                + "                                 tbldctosordenesdetalle.idTipoOrden                        "                                    
	                + "               AND tbldctos.idOrden =tbldctosordenesdetalle.idOrden                        "                                    
	                + "               AND tbldctos.idCliente =                                                    "                                    
	                + "              			tbldctosordenesdetalle.idCliente                                  "                                    
	                + "               WHERE tbldctosordenesdetalle.idLocal    =                                   "                                    
	                + "               ?1                                                                         "                                    
	                + "               AND tbldctosordenesdetalle.IDTIPOORDEN  = 9                                 "                                    
	                + "               AND tbldctosordenesdetalle.IDTIPO       > 100                               "                                    
	                + "               AND tbldctos.idPeriodo                  =                                   "                                    
	                + "               ?3                                                                      "                                    
	                + "               AND tbldctosordenesdetalle.VRVENTAUNITARIO != 0                             "                                    
	                + "               UNION                                                                       "                                    
	                + "               SELECT tbldctos.idLocal,                                                    "                                    
	                + "                      tbldctos.idTipoOrdenCruce AS idTipoOrden,                            "                                    
	                + "                      tbldctos.idOrdenCruce AS idOrden,                                    "                                    
	                + "                      tbldctosordenesdetalle.vrVentaUnitario,                              "                                    
	                + "                      tbldctosordenesdetalle.idOrden AS allReg,                            "                                    
	              	+ "               tbldctosordenesdetalle.IDPLU                                                "                                     
	                + "               FROM tbldctos                                                               "                                    
	                + "               INNER JOIN tbldctosordenesdetalle                                           "                                    
	                + "               ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL                        "                                    
	                + "               AND tbldctos.idTipoOrden =                                                  "                                    
	                + "                                 tbldctosordenesdetalle.idTipoOrden                        "                                    
	                + "               AND tbldctos.idOrden =tbldctosordenesdetalle.idOrden                        "                                    
	                + "               AND tbldctos.idCliente =                                                    "                                    
	                + "              			tbldctosordenesdetalle.idCliente                                  "                                    
	                + "               WHERE tbldctosordenesdetalle.idLocal    = ?1                               "                                    
	                + "               AND tbldctosordenesdetalle.IDTIPOORDEN  = 29                                "                                    
	                + "               AND tbldctosordenesdetalle.IDTIPO       > 100                               "                                    
	                + "               AND tbldctos.idPeriodo                  = ?3                            "                                    
	                + "               AND tbldctosordenesdetalle.VRVENTAUNITARIO != 0                             "                                    
	                + "                                   ) AS tmpSUB                                             "                                    
	                + "               GROUP BY tmpSUB.idLocal,                                                    "                                    
	                + "                        tmpSUB.idTipoOrden,                                                "                                    
	                + "                        tmpSUB.idOrden ) AS tmpDEU                                         "                                    
	                + "               ON tbldctos.idLocal = tmpDEU.IDLOCAL                                        "                                    
	                + "               AND tbldctos.idTipoOrden =  tmpDEU.idTipoOrden                              "                                    
	                + "               AND tbldctos.idOrden = tmpDEU.idOrden                                       "                                    
	                + "               WHERE tbldctos.idLocal =?1                                                 "                                    
	                + "               AND tbldctos.idPeriodo =?3                                              "                                    
	                + "               AND tbldctos.idTipoOrden IN (9,29)                                          "                                    
	                + "               AND tmpDET.VRVENTAUNITARIO != 0                                             "                                    
	                + "               AND tmpDET.CANTIDAD != 0                                                    "                                    
	                + "               AND  tmpDET.idtipo < 100                                                    "                                              
	                + "               AND tbldctos.idCliente  IN (?2)                                          "                                               
	                + "               ORDER BY tbldctos.idLocal,                                                  "                                    
	                + "                        tbldctos.idOrden,                                                  "                                    
	                + "                        tmpCAT.idProducto,                                                 "                                    
	                + "                        tmpDET.IDTIPO                                                      "           
				  , nativeQuery = true)		    
		  List<TblDctosOrdenesDTO> listaUnClienteProducto(int idLocal, List<String> idClientes, Double xIdPeriodo);
		  
		  
		  
		  //ANTERIOR
//		  @Query( value = "     SELECT tbldctos.idLocal,                                   " 
//	                + "        tbldctos.idOrden,                                       "
//	                + "        tbldctos.idDcto,                                        "
//	                + "        tbldctos.idPeriodo,                                     "
//	                + "        tbldctos.fechaDcto,                                     "
//	                + "        tbldctos.idCliente,                                     "
//	                + "	   tbldctos.nombreTercero,                                     "
//	                + "	   tbldctosordenes.promedio,                                   "
//	                + "        tbldctosordenes.promedioEstrato,                        "
//	                + "        tbldctosordenes.cuotaVencida,                           "
//	                + "        (CASE WHEN (tbldctosordenes.cuotaVencida = 0)           "
//	                + "             THEN 0 WHEN (tbldctosordenes.cuotaVencida > 0)     "
//	                + "             THEN (tbldctosordenes.cuotaVencida * 30)           "
//	                + "			                     END) AS diasMora,                 "
//	                + "	    'FIN. '+ stuff(tmpDET.comentario, 1,                       "
//	                + "	    charindex(' CTA', tmpDET.comentario), '')                  "
//	                + "					      AS financiacion,                         "
//	                + "        (tmpDET.comentario) AS textoFinanciacion,               "
//	                + "        tbldctosordenes.comentario,                             "
//	                + "	   tbldctosordenes.email,                                      "
//	                + "	   tbldctosordenes.DIRECCIONDESPACHO                           "
//	                + "		                          AS direccionTercero,             "
//	                + "	   tbldctosordenes.historiaConsumo,                            "
//	                + "	   tblterceros.numeroMedidor,                                  "
//	                + "	   tblmedidores.marcaMedidor,                                  "
//	                + "        tblterceros.fechaInstalacionMedidor,                    "
//	                + "	   tblterceros.CC_Nit,                                         "
//	                + "	   tblterceros.direccionCobro,                                 "
//	                + "	   tblterceros.codigoCatastral,                                "
//	                + "        tblterceros.ordenRuta,                                  "
//	                + "	   tmpDET.idRuta,                                              "
//	                + "	   tmpDET.nombreRuta,                                          "
//	                + "	   tmpDET.idEstracto,                                          "
//	                + "	   tmpDET.codigoClaseUso,                                      "
//	                + "	   tmpDET.nombreEstracto,                                      "
//	                + "	   tbldctosperiodo.fechaInicial,                               "
//	                + "	   tbldctosperiodo.fechaFinal,                                 "
//	                + "	   tbldctosperiodo.fechaConRecargo,                            "
//	                + "	   tbldctosperiodo.fechaSinRecargo,                            "
//	                + "	   tbldctosperiodo.nombrePeriodo,                              "
//	                + "	   (tmpLEC.lecturaMedidor) AS lecturaActual,                   "
//	                + "	   tmpANT.lecturaAnterior,                                     "
//	                + "	   tmpCON.consumo,                                             "
//	                + "        tmpLEC.nombreCausa,                                     "
//	                + "	   (CASE WHEN (tbldctosordenes.cuotaVencida) >=                "
//	                + "                  (tbllocales.cuotaSuspension)	               "
//	                + "             THEN (tbllocales.txtSuspension)                    "
//	                + "                		        END) AS txtSuspension,             "
//	                + "        tbldctosordenes.fechaPagoUltimo AS fechaPagoUltimo,     "
//	                + "        tbldctosordenes.vrPagoUltimo AS vrPagoUltimo,           "
//	                + "        0.0 AS vrBase,                                          "
//	                + "        0.0 AS vrIva,                                           "
//	                + "        0.0 AS vrFactura,                                       "
//	                + "        tmpDET.idTipo AS idTipoNegativo,                        "
//	                + "        CASE WHEN tmpDET.VRVENTAUNITARIO<0                      "
//	                + "              THEN CONVERT(numeric(10,2),                       "
//	                + "             ABS(tmpDET.VRVENTAUNITARIO* tmpDET.CANTIDAD))      "
//	                + "                ELSE 0 END AS vrTipoNegativo,                   "
//	                + "        tmpDET.CANTIDAD,                                        "
//	                + "        tmpDET.VRVENTAUNITARIO,                                 "
//	                + "        tmpDET.PORCENTAJEIVA,                                   "
//	                + "        tmpDET.idPlu,                                           "
//	                + "        tmpCAT.NOMBREPLU,                                       "
//	                + "      CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/     "
//	                + "      ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2))                     "
//	                + "                                  AS vrBaseUnitarioSinIva,      "
//	                + "      CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/     "
//	                + "      ( 1+ tmpDET.PORCENTAJEIVA/100 ),2) *                      "
//	                + "       tmpDET.CANTIDAD *                                        "
//	                + "       tmpDET.PORCENTAJEIVA/100.0 ) AS vrIvaUnitario,           "
//	                + "      CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/     "
//	                + "       ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2) *                   "
//	                + "       tmpDET.CANTIDAD) AS vrVentaUnitarioSinIva,               "
//	                + "        tbldctos.vrRteFuente,                                   "
//	                + "        tbldctos.vrRteIva,                                      "
//	                + "        1.0 AS porcentajeRteFuente,                             "
//	                + "        6 AS taxId_RteFuente,                                   "
//	                + "        1.0 AS porcentajeRteIva,                                "
//	                + "        5 AS taxId_RteIva,                                      "
//	                + "        1 AS taxId_Iva,                                         "
//	                + "      CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/     "        
//	                + "      ( 1+ tmpDET.PORCENTAJEIVA/100.0 ) *                       "
//	                + "       tmpDET.CANTIDAD *                                        "
//	                + "      1.0 / 100.00,2)) AS vrUnitarioRteFuente,                  "
//	                + "      CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/     "
//	                + "       ( 1+ tmpDET.PORCENTAJEIVA/100 ) *                        "
//	                + "       tmpDET.CANTIDAD *                                        "
//	                + "       tmpDET.PORCENTAJEIVA/100.0 *                             "
//	                + "       1.0 / 100.00,2)) AS vrUnitarioRteIva,                    "
//	                + "       tbldctos.cufe                                            "
//	                + "       ,ISNULL(tmpDEU.vrDeudaAnterior,0) AS vrDeudaAnterior     "
//	                + "      FROM tbldctos                                             " 
//	                + "      INNER JOIN                                                " 
//	                + "      (SELECT tbldctosordenesdetalle.idLocal,                   " 
//	                + "         CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29      "
//	                + "         THEN 9 ELSE tbldctosordenesdetalle.IDTIPOORDEN         "
//	                + "         END AS IDTIPOORDEN,                                    "
//	                + "         CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29      "
//	                + "         THEN idOrdenCruce                                      "
//	                + "         ELSE tbldctosordenesdetalle.idOrden                    "
//	                + "         END AS idOrden,                                        "
//	                + "         tbldctosordenesdetalle.idPlu,                          "
//	                + "         tbldctosordenesdetalle.idTipo,                         "
//	                + "         tbldctosordenesdetalle.CANTIDAD,                       "
//	                + "         tbldctosordenesdetalle.VRVENTAUNITARIO,                "
//	                + "        (tbldctosordenesdetalle.PORCENTAJEIVA)                  "
//	                + "                                          AS PORCENTAJEIVA,     "
//	                + "         tbldctosordenesdetalle.nombrePlu,                      "
//	                + "         tbltercerosruta.idRuta,                                "
//	                + "	    tbltercerosruta.nombreCiclo + '-' +                        "      
//	                + "                 tbltercerosruta.nombreRuta AS nombreRuta,      "            
//	                + "	    tblterceroestracto.idEstracto,                             "
//	                + "	    tblterceroestracto.codigoClaseUso,                         "
//	                + "	    tblterceroestracto.nombreEstracto,                         "
//	                + "         tbldctosordenesdetalle.comentario                      "
//	                + "  FROM tbldctos                                                 "
//	                + "  INNER JOIN tbldctosordenesdetalle                             "
//	                + "  ON tbldctos.IDLOCAL = tbldctosordenesdetalle.IDLOCAL          "
//	                + "  AND tbldctos.IDTIPOORDEN =                                    "
//	                + "                         tbldctosordenesdetalle.IDTIPOORDEN     "
//	                + "  AND tbldctos.IDORDEN = tbldctosordenesdetalle.IDORDEN         "
//	                + "  INNER JOIN tbltercerosruta                                    "
//	                + "  ON tbldctosordenesdetalle.IDLOCAL =                           "
//	                + "                                    tbltercerosruta.idLocal     "
//	                + "  AND tbldctosordenesdetalle.idRuta =                           "
//	                + "                                     tbltercerosruta.idRuta     "
//	                + "  INNER JOIN tblterceroestracto                                 "
//	                + "  ON tbldctosordenesdetalle.IDLOCAL =                           "
//	                + "                                 tblterceroestracto.idLocal     "
//	                + "  AND tbldctosordenesdetalle.idEstracto =                       "
//	                + "                              tblterceroestracto.idEstracto     "
//	                + "  WHERE tbldctos.idLocal =                                      "
//	                + " ?1                                                             "
//	                + "  AND tbldctos.idPeriodo =                                      "
//	                + " ?3                                                             "
//	                + "  AND tbldctos.idTipoOrden IN (9,29)                            "
//	                + "  AND tbldctosordenesdetalle.VRVENTAUNITARIO!=0                 "
//	                + "  AND tbldctosordenesdetalle.CANTIDAD != 0) AS tmpDET           "
//	                + " ON tbldctos.IDLOCAL = tmpDET.IDLOCAL                           "
//	                + " AND tbldctos.IDTIPOORDEN = tmpDET.IDTIPOORDEN                  "
//	                + " AND tbldctos.IDORDEN = tmpDET.IDORDEN                          "
//	                + " INNER JOIN                                                     "
//	                + " (SELECT tblplus.idLocal                                        "
//	                + "        ,tblplus.idPlu                                          "
//	                + "        ,RTRIM(LTRIM(                                           "
//	                + "        tblcategorias.nombreCategoria)) + ' ' +                 "
//	                + "         tblplus.nombrePlu AS nombrePlu                         "
//	                + "  FROM tblcategorias                                            "
//	                + "  INNER JOIN tblplus                                            "
//	                + "  ON tblcategorias.idLocal = tblplus.idLocal                    "
//	                + "  AND tblcategorias.idLinea = tblplus.idLinea                   "
//	                + "  AND tblcategorias.idCategoria = tblplus.idCategoria           "
//	                + "  WHERE tblplus.idLocal =                                       "
//	                + " ?1 ) AS tmpCAT                                                 "
//	                + " ON tbldctos.idLocal = tmpCAT.idLocal                           "
//	                + " AND tmpDET.idPlu = tmpCAT.idPlu                                "
//	                + " INNER JOIN  tbldctosordenes                                    "
//	                + " ON tbldctosordenes.IDLOCAL = tbldctos.IDLOCAL                  "
//	                + " AND tbldctosordenes.IDTIPOORDEN = tbldctos.IDTIPOORDEN         "
//	                + " AND tbldctosordenes.IDORDEN = tbldctos.IDORDEN                 "
//	                + " INNER JOIN tbllocales                                          "
//	                + " ON tbllocales.idLocal = tbldctosordenes.IDLOCAL                "
//	                + " INNER JOIN tblterceros                                         "
//	                + " ON tbldctos.IDLOCAL = tblterceros.idLocal                      "
//	                + " AND tbldctos.idCliente = tblterceros.idCliente                 "
//	                + " INNER JOIN tbldctosperiodo                                     "
//	                + " ON tbldctos.IDLOCAL = tbldctosperiodo.idLocal                  "
//	                + " AND tbldctos.idPeriodo = tbldctosperiodo.idPeriodo             "
//	                + " INNER JOIN (                                                   "
//	                + "  SELECT tbldctosordenesdetalle.IDLOCAL,                        "
//	                + "         tbldctosordenesdetalle.IDTIPOORDEN,                    "
//	                + "  	     tbldctosordenesdetalle.IDORDEN,                       "
//	                + "         tbldctos.idPeriodo,                                    "
//	                + "  	     MAX(tbltipocausanota.nombreCausa)                     "
//	                + "                                      AS nombreCausa,           "
//	                + "  MAX(CONVERT(int,tbldctosordenesdetalle.lecturaMedidor))       "
//	                + "  	                                    AS lecturaMedidor      "
//	                + "  FROM tbldctosordenesdetalle                                   "
//	                + "  INNER JOIN tbldctos                                           "
//	                + "  ON tbldctosordenesdetalle.IDLOCAL = tbldctos.IDLOCAL          "
//	                + "  AND tbldctosordenesdetalle.IDTIPOORDEN =                      "
//	                + "                                     tbldctos.IDTIPOORDEN       "
//	                + "  AND tbldctosordenesdetalle.IDORDEN = tbldctos.IDORDEN         "
//	                + "  INNER JOIN tbltipocausanota                                   "
//	                + "  ON tbltipocausanota.idCausa =                                 "
//	                + "                 tbldctosordenesdetalle.idNovedadLectura        "
//	                + "  WHERE tbltipocausanota.idTipoTabla    =  2                    "
//	                + "  AND tbldctosordenesdetalle.idTipo     =  4                    "
//	                + "  AND tbldctosordenesdetalle.STRIDLISTA =  '1'                  "
//	                + "  AND tbldctosordenesdetalle.idLocal   =                        "
//	                + " ?1                                                             "
//	                + "  AND tbldctos.idPeriodo =                                      "
//	                + " ?3                                                             "
//	                + "  GROUP BY tbldctosordenesdetalle.IDLOCAL,                      "
//	                + "           tbldctosordenesdetalle.IDTIPOORDEN,                  "
//	                + "  	        tbldctosordenesdetalle.IDORDEN,                    "
//	                + "        tbldctos.idPeriodo) AS tmpLEC                           "
//	                + "  ON tmpLEC.IDLOCAL = tbldctos.IDLOCAL                          "
//	                + "  AND tmpLEC.IDTIPOORDEN = tbldctos.IDTIPOORDEN                 "
//	                + "  AND tmpLEC.IDORDEN = tbldctos.IDORDEN                         "
//	                + "  AND tmpLEC.idPeriodo = tbldctos.idPeriodo                     "
//	                + " LEFT JOIN                                                      "
//	                + " (SELECT tbldctosordenesdetalle.IDLOCAL,                        "
//	                + "       tbldctosordenesdetalle.IDTIPOORDEN,                      "
//	                + "	  tbldctosordenesdetalle.idCliente,                            "
//	                + "       MAX(CONVERT(int,                                         "
//	                + "                 tbldctosordenesdetalle.lecturaAnterior))       "
//	                + "	                                 AS lecturaAnterior            "
//	                + " FROM tbldctosordenesdetalle                                    "
//	                + " INNER JOIN tbldctos                                            "
//	                + " ON tbldctosordenesdetalle.IDLOCAL = tbldctos.IDLOCAL           "
//	                + " AND tbldctosordenesdetalle.IDTIPOORDEN =                       "
//	                + "                                     tbldctos.IDTIPOORDEN       "
//	                + " AND tbldctosordenesdetalle.IDORDEN = tbldctos.IDORDEN          "
//	                + " AND tbldctosordenesdetalle.idCliente = tbldctos.idCliente      "
//	                + " WHERE tbldctosordenesdetalle.idTipo     =  4                   "
//	                + " AND tbldctosordenesdetalle.STRIDLISTA   = '1'                  "
//	                + " AND tbldctosordenesdetalle.idLocal   =                         "
//	                + " ?1                                                             "
//	                + " AND tbldctos.idPeriodo =                                       "
//	                + " ?3                                                             "
//	                + " GROUP BY tbldctosordenesdetalle.IDLOCAL,                       "
//	                + "         tbldctosordenesdetalle.IDTIPOORDEN,                    "
//	                + "         tbldctosordenesdetalle.idCliente) AS tmpANT            "
//	                + " ON tmpANT.IDLOCAL = tbldctos.IDLOCAL                           "
//	                + " AND tmpANT.IDTIPOORDEN = tbldctos.IDTIPOORDEN                  "
//	                + " AND tmpANT.idCliente = tbldctos.idCliente                      "
//	                + " INNER JOIN tblmedidores                                        "
//	                + " ON tblmedidores.idLocal =tblterceros.IDLOCAL                   "
//	                + " AND tblmedidores.idMedidor = tblterceros.idMedidor             "
//	                + " INNER JOIN                                                     "
//	                + " ( SELECT tbldctos.IDLOCAL,                                     "
//	                + "         tbldctos.IDTIPOORDEN,                                  "
//	                + "	    tbldctos.IDORDEN,                                          "
//	                + "         tbldctos.idPeriodo,                                    "
//	                + "         tbldctosordenesdetalle.idcliente,                      "
//	                + "	    SUM(tbldctosordenesdetalle.CANTIDAD)                       "
//	                + "	                                     AS consumo                "
//	                + " FROM tbldctos                                                  "
//	                + " INNER JOIN tbldctosordenesdetalle                              "
//	                + " ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL           "
//	                + " AND tbldctos.idTipoOrden =                                     "
//	                + "                   tbldctosordenesdetalle.idTipoOrden           "
//	                + " AND tbldctos.idOrden = tbldctosordenesdetalle.idOrden          "
//	                + " WHERE tbldctosordenesdetalle.IDTIPO = 4                        "
//	                + " GROUP BY tbldctos.IDLOCAL,                                     "
//	                + "         tbldctos.IDTIPOORDEN,                                  "
//	                + "	    tbldctos.IDORDEN,                                          "
//	                + "         tbldctos.idPeriodo,                                    "
//	                + "         tbldctosordenesdetalle.idcliente) AS tmpCON            "
//	                + " ON tmpCON.IDLOCAL = tbldctos.IDLOCAL                           "
//	                + " AND tmpCON.IDTIPOORDEN = tbldctos.IDTIPOORDEN                  "
//	                + " AND tmpCON.IDORDEN= tbldctos.IDORDEN                           "
//	                + " AND tmpCON.idPeriodo= tbldctos.idPeriodo                       "
//	                + " LEFT JOIN  (                                                   "
//	                + " SELECT tmpSUB.idLocal,                                         "
//	                + "        tmpSUB.idTipoOrden,                                     "
//	                + "        tmpSUB.idOrden,                                         "
//	                + "       SUM(tmpSUB.vrVentaUnitario) AS vrDeudaAnterior           "
//			        + " FROM                                                           "     
//	                + " (SELECT tbldctos.idLocal,                                      "
//	                + "        tbldctos.idTipoOrden,                                   "
//	                + "        tbldctos.idOrden,                                       "
//	                + "        tbldctosordenesdetalle.vrVentaUnitario,                 "
//	                + "        tbldctosordenesdetalle.idOrden AS allReg,               "
//			  	    + " tbldctosordenesdetalle.IDPLU                                   "
//	                + " FROM tbldctos                                                  "
//	                + " INNER JOIN tbldctosordenesdetalle                              "
//	                + " ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL           "
//	                + " AND tbldctos.idTipoOrden =                                     "
//	                + "                   tbldctosordenesdetalle.idTipoOrden           "
//	                + " AND tbldctos.idOrden =tbldctosordenesdetalle.idOrden           "
//	                + " AND tbldctos.idCliente =                                       "
//	                + "			tbldctosordenesdetalle.idCliente                       "
//	                + " WHERE tbldctosordenesdetalle.idLocal    =                      "
//	                + " ?1                                                             "
//	                + " AND tbldctosordenesdetalle.IDTIPOORDEN  = 9                    "
//	                + " AND tbldctosordenesdetalle.IDTIPO       > 100                  "
//	                + " AND tbldctos.idPeriodo                  =                      "
//	                + " ?3                                                             "
//	                + " AND tbldctosordenesdetalle.VRVENTAUNITARIO != 0                "
//	                + " UNION                                                          "
//	                + " SELECT tbldctos.idLocal,                                       "
//	                + "        tbldctos.idTipoOrdenCruce AS idTipoOrden,               "
//	                + "        tbldctos.idOrdenCruce AS idOrden,                       "
//	                + "        tbldctosordenesdetalle.vrVentaUnitario,                 "
//	                + "        tbldctosordenesdetalle.idOrden AS allReg,               "
//			  	    + " tbldctosordenesdetalle.IDPLU                                   "
//	                + " FROM tbldctos                                                  "
//	                + " INNER JOIN tbldctosordenesdetalle                              "
//	                + " ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL           "
//	                + " AND tbldctos.idTipoOrden =                                     "
//	                + "                   tbldctosordenesdetalle.idTipoOrden           "
//	                + " AND tbldctos.idOrden =tbldctosordenesdetalle.idOrden           "
//	                + " AND tbldctos.idCliente =                                       "
//	                + "			tbldctosordenesdetalle.idCliente                       "
//	                + " WHERE tbldctosordenesdetalle.idLocal    = ?1                   "
//	                + " AND tbldctosordenesdetalle.IDTIPOORDEN  = 29                   "
//	                + " AND tbldctosordenesdetalle.IDTIPO       > 100                  "
//	                + " AND tbldctos.idPeriodo                  = ?3                   "
//	                + " AND tbldctosordenesdetalle.VRVENTAUNITARIO != 0                "
//			        + "                     ) AS tmpSUB                                "
//	                + " GROUP BY tmpSUB.idLocal,                                       "
//	                + "          tmpSUB.idTipoOrden,                                   "
//	                + "          tmpSUB.idOrden ) AS tmpDEU                            "         
//	                + " ON tbldctos.idLocal = tmpDEU.IDLOCAL                           "
//	                + " AND tbldctos.idTipoOrden =  tmpDEU.idTipoOrden                 "
//	                + " AND tbldctos.idOrden = tmpDEU.idOrden                          "
//	                + " WHERE tbldctos.idLocal =?1                                     "
//	                + " AND tbldctos.idPeriodo =?3                                     "
//	                + " AND tbldctos.idTipoOrden IN (9,29)                             "
//	                + " AND tmpDET.VRVENTAUNITARIO != 0                                "
//	                + " AND tmpDET.CANTIDAD != 0                                       "
//	                + " AND  tmpDET.idtipo < 100                                       "                             
//	                + " AND tbldctos.idCliente  IN (?2)                                "                           
//	                + " ORDER BY tbldctos.idLocal,                                     "
//	                + "          tbldctos.idOrden,                                     "
//	                + "          tmpDET.IDTIPO                                         "           
//				  , nativeQuery = true)
//		  
//
//		  
//		  List<TblDctosOrdenesDTO> listaUnClienteProducto(int idLocal, List<String> idClientes, Double xIdPeriodo);
		  
		  
		  
		  
		  
		  @Query( value = "                      SELECT tbldctos.idLocal,                                                       "          
			        + "                          tbldctos.idOrden,                                                          "          
			        + "                          tbldctos.idDcto,                                                           "          
			        + "                          tbldctos.idPeriodo,                                                        "          
			        + "                          tbldctos.fechaDcto,                                                        "          
			        + "                          tbldctos.idCliente,                                                        "          
			        + "                  	   tbldctos.nombreTercero,                                                      "          
			        + "                  	   tbldctosordenes.promedio,                                                    "          
			        + "                          tbldctosordenes.promedioEstrato,                                           "          
			        + "                          tbldctosordenes.cuotaVencida,                                              "          
			        + "                          (CASE WHEN (tbldctosordenes.cuotaVencida = 0)                              "          
			        + "                               THEN 0 WHEN (tbldctosordenes.cuotaVencida > 0)                        "          
			        + "                               THEN (tbldctosordenes.cuotaVencida * 30)                              "          
			        + "                  			                     END) AS diasMora,                                  "          
			        + "                  	    'FIN. '+ stuff(tmpDET.comentario, 1,                                        "          
			        + "                  	    charindex(' CTA', tmpDET.comentario), '')                                   "          
			        + "                  					      AS financiacion,                                          "          
			        + "                          (tmpDET.comentario) AS textoFinanciacion,                                  "          
			        + "                          tbldctosordenes.comentario,                                                "          
			        + "                  	   tblTerceros.email,                                                           "          
			        + "                  	   tbldctosordenes.DIRECCIONDESPACHO                                            "          
			        + "                  		                          AS direccionTercero,                              "          
			        + "                  	   tbldctosordenes.historiaConsumo,                                             "          
			        + "                  	   tblterceros.numeroMedidor,                                                   "          
			        + "                  	   tblmedidores.marcaMedidor,                                                   "          
			        + "                          tblterceros.fechaInstalacionMedidor,                                       "          
			        + "                  	   tblterceros.CC_Nit,                                                          "          
			        + "                  	   tblterceros.direccionCobro,                                                  "          
			        + "                  	   tblterceros.codigoCatastral,                                                 "          
			        + "                          tblterceros.ordenRuta,                                                     "          
			        + "                  	   tmpDET.idRuta,                                                               "          
			        + "                  	   tmpDET.nombreRuta,                                                           "          
			        + "                  	   tmpDET.idEstracto,                                                           "          
			        + "                  	   tmpDET.codigoClaseUso,                                                       "          
			        + "                  	   tmpDET.nombreEstracto,                                                       "          
			        + "                  	   tbldctosperiodo.fechaInicial,                                                "          
			        + "                  	   tbldctosperiodo.fechaFinal,                                                  "          
			        + "                  	   tbldctosperiodo.fechaConRecargo,                                             "          
			        + "                  	   tbldctosperiodo.fechaSinRecargo,                                             "          
			        + "                  	   tbldctosperiodo.nombrePeriodo,                                               "          
			        + "                  	   (tmpLEC.lecturaMedidor) AS lecturaActual,                                    "          
			        + "                  	   tmpLEC.lecturaAnterior,                                                      "          
			        + "                  	   tmpCON.consumo,                                                              "          
			        + "                          tmpLEC.nombreCausa,                                                        "          
			        + "                  	   (CASE WHEN (tbldctosordenes.cuotaVencida) >=                                 "          
			        + "                                    (tbllocales.cuotaSuspension)	                                    "          
			        + "                               THEN (tbllocales.txtSuspension)                                       "          
			        + "                                  		        END) AS txtSuspension,                              "          
			        + "                          tbldctosordenes.fechaPagoUltimo AS fechaPagoUltimo,                        "          
			        + "                          tbldctosordenes.vrPagoUltimo AS vrPagoUltimo,                              "          
			        + "                          0.0 AS vrBase,                                                             "          
			        + "                          0.0 AS vrIva,                                                              "          
			        + "                          0.0 AS vrFactura,                                                          "          
			        + "                          tmpDET.idTipo AS idTipoNegativo,                                           "          
			        + "                          CASE WHEN tmpDET.VRVENTAUNITARIO<0                                         "          
			        + "                                THEN CONVERT(numeric(10,2),                                          "          
			        + "                               ABS(tmpDET.VRVENTAUNITARIO* tmpDET.CANTIDAD))                         "          
			        + "                                  ELSE 0 END AS vrTipoNegativo,                                      "          
			        + "                          tmpDET.CANTIDAD,                                                           "          
			        + "                          tmpDET.VRVENTAUNITARIO,                                                    "          
			        + "                          tmpDET.PORCENTAJEIVA,                                                      "          
			        + "                          tmpDET.idPlu,                                                              "          
			        + "                          tmpCAT.NOMBREPLU,                                                          "          
			        + "                        CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                        "          
			        + "                        ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2))                                        "          
			        + "                                                    AS vrBaseUnitarioSinIva,                         "          
			        + "                        CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                        "          
			        + "                        ( 1+ tmpDET.PORCENTAJEIVA/100 ),2) *                                         "          
			        + "                         tmpDET.CANTIDAD *                                                           "          
			        + "                         tmpDET.PORCENTAJEIVA/100.0 ) AS vrIvaUnitario,                              "          
			        + "                        CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                        "          
			        + "                         ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2) *                                      "          
			        + "                         tmpDET.CANTIDAD) AS vrVentaUnitarioSinIva,                                  "          
			        + "                          tbldctos.vrRteFuente,                                                      "          
			        + "                          tbldctos.vrRteIva,                                                         "          
			        + "                          1.0 AS porcentajeRteFuente,                                                "          
			        + "                          6 AS taxId_RteFuente,                                                      "          
			        + "                          1.0 AS porcentajeRteIva,                                                   "          
			        + "                          5 AS taxId_RteIva,                                                         "          
			        + "                          1 AS taxId_Iva,                                                            "          
			        + "                        CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                        "          
			        + "                        ( 1+ tmpDET.PORCENTAJEIVA/100.0 ) *                                          "          
			        + "                         tmpDET.CANTIDAD *                                                           "          
			        + "                        1.0 / 100.00,2)) AS vrUnitarioRteFuente,                                     "          
			        + "                        CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/                        "          
			        + "                         ( 1+ tmpDET.PORCENTAJEIVA/100 ) *                                           "          
			        + "                         tmpDET.CANTIDAD *                                                           "          
			        + "                         tmpDET.PORCENTAJEIVA/100.0 *                                                "          
			        + "                         1.0 / 100.00,2)) AS vrUnitarioRteIva,                                       "          
			        + "                         tbldctos.cufe                                                               "          
			        + "                         ,ISNULL(tmpDEU.vrDeudaAnterior,0) AS vrDeudaAnterior                        "          
			        + "                          ,tmpCAT.idProducto                                                         "          
			        + "                        FROM tbldctos				                                                "          
			        + "                        INNER JOIN                                                                   "          
			        + "                        (SELECT tbldctosordenesdetalle.idLocal,                                      "          
			        + "                           CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29                         "          
			        + "                           THEN 9 ELSE tbldctosordenesdetalle.IDTIPOORDEN                            "          
			        + "                           END AS IDTIPOORDEN,                                                       "          
			        + "                           CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29                         "          
			        + "                           THEN idOrdenCruce                                                         "          
			        + "                           ELSE tbldctosordenesdetalle.idOrden                                       "          
			        + "                           END AS idOrden,                                                           "          
			        + "                           tbldctosordenesdetalle.idPlu,                                             "          
			        + "                           tbldctosordenesdetalle.idTipo,                                            "          
			        + "                           tbldctosordenesdetalle.CANTIDAD,                                          "          
			        + "                           tbldctosordenesdetalle.VRVENTAUNITARIO,                                   "          
			        + "                          (tbldctosordenesdetalle.PORCENTAJEIVA)                                     "          
			        + "                                                            AS PORCENTAJEIVA,                        "          
			        + "                           tbldctosordenesdetalle.nombrePlu,                                         "          
			        + "                           tbltercerosruta.idRuta,                                                   "          
			        + "                  	    tbltercerosruta.nombreCiclo + '-' +                                         "          
			        + "                                   tbltercerosruta.nombreRuta AS nombreRuta,                         "          
			        + "                  	    tblterceroestracto.idEstracto,                                              "          
			        + "                  	    tblterceroestracto.codigoClaseUso,                                          "          
			        + "                  	    tblterceroestracto.nombreEstracto,                                          "          
			        + "                           tbldctosordenesdetalle.comentario                                         "          
			        + "                    FROM tbldctos                                                                    "          
			        + "                    INNER JOIN tbldctosordenesdetalle                                                "          
			        + "                    ON tbldctos.IDLOCAL = tbldctosordenesdetalle.IDLOCAL                             "          
			        + "                    AND tbldctos.IDTIPOORDEN =                                                       "          
			        + "                                           tbldctosordenesdetalle.IDTIPOORDEN                        "          
			        + "                    AND tbldctos.IDORDEN = tbldctosordenesdetalle.IDORDEN                            "          
			        + "                    INNER JOIN tbltercerosruta                                                       "          
			        + "                    ON tbldctosordenesdetalle.IDLOCAL =                                              "          
			        + "                                                      tbltercerosruta.idLocal                        "          
			        + "                    AND tbldctosordenesdetalle.idRuta =                                              "          
			        + "                                                       tbltercerosruta.idRuta                        "          
			        + "                    INNER JOIN tblterceroestracto                                                    "          
			        + "                    ON tbldctosordenesdetalle.IDLOCAL =                                              "          
			        + "                                                   tblterceroestracto.idLocal                        "          
			        + "                    AND tbldctosordenesdetalle.idEstracto =                                          "          
			        + "                                                tblterceroestracto.idEstracto                        "          
			        + "                    WHERE tbldctos.idLocal =                                                         "          
			        + "                   ?1                                                                               "          
			        + "                    AND tbldctos.idPeriodo =                                                         "          
			        + "                   ?3                                                                            "          
			        + "                    AND tbldctos.idTipoOrden IN (9,29)                                               "          
			        + "                    AND tbldctosordenesdetalle.VRVENTAUNITARIO!=0                                    "          
			        + "                    AND tbldctosordenesdetalle.CANTIDAD != 0) AS tmpDET 					            "          
			        + "                   ON tbldctos.IDLOCAL = tmpDET.IDLOCAL                                              "          
			        + "                   AND tbldctos.IDTIPOORDEN = tmpDET.IDTIPOORDEN                                     "          
			        + "                   AND tbldctos.IDORDEN = tmpDET.IDORDEN                                             "          
			        + "                   INNER JOIN                                                                        "          
			        + "                   (SELECT tblplus.idLocal                                                           "          
			        + "                          ,tblplus.idPlu                                                             "          
			        + "                          ,RTRIM(LTRIM(                                                              "          
			        + "                          tblcategorias.nombreCategoria)) + ' ' +                                    "          
			        + "                           tblplus.nombrePlu AS nombrePlu,                                           "          
			        + "                           tblcategorias.idProducto                                                  "          
			        + "                    FROM tblcategorias                                                               "          
			        + "                    INNER JOIN tblplus                                                               "          
			        + "                    ON tblcategorias.idLocal = tblplus.idLocal                                       "          
			        + "                    AND tblcategorias.idLinea = tblplus.idLinea                                      "          
			        + "                    AND tblcategorias.idCategoria = tblplus.idCategoria                              "          
			        + "                    WHERE tblplus.idLocal =                                                          "          
			        + "                   ?1 ) AS tmpCAT                                                                   "          
			        + "                   ON tbldctos.idLocal = tmpCAT.idLocal                                              "          
			        + "                   AND tmpDET.idPlu = tmpCAT.idPlu                                                   "          
			        + "                   INNER JOIN  tbldctosordenes                                                       "          
			        + "                   ON tbldctosordenes.IDLOCAL = tbldctos.IDLOCAL                                     "          
			        + "                   AND tbldctosordenes.IDTIPOORDEN = tbldctos.IDTIPOORDEN                            "          
			        + "                   AND tbldctosordenes.IDORDEN = tbldctos.IDORDEN                                    "          
			        + "                   INNER JOIN tbllocales                                                             "          
			        + "                   ON tbllocales.idLocal = tbldctosordenes.IDLOCAL                                   "          
			        + "                   INNER JOIN tblterceros                                                            "          
			        + "                   ON tbldctos.IDLOCAL = tblterceros.idLocal                                         "          
			        + "                   AND tbldctos.idCliente = tblterceros.idCliente                                    "          
			        + "                   INNER JOIN tbldctosperiodo                                                        "          
			        + "                   ON tbldctos.IDLOCAL = tbldctosperiodo.idLocal                                     "          
			        + "                   AND tbldctos.idPeriodo = tbldctosperiodo.idPeriodo 					            "          
			        + "                   INNER JOIN (SELECT TOP 1 tbldctosordenesdetalle.IDLOCAL,                          "          
			        + "                           tbldctosordenesdetalle.idCliente,                                         "          
			        + "                           tbldctosordenesdetalle.idOrden,                                           "          
			        + "                    	     (tbltipocausanota.nombreCausa)                                             "          
			        + "                                                        AS nombreCausa,                              "          
			        + "                    (CONVERT(int,tbldctosordenesdetalle.lecturaMedidor))                             "          
			        + "                    	                                    AS lecturaMedidor ,                         "          
			        + "                    (CONVERT(int,tbldctosordenesdetalle.lecturaAnterior))                            "          
			        + "                    	                                    AS lecturaAnterior    						"          									
			        + "                    FROM tbldctosordenesdetalle                                                      "          
			        + "                    INNER JOIN tbldctos                                                              "          
			        + "                    ON tbldctosordenesdetalle.IDLOCAL = tbldctos.IDLOCAL                             "          
			        + "                    AND tbldctosordenesdetalle.IDTIPOORDEN =                                         "          
			        + "                                                       tbldctos.IDTIPOORDEN                          "          
			        + "                    AND tbldctosordenesdetalle.IDORDEN = tbldctos.IDORDEN                            "          
			        + "                    INNER JOIN tbltipocausanota                                                      "          
			        + "                    ON tbltipocausanota.idCausa =                                                    "          
			        + "                                   tbldctosordenesdetalle.idNovedadLectura                           "          
			        + "                    WHERE tbltipocausanota.idTipoTabla    =  2                                       "          
			        + "                    AND tbldctosordenesdetalle.idTipo     =  4                                       "          
			        + "                    AND tbldctosordenesdetalle.idLocal   =   ?1                                     "                                  
			        + "                    AND tbldctos.idPeriodo =  ?3                                                 "          
			        + "                    AND tbldctos.idTipoOrden IN (9,29)                                               "          
			        + "                    AND tbldctos.idCliente = ?2                                                 "          
					+ "          		  ORDER BY 3 DESC                                                                   "          
			        + "                    ) AS tmpLEC  						                                            "          
			        + "                    ON tmpLEC.IDLOCAL = tbldctos.IDLOCAL                                             "          
			        + "                    AND tmpLEC.idCliente = tbldctos.idCliente                                        "                           
			        + "                   INNER JOIN tblmedidores                                                           "          
			        + "                   ON tblmedidores.idLocal =tblterceros.IDLOCAL                                      "          
			        + "                   AND tblmedidores.idMedidor = tblterceros.idMedidor                                "          
			        + "                   INNER JOIN                                                                        "          
			        + "                   (SELECT tbldctos.IDLOCAL,                                                         "          
			        + "                           tbldctos.idcliente,                                                       "          
			        + "                  	    SUM(tbldctosordenesdetalle.CANTIDAD)                                        "          
			        + "                  	                                     AS consumo                                 "          
			        + "                   FROM tbldctos                                                                     "          
			        + "                   INNER JOIN tbldctosordenesdetalle                                                 "          
			        + "                   ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL                              "          
			        + "                   AND tbldctos.idTipoOrden =                                                        "          
			        + "                                     tbldctosordenesdetalle.idTipoOrden   					        "          
			        + "                   AND tbldctos.idOrden =                                                            "          
			        + "                                     tbldctosordenesdetalle.idOrden                                  "          
		            + "                                                                                                     "          
			        + "                   WHERE tbldctosordenesdetalle.IDTIPO = 4                                           "          
					+ "          		      AND tbldctos.IDLOCAL= ?1                                                     "          
					+ "          		      AND tbldctos.idPeriodo =  ?3                                              "          
					+ "          			   AND tbldctos.idCliente = ?2                                            "          
					+ "          			   AND tbldctos.IDTIPOORDEN IN (9, 29)                                          "          
		            + "                   GROUP BY tbldctos.IDLOCAL,                                                        "          
			        + "                           tbldctos.idcliente) AS tmpCON   							                "          
			        + "                   ON tmpCON.IDLOCAL = tbldctos.IDLOCAL                                              "          
			        + "                   AND tmpCON.idCliente= tbldctos.idCliente                                          "                
			        + "                   LEFT JOIN  (                                                                      "          
			        + "                   SELECT tmpSUB.idLocal,                                                            "          
			        + "                          tmpSUB.idTipoOrden,                                                        "          
			        + "                          tmpSUB.idOrden,                                                            "          
			        + "                         SUM(tmpSUB.vrVentaUnitario) AS vrDeudaAnterior                              "          
					+ "                   FROM                                                                              "          
			        + "                   (SELECT tbldctos.idLocal,                                                         "          
			        + "                          tbldctos.idTipoOrden,                                                      "          
			        + "                          tbldctos.idOrden,                                                          "          
			        + "                          tbldctosordenesdetalle.vrVentaUnitario,                                    "          
			        + "                          tbldctosordenesdetalle.idOrden AS allReg,                                  "          
					+ "            	     tbldctosordenesdetalle.IDPLU                                                       "          
			        + "                   FROM tbldctos                                                                     "          
			        + "                   INNER JOIN tbldctosordenesdetalle                                                 "          
			        + "                   ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL                              "          
			        + "                   AND tbldctos.idTipoOrden =                                                        "          
			        + "                                     tbldctosordenesdetalle.idTipoOrden                              "          
			        + "                   AND tbldctos.idOrden =tbldctosordenesdetalle.idOrden                              "          
			        + "                   AND tbldctos.idCliente =                                                          "          
			        + "                  			tbldctosordenesdetalle.idCliente                                        "          
			        + "                   WHERE tbldctosordenesdetalle.idLocal    =                                         "          
			        + "                   ?1                                                                               "          
			        + "                   AND tbldctosordenesdetalle.IDTIPOORDEN  = 9                                       "          
			        + "                   AND tbldctosordenesdetalle.IDTIPO       > 100                                     "          
			        + "                   AND tbldctos.idPeriodo                  =                                         "          
			        + "                   ?3                                                                            "          
			        + "                   AND tbldctosordenesdetalle.VRVENTAUNITARIO != 0                                   "          
			        + "                   UNION                                                                             "          
			        + "                   SELECT tbldctos.idLocal,                                                          "          
			        + "                          tbldctos.idTipoOrdenCruce AS idTipoOrden,                                  "          
			        + "                          tbldctos.idOrdenCruce AS idOrden,                                          "          
			        + "                          tbldctosordenesdetalle.vrVentaUnitario,                                    "          
			        + "                          tbldctosordenesdetalle.idOrden AS allReg,                                  "          
					+ "            	     tbldctosordenesdetalle.IDPLU                                                       "          
			        + "                   FROM tbldctos                                                                     "          
			        + "                   INNER JOIN tbldctosordenesdetalle                                                 "          
			        + "                   ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL                              "          
			        + "                   AND tbldctos.idTipoOrden =                                                        "          
			        + "                                     tbldctosordenesdetalle.idTipoOrden                              "          
			        + "                   AND tbldctos.idOrden =tbldctosordenesdetalle.idOrden                              "          
			        + "                   AND tbldctos.idCliente =                                                          "          
			        + "                  			tbldctosordenesdetalle.idCliente                                        "          
			        + "                   WHERE tbldctosordenesdetalle.idLocal    = ?1                                     "          
			        + "                   AND tbldctosordenesdetalle.IDTIPOORDEN  = 29                                      "          
			        + "                   AND tbldctosordenesdetalle.IDTIPO       > 100                                     "          
			        + "                   AND tbldctos.idPeriodo                  = ?3                                  "          
			        + "                   AND tbldctosordenesdetalle.VRVENTAUNITARIO != 0                                   "          
					+ "                                       ) AS tmpSUB                                                   "          
			        + "                   GROUP BY tmpSUB.idLocal,                                                          "          
			        + "                            tmpSUB.idTipoOrden,                                                      "          
			        + "                            tmpSUB.idOrden ) AS tmpDEU                                               "          
			        + "                   ON tbldctos.idLocal = tmpDEU.IDLOCAL                                              "          
			        + "                   AND tbldctos.idTipoOrden =  tmpDEU.idTipoOrden                                    "          
			        + "                   AND tbldctos.idOrden = tmpDEU.idOrden                                             "          
			        + "                   WHERE tbldctos.idLocal =?1                                                       "          
			        + "                   AND tbldctos.idPeriodo =?3                                                    "          
			        + "                   AND tbldctos.idTipoOrden IN (9,29)                                                "          
			        + "                   AND tmpDET.VRVENTAUNITARIO != 0                                                   "          
			        + "                   AND tmpDET.CANTIDAD != 0                                                          "          
			        + "                   AND  tmpDET.idtipo < 100                                                          "                    
			        + "                   AND tbldctos.idCliente = ?2                                                "                     
			        + "                   ORDER BY tbldctos.idLocal,                                                        "          
			        + "                            tbldctos.idOrden,                                                        "          
			        + "                            tmpCAT.idProducto,                                                       "          
			        + "                            tmpDET.IDTIPO                                                            "           
				  , nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaUnSoloClienteProducto(int idLocal, String idCliente, Double xIdPeriodo);
		  
		  
		  

		  
		  
		  
		  @Query( value = "    SELECT tbldctos.idLocal,                                  "                                                                      
					 + "    tbldctos.idOrden,                                         "           
					 + "    tbldctos.idDcto,                                          "           
					 + "    tbldctos.idPeriodo,                                       "           
					 + "    tbldctos.fechaDcto,                                       "           
					 + "    tbldctos.idCliente,                                       "           
					 + "    tbldctos.nombreTercero,                                   "           
					 + "    tbldctosordenes.promedio,                                 "           
					 + "    tbldctosordenes.promedioEstrato,                          "           
					 + "    tbldctosordenes.cuotaVencida,                             "           
					 + "    (CASE WHEN (tbldctosordenes.cuotaVencida = 0)             "           
					 + "     THEN 0 WHEN (tbldctosordenes.cuotaVencida > 0)           "           
					 + "     THEN (tbldctosordenes.cuotaVencida * 30)                 "           
					 + "                      END) AS diasMora,                       "           
					 + "    'FIN. '+ stuff(tmpDET.comentario, 1,                      "           
					 + "    charindex(' CTA', tmpDET.comentario), '')                 "           
					 + "   			      AS financiacion,                            "        
					 + "    (tmpDET.comentario) AS textoFinanciacion,                 "           
					 + "    tbldctosordenes.comentario,                               "           
					 + "    tbldctosordenes.email,                                    "           
					 + "    tbldctosordenes.DIRECCIONDESPACHO                         "           
					 + "                             AS direccionTercero,             "           
					 + "    tbldctosordenes.historiaConsumo,                          "           
					 + "    tblterceros.numeroMedidor,                                "           
					 + "    tblmedidores.marcaMedidor,                                "           
					 + "    tblterceros.fechaInstalacionMedidor,                      "           
					 + "    tblterceros.CC_Nit,                                       "           
					 + "    tblterceros.direccionCobro,                               "           
					 + "    tblterceros.codigoCatastral,                              "           
					 + "    tblterceros.ordenRuta,                                    "           
					 + "    tmpDET.idRuta,                                            "           
					 + "    tmpDET.nombreRuta,                                        "           
					 + "    tmpDET.idEstracto,                                        "           
					 + "    tmpDET.codigoClaseUso,                                    "           
					 + "    tmpDET.nombreEstracto,                                    "           
					 + "    tbldctosperiodo.fechaInicial,                             "           
					 + "    tbldctosperiodo.fechaFinal,                               "           
					 + "    tbldctosperiodo.fechaConRecargo,                          "           
					 + "    tbldctosperiodo.fechaSinRecargo,                          "           
					 + "    tbldctosperiodo.nombrePeriodo,                            "           
					 + "    (tmpLEC.lecturaMedidor) AS lecturaActual,                 "           
					 + "    tmpANT.lecturaAnterior,                                   "           
					 + "    tmpCON.consumo,                                           "           
					 + "    tmpLEC.nombreCausa,                                       "           
					 + "    (CASE WHEN (tbldctosordenes.cuotaVencida) >=              "           
					 + "              (tbllocales.cuotaSuspension)	                  "            
					 + "         THEN (tbllocales.txtSuspension)                      "           
					 + "            		        END) AS txtSuspension,            "            
					 + "    tbldctosordenes.fechaPagoUltimo AS fechaPagoUltimo,       "           
					 + "    tbldctosordenes.vrPagoUltimo AS vrPagoUltimo,             "           
					 + "    0.0 AS vrBase,                                            "           
					 + "    0.0 AS vrIva,                                             "           
					 + "    0.0 AS vrFactura,                                         "           
					 + "    tmpDET.idTipo,                                            "           
	                 + "                                                              "
					 + "    tmpDET.CANTIDAD,                                          "           
					 + "    tmpDET.VRVENTAUNITARIO,                                   "           
					 + "    tmpDET.PORCENTAJEIVA,                                     "           
					 + "    tmpDET.idPlu,                                             "           
					 + "    tmpCAT.NOMBREPLU,                                         "           
	                 + "                                                              "
	                 + "                                                              "
					 + "    CONVERT(numeric(10,2),ROUND((tmpDET.VRVENTAUNITARIO)/     "           
					 + "    ( 1+ tmpDET.PORCENTAJEIVA/100.0 ),2) *                    "           
					 + "    tmpDET.CANTIDAD) AS vrVentaUnitarioSinIva,                "           
					 + "    tbldctos.vrRteFuente,                                     "           
					 + "    tbldctos.vrRteIva,                                        "           
					 + "    1.0 AS porcentajeRteFuente,                               "           
					 + "    6 AS taxId_RteFuente,                                     "           
					 + "    1.0 AS porcentajeRteIva,                                  "           
					 + "    5 AS taxId_RteIva,                                        "           
					 + "    1 AS taxId_Iva,                                           "           
	                 + "                                                              "
	                 + "                                                              "
					 + "    tbldctos.cufe                                             "           
					 + "    ,tmpCAT.idProducto                                        "           
					 + "    FROM tbldctos                                             "           
					 + "    INNER JOIN                                                "           
					 + "    (SELECT tbldctosordenesdetalle.idLocal,                   "           
					 + "      CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29       "           
					 + "      THEN 9 ELSE tbldctosordenesdetalle.IDTIPOORDEN          "           
					 + "      END AS IDTIPOORDEN,                                     "           
					 + "      CASE WHEN tbldctosordenesdetalle.IDTIPOORDEN = 29       "           
					 + "      THEN idOrdenCruce                                       "           
					 + "      ELSE tbldctosordenesdetalle.idOrden                     "           
					 + "      END AS idOrden,                                         "           
					 + "      tbldctosordenesdetalle.idPlu,                           "           
					 + "      tbldctosordenesdetalle.idTipo,                          "           
					 + "      tbldctosordenesdetalle.CANTIDAD,                        "           
					 + "      tbldctosordenesdetalle.VRVENTAUNITARIO,                 "           
					 + "     (tbldctosordenesdetalle.PORCENTAJEIVA)                   "           
					 + "                                       AS PORCENTAJEIVA,      "           
					 + "      tbldctosordenesdetalle.nombrePlu,                       "           
					 + "      tbltercerosruta.idRuta,                                 "           
					 + "      tbltercerosruta.nombreCiclo + '-' +                     "           
					 + "              tbltercerosruta.nombreRuta AS nombreRuta,       "           
					 + "      tblterceroestracto.idEstracto,                          "           
					 + "      tblterceroestracto.codigoClaseUso,                      "           
					 + "      tblterceroestracto.nombreEstracto,                      "           
					 + "      tbldctosordenesdetalle.comentario,                      "
					 + "  	  tmpDCT.idPeriodo                                        "
					 + "     FROM tbldctos AS tmpDCT                                  "                    
					 + "     INNER JOIN tbldctosordenesdetalle                        "           
					 + "     ON tmpDCT.IDLOCAL = tbldctosordenesdetalle.IDLOCAL       "         
					 + "     AND tmpDCT.IDTIPOORDEN =                                 "         
					 + "                       tbldctosordenesdetalle.IDTIPOORDEN     "           
					 + "     AND tmpDCT.IDORDEN     =                                 "         
					 + "                           tbldctosordenesdetalle.IDORDEN     "           
					 + "     INNER JOIN tbltercerosruta                               "           
					 + "     ON tbldctosordenesdetalle.IDLOCAL =                      "           
					 + "                                  tbltercerosruta.idLocal     "           
					 + "     AND tbldctosordenesdetalle.idRuta =                      "           
					 + "                                   tbltercerosruta.idRuta     "           
					 + "     INNER JOIN tblterceroestracto                            "           
					 + "     ON tbldctosordenesdetalle.IDLOCAL =                      "           
					 + "                               tblterceroestracto.idLocal     "           
					 + "     AND tbldctosordenesdetalle.idEstracto =                  "           
					 + "                            tblterceroestracto.idEstracto     "           
					 + "     WHERE tmpDCT.idLocal =    ?1                            "                                                       
					 + "     AND tmpDCT.idTipoOrden IN (9,29)                         "         
					 + "     AND tbldctosordenesdetalle.VRVENTAUNITARIO!=0            "           
					 + "     AND tbldctosordenesdetalle.CANTIDAD != 0) AS tmpDET      "           
					 + "    ON tbldctos.IDLOCAL = tmpDET.IDLOCAL                      "           
					 + "    AND tbldctos.IDTIPOORDEN = tmpDET.IDTIPOORDEN             "           
					 + "    AND tbldctos.IDORDEN = tmpDET.IDORDEN                     "
					 + "    AND tbldctos.idPeriodo = tmpDET.idPeriodo   			"		  
					 + "    INNER JOIN                                                "           
					 + "    (SELECT tblplus.idLocal                                   "           
					 + "        ,tblplus.idPlu                                        "           
					 + "        ,RTRIM(LTRIM(                                         "           
					 + "        tblcategorias.nombreCategoria)) + ' ' +               "           
					 + "        tblplus.nombrePlu AS nombrePlu,                       "           
					 + "  	  tblcategorias.idProducto                                "            
					 + "     FROM tblcategorias                                       "           
					 + "     INNER JOIN tblplus                                       "           
					 + "     ON tblcategorias.idLocal = tblplus.idLocal               "           
					 + "     AND tblcategorias.idLinea = tblplus.idLinea              "           
					 + "     AND tblcategorias.idCategoria = tblplus.idCategoria      "           
					 + "     WHERE tblplus.idLocal = ?1 ) AS tmpCAT                  "            
					 + "    ON tbldctos.idLocal = tmpCAT.idLocal                      "           
					 + "    AND tmpDET.idPlu = tmpCAT.idPlu                           "           
					 + "    INNER JOIN  tbldctosordenes                               "           
					 + "   ON tbldctosordenes.IDLOCAL = tbldctos.IDLOCAL              "           
					 + "   AND tbldctosordenes.IDTIPOORDEN = tbldctos.IDTIPOORDEN     "           
					 + "   AND tbldctosordenes.IDORDEN = tbldctos.IDORDEN             "           
					 + "   INNER JOIN tbllocales                                      "           
					 + "   ON tbllocales.idLocal = tbldctosordenes.IDLOCAL            "           
					 + "   INNER JOIN tblterceros                                     "           
					 + "   ON tbldctos.IDLOCAL = tblterceros.idLocal                  "           
					 + "   AND tbldctos.idCliente = tblterceros.idCliente             "           
					 + "   INNER JOIN tbldctosperiodo                                 "           
					 + "   ON tbldctos.IDLOCAL = tbldctosperiodo.idLocal              "           
					 + "   AND tbldctos.idPeriodo = tbldctosperiodo.idPeriodo         "           
					 + "   INNER JOIN (                                               "           
					 + "     SELECT tbldctosordenesdetalle.IDLOCAL,                   "           
					 + "       tbldctosordenesdetalle.IDTIPOORDEN,                    "           
					 + "     	 tbldctosordenesdetalle.IDORDEN,                      "            
					 + "       tbldctos.idPeriodo,                                    "           
					 + "     	 MAX(tbltipocausanota.nombreCausa)                    "            
					 + "                                    AS nombreCausa,           "           
					 + "       MAX(CONVERT(int,tbldctosordenesdetalle.lecturaMedidor))"               
					 + "     	                                    AS lecturaMedidor "            
					 + "     FROM tbldctosordenesdetalle                              "           
					 + "     INNER JOIN tbldctos                                      "           
					 + "     ON tbldctosordenesdetalle.IDLOCAL = tbldctos.IDLOCAL     "           
					 + "     AND tbldctosordenesdetalle.IDTIPOORDEN =                 "           
					 + "                                        tbldctos.IDTIPOORDEN  "           
					 + "     AND tbldctosordenesdetalle.IDORDEN = tbldctos.IDORDEN    "           
					 + "     INNER JOIN tbltipocausanota                              "           
					 + "     ON tbltipocausanota.idCausa =                            "           
					 + "                    tbldctosordenesdetalle.idNovedadLectura   "           
					 + "     WHERE tbltipocausanota.idTipoTabla    =  2               "           
					 + "     AND tbldctosordenesdetalle.idTipo     =  4               "           
					 + "     AND tbldctosordenesdetalle.STRIDLISTA =  '1'             "           
					 + "     AND tbldctosordenesdetalle.idLocal   =  ?1              "                               
					 + "     AND tbldctos.idPeriodo =  ?3                         "                  
					 + "     GROUP BY tbldctosordenesdetalle.IDLOCAL,                 "           
					 + "        tbldctosordenesdetalle.IDTIPOORDEN,                   "           
					 + "        tbldctosordenesdetalle.IDORDEN,                       "           
					 + "        tbldctos.idPeriodo) AS tmpLEC                         "           
					 + "     ON tmpLEC.IDLOCAL = tbldctos.IDLOCAL                     "           
					 + "     AND tmpLEC.IDTIPOORDEN = tbldctos.IDTIPOORDEN            "           
					 + "     AND tmpLEC.IDORDEN = tbldctos.IDORDEN                    "           
					 + "     AND tmpLEC.idPeriodo = tbldctos.idPeriodo                "           
					 + "   LEFT JOIN                                                  "           
					 + "   (SELECT tbldctosordenesdetalle.IDLOCAL,                    "           
					 + "          tbldctosordenesdetalle.IDTIPOORDEN,                 "           
					 + "   	  tbldctosordenesdetalle.idCliente,                       "        
					 + "          MAX(CONVERT(int,                                    "           
					 + "                    tbldctosordenesdetalle.lecturaAnterior))  "           
					 + "   	                                 AS lecturaAnterior       "        
					 + "   FROM tbldctosordenesdetalle                                "           
					 + "   INNER JOIN tbldctos                                        "           
					 + "   ON tbldctosordenesdetalle.IDLOCAL = tbldctos.IDLOCAL       "           
					 + "   AND tbldctosordenesdetalle.IDTIPOORDEN =                   "           
					 + "                                     tbldctos.IDTIPOORDEN     "           
					 + "   AND tbldctosordenesdetalle.IDORDEN = tbldctos.IDORDEN      "           
					 + "   AND tbldctosordenesdetalle.idCliente = tbldctos.idCliente  "           
					 + "   WHERE tbldctosordenesdetalle.idTipo     =  4               "           
					 + "   AND tbldctosordenesdetalle.STRIDLISTA   = '1'              "           
					 + "   AND tbldctosordenesdetalle.idLocal   =  ?1                "                             
					 + "   AND tbldctos.idPeriodo =  ?3                           "                
					 + "   GROUP BY tbldctosordenesdetalle.IDLOCAL,                   "           
					 + "            tbldctosordenesdetalle.IDTIPOORDEN,               "           
					 + "            tbldctosordenesdetalle.idCliente) AS tmpANT       "           
					 + "   ON tmpANT.IDLOCAL = tbldctos.IDLOCAL                       "           
					 + "   AND tmpANT.IDTIPOORDEN = tbldctos.IDTIPOORDEN              "           
					 + "   AND tmpANT.idCliente = tbldctos.idCliente                  "           
					 + "   INNER JOIN tblmedidores                                    "           
					 + "   ON tblmedidores.idLocal =tblterceros.IDLOCAL               "           
					 + "   AND tblmedidores.idMedidor = tblterceros.idMedidor         "           
					 + "   INNER JOIN                                                 "           
					 + "   ( SELECT tbldctos.IDLOCAL,                                 "           
					 + "            tbldctos.IDTIPOORDEN,                             "           
					 + "   	        tbldctos.IDORDEN,                                 "            
					 + "            tbldctos.idPeriodo,                               "           
					 + "            tbldctosordenesdetalle.idcliente,                 "           
					 + "   	    SUM(tbldctosordenesdetalle.CANTIDAD)                  "        
					 + "   	                                     AS consumo           "        
					 + "   FROM tbldctos                                              "           
					 + "   INNER JOIN tbldctosordenesdetalle                          "           
					 + "   ON tbldctos.idLocal = tbldctosordenesdetalle.IDLOCAL       "           
					 + "   AND tbldctos.idTipoOrden =                                 "           
					 + "                      tbldctosordenesdetalle.idTipoOrden      "           
					 + "   AND tbldctos.idOrden = tbldctosordenesdetalle.idOrden      "           
					 + "   WHERE tbldctosordenesdetalle.IDTIPO = 4                    "           
					 + "   GROUP BY tbldctos.IDLOCAL,                                 "           
					 + "            tbldctos.IDTIPOORDEN,                             "           
					 + "   	        tbldctos.IDORDEN,                                 "          
					 + "            tbldctos.idPeriodo,                               "           
					 + "            tbldctosordenesdetalle.idcliente) AS tmpCON       "           
					 + "   ON tmpCON.IDLOCAL = tbldctos.IDLOCAL                       "           
					 + "   AND tmpCON.IDTIPOORDEN = tbldctos.IDTIPOORDEN              "           
					 + "   AND tmpCON.IDORDEN= tbldctos.IDORDEN                       "           
					 + "   AND tmpCON.idPeriodo= tbldctos.idPeriodo                   "           
					 + "                                                              "           
					 + "    WHERE tbldctos.idLocal = ?1                              "              
					 + "    AND tmpCON.idPeriodo = ?3                             "             
					 + "    AND tbldctos.idTipoOrden IN (9,29)                       "		      
					 + "    AND tbldctos.idDcto =  ?2                             "                
					 + "                                                              "           
					 + "    AND tmpDET.VRVENTAUNITARIO != 0                           "           
					 + "    AND tmpDET.CANTIDAD != 0                                  "                                   
					 + "    ORDER BY tbldctos.idLocal,                                "           
					 + "             tbldctos.idOrden,                                "           
					 + "  	       tmpCAT.idProducto,                                 "            
					 + "             tmpDET.IDTIPO                                    "           
				  , nativeQuery = true)
  
		  List<TblDctosOrdenesDTO> ObtenerFacturaActualizada(int idLocal, int idDcto, int xIdPeriodo);
		  
	
	
		  
		  @Query( value = " SELECT tmpPRC.idLocal,                             "
	                + "        tmpPRC.idDcto,                              "
	                + "        tmpPRC.idPeriodo,                           "
	                + " 	   tmpPRC.nombrePeriodo,                       "
	                + "        tmpPRC.idCliente,                           "
	                + "        MAX(tmpPRC.nombreTercero) AS nombreTercero, "
	                + "        MAX(tbldctosordenes.historiaConsumo)        "
	                + "                                AS historiaConsumo, "
	                + "        MAX(tbldctosordenes.promedio) AS promedio,  "
	                + "        ISNULL(MAX(tblterceros.ordenRuta),0)        "
	                + " 	                                 AS ordenRuta, "
	                + " 	   MAX(tmpPRC.idRuta)  AS idRuta,              "
	                + "        MAX(tmpPRC.nombreCiclo) + '-' +             "
	                + "  MAX(tmpPRC.nombreRuta) AS nombreRuta, "
	                + "        MAX(tmpPRC.idEstracto) AS idEstracto,       "
	                + "      MAX(tmpPRC.nombreEstracto) AS nombreEstracto, "
	                + "       MAX(tmpPRC.lecturaMedidor) AS lecturaActual, "
	                + "        ISNULL((SELECT TOP 1                        "
	                + " tbldctosordenesdetalle.lecturaAnterior  			"
	                + "                                AS lecturaAnterior  "
	                + "         FROM tbldctosordenes                       "
	                + "         INNER JOIN tbldctosordenesdetalle          "
	                + "         ON tbldctosordenes.IDLOCAL                 "
	                + "                   = tbldctosordenesdetalle.IDLOCAL "
	                + "         AND tbldctosordenes.IDTIPOORDEN            "
	                + "               = tbldctosordenesdetalle.IDTIPOORDEN "
	                + "         AND tbldctosordenes.IDORDEN                "
	                + "                   = tbldctosordenesdetalle.IDORDEN "
	                + "         WHERE tbldctosordenes.idLocal =            "
	                + "                         tmpPRC.IDLOCAL "
	                + "         AND tbldctosordenes.idTipoOrden =          "
	                + "                     tmpPRC.IDTIPOORDEN "
	                + "         AND tbldctosordenes.idPeriodo =            "
	                + "?1                                "
	                + "         AND tbldctosordenesdetalle.idTipo = 4      "
	                + "         AND tbldctosordenesdetalle.idCliente =     "
	                + "           tmpPRC.idCliente),0)         "
	                + " 				   AS lecturaAnterior, "
	                + "         SUM(tmpPRC.cantidad) AS cantidad,          "
	                + "         MAX(tmpFRA.nombreCausa) AS nombreCausa     "
	                + " FROM (                                             "
	                + " SELECT tbldctos.idLocal,                           "
	                + "        tbldctos.idTipoOrden,                       "
	                + "        tbldctos.idOrden,                           "
	                + "        tbldctos.idDcto,                            "
	                + "        tbldctos.idPeriodo,                         "
	                + "        tbldctos.idCliente,                         "
	                + "        tbldctos.nombreTercero,                     "
	                + "        MAX(tbldctos.fechaDcto) AS fechaDcto,       "
	                + "        tblplus.idTipo,                             "
	                + "        MAX(CASE WHEN tblplus.idTipo = 4            "
	                + "        THEN tbldctosordenesdetalle.lecturaMedidor  "
	                + "                     ELSE 0 END) AS lecturaMedidor, "
	                + "        SUM(CASE WHEN tblplus.idTipo = 4            "
	                + "            THEN tbldctosordenesdetalle.cantidad    "
	                + "                           ELSE 0 END) AS cantidad, "
	                + "        MAX(tbldctosperiodo.nombrePeriodo)          "
	                + "                                  AS nombrePeriodo, "
	                + "        MAX(tbltercerosruta.nombreCiclo)            "
	                + "                                    AS nombreCiclo, "
	                + "        MAX(tbltercerosruta.nombreRuta)             "
	                + "                                     AS nombreRuta, "
	                + "        MAX(tbltercerosruta.idRuta) AS idRuta,      "
	                + "        MAX(tblterceroestracto.idEstracto)          "
	                + "                                     AS idEstracto, "
	                + "        MAX(tblterceroestracto.nombreEstracto)      "
	                + "            		             AS nombreEstracto "
	                + " FROM tbldctos                                      "
	                + " INNER JOIN tbldctosordenesdetalle                  "
	                + " ON tbldctos.IDLOCAL =                              "
	                + "         tbldctosordenesdetalle.IDLOCAL "
	                + " AND tbldctos.IDTIPOORDEN =                         "
	                + "     tbldctosordenesdetalle.IDTIPOORDEN "
	                + " AND tbldctos.IDORDEN =                             "
	                + "         tbldctosordenesdetalle.IDORDEN "
	                + " INNER JOIN tbldctosordenes                         "
	                + " ON tbldctos.IDLOCAL  =  tbldctosordenes.IDLOCAL    "
	                + " AND tbldctos.IDTIPOORDEN =                         "
	                + "            tbldctosordenes.IDTIPOORDEN "
	                + " AND tbldctos.IDORDEN = tbldctosordenes.IDORDEN     "
	                + " INNER JOIN tblterceroestracto                      "
	                + " ON tblterceroestracto.idEstracto =                 "
	                + "      tbldctosordenesdetalle.idEstracto "
	                + " AND tblterceroestracto.idLocal =                   "
	                + "         tbldctosordenesdetalle.idLocal "
	                + " INNER JOIN tbltercerosruta                         "
	                + " ON tbldctosordenesdetalle.idRuta                   "
	                + "                           = tbltercerosruta.idRuta "
	                + " AND tbldctosordenesdetalle.idLocal                 "
	                + "                          = tbltercerosruta.idLocal "
	                + " INNER JOIN tblplus                                 "
	                + " ON tbldctosordenesdetalle.IDPLU = tblplus.idPlu    "
	                + " AND tbldctosordenesdetalle.idLocal =               "
	                + "                        tblplus.idLocal "
	                + " INNER JOIN tbldctosperiodo                         "
	                + " ON tbldctosperiodo.idPeriodo = tbldctos.idPeriodo  "
	                + " AND tbldctosperiodo.idLocal = tbldctos.idLocal     "
	                + " WHERE     tbldctos.idLocal       =                 "
	                + "?2                                      "
	                + " AND       tbldctos.idTipoOrden   =                 "
	                + "?3                                  "
	                + " AND       tbldctos.idPeriodo     =                 "
	                + "?4                                    "
	                + " GROUP BY tbldctos.idLocal,                         "
	                + "         tbldctos.idTipoOrden,                      "
	                + "         tbldctos.idOrden,                          "
	                + "         tbldctos.idDcto,                           "
	                + "         tbldctos.idPeriodo,                        "
	                + "         tbldctos.idCliente,                        "
	                + "         tblplus.idTipo,                            "
	                + "         tbldctos.nombreTercero) AS tmpPRC          "
	                + " INNER JOIN tbllocales                              "
	                + " ON tbllocales.idLocal = tmpPRC.IDLOCAL             "
	                + " INNER JOIN tblterceros                             "
	                + " ON tblterceros.idLocal = tmpPRC.IDLOCAL            "
	                + " AND tblterceros.idCliente = tmpPRC.idCliente       "
	                + " INNER JOIN tbldctosordenes                         "
	                + " ON tbldctosordenes.idLocal = tmpPRC.IDLOCAL        "
	                + " AND tbldctosordenes.idTipoOrden =                  "
	                + "                     tmpPRC.idTipoOrden "
	                + " AND tbldctosordenes.idOrden = tmpPRC.idOrden       "
	                + " INNER JOIN tblterceroestracto                      "
	                + " ON tblterceroestracto.idEstracto =                 "
	                + "                tblterceros.idEstracto  "
	                + " AND tblterceroestracto.idLocal =                   "
	                + "                   tblterceros.idLocal  "
	                + " INNER JOIN tbltercerosruta                         "
	                + " ON tblterceros.idRuta = tbltercerosruta.idRuta     "
	                + " AND tblterceros.idLocal = tbltercerosruta.idLocal  "
	                + " INNER JOIN                                         "
	                + " (SELECT tbldctosordenesdetalle.IDLOCAL,            "
	                + "         tbldctosordenesdetalle.IDTIPOORDEN,        "
	                + "         tbldctosordenesdetalle.IDORDEN,            "
	                + "         tbltipocausanota.nombreCausa               "
	                + " FROM tbldctosordenes                               "
	                + " INNER JOIN tbldctosordenesdetalle                  "
	                + " ON tbldctosordenes.IDLOCAL =                       "
	                + "         tbldctosordenesdetalle.IDLOCAL "
	                + " AND tbldctosordenes.IDTIPOORDEN =                  "
	                + "     tbldctosordenesdetalle.IDTIPOORDEN "
	                + " AND tbldctosordenes.IDORDEN =                      "
	                + "         tbldctosordenesdetalle.IDORDEN "
	                + " INNER JOIN tbltipocausanota                        "
	                + " ON tbltipocausanota.idCausa =                      "
	                + "tbldctosordenesdetalle.idNovedadLectura "
	                + " WHERE tbldctosordenesdetalle.IDLOCAL  =            "
	                + "?2                                      "
	                + " AND tbldctosordenesdetalle.IDTIPOORDEN =           "
	                + "?3                                  "
	                + " AND tbldctosordenes.IDPERIODO         =            "
	                + "?4                                    "
	                + " AND tbldctosordenesdetalle.IDTIPO     = 4          "
	                + " AND tbldctosordenesdetalle.STRIDLISTA = 1          "
	                + " AND tbltipocausanota.idTipoTabla = 2) AS tmpFRA    "
	                + " ON tmpFRA.IDLOCAL=tmpPRC.IDLOCAL                   "
	                + " AND tmpFRA.IDTIPOORDEN = tmpPRC.idTipoOrden        "
	                + " AND tmpFRA.IDORDEN = tmpPRC.idOrden                "
	                + " INNER JOIN tblmedidores                            "
	                + " ON tblmedidores.idLocal = tblterceros.IDLOCAL      "
	                + " AND tblmedidores.idMedidor = tblterceros.idMedidor "
	                + " WHERE     tmpPRC.idLocal         =                 "
	                + "?2                                      "
	                + " AND       tmpPRC.idTipoOrden     =                 "
	                + "?3                                  "
	                + " AND       tmpPRC.idPeriodo       =                 "
	                + "?4                                    "
	                + " GROUP BY tmpPRC.idLocal,                           "
	                + "        tmpPRC.idTipoOrden,                         "
	                + "        tmpPRC.idOrden,                             "
	                + "        tmpPRC.idDcto,                              "
	                + "        tmpPRC.idPeriodo,                           "
	                + "        tmpPRC.idCliente,                           "
	                + "       tmpPRC.nombrePeriodo                         "
	                + " ORDER BY idruta,                                   "
	                + "          ordenRuta", nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaLecturaAllSuscriptor(int xidPeriodoAnterior, int idLocal, int idTipoOrden, int idPeriodo );
		  

		  
		  
		  
		  
		  
		  
		  @Query( value = "SELECT  COUNT(*) AS cuenta " +
		  		  "FROM    tbldctos " +
				  "JOIN bdaquamovil.dbo.tbldctosOrdenes " +
		  		  "ON tbldctos.IDLOCAL      =   tbldctosOrdenes.IDLOCAL  " + 
				  "AND tbldctos.IDTIPOORDEN =   tbldctosOrdenes.IDTIPOORDEN " +
		  		  "AND tbldctos.IDORDEN       =      tbldctosOrdenes.IDORDEN  " +
		  		  "WHERE tbldctos.IDLOCAL     = ?1  " + 
		  		  "AND   tbldctos.IDTIPOORDEN = ?2 " +
		  		  "AND   tbldctos.idPeriodo   = ?3 " +
		  		  "GROUP BY tbldctos.IDLOCAL, " +
		  		  "tbldctos.IDTIPOORDEN "
		  		  , nativeQuery = true)
		  List<TblDctosOrdenesDTO> PeriodoFacturado(int idLocal,  int idTipoOrden, int idPeriodo );
		  
		  
		  
		  @Query( value = "      SELECT MAX(tblterceros.nombreTercero) AS nombreTercero,      "                               
				    + "            MAX(tbltipocausanota.nombreCausa)                      "                        
				    + "     	                            AS nombreEstadoCliente,       "                          
				    + "            MAX(tblterceros.direccionTercero)                      "                        
				    + "                                        AS direccionTercero,       "                        
				    + "            tmpPRC.idDcto,                                         "                        
				    + "            tmpPRC.idPeriodo,                                      "                        
				    + "            tmpPRC.idCliente,                                      "                        
				    + "            SUM(tmpPRC.vrConsumo)  AS vrConsumo,                   "                        
				    + "            MAX(tmpPRC.lecturaMedidor)                             "                        
				    + "                                   AS lecturaActual,               "                        
				    + "           CASE WHEN MAX(tmpPRC.lecturaMedidor) -                  "                        
				    + "          SUM(tmpPRC.cantidad)<0 THEN 0                            "                              
				    + "            ELSE MAX(tmpPRC.lecturaMedidor) -                      "                        
				    + "           SUM(tmpPRC.cantidad)                                    "                               
				    + "                             END AS lecturaAnterior,               "                        
				    + "            MAX(ISNULL(tbldctosordenes.promedio,0))                "                        
				    + "                                        AS promedio,               "                        
				    + "            SUM(tmpPRC.vrCargoFijo) AS vrCargoFijo,                "                        
				    + "            MAX(tmpPRC.vrVentaUnitario)                            "                        
				    + "                                 AS vrVentaUnitario,               "                        
				    + "            SUM(tmpPRC.vrDeudaCargoFijo)                           "                        
				    + "                                AS vrDeudaCargoFijo,               "                        
				    + "            SUM(tmpPRC.vrDeudaConsumo)                             "                        
				    + "                                  AS vrDeudaConsumo,               "                        
				    + "            SUM(tmpPRC.vrDeudaContribucion)                        "                        
				    + "                             AS vrDeudaContribucion,               "                        
				    + "    	   SUM(tmpPRC.vrDeudaSubsidio)                                "                      
				    + "                                AS vrDeudaSubsidio,                "                        
				    + "            SUM(tmpPRC.vrDeudaReconexion)                          "                        
				    + "                               AS vrDeudaReconexion,               "                        
				    + "            SUM(tmpPRC.vrDeudaConexion)                            "                        
				    + "                                 AS vrDeudaConexion,               "                        
				    + "            SUM(tmpPRC.vrDeudaSuspencion)                          "                        
				    + "                               AS vrDeudaSuspencion,               "                        
				    + "            SUM(tmpPRC.vrDeudaReinstalacion)                       "                        
				    + "                            AS vrDeudaReinstalacion,               "                        
				    + "           SUM(tmpPRC.vrDeudaOtros) AS vrDeudaOtros,               "                        
				    + "            SUM(tmpPRC.vrDeudaCargoCorte)                          "                        
				    + "                               AS vrDeudaCargoCorte,               "                        
				    + "            SUM(tmpPRC.vrDeudaMedidor)                             "                        
				    + "                                  AS vrDeudaMedidor,               "                        
				    + "            SUM(tmpPRC.vrFinanciacion)                             "                        
				    + "                                  AS vrFinanciacion,               "                        
				    + "            SUM(tmpPRC.vrDeudaFinanciacion)                        "                        
				    + "                             AS vrDeudaFinanciacion,               "                        
				    + "            SUM(tmpPRC.vrMedidor) AS vrMedidor,                    "                        
				    + "            MAX(ISNULL(                                            "                        
				    + "               tbldctosordenes.cuotaVencida,0))                    "                        
				    + "                                    AS cuotaVencida,               "                        
				    + "            SUM(tmpPRC.cantidad) AS cantidad,  	                  "                      
				    + "            MAX(tmpFRA.nombreCausa) AS nombreCausa,                "                        
				    + "            SUM(tmpPRC.vrConexion) AS vrConexion,                  "                        
				    + "           SUM(tmpPRC.vrReconexion) AS vrReconexion,               "                        
				    + "           SUM(tmpPRC.vrReinstalacion)                             "                        
				    + "                                 AS vrReinstalacion,               "                        
				    + "           SUM(tmpPRC.vrSuspencion) AS vrSuspencion,               "                        
				    + "           SUM(tmpPRC.vrCargoCorte) AS vrCargoCorte,               "                        
				    + "           SUM(tmpPRC.vrOtros) AS vrOtros,                         "                        
				    + "           SUM(tmpPRC.vrConsumo  +                                 "                        
				    + "               tmpPRC.vrCargoFijo    +                             "                        
				    + "               tmpPRC.vrMedidor      +                             "                        
				    + "               tmpPRC.vrFinanciacion +               	          "                          
				    + "               tmpPRC.vrInteres      +               	          "                                                         
				    + "               tmpPRC.VrReconexion   +                             "                        
				    + "               tmpPRC.vrConexion     +                             "                        
				    + "               tmpPRC.vrReinstalacion +                            "                        
				    + "               tmpPRC.vrCargoCorte   +                             "                        
				    + "               tmpPRC.vrOtros        +                             "                        
				    + "               tmpPRC.vrSuspencion  +                              "                        
				    + "               tmpPRC.vrSubsidio  +                                "                        
				    + "               tmpPRC.vrContribucion +                             "                        
				    + "               tmpPRC.vrAlcantarillaCargoFijo +	                  "                      
				    + "               tmpPRC.vrAlcantarillaConsumo +                      "                        
				    + "               tmpPRC.vrAlcantarillaDeuda +                        "                        
					+ "  		   tmpPRC.vrAseoDeuda +                                   "                      
				    + "         tmpPRC.vrSubsidioCargoFijoAlcantarillado +                "                        
				    + "           tmpPRC.vrSubsidioConsumoAlcantarillado +                "                        
				    + "      tmpPRC.vrContribucionCargoFijoAlcantarillado +               "                        
				    + "       tmpPRC.vrContribucionConsumoAlcantarillado +                "                        
				    + "               tmpPRC.vrAseoCargoFijo +                            "                        
				    + "               tmpPRC.vrContribucionCargoFijoAseo +                "                        
				    + "               tmpPRC.vrSubsidioCargoFijoAseo +                    "                        
				    + "               tmpPRC.vrAjusteDecena +                             "                        
				    + "              tmpPRC.deudaAnterior) AS vrTotalPagar,               "                        
				    + "           (SELECT ISNULL(SUM(tblpagos.vrPago),0)                  "                        
				    + "                                           AS vrPago               "                        
				    + "            FROM tblpagos                                          "                        
				    + "            WHERE tblpagos.IDLOCAL = tmpPRC.idLocal                "                        
				    + "            AND tblpagos.IDTIPOORDEN =                             "                        
				    + "                      tmpPRC.idTipoOrden                           "                        
				    + "            AND tblpagos.nitCC = tmpPRC.idCliente                  "                        
				    + "            AND tblpagos.idPeriodo =                               "                        
				    + "         ?1  ) AS vrPago, 		                                  "                          
				    + "           (SELECT tbldctosordenesdetalle.CANTIDAD                 "                        
				    + "                                    AS cantidadRango               "                        
				    + "            FROM tbldctosordenesdetalle                            "                        
				    + "            WHERE tbldctosordenesdetalle.IDLOCAL =                 "                        
				    + "                          tmpPRC.idLocal                           "                        
				    + "    	   AND tbldctosordenesdetalle.IDTIPOORDEN =                   "                      
				    + "                     tmpPRC.idTipoOrden                            "                        
				    + "    	   AND tbldctosordenesdetalle.IDORDEN =                       "                      
				    + "                          tmpPRC.idOrden                           "                        
				    + "    	  AND tbldctosordenesdetalle.STRIDLISTA = 1                   "                      
				    + "    	   AND tbldctosordenesdetalle.IDTIPO   = 4)                   "                      
				    + "                                  AS cantidadRango1,               "                        
				    + "           ROUND(SUM(tmpPRC.vrSubsidioCargoFijo +                  "                        
				    + "     	  tmpPRC.vrSubsidioConsumo),0)                            "                          
				    + "                                      AS vrSubsidio,               "                        
				    + "           ROUND(SUM(tmpPRC.vrSubsidioCargoFijo),0)                "                        
				    + "                             AS vrSubsidioCargoFijo,               "                        
				    + "           ROUND(SUM(tmpPRC.vrSubsidioConsumo),0)                  "                        
				    + "                               AS vrSubsidioConsumo,               "                        
				    + "           SUM(tmpPRC.vrContribucion )                             "                        
				    + "     		                 AS vrContribucion,                   "                          
				    + "           SUM(tmpPRC.vrContribucionCargoFijo )                    "                        
				    + "     		        AS vrContribucionCargoFijo,                   "                          
				    + "           SUM(tmpPRC.vrContribucionConsumo )                      "                        
				    + "     		          AS vrContribucionConsumo,                   "                          
				    + "           SUM(tmpPRC.vrAjusteDecena)                              "                        
				    + "      	                         AS vrAjusteDecena,               "                          
				    + "           SUM(tmpPRC.vrDeudaAjusteDecena)                         "                        
				    + "    	                    AS vrDeudaAjusteDecena,                   "                      
				    + "     	  SUM(tmpPRC.deudaAnterior)                               "                          
				    + "                                 AS vrDeudaAnterior,               "                        
				    + "           SUM(tmpPRC.vrInteres +                                  "                        
				    + "     tmpPRC.vrInteresAcum) AS vrInteres,                           "                        
				    + "          SUM(tmpPRC.vrInteres) AS vrInteresPeriodo,               "                        
				    + "         SUM(tmpPRC.vrInteresAcum) AS vrInteresAcum,               "                        
				    + "           SUM(tmpPRC.vrAlcantarillaConsumo)                       "                        
				    + "     	                  AS vrAlcantarillaConsumo, 			"          		          					  
					+ "  		SUM(tmpPRC.vrAlcantarillaDeuda)                           "                      
				    + "     	                  AS vrAlcantarillaDeuda,                 "                          
				    + "            SUM(tmpPRC.vrAseoDeuda)                                "                        
				    + "     	                  AS vrAseoDeuda,						"          		          		  
				    + "           SUM(tmpPRC.vrAlcantarillaCargoFijo)                     "                        
				    + "     		        AS vrAlcantarillaCargoFijo,                   "                          
				    + "       SUM(tmpPRC.vrSubsidioCargoFijoAlcantarillado)               "                        
				    + "               AS vrSubsidioCargoFijoAlcantarillado,               "                        
				    + "           SUM(tmpPRC.vrSubsidioConsumoAlcantarillado)             "                        
				    + "                    AS vrSubsidioConsumoAlcantarillado,            "                        
				    + "      SUM(tmpPRC.vrContribucionCargoFijoAlcantarillado)            "                        
				    + "              AS vrContribucionCargoFijoAlcantarillado,            "                        
				    + "        SUM(tmpPRC.vrContribucionConsumoAlcantarillado)            "                        
				    + "                AS vrContribucionConsumoAlcantarillado,            "                        
				    + "           SUM(tmpPRC.vrAseoCargoFijo)                             "                        
				    + "                                 AS vrAseoCargoFijo,               "                        
				    + "           SUM(tmpPRC.vrContribucionCargoFijoAseo)                 "                        
				    + "                     AS vrContribucionCargoFijoAseo,               "                        
				    + "           SUM(tmpPRC.vrSubsidioCargoFijoAseo)                     "                        
				    + "                         AS vrSubsidioCargoFijoAseo,               "                        
				    + "          ISNULL(                                                  "                        
				    + "           MAX(tbldctosordenes.comentario),'')                     "                        
				    + "                               AS textoFinanciacion,               "                        
				    + "          MAX(tbltercerosruta.nombreCiclo) + '-' +                 "                        
				    + "          MAX(tbltercerosruta.nombreRuta)                          "                        
				    + "                                      AS nombreRuta,               "                        
				    + "          MAX(ISNULL(tblterceros.ordenRuta,0))                     "                        
				    + "                                       AS ordenRuta,               "                        
				    + "          MAX(tblterceros.idRuta) AS idRuta,                       "                        
				    + "          MAX(tblterceroestracto.nombreEstracto)                   "                        
				    + "                                  AS nombreEstracto,               "                        
				    + "          MAX(tblterceros.email) AS emailSuscriptor,               "                        
				    + "      	 MAX(tblterceros.direccionCobro)                          "                          
				    + "      		                 AS direccionCobro,                   "                          
				    + "          tmpPRC.fechaInicial AS fechaDesde,                       "                        
				    + "          tmpPRC.fechaFinal AS fechaHasta,                         "                        
				    + "          tmpPRC.fechaSinRecargo,                                  "                        
				    + "          tmpPRC.fechaConRecargo,                                  "                        
				    + "          tmpPRC.nombrePeriodo      						          "                      
				    + "      FROM (                                                       "                        
				    + "      SELECT tbldctos.idLocal,                                     "                        
				    + "             tbldctos.idTipoOrden,                                 "                        
				    + "             tbldctos.idOrden,                                     "                        
				    + "             tbldctos.idDcto,                                      "                        
				    + "             tbldctos.idPeriodo,                                   "                        
				    + "             tbldctos.idCliente,                                   "                        
				    + "             MAX(tbldctos.fechaDcto) AS fechaDcto,                 "                        
				    + "             tblplus.idTipo,                                       "                        
				    + "             SUM (CASE WHEN tblplus.idTipo = 4                     "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad  *                "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario)                 "                        
				    + "              ELSE 0 END) AS vrConsumo,                            "                        
				    + "             SUM(CASE WHEN tblplus.idTipo = 104                    "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "               ELSE 0 END) AS vrDeudaConsumo,                      "                        
				    + "             MAX(CASE WHEN tblplus.idTipo = 4                      "                        
				    + "               THEN                                                "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario                "                        
				    + "              ELSE 0 END) AS vrVentaUnitario,  	                  "                      
				    + "             MAX (CASE WHEN tblplus.idTipo = 4                     "                        
				    + "                 THEN                                              "                        
				    + "             tbldctosordenesdetalle.lecturaMedidor                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS lecturaMedidor,                             "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo = 4                                      "                        
				    + "          THEN tbldctosordenesdetalle.cantidad                     "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS cantidad,                                   "                        
				    + "             SUM (CASE WHEN tblplus.idTipo = 6                     "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario)                 "                        
				    + "                 ELSE 0 END) AS vrCargoFijo,                       "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo = 106                                    "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "        tbldctosordenesdetalle.vrVentaUnitario )                   "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaCargoFijo,                           "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (9)                                  "                         
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "               ELSE 0                                              "                        
				    + "               END) AS vrMedidor,                                  "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (109)                                "                         
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "               ELSE 0                                              "                        
				    + "               END) AS vrDeudaMedidor, 		                      "                      
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (8)                                   "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrFinanciacion,                             "                        
				    + "              SUM(CASE WHEN tblplus.idTipo IN (108)                "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaFinanciacion,                        "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (12)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrInteres,                                  "                        
				    + "               SUM (CASE WHEN                                      "                        
				    + "           tblplus.idTipo IN (112)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "        tbldctosordenesdetalle.vrVentaUnitario )                   "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrInteresAcum,                              "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (13)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrReconexion,    		                      "                      
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (113)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaReconexion,	                      "                          
				    + "               SUM (CASE WHEN                                      "                        
				    + "         tblplus.idTipo IN (14)                                    "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrConexion,                                 "                        
				    + "               SUM (CASE WHEN                                      "                        
				    + "         tblplus.idTipo IN (114)                                   "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaConexion,   	                      "                          
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (15)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "       tbldctosordenesdetalle.vrVentaUnitario )                    "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrReinstalacion,                            "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (115)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "       tbldctosordenesdetalle.vrVentaUnitario )                    "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaReinstalacion, 	                  "                          
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (16)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrSuspencion,                               "                        
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (116)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaSuspencion, 	                      "                          
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (17)                                  "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "        tbldctosordenesdetalle.vrVentaUnitario  )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrCargoCorte,                               "                        
				    + "    SUM (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (117)                                 "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "        tbldctosordenesdetalle.vrVentaUnitario  )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaCargoCorte,     	                  "                          
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (18)                                  "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad  *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrOtros,                                    "                        
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (118)                                 "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad  *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaOtros,		                          "                      
				    + "            SUM(CASE WHEN tblplus.idTipo IN (19,21)               "                         
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario)                 "                        
				    + "                 ELSE 0 END) AS vrSubsidio,                        "                        
				    + "              SUM(CASE WHEN tblplus.idTipo IN (19)                "                         
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario)                 "                        
				    + "                ELSE 0 END) AS vrSubsidioCargoFijo,                "                        
				    + "             SUM(CASE WHEN tblplus.idTipo IN (21)                  "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario)                  "                        
				    + "                 ELSE 0 END) AS vrSubsidioConsumo,                 "                        
				    + "     	 SUM(CASE WHEN tblplus.idTipo IN (119,121)               "                           
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario )                "                        
				    + "                    ELSE 0 END) AS vrDeudaSubsidio,                "                        
				    + "            SUM(CASE WHEN tblplus.idTipo IN (20,22)                "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario )                "                        
				    + "                 ELSE 0 END) AS vrContribucion,                    "                        
				    + "           SUM(CASE WHEN tblplus.idTipo IN (20)                    "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "            ELSE 0 END) AS vrContribucionCargoFijo,                "                        
				    + "          SUM(CASE WHEN tblplus.idTipo IN (22)                     "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "            ELSE 0 END) AS vrContribucionConsumo,                  "                        
				    + "          SUM(CASE WHEN tblplus.idTipo IN (120,122)                "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "                ELSE 0 END) AS vrDeudaContribucion,                "                        
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (50)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrAlcantarillaCargoFijo, 	                  "                      
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (51)                                  "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "              END) AS vrAlcantarillaConsumo,                       "                        
				    + "       SUM (CASE WHEN                                              "                        
				    + "           tblplus.idTipo IN (150, 151)                            "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "              END) AS vrAlcantarillaDeuda,					   	"          	              
					+ "  		  SUM (CASE WHEN                                          "                      
				    + "           tblplus.idTipo IN (160)                                 "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "              END) AS vrAseoDeuda, 							      "                      
				    + "     SUM (CASE WHEN                                                "                        
				    + "           tblplus.idTipo IN (23)                                  "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "              END) AS vrAjusteDecena,        	                  "                          
				    + "     	 SUM(CASE WHEN tblplus.idTipo IN (123)                    "                          
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "                ELSE 0 END) AS vrDeudaAjusteDecena,                "                        
				    + "             SUM (CASE WHEN tblplus.idTipo IN                      "                        
				    + "                  (106,104,105,108,109,110,111,112                "                         
				    + "                  ,113,119,114,115,116,117,118,121                "                         
				    + "                  ,120,122,123,129,125,10,11,151                  "                         
				    + "                  ,150,160,127,128)                                "                        
				    + "          THEN (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS deudaAnterior                               "                        
				    + "               ,MAX(tbldctosperiodo.fechaInicial)                  "                        
				    + "                                 AS  fechaInicial                  "                        
				    + "          ,MAX (tbldctosperiodo.fechaFinal )                       "                        
				    + "                          AS  fechaFinal                           "                        
				    + "          ,MAX(tbldctosperiodo.fechaSinRecargo)                    "                        
				    + "                           AS fechaSinRecargo                      "                        
				    + "           ,MAX(tbldctosperiodo.fechaConRecargo)                   "                        
				    + "                            AS fechaConRecargo                     "                        
				    + "           ,MAX(tbldctosperiodo.nombrePeriodo)                     "                        
				    + "                           AS  nombrePeriodo                       "                        
				    + "     	  ,tbldctosordenesdetalle.idEstracto                      "                          
				    + "     	  ,tbldctosordenesdetalle.idRuta                          "                          
				    + "    	  ,SUM (CASE WHEN tblplus.idTipo IN (29)                     "                       
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "            ELSE 0                                                 "                        
				    + "         END) AS vrSubsidioCargoFijoAlcantarillado,                "                        
				    + "            SUM (CASE WHEN tblplus.idTipo IN (25)                  "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "            ELSE 0                                                 "                        
				    + "           END) AS vrSubsidioConsumoAlcantarillado,                "                        
				    + "            SUM (CASE WHEN tblplus.idTipo IN (24)                  "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "            ELSE 0                                                 "                        
				    + "            END) AS vrContribucionCargoFijoAlcantarillado,         "                        
				    + "            SUM (CASE WHEN tblplus.idTipo IN (26)                  "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "            ELSE 0                                                 "                        
				    + "            END) AS vrContribucionConsumoAlcantarillado,           "                        
				    + "           SUM(CASE WHEN tblplus.idTipo IN (60)                    "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "                    ELSE 0 END) AS vrAseoCargoFijo,                "                        
				    + "            SUM (CASE WHEN tblplus.idTipo IN (28)                  "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "            ELSE 0                                                 "                        
				    + "            END) AS vrContribucionCargoFijoAseo,	                  "                      
				    + "            SUM (CASE WHEN tblplus.idTipo IN (27)                  "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "            ELSE 0                                                 "                        
				    + "            END) AS vrSubsidioCargoFijoAseo                        "                        
				    + "      FROM tbldctos                                                "                        
				    + "      INNER JOIN tbldctosordenesdetalle                            "                        
				    + "      ON tbldctos.IDLOCAL           =                              "                        
				    + "         tbldctosordenesdetalle.IDLOCAL                            "                        
				    + "      AND tbldctos.IDTIPOORDEN       =                             "                        
				    + "    tbldctosordenesdetalle.IDTIPOORDEN                             "                        
				    + "      AND tbldctos.IDORDEN            =                            "                        
				    + "        tbldctosordenesdetalle.IDORDEN                             "                        
				    + "      INNER JOIN tblplus                                           "                        
				    + "      ON tbldctosordenesdetalle.IDPLU =                            "                        
				    + "                          tblplus.idPlu                            "                        
				    + "      AND tbldctosordenesdetalle.idLocal =                         "                        
				    + "                        tblplus.idLocal                            "                        
				    + "      INNER JOIN tbldctosperiodo                                   "                        
				    + "      ON tbldctosperiodo.idPeriodo =                               "                        
				    + "                     tbldctos.idPeriodo                            "                        
				    + "      AND tbldctosperiodo.idLocal =                                "                        
				    + "                       tbldctos.idLocal                            "                        
				    + "      WHERE tbldctos.idLocal       =    ?2                         "                                    
				    + "      AND       tbldctos.idTipoOrden   = ?3                        "                                    
				    + "      AND       tbldctos.idPeriodo     = ?1                        "                                   
				    + "      GROUP BY tbldctos.idLocal,                                   "                        
				    + "              tbldctos.idTipoOrden,                                "                        
				    + "              tbldctos.idOrden,                                    "                        
				    + "              tbldctos.idDcto,                                     "                        
				    + "              tbldctos.idPeriodo,                                  "                        
				    + "              tbldctos.idCliente,                                  "                        
				    + "             tblplus.idTipo,                                       "                        
				    + "     	   tbldctosordenesdetalle.idEstracto,                     "                          
				    + "     	   tbldctosordenesdetalle.idRuta                          "                          
				    + "      UNION ALL                                                    "                        
				    + "      SELECT tbldctos.idLocalCruce AS idLocal,                     "                        
				    + "             tbldctos.idTipoOrdenCruce                             "                        
				    + "                                    AS idTipoOrden,                "                        
				    + "             tbldctos.idOrdenCruce AS idOrden,                     "                        
				    + "             tbldctos.idDctoCruce AS idDcto,                       "                        
				    + "             tbldctos.idPeriodo,                                   "                        
				    + "             tbldctos.idCliente,                                   "                        
				    + "             tbldctos.fechaDcto,                                   "                        
				    + "             tblplus.idTipo,                                       "                        
				    + "            (CASE WHEN tblplus.idTipo = 4                          "                        
				    + "          THEN (tbldctosordenesdetalle.cantidad  *                 "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "             ELSE 0 END) AS vrConsumo,                             "                        
				    + "            (CASE WHEN tblplus.idTipo = 104                        "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario)                 "                        
				    + "            ELSE 0 END) AS vrDeudaConsumo, 	                      "                      
				    + "            (CASE WHEN tblplus.idTipo = 4                          "                        
				    + "        THEN tbldctosordenesdetalle.vrVentaUnitario                "                        
				    + "                   ELSE 0 END) AS vrVentaUnitario,                 "                        
				    + "              (CASE WHEN tblplus.idTipo = 4                        "                        
				    + "         THEN tbldctosordenesdetalle.lecturaMedidor                "                        
				    + "                 ELSE 0 END) AS lecturaMedidor,                    "                        
				    + "              (CASE WHEN tblplus.idTipo = 4                        "                        
				    + "              THEN tbldctosordenesdetalle.cantidad                 "                        
				    + "                 ELSE 0 END) AS cantidad,                          "                        
				    + "               (CASE WHEN tblplus.idTipo = 6                       "                        
				    + "          THEN (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0 END) AS vrCargoFijo,                       "                        
				    + "               (CASE WHEN  tblplus.idTipo = 106                    "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0 END) AS vrDeudaCargoFijo,                  "                        
				    + "               (CASE WHEN tblplus.idTipo IN (9)                   "                         
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "               ELSE 0 END) AS vrMedidor,                           "                        
				    + "              (CASE WHEN tblplus.idTipo IN (109)                  "                         
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "               ELSE 0 END) AS vrDeudaMedidor, 	                  "                          
				    + "               (CASE WHEN tblplus.idTipo IN (8)                    "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0  END) AS vrFinanciacion,                   "                        
				    + "               (CASE WHEN tblplus.idTipo IN (108)                  "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaFinanciacion,                        "                        
				    + "               (CASE WHEN                                          "                        
				    + "           tblplus.idTipo IN (12)                                  "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrInteres,                                  "                        
				    + "               (CASE WHEN                                          "                        
				    + "           tblplus.idTipo IN (112)                                 "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrInteresAcum,                              "                        
				    + "               (CASE WHEN                                          "                        
				    + "           tblplus.idTipo IN (13)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrReconexion,                               "                        
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (113)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaReconexion,                          "                        			                           			                                                                  
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (14)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrConexion,                                 "                        
				    + "                (CASE WHEN                                         "                        
				    + "         tblplus.idTipo IN (114)                                   "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaConexion, 		                      "                      
				    + "               (CASE WHEN                                          "                        
				    + "           tblplus.idTipo IN (15)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrReinstalacion,                            "                        
				    + "             (CASE WHEN                                            "                        
				    + "           tblplus.idTipo IN (115)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "       tbldctosordenesdetalle.vrVentaUnitario )                    "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaReinstalacion, 	                  "                          
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (16)                                  "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad *                   "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrSuspencion,                               "                        
				    + "               (CASE WHEN                                          "                        
				    + "           tblplus.idTipo IN (116)                                 "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaSuspencion, 	                      "                          
				    + "               (CASE WHEN                                          "                        
				    + "           tblplus.idTipo IN (17)                                  "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrCargoCorte,                               "                        
				    + "              (CASE WHEN                                           "                        
				    + "           tblplus.idTipo IN (117)                                 "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "        tbldctosordenesdetalle.vrVentaUnitario  )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaCargoCorte,  	                      "                      
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (18)                                  "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "        tbldctosordenesdetalle.vrVentaUnitario )                   "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrOtros,                                    "                        
				    + "             (CASE WHEN                                            "                        
				    + "           tblplus.idTipo IN (118)                                 "                        
				    + "        THEN  (tbldctosordenesdetalle.cantidad  *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrDeudaOtros,		                          "                      
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (19,21)                              "                         
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "           tbldctosordenesdetalle.vrVentaUnitario)                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrSubsidio,                                 "                        
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (19)                                 "                         
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario)                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrSubsidioCargoFijo,	                      "                      
				    + "                (CASE WHEN                                         "                        
				    + "          tblplus.idTipo IN (21)                                   "                        
				    + "          THEN  (tbldctosordenesdetalle.cantidad *                 "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario)                  "                        
				    + "                  ELSE 0                                           "                        
				    + "                       END) AS vrSubsidioConsumo,                  "                        
				    + "             (CASE WHEN tblplus.idTipo IN (119,121)               "                         
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "                    ELSE 0 END) AS vrDeudaSubsidio,                "                        
				    + "            (CASE WHEN tblplus.idTipo IN (20,22)                   "                        
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "                 ELSE 0 END) AS vrContribucion,                    "                        
				    + "           (CASE WHEN tblplus.idTipo IN (20)                       "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "            ELSE 0 END) AS vrContribucionCargoFijo,                "                        
				    + "           (CASE WHEN tblplus.idTipo IN (22)                       "                        
				    + "           THEN (tbldctosordenesdetalle.cantidad *                 "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "            ELSE 0 END) AS vrContribucionConsumo,                  "                        
				    + "     	  (CASE WHEN tblplus.idTipo IN (120,122)                  "                          
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "               ELSE 0 END) AS vrDeudaContribucion,                 "                        
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (50)                                  "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "          tbldctosordenesdetalle.vrVentaUnitario )                 "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrAlcantarillaCargoFijo, 	                  "                      
				    + "                (CASE WHEN                                         "                        
				    + "           tblplus.idTipo IN (51)                                  "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrAlcantarillaConsumo, 	                  "                          
				    + "                                                                   "                        
				    + "        (CASE WHEN                                                 "                        
				    + "           tblplus.idTipo IN (150, 151)                            "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrAlcantarillaDeuda,                        "                        
					+ "  		   (CASE WHEN                                             "                      
				    + "           tblplus.idTipo IN (160)                                 "                        
				    + "         THEN  (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS vrAseoDeuda,							      "                      
				    + "           (CASE WHEN tblplus.idTipo IN (9)                       "                        
				    + "          THEN (tbldctosordenesdetalle.cantidad *                  "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                   ELSE 0 END) AS vrAjusteDecena,                  "                        
				    + "     	    (CASE WHEN tblplus.idTipo IN (123)                    "                          
				    + "            THEN (tbldctosordenesdetalle.cantidad *                "                        
				    + "            tbldctosordenesdetalle.vrVentaUnitario)                "                        
				    + "                ELSE 0 END) AS vrDeudaAjusteDecena,                "                        
				    + "              (CASE WHEN tblplus.idTipo IN                         "                        
				    + "                  (106,104,105,108,109,110,111,112                "                         
				    + "                  ,113,119,114,115,116,117,118,121                "                         
				    + "                  ,120,122,123,129,125,10,11,151                  "                         
				    + "                  ,150,160,127,128)                                "                        
				    + "         THEN (tbldctosordenesdetalle.cantidad *                   "                        
				    + "         tbldctosordenesdetalle.vrVentaUnitario )                  "                        
				    + "                 ELSE 0                                            "                        
				    + "               END) AS deudaAnterior                               "                        
				    + "    ,tbldctosperiodo.fechaInicial                                  "                        
				    + "    ,tbldctosperiodo.fechaFinal                                    "                        
				    + "    ,tbldctosperiodo.fechaSinRecargo                               "                        
				    + "    ,tbldctosperiodo.fechaConRecargo                               "                        
				    + "    ,tbldctosperiodo.nombrePeriodo                                 "                        
				    + "     	    ,tbldctosordenesdetalle.idEstracto                    "                          
				    + "     	    ,tbldctosordenesdetalle.idRuta                        "                          
				    + "             ,(CASE WHEN tblplus.idTipo IN (29)                   "                         
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "             ELSE 0 END)                                           "                        
				    + "               AS vrSubsidioCargoFijoAlcantarillado,               "                        
				    + "              (CASE WHEN tblplus.idTipo IN (25)                    "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "              ELSE 0  END)                                         "                        
				    + "                 AS vrSubsidioConsumoAlcantarillado,               "                        
				    + "              (CASE WHEN tblplus.idTipo IN (24)                    "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "               ELSE 0 END)                                         "                        
				    + "           AS vrContribucionCargoFijoAlcantarillado,               "                        
				    + "             (CASE WHEN tblplus.idTipo IN (26)                     "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "             ELSE 0 END)                                           "                        
				    + "             AS vrContribucionConsumoAlcantarillado,               "                        
				    + "              (CASE WHEN tblplus.idTipo IN (60)                    "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "                     ELSE 0 END) AS vrAseoCargoFijo,               "                        
				    + "             (CASE WHEN tblplus.idTipo IN (28)                     "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "              ELSE 0 END)                                          "                        
				    + "                     AS vrContribucionCargoFijoAseo,               "                        
				    + "             (CASE WHEN tblplus.idTipo IN (27)                     "                        
				    + "             THEN (tbldctosordenesdetalle.cantidad *               "                        
				    + "             tbldctosordenesdetalle.vrVentaUnitario)               "                        
				    + "             ELSE 0 END) AS vrSubsidioCargoFijoAseo                "                        
				    + "      FROM         tbldctos                                        "                        
				    + "      INNER JOIN tbldctosordenesdetalle                            "                        
				    + "      ON tbldctos.IDLOCAL           =                              "                        
				    + "         tbldctosordenesdetalle.IDLOCAL                            "                        
				    + "      AND tbldctos.IDTIPOORDEN       =                             "                        
				    + "     tbldctosordenesdetalle.IDTIPOORDEN                            "                        
				    + "      AND tbldctos.IDORDEN            =                            "                        
				    + "         tbldctosordenesdetalle.IDORDEN                            "                        
				    + "      INNER JOIN tblplus                                           "                        
				    + "      ON tbldctosordenesdetalle.IDPLU =                            "                        
				    + "                           tblplus.idPlu                           "                        
				    + "      AND tbldctosordenesdetalle.idLocal =                         "                        
				    + "                         tblplus.idLocal                           "                        
				    + "      INNER JOIN tbldctosperiodo                                   "                        
				    + "      ON tbldctosperiodo.idPeriodo =                               "                        
				    + "                     tbldctos.idPeriodo                            "                        
				    + "      AND tbldctosperiodo.idLocal = tbldctos.idLocal               "                        
				    + "      WHERE     tbldctos.idLocal             =  ?2                 "                                   
				    + "      AND       tbldctos.idTipoOrden         = 29                  "                        
				    + "      AND       tbldctos.idPeriodo           =                     "                        
				    + "      ?1) AS tmpPRC 					                              "                      
				    + "      INNER JOIN tbllocales                                        "                        
				    + "      ON tbllocales.idLocal  =  tmpPRC.IDLOCAL                     "                        
				    + "      INNER JOIN tblterceros                                       "                        
				    + "      ON tblterceros.idLocal  = tmpPRC.IDLOCAL                     "                        
				    + "      AND tblterceros.idCliente  = tmpPRC.idCliente                "                        
				    + "      INNER JOIN tbldctosordenes                                   "                        
				    + "      ON tbldctosordenes.idLocal = tmpPRC.IDLOCAL                  "                        
				    + "      AND tbldctosordenes.idTipoOrden   =                          "                        
				    + "                     tmpPRC.idTipoOrden                            "                        
				    + "      AND tbldctosordenes.idOrden =  tmpPRC.idOrden                "                        
				    + "      INNER JOIN tblterceroestracto                                "                        
				    + "      ON tblterceroestracto.idEstracto =                           "                        
				    + "                      tmpPRC.idEstracto                            "                        
				    + "      AND tblterceroestracto.idLocal =                             "                        
				    + "                         tmpPRC.idLocal                            "                        
				    + "      INNER JOIN tbltercerosruta                                   "                        
				    + "      ON tmpPRC.idRuta = tbltercerosruta.idRuta                    "                        
				    + "      AND tmpPRC.idLocal =  tbltercerosruta.idLocal                "                        
				    + "      INNER JOIN                                                   "                        
				    + "      (SELECT tbldctosordenesdetalle.IDLOCAL,                      "                        
				    + "              tbldctosordenesdetalle.IDTIPOORDEN,                  "                        
				    + "     	     tbldctosordenesdetalle.IDORDEN,                      "                          
				    + "     	     tbltipocausanota.nombreCausa                         "                          
				    + "      FROM     tbldctosordenes                                     "                        
				    + "      INNER JOIN tbldctosordenesdetalle                            "                        
				    + "      ON tbldctosordenes.IDLOCAL =                                 "                        
				    + "       tbldctosordenesdetalle.IDLOCAL                              "                        
				    + "      AND tbldctosordenes.IDTIPOORDEN =                            "                        
				    + "              tbldctosordenesdetalle.IDTIPOORDEN                   "                        
				    + "      AND  tbldctosordenes.IDORDEN =                               "                        
				    + "      tbldctosordenesdetalle.IDORDEN                               "                        
				    + "      INNER JOIN tbltipocausanota                                  "                        
				    + "      ON tbltipocausanota.idCausa =                                "                        
				    + "           tbldctosordenesdetalle.idNovedadLectura                 "                        
				    + "      WHERE tbldctosordenesdetalle.IDLOCAL   =  ?2                 "                                   
				    + "      AND tbldctosordenesdetalle.IDTIPOORDEN =  ?3                 "                                   
				    + "      AND tbldctosordenes.IDPERIODO          =  ?1                 "                                   
				    + "      AND tbldctosordenesdetalle.IDTIPO      = 4                   "                        
				    + "      AND tbldctosordenesdetalle.STRIDLISTA  = 1                   "                        
				    + "      AND tbltipocausanota.idTipoTabla       = 2)                  "                        
				    + "                                   AS tmpFRA                       "                        
				    + "      ON tmpFRA.IDLOCAL=tmpPRC.IDLOCAL                             "                        
				    + "      AND tmpFRA.IDTIPOORDEN = tmpPRC.idTipoOrden                  "                        
				    + "      AND tmpFRA.IDORDEN=tmpPRC.idOrden                            "                        
				    + "      INNER JOIN tblmedidores                                      "                        
				    + "      ON tblmedidores.idLocal = tblterceros.IDLOCAL                "                        
				    + "      AND tblmedidores.idMedidor =                                 "                        
				    + "                  tblterceros.idMedidor                            "                        
				    + "      INNER JOIN tbltipocausanota                                  "                        
				    + "      ON tbltipocausanota.idCausa                                  "                        
				    + "                           = tbldctosordenes.estado                "                        
				    + "      WHERE     tmpPRC.idLocal         =     ?2                    "                                
				    + "      AND       tmpPRC.idTipoOrden     =    ?3                     "                                    
				    + "      AND       tmpPRC.idPeriodo       =    ?1                     "                                    
				    + "      AND tbltipocausanota.idTipoTabla  = 3                        "                        
				    + "      GROUP BY tmpPRC.idLocal,                                     "                        
				    + "             tmpPRC.idTipoOrden,                                   "                        
				    + "             tmpPRC.idOrden,                                       "                        
				    + "             tmpPRC.idDcto,                                        "                        
				    + "             tmpPRC.idPeriodo,                                     "                        
				    + "             tmpPRC.idCliente                                      "                        
				    + "            ,tmpPRC.fechaInicial                                   "                        
				    + "            ,tmpPRC.fechaFinal                                     "                        
				    + "            ,tmpPRC.fechaSinRecargo                                "                        
				    + "            ,tmpPRC.fechaConRecargo                                "                        
				    + "            ,tmpPRC.nombrePeriodo                                  "                        
				    + "      ORDER BY idRuta,ordenRuta                                    ",
			        nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDetalleDeudaRuta(int idPeriodo, int idLocal, int idTipoOrden );
		  
		  
		  
		  @Query( value = "SELECT TOP 1 tbldctosordenes.idOrden     "

	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLocal   =         "
	                + "?1                            "
	                + "AND tbldctosordenes.idPeriodo   =         "
	                + "?2                          "
	                + "AND  tbldctosordenes.IDTIPOORDEN =        "
	                + "?3                        "
	                + "AND  tbldctosordenes.idRazon     = ?4      "

		  		  , nativeQuery = true)
		  Integer listaOrdenIdPeriodo(int idLocal,  int idPeriodo, int IdTipoOrden, int idRazon);
		  
		  
		  
		  
		  @Query( value = "SELECT MAX(tbldctosordenes.idOrden) "
	                + "FROM tbldctosordenes              "
	                + "WHERE tbldctosordenes.idLocal   = ?1 "
		  		  , nativeQuery = true)
		  Integer maximaIdOrdenIdLocal(int idLocal);
		  
		  
		  
		  @Query( value = "SELECT TOP 1 tbldctosordenes.idLog     "

	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLocal   =         "
	                + "?1                            "
	                + "AND tbldctosordenes.idPeriodo   =         "
	                + "?2                          "
	                + "AND  tbldctosordenes.IDTIPOORDEN =        "
	                + "?3                        "
	                + "AND  tbldctosordenes.idRazon     = ?4      "

		  		  , nativeQuery = true)
		  Integer listaOrdenIdPeriodoIDLOG(int idLocal,  int idPeriodo, int IdTipoOrden, int idRazon);
		  
		  
		  @Query( value = "SELECT tblDctosOrdenes.IDORDEN " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.idPeriodo = ?2 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = 9 "+
		  		  "AND tblDctosOrdenes.idCliente = ?3 ", nativeQuery = true)
		  Integer ObtenerIdOrdenConFactura(int IDLOCAL, int idPeriodoAnterior, String idCliente);
		  
		  
		  
		  @Query( value = "  SELECT TOP 1 tblDctosOrdenes.IDORDEN      "
			  		+ "  FROM bdaquamovil.dbo.tblDctosOrdenes      "
			  		+ "  WHERE tblDctosOrdenes.IDLOCAL = ?1       "
			  		+ "  AND tblDctosOrdenes.idPeriodo = ?2    "
			  		+ "  AND tblDctosOrdenes.IDTIPOORDEN = 29      "
			  		+ "  AND tblDctosOrdenes.idCliente = ?3     "
					+ "  order by IDORDEN desc                     ", nativeQuery = true)
		  Integer ObtenerIdOrdenConNota(int IDLOCAL, int idPeriodoAnterior, String idCliente);
		  
		  
		  
		  @Query( value = "SELECT TOP 1 tbldctosordenes.idLocal,     "
	                + "       tbldctosordenes.idTipoOrden,       "
	                + "       tbldctosordenes.idOrden,           "
	                + "       tbldctosordenes.fechaOrden,        "
	                + "       tbldctosordenes.estado,            "
	                + "       tbldctosordenes.idCliente,         "
	                + "       tbldctosordenes.idUsuario,         "
	                + "       tbldctosordenes.idOrigen,          "
	                + "       tbldctosordenes.idLog,             "
	                + "       tbldctosordenes.fechaEntrega,      "
	                + "       tbldctosordenes.tipoDcto,          "
	                + "       tbldctosordenes.direccionDespacho, "
	                + "       tbldctosordenes.email,             "
	                + "       tbldctosordenes.fax,               "
	                + "       tbldctosordenes.contacto,          "
	                + "       tbldctosordenes.observacion,       "
	                + "       tbldctosordenes.ciudadDespacho,    "
	                + "       tbldctosordenes.formaPago,         "
	                + "       tbldctosordenes.ordenCompra,       "
	                + "       tbldctosordenes.descuentoComercial,"
	                + "       tbldctosordenes.impuestoVenta,     "
	                + "       tbldctosordenes.idRazon            "
	                + "FROM    tblagendalogvisitas		 "
	                + "INNER JOIN tbldctosordenes		 "
	                + "ON tblagendalogvisitas.IDLOG        =     "
	                + "                    tbldctosordenes.IDLOG "
	                + "INNER JOIN tbldctosordenesdetalle	 "
	                + "ON tbldctosordenes.IDLOCAL          =     "
	                + "           tbldctosordenesdetalle.IDLOCAL "
	                + "AND tbldctosordenes.IDTIPOORDEN     =     "
	                + "       tbldctosordenesdetalle.IDTIPOORDEN "
	                + "AND tbldctosordenes.IDORDEN         =     "
	                + "          tbldctosordenesdetalle.IDORDEN  "
	                + "WHERE tbldctosordenes.idPeriodo     =     "
	                + "?1                         "
	                + "AND  tbldctosordenes.idTipoOrden    =     "
	                + "?2                       "
	                + "AND  tbldctosordenes.idRazon        = 4   "
	                + "AND  tbldctosordenes.idLocal        =  ?3   "

		  		  , nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaConsumoFCH(int idPeriodo, int idTipoOrden, int idLocal);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "INSERT INTO tbldctosordenes (idLocal,    "
	                + "                      idTipoOrden,       "
	                + "                      idOrden,           "
	                + "                      fechaOrden,        "
	                + "                      estado,            "
	                + "                      idCliente,         "
	                + "                      idUsuario,         "
	                + "                      idOrigen,          "
	                + "                      idLog,             "
	                + "                      fechaEntrega,      "
	                + "                      tipoDcto,          "
	                + "                      email,             "
	                + "                      fax,               "
	                + "                      contacto,          "
	                + "                      observacion,       "
	                + "                      direccionDespacho, "
	                + "                      ciudadDespacho,    "
	                + "                      formaPago,         "
	                + "                      ordenCompra,       "
	                + "                      descuentoComercial,"
	                + "                      impuestoVenta,     "
	                + "                      idRazon,           "
	                + "                      idEstadoTx,        "
	                + "                      idTipoTx,          "
	                + "                      numeroOrden,       "
	                + "                      idResponsable,     "
	                + "                      diasHistoria,      "
	                + "                      diasInventario,    "
	                + "                      idPeriodo,         "
	                + "                      vrTotalDiferir,    "
	                + "                      cuotaDiferir,      "
	                + "              porcentajeInteresADiferir, "
	                + "                      vrInteresADiferir, "
	                + "                      promedio,          "
	                + "                      historiaConsumo,   "
	                + "                      promedioEstrato)   "
	                + "VALUES (?1,"
	                + "?2,"
	                + "?3,"
	                + "?4,"
	                + "?5,"
	                + "?6,"
	                + "?7,"
	                + "?8,"
	                + "?9,"
	                + "?10,"
	                + "?11,"
	                + "?12,"
	                + "?13,"
	                + "?14,"
	                + "?15,"
	                + "?16,"
	                + "?17,"
	                + "?18,"
	                + "?19,"
	                + "?20,"
	                + "?21,"
	                + "?22,"
	                + "?23,"
	                + "?24,"
	                + "?25,"
	                + "?26,"
	                + "?27,"
	                + "?28,"
	                + "?29,"
	                + "?30,"
	                + "?31,"
	                + "?32,"
	                + "?33,"
	                + "?34,"
	                + "?35,"
	                + "?36)", nativeQuery = true)
		  public void ingresaPedido(int idLocal, int IdTipoOrden, int IdOrden, String strFechaVisita, int Estado, String IdCliente, int IdUsuario, int IdOrigen, int IdLog, String FechaEntregaSqlServer, 
				  String TipoDcto, String Email, String fax, String Contacto, String Observacion, String DireccionDespacho, String CiudadDespacho, String FormaPago, String OrdenCompra,
				  int DescuentoComercial, int ImpuestoVenta, int IdRazon, int IdEstadoTx, int IdTipoTx, int NumeroOrden, int IdResponsable, int DiasHistoria, int DiasInventario, int IdPeriodo, 
				  Double VrTotalDiferir, int CuotaDiferir, Double PorcentajeInteresADiferir, Double VrInteresADiferir, Double Promedio, String HistoriaConsumo, Double PromedioEstrato);
		  
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tbldctosordenes            "
	                + "SET tbldctosordenes.comentario  = "
	                + "  SUBSTRING(CONCAT(LTRIM(RTRIM(tbldctosordenes.comentario)) ,"
	                + "?1),1,500)              "
	                + "WHERE tbldctosordenes.idLocal =   "
	                + "?2                   "
	                + "AND tbldctosordenes.idTipoOrden = "
	                + "?3               "  
	                + "AND   tbldctosordenes.idOrden  = ?4 ",
	                nativeQuery = true)
		  public void actualizaComentario(String Comentario, int idLocal, int IdTipoOrden,  int IdOrden);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tbldctosordenes                            "
	                + " SET cuotaVencida = tmpCTV.cuotaVencida         "
	                + " FROM tbldctosordenes                           "
	                + " INNER JOIN                                     "
	                + " (SELECT tbldctosordenes.IDLOCAL,               "
	                + "        tbldctosordenes.IDTIPOORDEN,            "
	                + " 	   tbldctosordenes.IDORDEN,                "
	                + "        tbldctosordenesdetalle.VRVENTAUNITARIO, "
	                + "        tblplus.vrGeneral,                      "
	                + " ISNULL(FLOOR(tbldctosordenesdetalle.VRVENTAUNITARIO  "
	                + "   / NULLIF(tblplus.vrGeneral,0)),0) AS cuotaVencida  "
	                + " FROM tbldctosordenes                           "
	                + " INNER JOIN tbldctosordenesdetalle              "
	                + " ON tbldctosordenes.IDLOCAL      =              "
	                + "                tbldctosordenesdetalle.IDLOCAL  "
	                + " AND tbldctosordenes.IDTIPOORDEN =              "
	                + "            tbldctosordenesdetalle.IDTIPOORDEN  "
	                + " AND tbldctosordenes.IDORDEN     =              "
	                + "                tbldctosordenesdetalle.IDORDEN  "
	                + " INNER JOIN tblplus                             "
	                + " ON tbldctosordenesdetalle.IDLOCAL     =        "
	                + "                                tblplus.idLocal "
	                + " AND tbldctosordenesdetalle.idEstracto =        "
	                + "                             tblplus.idEstracto "
	                + " WHERE tbldctosordenes.IDLOCAL         =        "
	                + "?1                                 "
	                + " AND tbldctosordenes.idPeriodo         =        "
	                + "?2                               "
	                + " AND tbldctosordenesdetalle.idtipo     = 106    "
	                + " AND tbldctosordenesdetalle.VRVENTAUNITARIO > 0 "
	                + " AND tblplus.idtipo=6) AS tmpCTV                "
	                + " ON tbldctosordenes.IDLOCAL = tmpCTV.IDLOCAL    "
	                + " AND tbldctosordenes.IDTIPOORDEN =              "
	                + "                           tmpCTV.IDTIPOORDEN   "
	                + " AND tbldctosordenes.IDORDEN = tmpCTV.IDORDEN",
	                nativeQuery = true)
		  public void actualizaCuotaVencida(int idLocal, int idPeriodo);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = " UPDATE tblterceros                             "
	                + " SET cuotaVencida = tmpCTV.cuotaVencida         "
	                + " FROM tblterceros                               "
	                + " 	 INNER JOIN                                "
	                + "  (SELECT tbldctosordenes.IDLOCAL,              "
	                + "        tbldctosordenes.idCliente,              "
	                + " ISNULL(FLOOR(tbldctosordenesdetalle.VRVENTAUNITARIO  "
	                + "   / NULLIF(tblplus.vrGeneral,0)),0) AS cuotaVencida  "
	                + " FROM tbldctosordenes                           "
	                + " INNER JOIN tbldctosordenesdetalle              "
	                + " ON tbldctosordenes.IDLOCAL      =              "
	                + "                tbldctosordenesdetalle.IDLOCAL  "
	                + " AND tbldctosordenes.IDTIPOORDEN =              "
	                + "            tbldctosordenesdetalle.IDTIPOORDEN  "
	                + " AND tbldctosordenes.IDORDEN     =              "
	                + "                tbldctosordenesdetalle.IDORDEN  "
	                + " INNER JOIN tblplus                             "
	                + " ON tbldctosordenesdetalle.IDLOCAL     =        "
	                + "                                tblplus.idLocal "
	                + " AND tbldctosordenesdetalle.idEstracto =        "
	                + "                             tblplus.idEstracto "
	                + " WHERE tbldctosordenes.IDLOCAL =                "
	                + "?1                                 "
	                + " AND tbldctosordenes.idPeriodo         =        "
	                + "?2                               "
	                + " AND tbldctosordenesdetalle.idtipo     = 106    "
	                + " AND tbldctosordenesdetalle.VRVENTAUNITARIO > 0 "
	                + " AND tblplus.idtipo=6)  AS tmpCTV               "
	                + " ON tblterceros.IDLOCAL = tmpCTV.IDLOCAL        "
	                + " AND tblterceros.IDCLIENTE = tmpCTV.IDCLIENTE   ",
	                nativeQuery = true)
		  public void actualizaCuotaVencidaLectura(int idLocal, int idPeriodo);
		
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tblDctosOrdenes          "
	                + " SET cuotaVencida = 0           "
	                + " FROM tblDctos                  "
	                + " INNER JOIN tblDctosOrdenes     "
	                + " ON tblDctos.IDLOCAL      =     "
	                + "        tblDctosOrdenes.IDLOCAL "
	                + " AND tblDctos.IDTIPOORDEN =     "
	                + "    tblDctosOrdenes.IDTIPOORDEN "
	                + " AND tblDctos.IDORDEN    =      "
	                + "        tblDctosOrdenes.IDORDEN "
	                + " WHERE tblDctos.IDLOCAL =       "
	                + "?1                 "
	                + " AND tblDctos.idPeriodo =       "
	                + "?2               "
	                + " AND tblDctos.IDTIPOORDEN =     "
	                + "?3             "
	                + " AND tblDctos.vrBase <= 0",
	                nativeQuery = true)
		  public void actualizaCuotaVencidaxAnticipo(int idLocal, int idPeriodo, int IdTipoOrden);
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = " UPDATE tbldctosordenes          "
	                + " SET   estadoCorte =             "
	                + "   tblterceros.estadoCorte       "
	                + " FROM tbldctosordenes            "
	                + " INNER JOIN tblterceros          "
	                + " ON tbldctosordenes.IDLOCAL    = "
	                + "         tblterceros.idLocal     "
	                + " AND tbldctosordenes.idCliente = "
	                + "         tblterceros.idCliente   "
	                + " WHERE tbldctosordenes.IDLOCAL = "
	                + "?1                  "
	                + " AND tbldctosordenes.idPeriodo = ?2 ",
	                nativeQuery = true)
		  public void actualizaEstadoCorte(int idLocal, int idPeriodo);
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = " UPDATE tblDctosOrdenes                                 "
				  + " SET         vrPagoUltimo =tmpULT.vrPago,                    "
				  + "            fechaPagoUltimo =tmpULT.fechaPago                "
				  + " FROM    tblDctosOrdenes                                     "
				  + " INNER JOIN (                                                "
				  + " SELECT tblPagos.idLocal,                                    "
				  + "       tblPagos.idTipoOrden,                                 "
				  + "	   tblPagos.nitCC AS idCliente,                           "
				  + "	   tblPagos.vrPago,                                       "
				  + "	   tblPagos.fechaPago                                     "
				  + " FROM tblPagos                                               "
				  + " INNER JOIN                                                  "
				  + " ( SELECT tblPagos.idLocal,                                  "
				  + "       tblPagos.idTipoOrden,                                 "
				  + "       MAX(tblPagos.IDRECIBO) AS idRecibo,                   "
				  + "	   tblPagos.NITCC                                         "
				  + " FROM tblPagos                                               "
				  + " WHERE EXISTS ( SELECT *                                     "
				  + " FROM  tblPagosMedios                                        "
				  + " WHERE  tblPagos.idLocal= tblPagosMedios.idLocal             "
				  + " AND  tblPagos.IDTIPOORDEN= tblPagosMedios.IDTIPOORDEN       "
				  + " AND  tblPagos.IDRECIBO= tblPagosMedios.IDRECIBO )           "
				  + " AND tblPagos.IDLOCAL      = ?1                              "
				  + " AND   tblPagos.IDTIPOORDEN=9                                "
				  + " GROUP BY tblPagos.idLocal,                                  "
				  + "         tblPagos.idTipoOrden,                               "
				  + "		 tblPagos.NITCC )  AS tmpPAG                          "
				  + " ON tblPagos.idLocal= tmpPAG.idLocal                         "
				  + " AND tblPagos.idTipoOrden= tmpPAG.idTipoOrden                "
				  + " AND tblPagos.idrecibo= tmpPAG.idrecibo                      "
				  + " AND tblPagos.nitcc= tmpPAG.nitcc                            "
				  + " ) AS tmpULT                                                 "
				  + " ON  tblDctosOrdenes.IDLOCAL = tmpULT.IDLOCAL                "
				  + " AND tblDctosOrdenes.IDTIPOORDEN = tmpULT.IDTIPOORDEN        "
				  + " AND tblDctosOrdenes.idCliente = tmpULT.idCliente            "
				  + " WHERE tblDctosOrdenes.IDLOCAL    = ?1                       "
				  + " AND   tblDctosOrdenes.IDTIPOORDEN=9                         "
				  + " AND   tblDctosOrdenes.idPeriodo   = ?2                      ",	                                                                  
	                nativeQuery = true)
		  public void actualizaFechaPagoUltimo(int idLocal, int idPeriodo);
		  
		  
		  
		  @Query( value = "SELECT tbldctosordenes.idLocal,           "
	                + "       tbldctosordenes.idTipoOrden,       "
	                + "       tbldctosordenes.idOrden,           "
	                + "       tbldctosordenes.fechaOrden,        "
	                + "       tbldctosordenes.estado,            "
	                + "       tbldctosordenes.idCliente,         "
	                + "       tbldctosordenes.idUsuario,         "
	                + "       tbldctosordenes.idOrigen,          "
	                + "       tbldctosordenes.idLog,             "
	                + "       tbldctosordenes.fechaEntrega,      "
	                + "       tbldctosordenes.tipoDcto,          "
	                + "       tbldctosordenes.direccionDespacho, "
	                + "       tbldctosordenes.email,             "
	                + "       tbldctosordenes.fax,               "
	                + "       tbldctosordenes.contacto,          "
	                + "       tbldctosordenes.observacion,       "
	                + "       tbldctosordenes.ciudadDespacho,    "
	                + "       tbldctosordenes.formaPago,         "
	                + "       tbldctosordenes.ordenCompra,       "
	                + "       tbldctosordenes.descuentoComercial,"
	                + "       tbldctosordenes.impuestoVenta,     "
	                + "       tbldctosordenes.idRazon,           "
	                + "       tbldctosordenes.idEstadoTx,         "
	                + "       tbldctosordenes.idPeriodo         "
	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLocal     =       "
	                + "?1                   "
	                + "AND   tbldctosordenes.idTipoOrden =       "
	                + "?2               "
	                + "AND   tbldctosordenes.idOrden     =  ?3     ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDctoOrden( int idLocal, int idTipoOrden, int IdOrden);
		  
		  
		  
		  @Query( value = "SELECT tbldctosordenes.idLocal,           "
	                + "       tbldctosordenes.idTipoOrden,       "
	                + "       tbldctosordenes.idOrden,           "
	                + "       tbldctosordenes.fechaOrden,        "
	                + "       tbldctosordenes.estado,            "
	                + "       tbldctosordenes.idCliente,         "
	                + "       tbldctosordenes.idUsuario,         "
	                + "       tbldctosordenes.idOrigen,          "
	                + "       tbldctosordenes.idLog,             "
	                + "       tbldctosordenes.fechaEntrega,      "
	                + "       tbldctosordenes.tipoDcto,          "
	                + "       tbldctosordenes.direccionDespacho, "
	                + "       tbldctosordenes.email,             "
	                + "       tbldctosordenes.fax,               "
	                + "       tbldctosordenes.contacto,          "
	                + "       tbldctosordenes.observacion,       "
	                + "       tbldctosordenes.ciudadDespacho,    "
	                + "       tbldctosordenes.formaPago,         "
	                + "       tbldctosordenes.ordenCompra,       "
	                + "       tbldctosordenes.descuentoComercial,"
	                + "       tbldctosordenes.impuestoVenta,     "
	                + "       tbldctosordenes.idRazon,           "
	                + "       tbldctosordenes.idPeriodo          "
	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLocal =           "
	                + "?1                           "
	                + "AND tbldctosordenes.idLog =   ?2            ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDctoOrdenIdLog(int idLocal, int idLog);
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "INSERT INTO tbldctosordenes (idLocal, "
	                + "                      idTipoOrden,    "
	                + "                      idOrden,        "
	                + "                      fechaOrden,     "
	                + "                      estado,         "
	                + "                      idCliente,      "
	                + "                      idUsuario,      "
	                + "                      idOrigen,       "
	                + "                      idLog,          "
	                + "                      fechaEntrega,   "
	                + "                      tipoDcto,       "
	                + "                      email,          "
	                + "                      formaPago,      "
	                + "                      diasHistoria,   "
	                + "                      diasInventario, "
	                + "                      observacion,    "
	                + "                      idRazon,        "
	                + "                      idPeriodo,      "
	                + "                      vrTotalDiferir, "
	                + "                      cuotaDiferir,   "
	                + "           porcentajeInteresADiferir, "
	                + "                   vrInteresADiferir, "
	                + "                      ordenCompra)    "
	                + "VALUES (?1,"
	                + "?2,"
	                + "?3,"
	                + "?4,"
	                + "?5,"
	                + "?6,"
	                + "?7,"
	                + "?8,"
	                + "?9,"
	                + "?10,"
	                + "?11,"
	                + "?12,"
	                + "?13,"
	                + "?14,"
	                + "?15,"
	                + "?16,"
	                + "?17,"
	                + "?18,"
	                + "?19,"
	                + "?20, "
	                + "?21, "
	                + "?22,"
	                + "?23)", nativeQuery = true)
		  public void ingresaDctosOrden(int idLocal, int IdTipoOrden, int IdOrden, String strFechaVisita, int Estado, String IdCliente, int IdUsuario, int IdOrigen, int IdLog, String FechaEntregaSqlServer, 
				  String TipoDcto, String Email, String FormaPago, int DiasHistoria, int DiasInventario, String Observacion, int IdRazon, int IdPeriodo, Double VrTotalDiferir, Double CuotaDiferir, 
				  Double PorcentajeInteresADiferir, Double VrInteresADiferir, int OrdenCompra);
		  
		  
		  
		  
		  @Query( value = "SELECT tbldctosordenes.idLocal,                         "
	                + "       tbldctosordenes.idTipoOrden,                     "
	                + "       tbldctosordenes.idOrden,                         "
	                + "       tbldctosordenes.idLog,                           "
	                + "       tbldctosordenes.idCliente,                       "
	                + "       tbldctosordenes.idUsuario,                       "
	                + "       tbldctosordenes.fechaOrden,                      "
	                + "       tbldctosordenes.idEstadoTx,                      "
	                + "       COUNT(tbldctosordenesdetalle.idPlu)              "
	                + "                        AS cantidadArticulos,           "
	                + "       SUM ( tbldctosordenesdetalle.cantidad         *  "
	                + "             tbldctosordenesdetalle.vrVentaUnitario )   "
	                + "                        AS vrVentaConIva,               "
	                + "       SUM ( tbldctosordenesdetalle.cantidad         *  "
	                + "             tbldctosordenesdetalle.vrVentaUnitario  /  "
	                + "  (1 + (tbldctosordenesdetalle.porcentajeIva/100)))     "
	                + "                        AS vrVentaSinIva,               "
	                + "       SUM(tbldctosordenesdetalle.vrCosto *             "
	                + "           tbldctosordenesdetalle.cantidad)             "
	                + "                                   AS vrCostoConIva,    "
	                + "       SUM ( tbldctosordenesdetalle.cantidad *          "
	                + "             tbldctosordenesdetalle.vrCosto  /          "
	                + "  (1 + (tbldctosordenesdetalle.porcentajeIva/100)))     "
	                + "                                   AS vrCostoSinIva     "
	                + "FROM  tbldctosordenes ,                                 "
	                + "      tbldctosordenesdetalle                            "
	                + "WHERE tbldctosordenes.idOrden         =                 "
	                + "      tbldctosordenesdetalle.idOrden                    "
	                + "AND   tbldctosordenes.idTipoOrden     =                 "
	                + "      tbldctosordenesdetalle.idTipoOrden                "
	                + "AND   tbldctosordenes.idLocal         =                 "
	                + "      tbldctosordenesdetalle.idLocal                    "
	                + "AND   tbldctosordenes.idLocal         =                 "
	                + "?1                                         "
	                + "AND   tbldctosordenes.idLog           =                 "
	                + "?2                                           "
	                + "AND   tbldctosordenes.idTipoOrden     =                 "
	                + "?3                                     "
	                + "GROUP BY tbldctosordenes.idLocal,                       "
	                + "       tbldctosordenes.idTipoOrden,                     "
	                + "       tbldctosordenes.idOrden,                         "
	                + "       tbldctosordenes.idLog,                           "
	                + "       tbldctosordenes.idCliente,                       "
	                + "       tbldctosordenes.idUsuario,                       "
	                + "       tbldctosordenes.fechaOrden,                      "
	                + "       tbldctosordenes.idEstadoTx                       ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> liquidaOrdenLocal( int idLocal, int idLog, int IdTipoOrden);
		  

		  @Query( value = "SELECT tbldctosordenes.idPeriodo                  "
	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLog       =       "
	                + "?1                             "
	                + "AND   tbldctosordenes.idTipoOrden =       "
	                + "?2                       "
	                + "AND   tbldctosordenes.idLocal     =   ?3    ",
	                nativeQuery = true)
		  Integer existePedido( int idLog, int IdTipoOrden, int idLocal);
		  
		  
		  
		  
		  @Query( value = "SELECT tbldctosordenes.idLocal,           "
	                + "       tbldctosordenes.idTipoOrden,       "
	                + "       tbldctosordenes.idOrden,           "
	                + "       tbldctosordenes.fechaOrden,        "
	                + "       tbldctosordenes.estado,            "
	                + "       tbldctosordenes.idCliente,         "
	                + "       tbldctosordenes.idUsuario,         "
	                + "       tbldctosordenes.idOrigen,          "
	                + "       tbldctosordenes.idLog,             "
	                + "       tbldctosordenes.fechaEntrega,      "
	                + "       tbldctosordenes.tipoDcto,          "
	                + "       tbldctosordenes.direccionDespacho, "
	                + "       tbldctosordenes.email,             "
	                + "       tbldctosordenes.fax,               "
	                + "       tbldctosordenes.contacto,          "
	                + "       tbldctosordenes.observacion,       "
	                + "       tbldctosordenes.ciudadDespacho,    "
	                + "       tbldctosordenes.formaPago,         "
	                + "       tbldctosordenes.ordenCompra,       "
	                + "       tbldctosordenes.descuentoComercial,"
	                + "       tbldctosordenes.impuestoVenta,     "
	                + "       tbldctosordenes.idRazon,           "
	                + "       tbldctosordenes.idEstadoTx,        "
	                + "       tbldctosordenes.idTipoTx,          "
	                + "       tbldctosordenes.numeroOrden,       "
	                + "       tbldctosordenes.idResponsable,     "
	                + "       tbldctosordenes.diasHistoria,      "
	                + "       tbldctosordenes.diasInventario,    "
	                + "       tbldctosordenes.idPeriodo,         "
	                + "       tbldctosordenes.vrTotalDiferir,    "
	                + "       tbldctosordenes.cuotaDiferir,      "
	                + "  tbldctosordenes.porcentajeInteresADiferir, "
	                + "       tbldctosordenes.vrInteresADiferir  "
	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLocal =           "
	                + "?1                           "
	                + "AND  tbldctosordenes.idTipoOrden =        "
	                + "?2                       "
	                + " AND tbldctosordenes.idLog        =  ?3     ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDctoOrdenIdLogIdTipoOrden( int idLocal, int IdTipoOrden, int idLog);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "DELETE FROM tbldctosordenes          "
	                + "WHERE tbldctosordenes.IDLOCAL      = "
	                + "?1                      "
	                + "AND   tbldctosordenes.IDTIPOORDEN  = "
	                + "?2                  "
	                + "AND   tbldctosordenes.IDORDEN      = "
	                + "?3                      ", nativeQuery = true)
		  public void retira(int idLocal, int IdTipoOrden, int idOrden);
		  
		  
		  
		  @Query( value = " SELECT MAX(tbldctosordenes.vrTotalDiferir -         "
	                + "            tbldctosordenes.vrInteresADiferir)       "
	                + "                                  AS vrFinanciacion, "
	                + "        MAX(tbldctosordenes.vrInteresADiferir)       "
	                + "                               AS vrInteresADiferir, "
	                + "      MAX(tbldctosordenes.porcentajeInteresADiferir) "
	                + "                       AS porcentajeInteresADiferir, "
	                + "      SUM(tbldctosordenesdetalle.vrVentaUnitario)    "
	                + "                                AS vrTotalSumatoria, "
	                + "        MAX(tbldctosordenes.vrTotalDiferir)          "
	                + "                               AS vrTotalDiferir     "
	                + "   FROM  tbldctosordenes                             "
	                + "   INNER JOIN  tbldctosordenesdetalle                "
	                + "   ON tbldctosordenes.idLocal        =               "
	                + "                    tbldctosordenesdetalle.idLocal   "
	                + "   AND tbldctosordenes.IDTIPOORDEN   =               "
	                + "                tbldctosordenesdetalle.IDTIPOORDEN   "
	                + "   AND tbldctosordenes.IDORDEN       =               "
	                + "                    tbldctosordenesdetalle.IDORDEN   "
	                + "   WHERE tbldctosordenes.idLocal     =               "
	                + "?1                                      "
	                + "   AND   tbldctosordenes.idTipoOrden =               "
	                + "?2                                  "
	                + "   AND   tbldctosordenes.IDlOG       =     ?3          ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaLiquidaDiferido(int idLocal, int IdTipoOrden, int idLog);
		  
		  
		  
		  @Query( value = " SELECT MAX(tbldctosordenes.vrTotalDiferir -         "
	                + "            tbldctosordenes.vrInteresADiferir)       "
	                + "                                  AS vrFinanciacion, "
	                + "        MAX(tbldctosordenes.vrInteresADiferir)       "
	                + "                               AS vrInteresADiferir, "
	                + "      MAX(tbldctosordenes.porcentajeInteresADiferir) "
	                + "                       AS porcentajeInteresADiferir, "
	                + "      SUM(tbldctosordenesdetalle.vrVentaUnitario)    "
	                + "                                AS vrTotalSumatoria, "
	                + "        MAX(tbldctosordenes.vrTotalDiferir)          "
	                + "                               AS vrTotalDiferir     "
	                + "   FROM  tbldctosordenes                             "
	                + "   INNER JOIN  tbldctosordenesdetalle                "
	                + "   ON tbldctosordenes.idLocal        =               "
	                + "                    tbldctosordenesdetalle.idLocal   "
	                + "   AND tbldctosordenes.IDTIPOORDEN   =               "
	                + "                tbldctosordenesdetalle.IDTIPOORDEN   "
	                + "   AND tbldctosordenes.IDORDEN       =               "
	                + "                    tbldctosordenesdetalle.IDORDEN   "
	                + "   WHERE tbldctosordenes.idLocal     =               "
	                + "?1                                     "
	                + "   AND   tbldctosordenes.idTipoOrden =               "
	                + "?2                                  "
	                + "   AND   tbldctosordenes.IDlOG       =     ?3          ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaLiquidaDiferidoFCH(int idLocal, int IdTipoOrden, int idLog);
		  
		  
		  
		  
		  @Query( value = "SELECT tbldctosordenes.idLocal,                         "
	                + "       tbldctosordenes.idTipoOrden,                     "
	                + "       tbldctosordenes.idLog,                           "
	                + "       COUNT(tbldctosordenesdetalle.idPlu)              "
	                + "                        AS cantidadArticulos,           "
	                + "        SUM (tbldctosordenesdetalle.cantidad         *  "
	                + "              tbldctosordenesdetalle.vrVentaUnitario )  "
	                + "                                      AS vrVentaConIva, "
	                + "        SUM((tbldctosordenesdetalle.cantidad        *   "
	                + "              tbldctosordenesdetalle.vrVentaUnitario) / "
	                + "  ( 1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) "
	                + "                                      AS vrVentaSinIva, "
	                + "  SUM(((tbldctosordenesdetalle.cantidad        *        "
	                + "      tbldctosordenesdetalle.vrVentaUnitario) /         "
	                + "  (1 + (tbldctosordenesdetalle.porcentajeIva / 100))) * "
	                + "( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100))* "
	                + "       ( tbldctosordenesdetalle.porcentajeIva / 100 ))  "
	                + "                                     AS vrIva,          "
	                + "                  SUM(tbldctosordenesdetalle.vrCosto *  "
	                + "                      tbldctosordenesdetalle.cantidad)  "
	                + "                                     AS vrCostoConIva,  "
	                + "               SUM( (tbldctosordenesdetalle.cantidad *  "
	                + "                     tbldctosordenesdetalle.vrCosto ) / "
	                + "     (1 + (tbldctosordenesdetalle.porcentajeIva/100)))  "
	                + "                                     AS vrCostoSinIva,  "
	                + "          SUM(((tbldctosordenesdetalle.cantidad       * "
	                + "             tbldctosordenesdetalle.vrVentaUnitario)  / "
	                + " (1 + ( tbldctosordenesdetalle.porcentajeIva / 100))) * "
	                + "( 1 - ( tbldctosordenesdetalle.porcentajeDscto / 100))) "
	                + "                                    AS vrVentaSinDscto  "
	                + "FROM  tbldctosordenes ,                                 "
	                + "      tbldctosordenesdetalle                            "
	                + "WHERE tbldctosordenes.idOrden         =                 "
	                + "      tbldctosordenesdetalle.idOrden                    "
	                + "AND   tbldctosordenes.idTipoOrden     =                 "
	                + "      tbldctosordenesdetalle.idTipoOrden                "
	                + "AND   tbldctosordenes.idLocal         =                 "
	                + "      tbldctosordenesdetalle.idLocal                    "
	                + "AND   tbldctosordenes.idLog           =                 "
	                + "?1                                          "
	                + "AND   tbldctosordenes.idLocal         =                 "
	                + "?2                                        "
	                + "AND   tbldctosordenes.idTipoOrden     =                 "
	                + "?3                                    "
	                + "GROUP BY tbldctosordenes.idLocal,                       "
	                + "       tbldctosordenes.idTipoOrden,                     "
	                + "       tbldctosordenes.idLog                            ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> liquidaLog( int idLog, int idLocal, int IdTipoOrden );
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "DELETE FROM tbldctosordenes          "
	                + "WHERE tbldctosordenes.IDLOCAL      = "
	                + "?1                      "
	                + "AND   tbldctosordenes.IDTIPOORDEN  = "
	                + "?2                  "
	                + "AND   tbldctosordenes.IDORDEN      = "
	                + "?3                      ", 
	                nativeQuery = true)
		  public void retiraLog(int idLocal, int IdTipoOrden, int IdOrden);
		  
		  
		  
		  
		  @Query( value = "SELECT * " +
		  		  "FROM bdaquamovil.dbo.tblDctosOrdenes " +
		  		  "WHERE tblDctosOrdenes.IDLOCAL = ?1 " +
		  		  "AND tblDctosOrdenes.IDTIPOORDEN = ?2 " +
		  		  "AND tblDctosOrdenes.idCliente = ?3 ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> obtenerOrdenTemporal( int idLocal, int idTipoOrden, String idCliente);
		  
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tbldctosordenes            "
	                + "SET tbldctosordenes.observacion = "
	                +  "CONCAT(LTRIM(?1),RTRIM(tbldctosordenes.observacion)) "
	                + "WHERE tbldctosordenes.idLocal =   "
	                + "?2                   "
	                + "AND tbldctosordenes.idTipoOrden = "
	                + "?3               "
	                + "AND   tbldctosordenes.idOrden  = ?4  ", 
	                nativeQuery = true)
		  public void actualizaFinObservacion(String Observacion, int idLocal, int IdTipoOrden, int IdOrden);
		  
		  
		  @Query( value = "SELECT tbldctos.IDLOCAL,                  "
	                + "        tbldctos.IDTIPOORDEN,             "
	                + "        tbldctos.IDORDEN,                 "
	                + "        tbldctos.idDcto,                  "
	                + " 	   tbldctos.idCliente,               "
	                + " 	   tblterceros.nombreTercero,        "
	                + "        tbldctos.indicador,               "
	                + "        tbldctos.fechaDcto,               "
	                + "        tbldctos.vrBase,                  "
	                + "        tbldctos.vrIva,                   "
	                + "        tbldctos.vrRteFuente,             "
	                + "        tbldctos.vrDescuento,             "
	                + "        tbldctos.vrRteIva,                "
	                + "        tbldctos.vrRteIca,                "
	                + "        tbldctos.idDctoNitCC,             "
	                + "        tbldctos.vrImpoconsumo,           "
	                + " 	   tbldctosordenes.OBSERVACION,      "
	                + "       tbldctosordenes.cuotaDiferir       "
	                + "                    AS numeroArticulo,    "
	                + " 	  tbldctosordenes.vrTotalDiferir,    "
	                + " 	   (CAST(MIN(item) AS varchar(10))   "
	                + "        + ' / ' +                         "
	                + "        CAST(MAX(item) AS varchar(10)))   "
	                + "                         AS comentario,   "
	                + "         tbldctosordenesdetalle.idPlu,    "
	                + "	tbldctosordenesdetalle.nombrePlu     "
	                + " FROM tbldctos                            "
	                + " INNER JOIN tbldctosordenes               "
	                + " ON tbldctosordenes.IDLOCAL         =     "
	                + "                         tbldctos.IDLOCAL "
	                + " AND tbldctosordenes.IDTIPOORDEN    =     "
	                + "                     tbldctos.IDTIPOORDEN "
	                + " AND tbldctosordenes.IDORDEN        =     "
	                + "                         tbldctos.IDORDEN "
	                + " INNER JOIN tbldctosordenesdetalle        "
	                + " ON tbldctosordenesdetalle.IDLOCAL   =    "
	                + "                         tbldctos.IDLOCAL "
	                + " AND tbldctosordenesdetalle.IDTIPOORDEN = "
	                + "                     tbldctos.IDTIPOORDEN "
	                + " AND tbldctosordenesdetalle.IDORDEN     = "
	                + "                         tbldctos.IDORDEN "
	                + " INNER JOIN tblterceros                   "
	                + " ON tblterceros.IDLOCAL =                 "
	                + "                         tbldctos.IDLOCAL "
	                + " AND tblterceros.idCliente    =           "
	                + "                       tbldctos.idCliente"
	                + " WHERE tbldctos.idLocal                 = "
	                + "?1                           "
	                + " AND tbldctos.idTipoOrden               = "
	                + "?2                       "
	                + " AND tbldctos.idCliente                = "
	                + "?3                        "
	                + " AND tbldctosordenesdetalle.idTipo != 8   "
	                + " GROUP BY   tbldctos.IDLOCAL,             "
	                + "        tbldctos.IDTIPOORDEN,             "
	                + "        tbldctos.IDORDEN,                 "
	                + "        tbldctos.idDcto,                  "
	                + " 	   tbldctos.idCliente,               "
	                + " 	   tblterceros.nombreTercero,        "
	                + "        tbldctos.indicador,               "
	                + "        tbldctos.fechaDcto,               "
	                + "        tbldctos.vrBase,                  "
	                + "        tbldctos.vrIva,                   "
	                + "        tbldctos.vrRteFuente,             "
	                + "        tbldctos.vrDescuento,             "
	                + "        tbldctos.vrRteIva,                "
	                + "        tbldctos.vrRteIca,                "
	                + "        tbldctos.idDctoNitCC,             "
	                + "        tbldctos.vrImpoconsumo,           "
	                + " 	   tbldctosordenes.OBSERVACION,      "
	                + "       tbldctosordenes.cuotaDiferir,      "
	                + " 	  tbldctosordenes.vrTotalDiferir,    "
	                + "	   tbldctosordenesdetalle.idPlu,     "
	                + "	tbldctosordenesdetalle.nombrePlu     "
	                + " ORDER BY tbldctos.fechaDcto DESC",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaCobroPermanente( int idLocal, int IdTipoOrden, String idCliente );
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tbldctosordenes          "
	                + "SET tbldctosordenes.vrTotalDiferir = "
	                + "?1          "
	                + "WHERE tbldctosordenes.idLocal = "
	                + "?2                 "
	                + "AND tbldctosordenes.idTipoOrden = "
	                + "?3             "
	                + "AND tbldctosordenes.idOrden   =  ?4 ", 
	                nativeQuery = true)
		  public void modificaCobroPermanente(Double VrTotalDiferir, int idLocal, int IdTipoOrden, int IdOrden);
		  
		  
		  
		  @Query( value = " SELECT tbldctosordenes.IDLOCAL           "          
				  + "   ,tbldctosordenes.IDTIPOORDEN         "  
				  + "   ,tbldctosordenes.IDORDEN             "  
				  + "   ,tbldctos.idDcto                     "
				  + "   ,MAX(tbldctosordenes.idCliente)      "  
				  + "              AS idCliente              "
				  + "  ,MAX(tblterceros.nombreTercero)       "
				  + "                AS nombreTercero        "
				  + "   ,MAX(tbldctosordenes.FECHAORDEN)     "   
				  + "              AS fechaOrden             "
				  + "  ,MAX(tbldctosordenes.observacion)     "
				  + "                 AS observacion         "
				  + "  ,MAX(tbldctosordenes.idPeriodo)       " 
				  + "             AS idPeriodo               "
				  + "  ,MAX(tbldctosordenes.vrTotalDiferir)  "
				  + "  	                   AS vrCredito    "
				  + "  ,MAX(tbldctosordenes.cuotaDiferir)    "
				  + "                    AS cantidad         "
				  + "  ,SUM( tmpFIN.vrVentaUnitario *        "
				  + "    tmpFIN.cuotaFacturada )             "
				  + "                    AS vrFacturado      "
				  + "  ,SUM(tmpFIN.cuotaFacturada)           "
				  + "                 AS cuotaFacturada      "
				  + "  ,MAX(tbldctosordenes.vrTotalDiferir)- " 
				  + "  	   SUM( tmpFIN.vrVentaUnitario *   "
				  + "  	   tmpFIN.cuotaFacturada ) AS 	   "
				  + "  		      vrCreditoPendiente   "
				  + " FROM tbldctosordenes                   "
				  + " INNER JOIN (                           "
				  + "  SELECT IDLOCAL                        "
				  + "      ,IDTIPOORDEN                      "
				  + "      ,IDORDEN                          "
				  + "      ,SUM(VRVENTAUNITARIO)             "
				  + "                AS vrVentaUnitario,     "
				  + "       CASE                             "
				  + "       WHEN itemPadre > 1 THEN 1        "
				  + "       ELSE  0                          "
				  + "       END AS cuotaFacturada            "
				  + "  FROM  tbldctosordenesdetalle          "
				  + "  WHERE IDLOCAL       =                 "
				  + "?1                         "
				  + "    AND   IDTIPOORDEN   =               "
				  + "?2                     "
				  + "   AND   IDTIPO   =  8                  "
				  + "   GROUP BY IDLOCAL                     "
				  + "      ,IDTIPOORDEN                      "
				  + "      ,IDORDEN                          "
				  + "    ,itemPadre ) AS tmpFIN              "
				  + "  ON tmpFIN.idLocal       =             "
				  + "              tbldctosordenes.idLocal   "
				  + "  AND tmpFIN.idTipoOrden  =             "
				  + "          tbldctosordenes.idTipoOrden   "
				  + "  AND tmpFIN.idOrden      =             "
				  + "              tbldctosordenes.idOrden   "
				  + "  INNER JOIN tblterceros                "
				  + "  ON tblterceros.idLocal  =             "
				  + "              tbldctosordenes.idLocal   "
				  + "  AND tblterceros.idCliente  =          "
				  + "           tbldctosordenes.idCliente    "
				  
				  + " INNER JOIN tbldctos                    "
				  + " ON tblterceros.idLocal  =              "
				  + "                 tbldctos.idLocal       "
				  + "AND tblterceros.idCliente  =            "
				  + "                 tbldctos.idCliente     "
				  + "AND tbldctos.idOrden  =                 "
				  + "               tbldctosordenes.idOrden  "
				  
				  
				  + "  WHERE tbldctosordenes.idLocal  =      " 
				  + "?1                         "   
				  + " AND   tbldctosordenes.IDTIPOORDEN =    "
				  + "?2                     "
				  + "  AND tbldctosordenes.cuotaDiferir > 0  "           
				  + "  AND tblterceros.idTipoTercero = 1     "
				  + "AND   tbldctosordenes.idCliente      = "
				  + "?3                     "
				  + "AND tbldctosordenes.FECHAORDEN BETWEEN "
				  + "?4  AND                                 "
				  + "?5                                      "                               
				  + "  GROUP BY tbldctosordenes.IDLOCAL      "     
				  + "      ,tbldctosordenes.IDTIPOORDEN      "     
				  + "      ,tbldctosordenes.IDORDEN          "  
				  + "      ,tbldctos.idDcto                  "
				  + "  HAVING                                "
				  + "  (MAX(tbldctosordenes.vrTotalDiferir)- "
				  + "    SUM(tmpFIN.vrVentaUnitario *        "
				  + "        tmpFIN.cuotaFacturada)) != 0 ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaHistoricoFinanciacionCliente( int idLocal, int IdTipoOrden, String idCliente, String FechaInicial, String FechaFinal);
		  
		  
		  
		  @Query( value = "SELECT MAX(tblterceros.nombreTercero) AS nombreTercero,      "
	                + "       MAX(tblciudades.idCiudad) AS idCiudadFormato,                "
	                + "       MAX(tblciudades.idDpto) AS idDptoStrFormato,                    "
	                + "       MAX(tbltercerossui.idIgacZona) AS idIgacZonaFormato,         "
	                + "       MAX(tbltercerossui.idIgacSector) AS idIgacSectorFormato,     "
	                + "       MAX(tbltercerossui.idIgacVereda)  AS idIgacVereda,    "
	                + "       MAX(tbltercerossui.idIgacPredio) AS idIgacPredio,     "
	                + "       MAX(tbltercerossui.idIgacCondPredio)                  "
	                + "   		                        AS idIgacCondPredioFormato,    "
	                + "       MAX(tblterceroestracto.codigoClaseUso)                "
	                + "   		                              AS idEstracto,    "
	                + "       MAX(tbltercerossui.idUMultiusuario)                   "
	                + "   		                         AS idUMultiusuarioVacioStr,    "
	                + "       MAX(tbltercerossui.idUNoMultiusuario)                 "
	                + "   		                       AS idUNoMultiusuarioVacioStr,    "
	                + "       MAX(tbltercerossui.idHogarComunitario)                "
	                + "   		                      AS idHogarComunitarioStr,    "
	                + "       MAX(tbltercerossui.estadoMedidor)                     "
	                + "   		                           AS estadoMedidor,    "
	                + "       MAX(tbltercerossui.idTipoLectura)                     "
	                + "   		                           AS idTipoLectura,    "
	                + "       MAX(tbltercerossui.idCausaRefactura)                  "
	                + "                                  AS idCausaRefactura,       "
	                + "       MAX(tbltercerossui.dctoRefactura)                     "
	                + "   		                           AS dctoRefactura,    "
	                + "       MAX(tbltercerossui.vrCostoMediaTasaUso)               "
	                + "   		                     AS vrCostoMediaTasaUso,    "
	                + "       MAX(tblterceros.codigoCatastral) AS numeroFichaFormato,      "
	                + "       MAX(tbltercerossui.corregimiento)                     "
	                + "   		                           AS corregimientoFormato,    "
	                + "       MAX(tbltercerossui.barrio) AS barrioFormato,                 "
	                + "       MAX(tbltercerossui.edificio) AS edificioFormato,             "
	                + "       MAX(tbltercerossui.unidadPredial)  AS unidadPredialFormato,  "
	                + "       MAX(tmpCAU.nombreCausa) AS nombreEstadoCliente,       "
	                + "       MAX(tbldctosordenes.direccionDespacho)                "
	                + "                                  AS direccionTerceroSui,       "
	                + "       tmpPRC.idDcto,                                        "
	                + "  	  MAX(tmpPRC.fechaDcto) AS fechaDctoFormatoSui,                   "
	                + "       tmpPRC.idPeriodo,                                     "
	                + "       tmpPRC.idCliente,                                     "
	                + "       SUM(tmpPRC.vrConsumo) AS vrConsumo,                   "                
	                + " ( SELECT  TOP 1                                             "              
	                + "       tmpDET.lecturaMedidor                                 "       
	                + "          as lecturaAnterior                                 " 
	                + " FROM   tblDctos tmpDCT                                      "          
	                + " INNER JOIN tblDctosOrdenesDetalle                           "   
	                + "                         tmpDET                              "  
	                + " ON tmpDCT.IDLOCAL        =                                  "         
	                + "    tmpDET.IDLOCAL                                           "      
	                + " AND tmpDCT.IDTIPOORDEN   =                                  "          
	                + "  tmpDET.IDTIPOORDEN                                         "          
	                + " AND tmpDCT.IDORDEN       =                                  "       
	                + "     tmpDET.IDORDEN                                          "           
	                + " AND   tmpDCT.idLocal     =                                  "          
	                + "?1                                             "
	                + " AND   tmpDCT.idTipoOrden IN (9,29)                          "  
	                + " AND   tmpDCT.idPeriodo   =                                  "      
	                + "?3                                            "
	                + " AND   tmpDET.IDTIPO      =    4                             "         
	                + " AND   tmpDET.IDCLIENTE   =                                  "            
	                + "                 MAX(tblterceros.idCliente)                  "         
	                + " ORDER BY tmpDCT.idCliente ,                                 "      
	                + "       tmpDCT.idOrden DESC )   AS lecturaActual,             "                  
	                + " ( SELECT  TOP 1                                             "              
	                + "       tmpDET.lecturaMedidor                                 "       
	                + "          as lecturaAnterior                                 " 
	                + " FROM   tblDctos tmpDCT                                      "          
	                + " INNER JOIN tblDctosOrdenesDetalle                           "   
	                + "                         tmpDET                              "  
	                + " ON tmpDCT.IDLOCAL        =                                  "         
	                + "    tmpDET.IDLOCAL                                           "      
	                + " AND tmpDCT.IDTIPOORDEN   =                                  "          
	                + "  tmpDET.IDTIPOORDEN                                         "          
	                + " AND tmpDCT.IDORDEN       =                                  "       
	                + "     tmpDET.IDORDEN                                          "           
	                + " AND   tmpDCT.idLocal     =                                  "          
	                + "?1                                             "
	                + " AND   tmpDCT.idTipoOrden IN (9,29)                          "  
	                + " AND   tmpDCT.idPeriodo   =                                  "      
	                + "?4    		                        "
	                + " AND   tmpDET.IDTIPO      =    4                             "         
	                + " AND   tmpDET.IDCLIENTE   =                                  "            
	                + "                 MAX(tblterceros.idCliente)                  "         
	                + " ORDER BY tmpDCT.idCliente ,                                 "      
	                + "       tmpDCT.idOrden DESC )   AS lecturaAnterior,           "                 
	                + "       MAX(ISNULL(tbldctosordenes.promedio,0)) AS promedio,  "
	                + "       SUM(tmpPRC.vrCargoFijo) AS vrCargoFijo,               "
	                + "  	  SUM(tmpPRC.vrCargoBasico) AS vrCargoBasico,           "
	                + "       SUM(tmpPRC.vrCargoComplementario)                     "
	                + "                             AS vrCargoComplementario,       "
	                + "       SUM(tmpPRC.vrCargoSuntuario) AS vrCargoSuntuario,     "
	                + "       MAX(tmpPRC.vrVentaUnitario) AS vrVentaUnitario,       "
	                + "       SUM(tmpPRC.vrDeudaCargoFijo) AS vrDeudaCargoFijo,     "
	                + "       SUM(tmpPRC.vrDeudaConsumo) AS vrDeudaConsumo,         "
	                + "       SUM(tmpPRC.vrDeudaReconexion) AS vrDeudaReconexion,   "
	                + "       SUM(tmpPRC.vrDeudaConexion) AS vrDeudaConexion,       "
	                + "       SUM(tmpPRC.vrDeudaSuspencion) AS vrDeudaSuspencion,   "
	                + "       SUM(tmpPRC.vrDeudaReinstalacion)                      "
	                + "                              AS vrDeudaReinstalacion, 	"
	                + "       CASE WHEN SUM(tmpPRC.vrDeudaOtros) < 0 THEN 0         "
	                + "            WHEN SUM(tmpPRC.vrDeudaOtros) >=0                "
	                + "       THEN SUM(tmpPRC.vrDeudaOtros) END AS vrDeudaOtros,	"
	                + "       SUM(tmpPRC.vrDeudaCargoCorte)                         "
	                + "                                 AS vrDeudaCargoCorte,       "
	                + "       SUM(tmpPRC.vrDeudaMedidor) AS vrDeudaMedidor,		"
	                + "       SUM(tmpPRC.vrMedidor) AS vrMedidor,                   "
	                + "       MAX(ISNULL(tbldctosordenes.cuotaVencida,0))           "
	                + "                                      AS cuotaVencida,       "
	                + "       SUM(tmpPRC.cantidad) AS cantidad,  	                "
	                + "       MAX(tmpFRA.nombreCausa) AS nombreCausa,               "
	                + "       SUM(tmpPRC.vrCargoConexion) AS vrCargoConexion,    		"
	                + "       CASE WHEN SUM(tmpPRC.vrReconexion)  < 0 THEN 0        "
	                + "	       WHEN SUM(tmpPRC.vrReconexion)  >=0               "
	                + "	  THEN SUM(tmpPRC.vrReconexion) END AS vrReconexion,    "
	                + "       SUM(tmpPRC.vrCargoReinstalacion) AS vrCargoReinstalacion,       "
	                + "       SUM(tmpPRC.vrCargoSuspencion) AS vrCargoSuspencion,  	        "
	                + "       SUM(tmpPRC.vrCargoCorte) AS vrCargoCorte,             "
	                + "    	  CASE WHEN SUM(tmpPRC.vrOtros + tmpPRC.vrFinanciacion  "
	                + "                        + tmpPRC.vrAjusteDecena) < 0 THEN 0  "
	                + "            WHEN SUM(tmpPRC.vrOtros + tmpPRC.vrFinanciacion  "
	                + "                       + tmpPRC.vrAjusteDecena) >=0          "
	                + "       THEN SUM(tmpPRC.vrOtros + tmpPRC.vrFinanciacion       "
	                + "               + tmpPRC.vrAjusteDecena)  END  AS vrOtros,    "
	                + "       SUM(tmpPRC.vrConsumo  +                               "
	                + "           tmpPRC.vrCargoFijo    +                           "
	                + "           tmpPRC.vrFinanciacion +                           "
	                + "           tmpPRC.vrMedidor      +                           "
	                + "           tmpPRC.vrInteres +                                "
	                + "           tmpPRC.vrInteresAcum  +                           "
	                + "           tmpPRC.VrReconexion   +                           "
	                + "           tmpPRC.vrCargoConexion     +                           "
	                + "           tmpPRC.vrCargoReinstalacion+                           "
	                + "           tmpPRC.vrCargoCorte   +                           "
	                + "           tmpPRC.vrOtros        +                           "
	                + "           tmpPRC.vrCargoSuspencion   +                           "
	                + "           tmpPRC.vrSubsidio     +                           "
	                + "           tmpPRC.vrContribucion +                           "
	                + "           tmpPRC.vrAjusteDecena +                           "
	                + "           tmpPRC.deudaAnterior) AS vrTotalFacturadoSuiSf0,            "
	                + "          (SELECT ISNULL(SUM(tblPagosMedios.vrMedio),0)      "
	                + "                                                AS vrPago    "
	                + "           FROM     tblPagos                                 "
	                + "           INNER JOIN tblPagosMedios                         "
	                + "           ON tblPagos.idLocal = tblPagosMedios.idLocal      "
	                + "           AND tblPagos.idTipoOrden =                        "
	                + "                                 tblPagosMedios.idTipoOrden  "
	                + "           AND tblPagos.idRecibo = tblPagosMedios.idRecibo   "
	                + "           AND tblPagos.indicador = tblPagosMedios.indicador "
	                + "           INNER JOIN tblPlus                                "
	                + "           ON tblPlus.idLocal = tblPagosMedios.idLocal       "
	                + "           AND tblPlus.idPlu = tblPagosMedios.idPlu          "
	                + "           WHERE tblpagos.IDLOCAL = tmpPRC.idLocal           "
	                + "           AND tblpagos.IDTIPOORDEN = tmpPRC.idTipoOrden     "
	                + "           AND tblpagos.nitCC  = tmpPRC.idCliente            "
	                + "           AND tblpagos.idPeriodo =                          "
	                + "?3                                            "
	                + "	      AND tblPlus.idTipo NOT IN (50,51,150,151,         "
	                + "                                25,29,125,129)) AS vrPago,   "
	                + "       SUM(tmpPRC.vrSubsidioCargoFijo +                      "
	                + "    	        tmpPRC.vrSubsidioConsumo) AS vrSubsidio,        "
	                + "       SUM(tmpPRC.vrSubsidioCargoFijo)                       "
	                + "                               AS vrSubsidioCargoFijo,       "
	                + "       SUM(tmpPRC.vrSubsidioConsumo)                         "
	                + "                                 AS vrSubsidioConsumo, 	"
	                + "       SUM(tmpPRC.vrContribucion) AS vrContribucion,         "
	                + "       SUM(tmpPRC.vrContribucionCargoFijo)                   "
	                + "                           AS vrContribucionCargoFijo,       "
	                + "       SUM(tmpPRC.vrContribucionConsumo)                     "
	                + "     	                      AS vrContribucionConsumo, "
	                + "       CASE WHEN SUM(tmpPRC.deudaAnterior) < 0 THEN 0        "
	                + "          WHEN SUM(tmpPRC.deudaAnterior) >=0                 "
	                + "          THEN SUM(tmpPRC.deudaAnterior) END                 "
	                + " 	                                 AS vrDeudaAnterior,    "
	                + "       SUM(tmpPRC.vrInteres + tmpPRC.vrInteresAcum)          "
	                + "                                         AS vrInteres,       "
	                + "       ISNULL(MAX(tbldctosordenes.comentario),'')            "
	                + "                                 AS textoFinanciacion,       "
	                + "       MAX(tbltercerosruta.nombreCiclo) + '-' +              "
	                + " MAX(tbltercerosruta.nombreRuta)                 "
	                + "                                        AS nombreRuta,       "
	                + "       MAX(ISNULL(tblterceros.ordenRuta,0))                  "
	                + "                                         AS ordenRuta,       "
	                + "       MAX(tmpPRC.idRuta) AS idRuta,                         "
	                + "       MAX(tblterceroestracto.nombreEstracto)                "
	                + "                                    AS nombreEstracto,       "
	                + "       MAX(tblterceros.email) AS emailSuscriptor,            "
	                + "     	 MAX(tblterceros.direccionCobro)                "
	                + "                                    AS direccionCobro        "
	                + "      ,tmpPRC.fechaInicial AS fechaInicialSui                     "
	                + "      ,tmpPRC.fechaFinal AS fechaHasta                       "
	                + "      ,tmpPRC.fechaSinRecargo                                "
	                + "      ,tmpPRC.fechaConRecargo                                "
	                + "      ,tmpPRC.nombrePeriodo                                  "
	                + "  	 ,MAX(tmpPRC.diasFactura) AS diasFactura                "
	                + "  	 ,CAST((CASE WHEN (SUM(tmpPRC.vrDeudaCargoFijo)/        "
	                + "             CASE WHEN SUM(tmpPRC.vrCargoFijo) != 0          "
	                + "        THEN SUM(tmpPRC.vrCargoFijo) ELSE 1 END) >0          "
	                + "        THEN (SUM(tmpPRC.vrDeudaCargoFijo) /                 "
	                + "        CASE WHEN SUM(tmpPRC.vrCargoFijo) !=  0              "
	                + "        THEN SUM(tmpPRC.vrCargoFijo) ELSE 1 END)             "
	                + "        ELSE 0 END) AS integer) * 30 AS diasMora             "
	                + "  	  ,CASE WHEN SUM(tmpPRC.deudaAnterior)<0                "
	                + "         THEN (SUM(tmpPRC.deudaAnterior) *(-1))              "
	                + "         WHEN SUM(tmpPRC.vrAjusteDecena  ) < 0               "
	                + "         THEN SUM(tmpPRC.vrAjusteDecena) *(-1)               "
	                + "	    WHEN (SUM(tmpPRC.deudaAnterior) +                   "
	                + "                      SUM(tmpPRC.vrDeudaAjusteDecena))<0     "
	                + "	    THEN (SUM(tmpPRC.deudaAnterior +                    "
	                + "                    tmpPRC.vrDeudaAjusteDecena) *(-1)) 	"
	                + "	    WHEN SUM(tmpPRC.deudaAnterior) >=0                  "
	                + "         AND SUM(tmpPRC.vrAjusteDecena  ) >= 0               "
	                + "         THEN 0  END AS vrPagoAnticipado                     "
	                + "      ,CASE WHEN SUM(tmpPRC.vrSubsidio) < 0                  "
	                + "          THEN (MAX(tmpPRC.factorCargoFijoSf3) *(-1))           "
	                + "          WHEN SUM(tmpPRC.vrSubsidio) >= 0                   "
	                + "            THEN MAX(tmpPRC.factorCargoFijoSf3)                 "
	                + "                                 END AS factorCargoFijoSf3      "
	                + "      ,MAX(tmpPRC.factorCargoConsumoSf3) AS factorCargoConsumoSf3  "
	                + "      ,SUM(tmpPRC.vrAjusteDecena) AS vrAjusteDecena       	"
	                + "      ,SUM(tmpPRC.vrDeudaAjusteDecena)                       "
	                + "                                   AS vrDeudaAjusteDecena    "
	                + "FROM (SELECT tbldctos.idLocal,                               "
	                + "tbldctos.idTipoOrden,                            "
	                + "tbldctos.idOrden,                                "
	                + "tbldctos.idDcto,                                 "
	                + "tbldctos.idPeriodo,                              "
	                + "tbldctos.idCliente,                              "
	                + "tblplus.idTipo,                                  "
	                + "MAX(tbldctos.fechaDcto) AS fechaDcto,            "
	                + "SUM(CASE WHEN tblplus.idTipo = 4                 "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "   tbldctosordenesdetalle.vrVentaUnitario)       "
	                + "                ELSE 0 END) AS vrConsumo,                    "
	                + "SUM(CASE WHEN tblplus.idTipo = 104               "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "   tbldctosordenesdetalle.vrVentaUnitario)       "
	                + "                ELSE 0 END) AS vrDeudaConsumo,               "
	                + "MAX(CASE WHEN tblplus.idTipo = 4                 "
	                + "               THEN tbldctosordenesdetalle.vrVentaUnitario   "
	                + "                 ELSE 0  END) AS vrVentaUnitario,  	        "
	                + "MAX(CASE WHEN tblplus.idTipo = 4                 "
	                + "                THEN tbldctosordenesdetalle.lecturaMedidor   "
	                + "                ELSE 0 END) AS lecturaMedidor,               "
	                + "SUM(CASE WHEN tblplus.idTipo = 4                 "
	                + "                THEN tbldctosordenesdetalle.cantidad         "
	                + "                ELSE 0 END) AS cantidad,                     "
	                + "SUM(CASE WHEN tblplus.idTipo = 6                 "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrCargoFijo,                  "
	                + "SUM(CASE WHEN tblplus.idTipo = 106               "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaCargoFijo,             "
	                + "  		  SUM(CASE WHEN tblplus.idTipo = 4              "
	                + "                   AND tblplus.topeMaximo = 1                "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrCargoBasico,                "
	                + "SUM(CASE WHEN tblplus.idTipo = 4                 "
	                + "                    AND tblplus.topeMaximo = 2               "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrCargoComplementario,        "
	                + "SUM(CASE WHEN tblplus.idTipo = 4                 "
	                + "                   AND tblplus.topeMaximo = 3                "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                 ELSE 0 END) AS vrCargoSuntuario,            "
	                + "SUM(CASE WHEN                                    "
	                + "          tblplus.idTipo IN (9)                  "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrMedidor,                      "
	                + "SUM(CASE WHEN tblplus.idTipo IN (109)            "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrDeudaMedidor, 	        "
	                + "SUM (CASE WHEN tblplus.idTipo IN (8)             "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrFinanciacion,               "
	                + "SUM (CASE WHEN                                   "
	                + "     tblplus.idTipo IN (108,119,120,121,122)     "
	                + "                 THEN  (tbldctosordenesdetalle.cantidad *    "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaFinanciacion,          "
	                + "SUM(CASE WHEN tblplus.idTipo IN (12)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrInteres,                    "
	                + "SUM(CASE WHEN tblplus.idTipo IN (112)            "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrInteresAcum,                "
	                + "SUM(CASE WHEN tblplus.idTipo IN (13)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0  END) AS vrReconexion,    		"
	                + "SUM(CASE WHEN  tblplus.idTipo IN (113)           "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaReconexion,	        "
	                + "SUM(CASE WHEN tblplus.idTipo IN (14)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0  END) AS vrCargoConexion,                  "
	                + "           SUM(CASE WHEN  tblplus.idTipo IN (114)            "
	                + "                THEN  (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaConexion,              "
	                + "SUM(CASE WHEN tblplus.idTipo IN (15)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrCargoReinstalacion,              "
	                + "SUM(CASE WHEN tblplus.idTipo IN (115)            "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaReinstalacion,         "
	                + "SUM(CASE WHEN tblplus.idTipo IN (16)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrCargoSuspencion,                 "
	                + "SUM(CASE WHEN tblplus.idTipo IN (116)            "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaSuspencion, 	        "
	                + "SUM(CASE WHEN tblplus.idTipo IN (17)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrCargoCorte,                 "
	                + "SUM(CASE WHEN  tblplus.idTipo IN (117)           "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaCargoCorte,            "
	                + "SUM(CASE WHEN tblplus.idTipo IN (18)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad  *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrOtros,                      "
	                + "SUM(CASE WHEN tblplus.idTipo IN (118)            "
	                + "                THEN (tbldctosordenesdetalle.cantidad  *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrDeudaOtros,		        "
	                + "SUM(CASE WHEN tblplus.idTipo IN (19,21)          "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrSubsidio,                   "
	                + "SUM(CASE WHEN tblplus.idTipo IN (19)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrSubsidioCargoFijo,	        "
	                + "SUM(CASE WHEN tblplus.idTipo IN (21)             "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrSubsidioConsumo,            "
	                + "SUM(CASE WHEN tblplus.idTipo IN (20,22)          "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrContribucion,               "
	                + "			  SUM(CASE WHEN tblplus.idTipo IN (20)  "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrContribucionCargoFijo,      "
	                + "			  SUM(CASE WHEN tblplus.idTipo IN (22)  "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrContribucionConsumo,        "
	                + "            (CASE WHEN tblplus.idTipo IN (19,20)             "
	                + "                THEN (tblplus.vrCostoIND/100) ELSE 0         "
	                + "                END) AS factorCargoFijoSf3,                     "
	                + "            (CASE WHEN  tblplus.idTipo IN (21,22)            "
	                + "                THEN (tblplus.vrCostoIND/100) ELSE 0         "
	                + "                              END) AS factorCargoConsumoSf3,    "
	                + "SUM(CASE WHEN  tblplus.idTipo IN (23)            "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                 ELSE 0 END) AS vrAjusteDecena,        	"
	                + "SUM(CASE WHEN  tblplus.idTipo IN (123)            "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                 ELSE 0 END) AS vrDeudaAjusteDecena,        	"
	                + "SUM(CASE WHEN tblplus.idTipo IN (                "
	                + "                     104, 105,106,108,109,110,111,113,114,   "
	                + "                     115, 116, 117, 118, 119,120,            "
	                + "                                 121,122,10,11,123)          "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS deudaAnterior                 "
	                + "           ,MAX(tbldctosperiodo.fechaInicial)                "
	                + "                                          AS fechaInicial    "
	                + "           ,MAX(tbldctosperiodo.fechaFinal) AS fechaFinal    "
	                + "           ,MAX(tbldctosperiodo.fechaSinRecargo)             "
	                + "                                       AS fechaSinRecargo    "
	                + "           ,MAX(tbldctosperiodo.fechaConRecargo)             "
	                + "                                        AS fechaConRecargo   "
	                + "           ,MAX(tbldctosperiodo.nombrePeriodo)               "
	                + "                                         AS  nombrePeriodo   "
	                + "  	      ,DATEDIFF(DAY,tbldctosperiodo.fechaInicial,       "
	                + "                   tbldctosperiodo.fechaFinal)   "
	                + "                                            AS diasFactura   "
	                + " 	      ,tbldctosordenesdetalle.idEstracto                "
	                + " 	      ,tbldctosordenesdetalle.idRuta 	                "
	                + "     FROM         tbldctos                                   "
	                + "     INNER JOIN tbldctosordenesdetalle                       "
	                + "     ON tbldctos.IDLOCAL      =                              "
	                + "                tbldctosordenesdetalle.IDLOCAL   "
	                + "     AND  tbldctos.IDTIPOORDEN  =                            "
	                + "         	           tbldctosordenesdetalle.IDTIPOORDEN   "
	                + "     AND tbldctos.IDORDEN       =                            "
	                + "                tbldctosordenesdetalle.IDORDEN   "
	                + "     INNER JOIN tblplus                                      "
	                + "     ON tbldctosordenesdetalle.IDPLU = tblplus.idPlu         "
	                + "     AND tbldctosordenesdetalle.idLocal = tblplus.idLocal    "
	                + "     INNER JOIN tbldctosperiodo                              "
	                + "     ON tbldctosperiodo.idPeriodo = tbldctos.idPeriodo       "
	                + "     AND tbldctosperiodo.idLocal = tbldctos.idLocal          "
	                + "     WHERE     tbldctos.idLocal       =                      "
	                + "?1                                              "
	                + "     AND       tbldctos.idTipoOrden   =                      "
	                + "?2                                          "
	                + "     AND       tbldctos.idPeriodo     =                      "
	                + "?3                                            "
	                + "     GROUP BY tbldctos.idLocal,                              "
	                + " tbldctos.idTipoOrden,                           "
	                + " tbldctos.idOrden,                               "
	                + " tbldctos.idDcto,                                "
	                + " tbldctos.idPeriodo,                             "
	                + " tbldctos.idCliente,                             "
	                + " tblplus.idTipo,                                 "
	                + " tblplus.vrCostoIND,                             "
	                + "  	        tbldctosperiodo.fechaInicial,                   "
	                + " tbldctosperiodo.fechaFinal ,                    "
	                + " 	        tbldctosordenesdetalle.idEstracto,              "
	                + " 	        tbldctosordenesdetalle.idRuta                   "
	                + "     UNION ALL                                               "
	                + "     SELECT tbldctos.idLocalCruce AS idLocal,                "
	                + "tbldctos.idTipoOrdenCruce AS idTipoOrden,        "
	                + "tbldctos.idOrdenCruce AS idOrden,                "
	                + "tbldctos.idDctoCruce AS idDcto,                  "
	                + "tbldctos.idPeriodo,                              "
	                + "tbldctos.idCliente,                              "
	                + "tbldctos.fechaDcto,                              "
	                + "tblplus.idTipo,                                  "
	                + "            (CASE WHEN tblplus.idTipo = 4                    "
	                + "             THEN (tbldctosordenesdetalle.cantidad  *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "             ELSE 0 END) AS vrConsumo,                       "
	                + "            (CASE WHEN tblplus.idTipo = 104                  "
	                + "             THEN (tbldctosordenesdetalle.cantidad  *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "             ELSE 0 END) AS vrDeudaConsumo,                  "
	                + "            (CASE WHEN tblplus.idTipo = 4                    "
	                + "             THEN tbldctosordenesdetalle.vrVentaUnitario     "
	                + "             ELSE 0 END) AS vrVentaUnitario,                 "
	                + "            (CASE WHEN tblplus.idTipo = 4                    "
	                + "             THEN  tbldctosordenesdetalle.lecturaMedidor     "
	                + "             ELSE 0 END) AS lecturaMedidor,                  "
	                + "            (CASE WHEN  tblplus.idTipo = 4                   "
	                + "             THEN tbldctosordenesdetalle.cantidad            "
	                + "             ELSE 0 END) AS cantidad,                        "
	                + "            (CASE WHEN  tblplus.idTipo = 6                   "
	                + "             THEN (tbldctosordenesdetalle.cantidad *         "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "             ELSE 0 END) AS vrCargoFijo,                     "
	                + "            (CASE WHEN tblplus.idTipo = 106                  "
	                + "             THEN (tbldctosordenesdetalle.cantidad *         "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "             ELSE 0 END) AS vrDeudaCargoFijo,                "
	                + "  		  (CASE WHEN tblplus.idTipo = 4                 "
	                + "                      AND tblplus.topeMaximo = 1             "
	                + "             THEN (tbldctosordenesdetalle.cantidad *         "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "             ELSE 0 END) AS vrCargoBasico,                   "
	                + "            (CASE WHEN tblplus.idTipo = 4                    "
	                + " 	                       AND tblplus.topeMaximo = 2       "
	                + "             THEN (tbldctosordenesdetalle.cantidad *         "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "             ELSE 0 END) AS vrCargoComplementario,           "
	                + "            (CASE WHEN tblplus.idTipo = 4                    "
	                + " 	                            AND tblplus.topeMaximo = 3  "
	                + "              THEN ( tbldctosordenesdetalle.cantidad *       "
	                + "      tbldctosordenesdetalle.vrVentaUnitario)    "
	                + "              ELSE 0 END) AS vrCargoSuntuario,               "
	                + "            (CASE WHEN  tblplus.idTipo IN (9)                "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "      tbldctosordenesdetalle.vrVentaUnitario)    "
	                + "              ELSE 0 END) AS vrMedidor,                      "
	                + "             (CASE WHEN  tblplus.idTipo IN (109)             "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "     tbldctosordenesdetalle.vrVentaUnitario)     "
	                + "              ELSE 0  END) AS vrDeudaMedidor, 	        "
	                + "             (CASE WHEN  tblplus.idTipo IN (8)               "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrFinanciacion,                 "
	                + "             (CASE WHEN tblplus.idTipo                       "
	                + "                                  IN (108,119,120,121,122)   "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrDeudaFinanciacion,            "
	                + "             (CASE WHEN tblplus.idTipo IN (12)               "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrInteres,                      "
	                + "             (CASE WHEN   tblplus.idTipo IN (112)            "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrInteresAcum,                "
	                + "             (CASE WHEN   tblplus.idTipo IN (13)             "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0  END) AS vrReconexion,                  "
	                + "             (CASE WHEN   tblplus.idTipo IN (113)            "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0  END) AS vrDeudaReconexion,             "
	                + "             (CASE WHEN tblplus.idTipo IN (14)               "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0  END) AS vrConexion,                    "
	                + "             (CASE WHEN tblplus.idTipo IN (114)              "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrDeudaConexion, 	        "
	                + "             (CASE WHEN tblplus.idTipo IN (15)               "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0  END) AS vrReinstalacion,               "
	                + "             (CASE WHEN  tblplus.idTipo IN (115)             "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrDeudaReinstalacion, 	        "
	                + "             (CASE WHEN  tblplus.idTipo IN (16)              "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrSuspencion,                   "
	                + "             (CASE WHEN  tblplus.idTipo IN (116)             "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0  END) AS vrDeudaSuspencion, 	        "
	                + "             (CASE WHEN  tblplus.idTipo IN (17)              "
	                + "               THEN (tbldctosordenesdetalle.cantidad *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrCargoCorte,                   "
	                + "             (CASE WHEN tblplus.idTipo IN (117)              "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrDeudaCargoCorte,  	        "
	                + "             (CASE WHEN tblplus.idTipo IN (18)               "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrOtros,                        "
	                + "             (CASE WHEN  tblplus.idTipo IN (118)             "
	                + "              THEN (tbldctosordenesdetalle.cantidad  *       "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrDeudaOtros,		        "
	                + "             (CASE WHEN tblplus.idTipo IN (19,21)            "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrSubsidio,                     "
	                + "             (CASE WHEN tblplus.idTipo IN (19)               "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0  END) AS vrSubsidioCargoFijo,	        "
	                + "             (CASE WHEN  tblplus.idTipo IN (21)              "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrSubsidioConsumo,              "
	                + "             (CASE WHEN tblplus.idTipo IN (20,22)            "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "              ELSE 0 END) AS vrContribucion,                 "
	                + "			   (CASE WHEN tblplus.idTipo IN (20)    "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrContribucionCargoFijo,      "
	                + "			   (CASE WHEN tblplus.idTipo IN (22)    "
	                + "                THEN (tbldctosordenesdetalle.cantidad *      "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                ELSE 0 END) AS vrContribucionConsumo,        "
	                + "             (CASE WHEN tblplus.idTipo IN (19,20)            "
	                + "                    THEN (tblplus.vrCostoIND/100) ELSE 0     "
	                + "                              END) AS factorCargoFijoSf3,       "
	                + "             (CASE WHEN  tblplus.idTipo IN (21,22)           "
	                + "                    THEN (tblplus.vrCostoIND/100) ELSE 0     "
	                + "                            END) AS factorCargoConsumoSf3,      "
	                + "             (CASE WHEN  tblplus.idTipo IN (23)              "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "      tbldctosordenesdetalle.vrVentaUnitario)    "
	                + "                 ELSE 0 END) AS vrAjusteDecena,              "
	                + "              (CASE WHEN  tblplus.idTipo IN (123)            "
	                + "                 THEN (tbldctosordenesdetalle.cantidad *     "
	                + "       tbldctosordenesdetalle.vrVentaUnitario)   "
	                + "                 ELSE 0 END) AS vrDeudaAjusteDecena,        	"
	                + "             (CASE WHEN tblplus.idTipo IN (                  "
	                + "                    104, 105,106,108,109,110,111,113,114,    "
	                + "                    115, 116, 117, 118, 119,120,             "
	                + "                                  121,122,10,11,123)         "
	                + "              THEN (tbldctosordenesdetalle.cantidad *        "
	                + "      tbldctosordenesdetalle.vrVentaUnitario)    "
	                + "              ELSE 0 END) AS deudaAnterior                   "
	                + "   ,tbldctosperiodo.fechaInicial                  "
	                + "   ,tbldctosperiodo.fechaFinal                    "
	                + "   ,tbldctosperiodo.fechaSinRecargo               "
	                + "   ,tbldctosperiodo.fechaConRecargo               "
	                + "   ,tbldctosperiodo.nombrePeriodo                 "
	                + "  		 ,DATEDIFF(DAY,tbldctosperiodo.fechaInicial,    "
	                + "                 tbldctosperiodo.fechaFinal)     "
	                + "                                            AS diasFactura   "
	                + " 		 ,tbldctosordenesdetalle.idEstracto             "
	                + " 		 ,tbldctosordenesdetalle.idRuta                 "
	                + "     FROM         tbldctos                                   "
	                + "     INNER JOIN tbldctosordenesdetalle                       "
	                + "     ON tbldctos.IDLOCAL = tbldctosordenesdetalle.IDLOCAL    "
	                + "     AND tbldctos.IDTIPOORDEN =                              "
	                + "            tbldctosordenesdetalle.IDTIPOORDEN   "
	                + "     AND tbldctos.IDORDEN = tbldctosordenesdetalle.IDORDEN   "
	                + "     INNER JOIN tblplus                                      "
	                + "     ON tbldctosordenesdetalle.IDPLU =  tblplus.idPlu        "
	                + "     AND tbldctosordenesdetalle.idLocal = tblplus.idLocal    "
	                + "     INNER JOIN tbldctosperiodo                              "
	                + "     ON tbldctosperiodo.idPeriodo = tbldctos.idPeriodo       "
	                + "     AND tbldctosperiodo.idLocal = tbldctos.idLocal          "
	                + "     WHERE tbldctos.idLocal             =                    "
	                + "?1                                              "
	                + "     AND       tbldctos.idTipoOrden         = 29             "
	                + "     AND       tbldctos.idPeriodo           =                "
	                + "?3  ) AS tmpPRC                               "
	                + "     INNER JOIN tbllocales                                   "
	                + "     ON tbllocales.idLocal     =  tmpPRC.IDLOCAL             "
	                + "     INNER JOIN tblterceros                                  "
	                + "     ON tblterceros.idLocal    =  tmpPRC.IDLOCAL             "
	                + "     AND tblterceros.idCliente = tmpPRC.idCliente            "
	                + "     INNER JOIN tbldctosordenes                              "
	                + "     ON tbldctosordenes.idLocal =  tmpPRC.IDLOCAL            "
	                + "     AND tbldctosordenes.idTipoOrden = tmpPRC.idTipoOrden    "
	                + "     AND tbldctosordenes.idOrden    =tmpPRC.idOrden          "
	                + "     INNER JOIN tblterceroestracto                           "
	                + "     ON tblterceroestracto.idEstracto = tmpPRC.idEstracto    "
	                + "     AND tblterceroestracto.idLocal =  tmpPRC.idLocal        "
	                + "     INNER JOIN tbltercerosruta                              "
	                + "     ON tmpPRC.idRuta =  tbltercerosruta.idRuta              "
	                + "     AND tmpPRC.idLocal  = tbltercerosruta.idLocal           "
	                + "     INNER JOIN tbltercerossui                               "
	                + "     ON tmpPRC.idLocal = tbltercerossui.idLocal              "
	                + "     AND tmpPRC.idCliente =   tbltercerossui.idCliente       "
	                + "     INNER JOIN tblciudades                                  "
	                + "     ON tblciudades.idCiudad =  tblterceros.idDptoCiudad     "
	                + "     INNER JOIN                                              "
	                + "     (SELECT tbldctosordenesdetalle.IDLOCAL,                 "
	                + " tbldctosordenesdetalle.IDTIPOORDEN,             "
	                + "    	      tbldctosordenesdetalle.IDORDEN,                  "
	                + "    	      tbltipocausanota.nombreCausa                     "
	                + "      FROM     tbldctosordenes                               "
	                + "      INNER JOIN tbldctosordenesdetalle                      "
	                + "      ON tbldctosordenes.IDLOCAL =                           "
	                + "                tbldctosordenesdetalle.IDLOCAL   "
	                + "      AND tbldctosordenes.IDTIPOORDEN =                      "
	                + "            tbldctosordenesdetalle.IDTIPOORDEN   "
	                + "      AND  tbldctosordenes.IDORDEN =                         "
	                + "                tbldctosordenesdetalle.IDORDEN   "
	                + "      INNER JOIN tbltipocausanota                            "
	                + "      ON tbltipocausanota.idCausa =                          "
	                + "       tbldctosordenesdetalle.idNovedadLectura   "
	                + "      WHERE tbldctosordenesdetalle.IDLOCAL   =               "
	                + "?1                                              "
	                + "     AND tbldctosordenesdetalle.IDTIPOORDEN =                "
	                + "?2                                          "
	                + "     AND tbldctosordenes.IDPERIODO          =                "
	                + "?3                                           "
	                + "     AND tbldctosordenesdetalle.IDTIPO      = 4              "
	                + "     AND tbldctosordenesdetalle.STRIDLISTA  = 1              "
	                + "     AND tbltipocausanota.idTipoTabla       = 2)             "
	                + "                                  AS tmpFRA                  "
	                + "     ON tmpFRA.IDLOCAL=tmpPRC.IDLOCAL                        "
	                + "     AND tmpFRA.IDTIPOORDEN = tmpPRC.idTipoOrden             "
	                + "     AND tmpFRA.IDORDEN=tmpPRC.idOrden                       "
	                + "     INNER JOIN tblmedidores                                 "
	                + "     ON tblmedidores.idLocal =tblterceros.IDLOCAL            "
	                + "     AND tblmedidores.idMedidor =  tblterceros.idMedidor     "
	                + "     INNER JOIN                                              "
	                + "     (SELECT tbldctosordenesdetalle.IDLOCAL,                 "
	                + " tbldctosordenesdetalle.IDTIPOORDEN,             "
	                + " tbldctosordenesdetalle.IDORDEN,                 "
	                + "		tbldctosordenes.estado,                         "
	                + " tbltipocausanota.nombreCausa,                   "
	                + "		tbldctosordenesdetalle.idNovedadLectura         "
	                + "      FROM     tbldctosordenes                               "
	                + "      INNER JOIN tbldctosordenesdetalle                      "
	                + "      ON tbldctosordenes.IDLOCAL =                           "
	                + "                tbldctosordenesdetalle.IDLOCAL   "
	                + "      AND tbldctosordenes.IDTIPOORDEN =                      "
	                + "            tbldctosordenesdetalle.IDTIPOORDEN   "
	                + "      AND tbldctosordenes.IDORDEN =                          "
	                + "                tbldctosordenesdetalle.IDORDEN   "
	                + "      INNER JOIN tbltipocausanota                            "
	                + "      ON tbltipocausanota.idCausa =  tbldctosordenes.estado  "
	                + "      WHERE tbldctosordenesdetalle.IDLOCAL   =               "
	                + "?1                                             "
	                + "      AND tbldctosordenesdetalle.IDTIPOORDEN =               "
	                + "?2                                          "
	                + "      AND tbldctosordenes.IDPERIODO          =               "
	                + "?3                                           "
	                + "      AND tbldctosordenesdetalle.IDTIPO      = 4             "
	                + "      AND tbldctosordenesdetalle.STRIDLISTA  = 1             "
	                + "      AND tbltipocausanota.idTipoTabla       = 3) AS tmpCAU  "
	                + "	ON tmpCAU.IDLOCAL=tmpPRC.IDLOCAL                        "
	                + "     AND tmpCAU.IDTIPOORDEN = tmpPRC.idTipoOrden             "
	                + "     AND tmpCAU.IDORDEN=tmpPRC.idOrden                       "
	                + "     INNER JOIN                                              "
	                + "     (SELECT tblterceros.idLocal,                            "
	                + " 	        tblterceros.idCliente,                          "
	                + " tblterceros.nombreTercero                       "
	                + "      FROM tblterceros                                       "
	                + "      WHERE tblterceros.idLocal   =                          "
	                + "?1  ) AS tmpFACT                                "
	                + " 	ON  tmpFACT.idLocal =  tmpPRC.idLocal                   "
	                + " 	AND  tmpFACT.idCliente =  tmpPRC.idCliente              "
	                + "     WHERE     tmpPRC.idLocal         =                      "
	                + "?1                                              "
	                + "     AND       tmpPRC.idTipoOrden     =                      "
	                + "?2                                          "
	                + "     AND       tmpPRC.idPeriodo       =                      "
	                + "?3                                            "
	                + "     AND tblterceroestracto.idServicio in (1,2,3)            "
	                + "     AND tmpCAU.ESTADO =1                                    "
	                + "     GROUP BY tmpPRC.idLocal,                                "
	                + "tmpPRC.idTipoOrden,                              "
	                + "tmpPRC.idOrden,                                  "
	                + "tmpPRC.idDcto,                                   "
	                + "tmpPRC.idPeriodo,                                "
	                + "tmpPRC.idCliente                                 "
	                + ",tmpPRC.fechaInicial                              "
	                + ",tmpPRC.fechaFinal                                "
	                + ",tmpPRC.fechaSinRecargo                           "
	                + ",tmpPRC.fechaConRecargo                           "
	                + ",tmpPRC.nombrePeriodo                             "
	                + "     ORDER BY idRuta,ordenRuta",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDetalleDeuda( int idLocal, int IdTipoOrden, int idPeriodo, int xIdPeriodoAnterior);
		  
		  
		  
		  
		  @Query( value = "SELECT MAX(idContrato)      "
	                + "              AS idContrato "
	                + "FROM tblDctosOrdenes        "
	                + "WHERE idLocal =             " 
	                + "?1             "
	                + "AND idTipoOrden =      ?2     ",
	                nativeQuery = true)
		  Integer maximaIdContratoNE(int IDLOCAL, int idTipoOrden);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "INSERT INTO tbldctosordenes (idLocal, "
	                + "                      idTipoOrden,    "
	                + "                      idOrden,        "
	                + "                      fechaOrden,     "
	                + "                      estado,         "
	                + "                      idCliente,      "
	                + "                      idUsuario,      "
	                + "                      idOrigen,       "
	                + "                      idLog,          "
	                + "                      tipoDcto,       "
	                + "                      email,          "
	                + "                      formaPago,      "
	                + "                      diasHistoria,   "
	                + "                      diasInventario, "
	                + "                      observacion,    "
	                + "                      idRazon,        "
	                + "                      idPeriodo,      "
	                
	                + "                      idContrato, "
	                + "                      fechaInicioContrato,   "
	                
	                + "                      fechaFinContrato, "
	                + "                      vrSalarioBasico, "
	                
	                + "                vrSubsidioTransporte, "
	                + "                             idMedio, "
	                
	                + "                        entidadMedio, "
	                + "                      cuentaMedio)    "
	                + "VALUES (?1,"
	                + "?2,"
	                + "?3,"
	                + "?4,"
	                + "?5,"
	                + "?6,"
	                + "?7,"
	                + "?8,"
	                + "?9,"	                
	                + "?10,"
	                + "?11,"
	                + "?12,"
	                + "?13,"
	                + "?14,"
	                + "?15,"
	                + "?16,"
	                + "?17,"
	                
	                + "?18,"
	                + "?19,"
	                
	                + "?20, "	                
	                + "?21, "
	                
	                + "?22,"
	                + "?23,"
	                
	                + "?24,"               
	                + "?25)", nativeQuery = true)
		  public void ingresaDctosOrdenNE(int idLocal, int IdTipoOrden, int IdOrden, String strFechaVisita, int Estado, String IdCliente, int IdUsuario, int IdOrigen, int IdLog, 
				  String TipoDcto, String Email, String FormaPago, int DiasHistoria, int DiasInventario, String Observacion, int IdRazon, int IdPeriodo, int idContrato, String fechaInicioContrato, 
				  String fechaFinContrato, Double vrSalarioBasico, Double vrSubsidioTransporte, int idMedio, String entidadMedio, String cuentaMedio);
		  
		  

		  
		  @Modifying
		  @Transactional
		  @Query(value = " UPDATE tbldctosordenes                  "
	                + " SET  fechaInicioContrato  =           "
	                + "?1, "
	                + "     fechaFinContrato     =            "
	                + "?2,    "
	                + "      vrSalarioBasico      =           "
	                + "?3 ,              "
	                + "      vrSubsidioTransporte =  	  "
	                + "?4 ,          "
	                + "                   idMedio =  	  "
	                + "?5,                       "
	                + "      entidadMedio =  	         "
	                + "?6,                 "
	                + "      cuentaMedio =  	         "
	                + "?7                   "
	                + " FROM tbldctosordenes                  "
	                + " WHERE EXISTS ( SELECT *               "
	                + " FROM tbldctosordenesdetalle           "
	                + " WHERE tbldctosordenes.IDLOCAL       = "
	                + "       tbldctosordenesdetalle.IDLOCAL  "
	                + " AND tbldctosordenes.IDTIPOORDEN =     "
	                + "   tbldctosordenesdetalle.IDTIPOORDEN  "
	                + " AND tbldctosordenes.IDORDEN      =    "
	                + "     tbldctosordenesdetalle.IDORDEN  ) "
	                + " AND tbldctosordenes.IDLOCAL      =    "
	                + "?8                        "
	                + " AND  tbldctosordenes.IDTIPOORDEN =    "
	                + "?9                    "
	                + " AND  tbldctosordenes.idOrden     =   ?10  ",
	                nativeQuery = true)
		  public void modificaOrdenNE(String FechaInicioContrato, String FechaFinContrato, Double VrSalarioBasico, Double VrSubsidioTransporte, int IdMedio, String EntidadMedio, String CuentaMedio, 
				                       int idLocal, int IdTipoOrden, int idOrden);
		  
		  
		  
		  
		  @Query( value = "SELECT tbldctosordenes.idLocal,           "
	                + "       tbldctosordenes.idTipoOrden,       "
	                + "       tbldctosordenes.idOrden,           "
	                + "       tbldctosordenes.fechaOrden,        "
	                + "       tbldctosordenes.estado,            "
	                + "       tbldctosordenes.idCliente,         "
	                + "       tbldctosordenes.idUsuario,         "
	                + "       tbldctosordenes.idOrigen,          "
	                + "       tbldctosordenes.idLog,             "
	                + "       tbldctosordenes.fechaEntrega,      "
	                + "       tbldctosordenes.tipoDcto,          "
	                + "       tbldctosordenes.direccionDespacho, "
	                + "       tbldctosordenes.email,             "
	                + "       tbldctosordenes.fax,               "
	                + "       tbldctosordenes.contacto,          "
	                + "       tbldctosordenes.observacion,       "
	                + "       tbldctosordenes.ciudadDespacho,    "
	                + "       tbldctosordenes.formaPago,         "
	                + "       tbldctosordenes.ordenCompra,       "
	                + "       tbldctosordenes.descuentoComercial,"
	                + "       tbldctosordenes.impuestoVenta,     "
	                + "       tbldctosordenes.idRazon,           "
	                + "       tbldctosordenes.idEstadoTx,        "
	                + "       tbldctosordenes.idTipoTx,          "
	                + "       tbldctosordenes.numeroOrden,       "
	                + "       tbldctosordenes.idResponsable,     "
	                + "       tbldctosordenes.diasHistoria,      "
	                + "       tbldctosordenes.diasInventario     "
	                + "FROM tbldctosordenes                      "
	                + "WHERE tbldctosordenes.idLog       =       "
	                + "?1                             "
	                + "AND   tbldctosordenes.idTipoOrden =       "
	                + "?2                       "
	                + "AND   tbldctosordenes.idLocal     =   ?3    ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaDctoOrdenLog(int idlog, int idTipoOrden, int idLocal);
		  
		  
		  
		  @Query( value = " SELECT tblDctosOrdenes.idLocal,            "
	                + "   tblDctosOrdenes.idTipoOrden,             "
	                + "   tblDctosOrdenes.idOrden,                 "
	                + "   tblDctosOrdenes.idLog,                   "
	                + "   MAX(tblDctosOrdenes.idCliente)           "
	                + "                            AS idCliente,   "
	                + "   MAX(tblDctosOrdenes.fechaOrden)          "
	                + "                             AS fechaOrden, "
	                + "   MAX(tblDctosOrdenes.fechaInicioContrato) "
	                + "           AS fechaInicioContrato,          "
	                + "   MAX(tblDctosOrdenes.vrSalarioBasico)     "
	                + "                AS vrSalarioBasico,         "
	                + " MAX(tblDctosOrdenes.vrSubsidioTransporte)  "
	                + "            AS vrSubsidioTransporte,	       "
	                + "   SUM(tmpTOT.vrDevengado) AS vrDevengado,  "
	                + "   SUM(tmpTOT.vrDeducido) AS vrDeducido     "
	                + "  FROM tblDctosOrdenes                      "
	                + "  INNER JOIN tblAgendaLogVisitas            "
	                + "  ON tblDctosOrdenes.idLocal =              "
	                + "             tblAgendaLogVisitas.idLocal    "
	                + "  AND tblDctosOrdenes.idLog =               "
	                + "               tblAgendaLogVisitas.idLog    "
	                + "  LEFT JOIN (                               "
	                + "    SELECT tblDctosOrdenesDetalle.idLocal,  "
	                + "    tblDctosOrdenesDetalle.idTipoOrden,     "
	                + "    tblDctosOrdenesDetalle.idOrden,         "
	                + "  CASE                                      "
	                + "   WHEN tblPlus.idCategoria IN (1400) THEN  "
	                + " (tblDctosOrdenesDetalle.vrVentaUnitario)   "
	                + "   ELSE 0                                   "
	                + "  END AS vrDevengado,                       "
	                + "  CASE                                      "
	                + "   WHEN tblPlus.idCategoria IN (1800) THEN  "
	                + "   (tblDctosOrdenesDetalle.vrVentaUnitario) "
	                + "     ELSE 0                                 "
	                + "  END AS vrDeducido                         "
	                + "      FROM tblDctosOrdenesDetalle           "
	                + "  INNER JOIN tblDctosOrdenes                "
	                + "  ON tblDctosOrdenes.idLocal        =       "
	                + "            tblDctosOrdenesDetalle.idLocal  "
	                + "  AND tblDctosOrdenes.idTipoOrden     =     "
	                + "        tblDctosOrdenesDetalle.idTipoOrden  "
	                + "  AND tblDctosOrdenes.idOrden     =         "
	                + "           tblDctosOrdenesDetalle.idOrden   "
	                + "  INNER JOIN tblPlus                        "
	                + "  ON tblPlus.idLocal               =        "
	                + "            tblDctosOrdenesDetalle.idLocal  "
	                + "  AND tblPlus.idPlu                =        "
	                + "             tblDctosOrdenesDetalle.idPlu   "
	                + "  WHERE tblDctosOrdenes.idLocal    =        "
	                + "?1 ) AS tmpTOT                 "
	                + "    ON tblDctosOrdenes.idLocal =            "
	                + "                             tmpTOT.idLocal "
	                + "    AND tblDctosOrdenes.idTipoOrden   =     "
	                + "             tmpTOT.idTipoOrden             "
	                + "    AND tblDctosOrdenes.idOrden       =     "
	                + "                 tmpTOT.idOrden             "
	                + "    INNER JOIN tblTerceros                  "
	                + "    ON tblTerceros.idLocal            =     "
	                + "                 tblDctosOrdenes.idLocal    "
	                + "    AND tblTerceros.idCliente         =     "
	                + "               tblDctosOrdenes.idCliente    "
	                + "   WHERE tblDctosOrdenes.idLocal   =        "
	                + "?1                             "
	                + "   AND tblTerceros.idCliente       =        "
	                + "?2                          "
	                + "   AND tblAgendaLogVisitas.estado  = 9      "
	                + "   AND tblTerceros.idTipoTercero   = 3      "
	                + "   AND tblDctosOrdenes.idLog       =        "
	                + "?3                                          "
	                + " GROUP BY  tblDctosOrdenes.idLocal,         "
	                + "           tblDctosOrdenes.idTipoOrden,     "
	                + "           tblDctosOrdenes.idOrden,         "
	                + "           tblDctosOrdenes.idLog ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaPagoFCH(int idLocal, String idCliente, int idlog);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = " INSERT INTO tblDctosOrdenes   "
	                + "  (IDLOCAL                   "
	                + "  ,IDTIPOORDEN               "
	                + "  ,IDORDEN                   "
	                + "  ,FECHAORDEN                "
	                + "  ,ESTADO                    "
	                + "  ,idCliente                 "
	                + "  ,IDUSUARIO                 "
	                + "  ,IDORIGEN                  "
	                + "  ,IDLOG                     "
	                + "  ,FECHAENTREGA              "
	                + "  ,TIPODCTO                  "
	                + "  ,DIRECCIONDESPACHO         "
	                + "  ,EMAIL                     "
	                + "  ,FAX                       "
	                + "  ,CONTACTO                  "
	                + "  ,OBSERVACION               "
	                + "  ,CIUDADDESPACHO            "
	                + "  ,FORMAPAGO                 "
	                + "  ,ordenCompra               "
	                + "  ,descuentoComercial        "
	                + "  ,impuestoVenta             "
	                + "  ,idRazon                   "
	                + "  ,idEstadoTx                "
	                + "  ,idTipoTx                  "
	                + "  ,numeroOrden               "
	                + "  ,idResponsable             "
	                + "  ,diasHistoria              "
	                + "  ,diasInventario            "
	                + "  ,idBodegaOrigen            "
	                + "  ,idBodegaDestino           "
	                + "  ,idPeriodo                 "
	                + "  ,vrTotalDiferir            "
	                + "  ,cuotaDiferir              "
	                + "  ,porcentajeInteresADiferir "
	                + "  ,vrInteresADiferir         "
	                + "  ,comentario                "
	                + "  ,historiaConsumo           "
	                + "  ,promedio                  "
	                + "  ,cuotaVencida              "
	                + "  ,estadoCorte               "
	                + "  ,fechaPagoUltimo           "
	                + "  ,vrPagoUltimo              "
	                + "  ,promedioEstrato           "
	                + "  ,fechaInicioContrato       "
	                + "  ,vrSalarioBasico           "
	                + "  ,vrSubsidioTransporte      "                
	                + "  ,fechaFinContrato          "
	                + "  ,idContrato                "
	                + "  ,idMedio                   "      
	                + "  ,entidadMedio              "
	                + "  ,cuentaMedio)              "                    
	                + " SELECT IDLOCAL,             "
	                + "?1           "
	                + "           AS IDTIPOORDEN,   "
	                + "?2 AS idOrden    "
	                + "  ,FECHAORDEN                "
	                + "  ,ESTADO                    "
	                + "  ,idCliente                 "
	                + "  ,IDUSUARIO                 "
	                + "  ,IDORIGEN,                 "
	                + "?3 AS idLog        "
	                + "  ,FECHAENTREGA              "
	                + "  ,TIPODCTO                  "
	                + "  ,DIRECCIONDESPACHO         "
	                + "  ,EMAIL                     "
	                + "  ,FAX                       "
	                + "  ,CONTACTO                  "
	                + "  ,OBSERVACION               "
	                + "  ,CIUDADDESPACHO            "
	                + "  ,FORMAPAGO                 "
	                + "  ,ordenCompra               "
	                + "  ,descuentoComercial        "
	                + "  ,impuestoVenta             "
	                + "  ,idRazon                   "
	                + "  ,idEstadoTx                "
	                + "  ,idTipoTx                  "
	                + "  ,numeroOrden               "
	                + "  ,idResponsable             "
	                + "  ,diasHistoria              "
	                + "  ,diasInventario            "
	                + "  ,idBodegaOrigen            "
	                + "  ,idBodegaDestino           "
	                + "  ,idPeriodo                 "
	                + "  ,vrTotalDiferir            "
	                + "  ,cuotaDiferir              "
	                + "  ,porcentajeInteresADiferir "
	                + "  ,vrInteresADiferir         "
	                + "  ,comentario                "
	                + "  ,historiaConsumo           "
	                + "  ,promedio                  "
	                + "  ,cuotaVencida              "
	                + "  ,estadoCorte               "
	                + "  ,fechaPagoUltimo           "
	                + "  ,vrPagoUltimo              "
	                + "  ,promedioEstrato           "
	                + "  ,fechaInicioContrato       "
	                + "  ,vrSalarioBasico           "
	                + "  ,vrSubsidioTransporte      "                
	                + "  ,fechaFinContrato,         "
	                + "?4 AS idContrato "
	                + "  ,idMedio                   "      
	                + "  ,entidadMedio              "
	                + "  ,cuentaMedio               "               
	                + "FROM tblDctosOrdenes         "
	                + "   WHERE idlocal    =        "
	                + "?5              "
	                + "   AND   idTipoOrden=        "
	                + "?6          "
	                + "   AND   idOrden    =    ?7    ",
	                nativeQuery = true)
		  public void ingresaDctosPagoNE(int xIdTipoOrdenTmp, int xIdOrdenTmp, int xIdLogTmp, int xIdContrato, int idLocal, int IdTipoOrden, int idOrden);
		  
		  
		  
		  
		  @Query( value = " SELECT   tblDctosOrdenes.idLocal,            "
	                + "  tblDctosOrdenes.idTipoOrden,              "
	                + "  tblDctosOrdenes.idOrden,                  "
	                + "  tblDctos.idDcto,                          "
	                + "  MAX(tblDctosOrdenes.idCliente)            "
	                + "               AS idCliente,                "
	                + "  MAX(tblDctosOrdenes.fechaInicioContrato)  "
	                + "          AS fechaInicioContrato,   	       "
	                + "  MAX(tblDctosOrdenes.fechaFinContrato)     "
	                + "                   AS fechaFinContrato,     "
	                + "  MAX(tblDctosOrdenes.vrSalarioBasico)      "
	                + "               AS vrSalarioBasico,          "
	                + "  MAX(tblDctosOrdenes.vrSubsidioTransporte) "
	                + "           AS vrSubsidioTransporte,	       "
	                + "  SUM(tmpTOT.vrDevengado)                   "
	                + "          AS vrDevengado,  	               "
	                + "  SUM(tmpTOT.vrDeducido)                    "
	                + "           AS vrDeducido                    "
	                + "  ,MAX(tblDctosOrdenes.idContrato)          "
	                + "                  AS idContrato             "
	                + "  ,MAX(tblDctosOrdenes.idMedio)             "
	                + "                      AS idMedio            "
	                + "  ,MAX(tblDctosOrdenes.entidadMedio)        "
	                + "                     AS entidadMedio        "
	                + "  ,MAX(tblDctosOrdenes.cuentaMedio)         "
	                + "                       AS cuentaMedio       "
	                + "  ,MAX(tblTerceros.nombreTercero)           "
	                + "                      AS nombreTercero      "
	                + "  ,MAX(tblDctos.fechaDcto) AS fechaPago     "
	                + "  ,MAX(tblDctos.envioFE)  AS envioFE        "
	                + "  ,MAX(tblDctos.cufe)  AS cufe              "    
	                + " FROM tblDctos                              "
	                + " INNER JOIN tblDctosOrdenes                 "
	                + " ON   tblDctosOrdenes.idLocal     =         "
	                + "               tblDctos.idLocal             "
	                + " AND tblDctosOrdenes.idTipoOrden=           "
	                + "           tblDctos.idTipoOrden             "
	                + " AND tblDctosOrdenes.idOrden    =           "
	                + "               tblDctos.idOrden             "
	                + " INNER JOIN tblTerceros                     "
	                + " ON tblTerceros.idLocal     =               "
	                + "               tblDctosOrdenes.idLocal      "
	                + " AND tblTerceros.idCliente      =           "
	                + "            tblDctosOrdenes.idCliente       "
	                + "  INNER JOIN (                              "
	                + "   SELECT tblDctosOrdenesDetalle.idLocal,   "
	                + "   tblDctosOrdenesDetalle.idTipoOrden,      "
	                + "   tblDctosOrdenesDetalle.idOrden,          "
	                + "   CASE                                     "
	                + "  WHEN tblPlus.idCategoria IN (1400) THEN   "
	                + "   (tblDctosOrdenesDetalle.vrVentaUnitario) "
	                + "  ELSE 0                                    "
	                + "  END AS vrDevengado,                       "
	                + "  CASE                                      "
	                + "  WHEN tblPlus.idCategoria IN (1800) THEN   "
	                + "   (tblDctosOrdenesDetalle.vrVentaUnitario) "
	                + "  ELSE 0                                    "
	                + "  END AS vrDeducido                         "
	                + "   FROM tblDctosOrdenesDetalle              "
	                + " INNER JOIN tblDctosOrdenes                 "
	                + " ON tblDctosOrdenes.idLocal        =        "
	                + "            tblDctosOrdenesDetalle.idLocal  "
	                + " AND tblDctosOrdenes.idTipoOrden     =      "
	                + "        tblDctosOrdenesDetalle.idTipoOrden  "
	                + " AND tblDctosOrdenes.idOrden     =          "
	                + "           tblDctosOrdenesDetalle.idOrden   "
	                + " INNER JOIN tblPlus                         "
	                + " ON tblPlus.idLocal               =         "
	                + "            tblDctosOrdenesDetalle.idLocal  "
	                + " AND tblPlus.idPlu                =         "
	                + "           tblDctosOrdenesDetalle.idPlu )   "
	                + " 			           AS tmpTOT   "
	                + "    ON tblDctosOrdenes.idLocal        =     "
	                + "                 tmpTOT.idLocal             "
	                + "    AND tblDctosOrdenes.idTipoOrden   =     "
	                + "             tmpTOT.idTipoOrden             "
	                + "    AND tblDctosOrdenes.idOrden       =     "
	                + "                 tmpTOT.idOrden             "
	                + "    WHERE tblDctosOrdenes.idlocal     =     "
	                + "?1                             "
	                + "   AND tblDctosOrdenes.idTipoOrden    =     "
	                + "?2                         "
	                + "   AND tblDctos.fechaDcto             =     "
	                + "?3                 "
	                + "   AND tblTerceros.idTipoTercero      =   3 "
	                + "   GROUP BY tblDctosOrdenes.idLocal,        "
	                + "          tblDctosOrdenes.idTipoOrden,      "
	                + " 		 tblDctosOrdenes.idOrden,      "
	                + "              tblDctos.idDcto               "
	                + " ORDER BY 16 ",
	                nativeQuery = true)
		  List<TblDctosOrdenesDTO> listaPagoNEAll(int idLocal, int idtipoOrden, String FechaPago);
		  
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = " INSERT INTO tblDctosOrdenes    "
	                + "   (IDLOCAL                   "
	                + "   ,IDTIPOORDEN               "
	                + "   ,IDORDEN                   "
	                + "   ,FECHAORDEN                "
	                + "   ,ESTADO                    "
	                + "   ,idCliente                 "
	                + "   ,IDUSUARIO                 "
	                + "   ,IDORIGEN                  "
	                + "   ,IDLOG                     "
	                + "   ,FECHAENTREGA              "
	                + "   ,TIPODCTO                  "
	                + "   ,DIRECCIONDESPACHO         "
	                + "   ,EMAIL                     "
	                + "   ,FAX                       "
	                + "   ,CONTACTO                  "
	                + "   ,OBSERVACION               "
	                + "   ,CIUDADDESPACHO            "
	                + "   ,FORMAPAGO                 "
	                + "   ,ordenCompra               "
	                + "   ,descuentoComercial        "
	                + "   ,impuestoVenta             "
	                + "   ,idRazon                   "
	                + "   ,idEstadoTx                "
	                + "   ,idTipoTx                  "
	                + "   ,numeroOrden               "
	                + "   ,idResponsable             "
	                + "   ,diasHistoria              "
	                + "   ,diasInventario            "
	                + "   ,idBodegaOrigen            "
	                + "   ,idBodegaDestino           "
	                + "   ,idPeriodo                 "
	                + "   ,vrTotalDiferir            "
	                + "   ,cuotaDiferir              "
	                + "   ,porcentajeInteresADiferir "
	                + "   ,vrInteresADiferir         "
	                + "   ,comentario                "
	                + "   ,historiaConsumo           "
	                + "   ,promedio                  "
	                + "   ,cuotaVencida              "
	                + "   ,estadoCorte               "
	                + "   ,fechaPagoUltimo           "
	                + "   ,vrPagoUltimo              "
	                + "   ,promedioEstrato           "
	                + "   ,fechaInicioContrato       "
	                + "   ,vrSalarioBasico           "
	                + "   ,vrSubsidioTransporte)     "
	                + " SELECT IDLOCAL,              "
	                + "?1 AS            "
	                + "   IDTIPOORDEN                "
	                + "  ,IDORDEN                    "
	                + "  ,FECHAORDEN                 "
	                + "  ,ESTADO                     "
	                + "  ,idCliente                  "
	                + "  ,IDUSUARIO                  "
	                + "  ,IDORIGEN                   "
	                + "  ,IDLOG                      "
	                + "  ,FECHAENTREGA               "
	                + "  ,TIPODCTO                   "
	                + "  ,DIRECCIONDESPACHO          "
	                + "  ,EMAIL                      "
	                + "  ,FAX                        "
	                + "  ,CONTACTO                   "
	                + "  ,OBSERVACION                "
	                + "  ,CIUDADDESPACHO             "
	                + "  ,FORMAPAGO                  "
	                + "  ,ordenCompra                "
	                + "  ,descuentoComercial         "
	                + "  ,impuestoVenta              "
	                + "  ,idRazon                    "
	                + "  ,idEstadoTx                 "
	                + "  ,idTipoTx                   "
	                + "  ,numeroOrden                "
	                + "  ,idResponsable              "
	                + "  ,diasHistoria               "
	                + "  ,diasInventario             "
	                + "  ,idBodegaOrigen             "
	                + "  ,idBodegaDestino            "
	                + "  ,?5                         "
	                + "  ,vrTotalDiferir             "
	                + "  ,cuotaDiferir               "
	                + "  ,porcentajeInteresADiferir  "
	                + "  ,vrInteresADiferir          "
	                + "  ,comentario                 "
	                + "  ,historiaConsumo            "
	                + "  ,promedio                   "
	                + "  ,cuotaVencida               "
	                + "  ,estadoCorte                "
	                + "  ,fechaPagoUltimo            "
	                + "  ,vrPagoUltimo               "
	                + "  ,promedioEstrato            "
	                + "  ,fechaInicioContrato        "
	                + "  ,vrSalarioBasico            "
	                + "  ,vrSubsidioTransporte       "
	                + "FROM tblDctosOrdenes          "
	                + "   WHERE idLocal  =           "
	                + "?2               "
	                + "   AND idTipoOrden=           "
	                + "?3           "
	                + "   AND idOrden    =    ?4       ",
	                nativeQuery = true)
		  public void ingresaNE(int xIdTipoOrden, int idLocal, int IdTipoOrden, int idOrden, int idPeriodo);
		  
		  
		  
		  @Modifying
		  @Transactional
		  @Query(value = "UPDATE tbldctosordenes            "
	                + "SET tbldctosordenes.idPeriodo = "
	                + "?1               "
	                + "WHERE tbldctosordenes.idLocal = "
	                + "?2                 "
	                + "AND tbldctosordenes.idTipoOrden = "
	                + "?3             "
	                + "AND   tbldctosordenes.idLog   = ?4 ",
	                nativeQuery = true)
		  public void actualizaPeriodo(int idPeriodo, int idLocal, int IdTipoOrden, int idLog);

		  
		  @Query( value = "    SELECT tbldctosordenes.idPeriodo,                                             "
		            + "           MAX(tbldctosperiodo.nombrePeriodo) AS nombrePeriodo,                   "
		            + "           MAX(tbldctosordenesdetalle.lecturaMedidor) AS lecturaMedidor ,         "
		            + "           SUM(tbldctosordenesdetalle.CANTIDAD)                                   "
		            + "    			                AS cantidad,                                         "
		            + "           MAX(tbldctosordenes.promedio) AS promedio,                             "
					+ "		   MAX(tbldctosordenesdetalle.idCliente) AS idCliente ,                      "
		            + "           MAX(tbldctosordenes.promedioEstrato) AS promedioEstrato                "
		            + "     FROM       tbldctosordenes                                                   "
		            + "     INNER JOIN tbldctosordenesdetalle                                            "
		            + "     ON tbldctosordenes.IDLOCAL  = tbldctosordenesdetalle.IDLOCAL                 "
		            + "     AND tbldctosordenes.IDTIPOORDEN   = tbldctosordenesdetalle.IDTIPOORDEN       "
		            + "     AND tbldctosordenes.IDORDEN = tbldctosordenesdetalle.IDORDEN                 "
		            + "     INNER JOIN tbldctosperiodo                                                   "
		            + "     ON tbldctosordenes.IDLOCAL  = tbldctosperiodo.IDLOCAL                        "
		            + "     AND tbldctosordenes.idPeriodo  = tbldctosperiodo.idPeriodo                   "
		            + "     WHERE tbldctosordenes.IDLOCAL                 =  ?1                           "         
		            + "     AND tbldctosordenes.idCliente                 =  ?2                          "             
		            + "     AND tbldctosordenesdetalle.IDTIPO  = 4                                       "
		            + "     AND tbldctosordenes.idPeriodo !=0                                            "
		            + "     GROUP BY tbldctosordenes.idPeriodo                                           "
		            + "     ORDER BY idPeriodo desc                                                      ",
                    nativeQuery = true)
             List<TblDctosOrdenesDTO> listaLecturaSuscriptor(int idLocal, String idCliente);
		  
		  
		  
		  
}







